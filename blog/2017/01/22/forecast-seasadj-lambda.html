      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Does seasonally adjusting first help forecasting?</title>
      	
         
         
            <meta name ="description" content ="I test some forecasting models on nearly 3,000 seasonal timeseries to see if it's better to seasonally adjust first or to incorporate the seasonality into the model used for forecasting.  Turns out it is marginally better to seasonally adjust beforehand when using an ARIMA model and it doesn't matter with exponential smoothing state space models.  Automated use of Box-Cox transformations also makes forecasts with these test series slightly worse.  The average effects were very small, and dwarfed by different performance on different domains and frequency of data.">
            <meta property="og:description" content ="I test some forecasting models on nearly 3,000 seasonal timeseries to see if it's better to seasonally adjust first or to incorporate the seasonality into the model used for forecasting.  Turns out it is marginally better to seasonally adjust beforehand when using an ARIMA model and it doesn't matter with exponential smoothing state space models.  Automated use of Box-Cox transformations also makes forecasts with these test series slightly worse.  The average effects were very small, and dwarfed by different performance on different domains and frequency of data.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Does seasonally adjusting first help forecasting?" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0079-lmer-results.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2017/01/22/forecast-seasadj-lambda.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
	        <!--	  <li><a href="/blog/most-popular.html">ordered by popularity</a></li> -->
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/pacific.html">all posts with data about Pacific island countries and territories</a></li>
                  <li><a href="/blog/nz.html">all posts with data about New Zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2026/02/18/pacific-diaspora>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Does seasonally adjusting first help forecasting?</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I test some forecasting models on nearly 3,000 seasonal timeseries to see if it's better to seasonally adjust first or to incorporate the seasonality into the model used for forecasting.  Turns out it is marginally better to seasonally adjust beforehand when using an ARIMA model and it doesn't matter with exponential smoothing state space models.  Automated use of Box-Cox transformations also makes forecasts with these test series slightly worse.  The average effects were very small, and dwarfed by different performance on different domains and frequency of data.</p>
	   <p class="meta">22 Jan 2017</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="the-experiment">The experiment</h2>
<p>A colleague at work was working with a time series where one got quite different results depending on whether one seasonally adjusted it first, or treated the seasonality as part of a SARIMA (seasonal auto-regressive integrated moving average)  model.  I have some theories about why this might have happened which I won’t go into in this post.  Instead, I’m going to report back on an experiment with the purpose of determining, empirically, if either of these strategies dominates the other or at least is better on average.</p>

<p>To do this I took all the quarterly and monthly time series from the <a href="https://forecasters.org/resources/time-series-data/m3-competition/">M3</a> and the <a href="http://robjhyndman.com/papers/the-tourism-forecasting-competition/">Tourism</a> forecasting competition data collections, available in the <a href="https://CRAN.R-project.org/package=Mcomp">Mcomp</a> and <a href="https://CRAN.R-project.org/package=Mcomp">Tcomp</a> R packages.  This is 2,977 data series in total.  I developed forecasts with eight different methods for the training set of each of these time series - the combinations of:</p>

<ul>
  <li>(S)ARIMA and exponential smoothing state space (using <code class="language-plaintext highlighter-rouge">auto.arima</code> and <code class="language-plaintext highlighter-rouge">ets</code> from Hyndman’s <code class="language-plaintext highlighter-rouge">forecast</code> package);</li>
  <li>with and without a Box-Cox transformation;</li>
  <li>seasonally adjusting before modelling and incorporating seasonality into the model.</li>
</ul>

<p>I then compared the predictions of the models against the official test sets and calculated the mean absolute scaled error (MASE) with the <code class="language-plaintext highlighter-rouge">accuracy</code> function from <code class="language-plaintext highlighter-rouge">forecast</code>.  The forecasting horizons were 8 periods for the quarterly data, 18 periods for the M3 monthly data, and 24 periods for the tourism monthly data.</p>

<p>For the seasonal adjustment prior to modelling I made use of the <a href="https://www.rdocumentation.org/packages/forecast/versions/7.3/topics/forecast.stl"><code class="language-plaintext highlighter-rouge">stlm</code> function</a> in the <code class="language-plaintext highlighter-rouge">forecast</code> package for which “forecasts of STL objects are obtained by applying a non-seasonal forecasting method to the seasonally adjusted data and re-seasonalizing using the last year of the seasonal component.”</p>

<p>I was interested in the impact of a Box-Cox transformation on forecasting accuracy in its own right, but also particularly in its interaction with seasonal adjustment.  I had a sort of working hypothesis that modelling untransformed data that isn’t second-order stationary is made harder by seasonality.  My intuition there was that if (as is common with untransformed data) the variance of a time series increases as its mean increases, the seasonality may magnify this effect, giving even more inappropriate weight than otherwise to parts of the time series with a higher mean value.  This would suggest that, with ARIMA models that rely on second-order stationarity, it would be helpful to do at least one of a Box-Cox transformation or seasonal adjustment before fitting the model.  <em>spoiler - the results aren’t completely consistent with this; seasonal adjustment helps, but Box-Cox transformations don’t seem to</em>.</p>

<p>For the models that included an automated Box-Cox transformation, the value of lambda for the transformation was chosen by Guerrero’s method implemented in <code class="language-plaintext highlighter-rouge">forecast::BoxCox.lambda</code>, but constrained to be between 0 and 1 (or 0.5 and 1.0 if the data included values of zero, which tended to result in very erratic forecasts when values of lambda were below 0.5).</p>

<h2 id="results">Results</h2>

<p>Here’s an example of how the results look for just one of the collections of data; quarterly time series from the M3 data collection.  Each point on the plot below is a single data series.  The horizontal axes show the error from the forecasts that incorporate seasonality into the models; the vertical axes show the same for when the series were seasonally adjusted before the modelling.  The diagonal line shows equality - where a point would be if the two methods gave equally accurate forecasts:</p>

<p><img src="/img/0079-m-results-quarterly-2.svg" alt="mq" /></p>

<p>Several things stand out:</p>

<ul>
  <li>The results are quite different.  For any individual data series, you might get much worse/better results with one of the methods rather than the other.  The differences can be quite substantial.</li>
  <li>On average there’s no really obvious trend.  The cloud of points is actually a little to the right and below the diagonal line, showing that errors are slightly lower when seasonal adjustment is done first, but not to the degree it’s obvious to the eye.</li>
  <li>The decision to Box-Cox transform or not first also doesn’t have any large, obvious overall average impact.  The two trend lines drawn through the cloud of points are practically identical.  This doesn’t mean the decision doesn’t matter for an individual series’ forecast, just that on average neither strategy is clearly better.</li>
</ul>

<p>Here are the overall results for all data collections in a graphic designed to show overall effects:</p>

<p><img src="/img/0079-all-boxplot.svg" alt="box" /></p>

<p>There’s not much to tell here!  For the ARIMA models (but not so much ETS), the blue boxes are a tiny bit to the left of the orange boxes, showing that on average the strategy of prior seasonally adjusting the series is a little better than incorporating seasonality into the forecasting model.</p>

<p>To quantify these results, I estimated a mixed-model with</p>

<ul>
  <li>Mean Absolute Scaled Error as the response term;</li>
  <li>modelling type, transformation type, and seasonal strategy as fixed explanatory effects of interest;</li>
  <li>data origin (M3 or Tourism) and frequency (quarterly or monthly) as fixed explanatory nuisance effects; and</li>
  <li>randomness at the level of data series, and of data series - strategy combination.</li>
</ul>

<p>Here’s the summary of the fixed effects for the simplest model:</p>

<table style="text-align:center"><tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td><em>Dependent variable:</em></td></tr>
<tr><td></td><td colspan="1" style="border-bottom: 1px solid black"></td></tr>
<tr><td style="text-align:left"></td><td>mase</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">modelETS</td><td>-0.013<sup>**</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.005)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">transformNone</td><td>-0.032<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.005)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">seasadjSeasonally adjusted first</td><td>-0.027<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.005)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">frequencyquarterly</td><td>0.238<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.031)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">collectionTourism</td><td>0.563<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.035)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">Constant</td><td>0.940<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.021)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Observations</td><td>23,816</td></tr>
<tr><td style="text-align:left">Log Likelihood</td><td>-17,232.660</td></tr>
<tr><td style="text-align:left">Akaike Inf. Crit.</td><td>34,481.320</td></tr>
<tr><td style="text-align:left">Bayesian Inf. Crit.</td><td>34,545.950</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"><em>Note:</em></td><td style="text-align:right"><sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01</td></tr>
</table>

<p>Positive coefficients mean that factor is associated with a <em>higher</em> mean absolute scaled error ie worse predictions.  Negative values, like those associated with the <code class="language-plaintext highlighter-rouge">ets</code> models, no Box-Cox transformation, and seasonal adjustment prior to modelling, mean better predictions.  Tourism data has a higher average scaled error, as does quarterly data (compared to monthly).</p>

<p>This table of coefficient estimates was produced with <code class="language-plaintext highlighter-rouge">stargazer</code>, which is awesome but unfortunately doesn’t include a summary of the random effects from a mixed effects model.  There are <a href="http://svmiller.com/blog/2015/02/quasi-automating-the-inclusion-of-random-effects-in-rs-stargazer-package/">workarounds for this</a> but I couldn’t be bothered. In this case, the size of those random effects is just a nuisance anyway.  For the record, the standard deviation at the level of “model - series” combination was 0.81 and of the lowest level individual residuals was 0.40.</p>

<p>What we see here is that there are small but noticeable impacts:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ets</code> performs slightly better (ie lower mean absolute scaled error, on average) than <code class="language-plaintext highlighter-rouge">auto.arima</code></li>
  <li>Fitting the model on untransformed data performs slightly better than using an automated Box Cox transformation</li>
  <li>Seasonally adjusting first performs slightly better than incorporating the seasonality into the model</li>
</ul>

<h3 id="subtlety---ets-versus-autoarima">Subtlety - <code class="language-plaintext highlighter-rouge">ets</code> versus <code class="language-plaintext highlighter-rouge">auto.arima</code></h3>

<p>The conclusions above are fine for a general takehome, but it’s worth noting that a better performing model to explain the experimental forecasting performance results (on the basis of AIC) includes a set of interaction effects between model type and my experimental factors of seasonal adjustment and transformation strategies.  I performed a single comparison of a full model with the expected interactions versus the simple model.  The interactions I looked at were between the model type (<code class="language-plaintext highlighter-rouge">ets</code> versus <code class="language-plaintext highlighter-rouge">auto.arima</code>) and the other explanatory variables; and between Box-Cox transformation and seasonality strategy.  This superior model is quite a bit harder to interpret:</p>

<table style="text-align:center"><tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td><em>Dependent variable:</em></td></tr>
<tr><td></td><td colspan="1" style="border-bottom: 1px solid black"></td></tr>
<tr><td style="text-align:left"></td><td>mase</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">modelETS</td><td>-0.052<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.011)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">transformNone</td><td>-0.061<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.010)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">seasadjSeasonally adjusted first</td><td>-0.065<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.010)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">frequencyquarterly</td><td>0.212<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.032)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">collectionTourism</td><td>0.604<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.035)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">transformNone:seasadjSeasonally adjusted first</td><td>0.034<sup>**</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.015)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">modelETS:transformNone</td><td>0.038<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.015)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">modelETS:seasadjSeasonally adjusted first</td><td>0.059<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.015)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">modelETS:frequencyquarterly</td><td>0.052<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.011)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">modelETS:collectionTourism</td><td>-0.084<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.012)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">modelETS:transformNone:seasadjSeasonally adjusted first</td><td>-0.031</td></tr>
<tr><td style="text-align:left"></td><td>(0.021)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">Constant</td><td>0.965<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.022)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Observations</td><td>23,816</td></tr>
<tr><td style="text-align:left">Log Likelihood</td><td>-17,208.300</td></tr>
<tr><td style="text-align:left">Akaike Inf. Crit.</td><td>34,444.600</td></tr>
<tr><td style="text-align:left">Bayesian Inf. Crit.</td><td>34,557.690</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"><em>Note:</em></td><td style="text-align:right"><sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01</td></tr>
</table>

<p>It’s basically impossible to think through the various interactions in the above single combined model, so purely for the purpose of presenting results I refit the model separately to the <code class="language-plaintext highlighter-rouge">ets</code> results and the <code class="language-plaintext highlighter-rouge">auto.arima</code> results.</p>

<h4 id="ets">ets</h4>
<table style="text-align:center"><tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td><em>Dependent variable:</em></td></tr>
<tr><td></td><td colspan="1" style="border-bottom: 1px solid black"></td></tr>
<tr><td style="text-align:left"></td><td>mase</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">transformNone</td><td>-0.022<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.009)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">seasadjSeasonally adjusted first</td><td>-0.006</td></tr>
<tr><td style="text-align:left"></td><td>(0.009)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">frequencyquarterly</td><td>0.264<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.033)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">collectionTourism</td><td>0.521<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.036)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">transformNone:seasadjSeasonally adjusted first</td><td>0.003</td></tr>
<tr><td style="text-align:left"></td><td>(0.012)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">Constant</td><td>0.913<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.022)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Observations</td><td>11,908</td></tr>
<tr><td style="text-align:left">Log Likelihood</td><td>-8,653.195</td></tr>
<tr><td style="text-align:left">Akaike Inf. Crit.</td><td>17,322.390</td></tr>
<tr><td style="text-align:left">Bayesian Inf. Crit.</td><td>17,381.470</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"><em>Note:</em></td><td style="text-align:right"><sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01</td></tr>
</table>

<h4 id="autoarima">auto.arima</h4>
<table style="text-align:center"><tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td><em>Dependent variable:</em></td></tr>
<tr><td></td><td colspan="1" style="border-bottom: 1px solid black"></td></tr>
<tr><td style="text-align:left"></td><td>mase</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">transformNone</td><td>-0.061<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.010)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">seasadjSeasonally adjusted first</td><td>-0.065<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.010)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">frequencyquarterly</td><td>0.212<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.032)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">collectionTourism</td><td>0.604<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.035)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">transformNone:seasadjSeasonally adjusted first</td><td>0.034<sup>**</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.015)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">Constant</td><td>0.965<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.022)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Observations</td><td>11,908</td></tr>
<tr><td style="text-align:left">Log Likelihood</td><td>-10,361.570</td></tr>
<tr><td style="text-align:left">Akaike Inf. Crit.</td><td>20,739.150</td></tr>
<tr><td style="text-align:left">Bayesian Inf. Crit.</td><td>20,798.220</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"><em>Note:</em></td><td style="text-align:right"><sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01</td></tr>
</table>

<p>And here’s a graphic representation that helps (a bit):</p>

<p><img src="/img/0079-lmer-results.svg" align="middle" /></p>

<p>All my attempts to get a way to easily understand those implications couldn’t improve on a simple contingency table of the average MASE values (these are trimmed means of the MASE return for all 2,977 series), using the tables of coefficients above to guide inference:</p>

<table>
 <thead>
  <tr>
   <th style="text-align:left;">| transform    |</th>
   <th style="text-align:left;">| seasadj             |</th>
   <th style="text-align:right;">|   ARIMA    |</th>
   <th style="text-align:right;">|   ETS      |</th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> BoxCox </td>
   <td style="text-align:left;"> Seasonal in model </td>
   <td style="text-align:right;"> 1.020 </td>
   <td style="text-align:right;"> 0.987 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BoxCox </td>
   <td style="text-align:left;"> Seasonally adjusted first </td>
   <td style="text-align:right;"> 0.987 </td>
   <td style="text-align:right;"> 0.993 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> None </td>
   <td style="text-align:left;"> Seasonal in model </td>
   <td style="text-align:right;"> 0.993 </td>
   <td style="text-align:right;"> 0.976 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> None </td>
   <td style="text-align:left;"> Seasonally adjusted first </td>
   <td style="text-align:right;"> 0.976 </td>
   <td style="text-align:right;"> 0.992 </td>
  </tr>
</tbody>
</table>

<h2 id="conclusion">Conclusion</h2>

<ul>
  <li>For an ARIMA model, the best approach on average is to seasonally adjust first, and not use an automated Box-Cox transformation.</li>
  <li>For an ETS model, no evidence either way on whether to seasonally adjust first or to incorporate into the model; but again, it is better to not automatically use a Box-Cox transformation.</li>
</ul>

<p>That it’s best not to automatically use a Box-Cox transformation slightly surprised me, particularly for SARIMA models which assume second order stationarity.  Something to think about.</p>

<p>Limitations or caveats include:</p>

<ul>
  <li>The accuracy checks were all done on a single point, 8 (for quarterly data) and 18 or 24 (for monthly) periods after the end of the training series.  The results may not generalize, particularly for forecast horizons that aren’t a relatively simple multiple of the series’ frequency.</li>
  <li><code class="language-plaintext highlighter-rouge">stlm</code> is not the state of the art in seasonal adjustment.  A more thorough experiment would use X13-SEATS-ARIMA to do the seasonal adjustment.  My reason for <em>not</em> doing this was convenience - <code class="language-plaintext highlighter-rouge">stlm</code> in combination with <code class="language-plaintext highlighter-rouge">forecast</code> makes it easy to backtransform the forecasts to the original seasonal version that I did the accuracy check on.</li>
  <li>There may be a better way to automate the choice of Box-Cox transformation.</li>
</ul>

<h2 id="code">Code</h2>

<p>All the code for the above (and a bit more) in one chunk today:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">Mcomp</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">Tcomp</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">foreach</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">doParallel</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stargazer</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lme4</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">forcats</span><span class="p">)</span><span class="w">

</span><span class="c1">#=========================analysis functions=======================</span><span class="w">

</span><span class="c1"># Set up a cluster for parallel computing</span><span class="w">
</span><span class="n">cluster</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">makeCluster</span><span class="p">(</span><span class="m">7</span><span class="p">)</span><span class="w"> </span><span class="c1"># only any good if you have at least 7 processors :)</span><span class="w">
</span><span class="n">registerDoParallel</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span><span class="w">

</span><span class="n">clusterEvalQ</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="n">library</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">


</span><span class="cd">#' fit 8 models (all combinations of ets/arima, seasonally adjusted / not, BoxCox transformed / not)</span><span class="w">
</span><span class="cd">#' to all data series in data_collection.  data_collection needs to be an object of class Mcomp</span><span class="w">
</span><span class="cd">#' @value data frame with columns for mase (mean absolute scaled error), series number, and</span><span class="w">
</span><span class="cd">#' three columns with information on the characteristics of the fit model</span><span class="w">
</span><span class="n">eval_forecasts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data_collection</span><span class="p">){</span><span class="w">
   </span><span class="n">clusterExport</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="s2">"data_collection"</span><span class="p">)</span><span class="w">
   
   </span><span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">foreach</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">data_collection</span><span class="p">),</span><span class="w"> </span><span class="n">.combine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbind</span><span class="p">)</span><span class="w"> </span><span class="o">%dopar%</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">the_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_collection</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w">
   
      </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_data</span><span class="o">$</span><span class="n">x</span><span class="w">
      </span><span class="n">xx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_data</span><span class="o">$</span><span class="n">xx</span><span class="w">
      </span><span class="n">h</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_data</span><span class="o">$</span><span class="n">h</span><span class="w">
      
      </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">BoxCox.lambda</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
      </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
      
      </span><span class="c1"># some time series with 0 in them fail catastrophically with stlm if lambda is close</span><span class="w">
      </span><span class="c1"># to zero, so we force them to be at most a square rootish transformation</span><span class="w">
      </span><span class="k">if</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0</span><span class="p">){</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">)}</span><span class="w">
      
      </span><span class="n">fc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">
      </span><span class="n">ac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">numeric</span><span class="p">()</span><span class="w">
      
      </span><span class="c1"># no seasonally adjustment, Box Cox transform</span><span class="w">
      </span><span class="n">fc</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">auto.arima</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
      </span><span class="n">fc</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">ets</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
      
      </span><span class="c1"># no seasonally adjustment, no Box Cox transform</span><span class="w">
      </span><span class="n">fc</span><span class="p">[[</span><span class="m">3</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">auto.arima</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
      </span><span class="n">fc</span><span class="p">[[</span><span class="m">4</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">ets</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
      
      </span><span class="c1"># seasonally adjust first, Box Cox transform</span><span class="w">
      </span><span class="n">fc</span><span class="p">[[</span><span class="m">5</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">stlm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"arima"</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
      </span><span class="n">fc</span><span class="p">[[</span><span class="m">6</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">stlm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ets"</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
      
      </span><span class="c1"># seasonally adjust first, no transform</span><span class="w">
      </span><span class="n">fc</span><span class="p">[[</span><span class="m">7</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">stlm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"arima"</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
      </span><span class="n">fc</span><span class="p">[[</span><span class="m">8</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">stlm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ets"</span><span class="p">),</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
      
      </span><span class="n">ac</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">mod</span><span class="p">){</span><span class="w">
         </span><span class="n">accuracy</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">]</span><span class="w">
      </span><span class="p">})</span><span class="w">
      
      </span><span class="n">data.frame</span><span class="p">(</span><span class="n">mase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ac</span><span class="p">,</span><span class="w">
                 </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"ARIMA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ETS"</span><span class="p">),</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w">
                 </span><span class="n">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"BoxCox"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BoxCox"</span><span class="p">,</span><span class="w"> </span><span class="s2">"None"</span><span class="p">,</span><span class="w"> </span><span class="s2">"None"</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w">
                 </span><span class="n">seasadj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Seasonal in model"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Seasonally adjusted first"</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w">
                 </span><span class="n">series</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w">
   </span><span class="nf">return</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#=============plotting and summary functions====================</span><span class="w">
</span><span class="c1"># Functions for summarising the results of eval_forecasts()</span><span class="w">
</span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">results</span><span class="p">){</span><span class="w">
   </span><span class="n">results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">spread</span><span class="p">(</span><span class="n">seasadj</span><span class="p">,</span><span class="w"> </span><span class="n">mase</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
      </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`Seasonally adjusted first`</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`Seasonal in model`</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transform</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">geom_abline</span><span class="p">(</span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">scale_x_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">coord_equal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Mean absolute scaled error from fitting a model to the original data"</span><span class="p">,</span><span class="w">
           </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Error from fitting a model to data\nthat was first seasonally adjusted"</span><span class="p">,</span><span class="w">
           </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">t1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">results</span><span class="p">){</span><span class="w">
   </span><span class="n">results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">group_by</span><span class="p">(</span><span class="n">seasadj</span><span class="p">,</span><span class="w"> </span><span class="n">transform</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">summarise</span><span class="p">(</span><span class="n">mase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">mase</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">spread</span><span class="p">(</span><span class="n">seasadj</span><span class="p">,</span><span class="w"> </span><span class="n">mase</span><span class="p">)</span><span class="w"> 
</span><span class="p">}</span><span class="w">

</span><span class="c1">#=============apply to data=============</span><span class="w">

</span><span class="n">m_results_monthly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eval_forecasts</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">M3</span><span class="p">,</span><span class="w"> </span><span class="s2">"MONTHLY"</span><span class="p">))</span><span class="w">
</span><span class="n">m_results_quarterly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eval_forecasts</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">M3</span><span class="p">,</span><span class="w"> </span><span class="s2">"QUARTERLY"</span><span class="p">))</span><span class="w">
</span><span class="n">t_results_monthly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eval_forecasts</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">tourism</span><span class="p">,</span><span class="w"> </span><span class="s2">"MONTHLY"</span><span class="p">))</span><span class="w">
</span><span class="n">t_results_quarterly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eval_forecasts</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">tourism</span><span class="p">,</span><span class="w"> </span><span class="s2">"QUARTERLY"</span><span class="p">))</span><span class="w">

</span><span class="c1">#-----------------plots of individual results--------------</span><span class="w">

</span><span class="n">p2</span><span class="p">(</span><span class="n">m_results_monthly</span><span class="p">);</span><span class="w">
</span><span class="n">t1</span><span class="p">(</span><span class="n">m_results_monthly</span><span class="p">)</span><span class="w">

</span><span class="n">p2</span><span class="p">(</span><span class="n">m_results_quarterly</span><span class="p">)</span><span class="w">
</span><span class="n">t1</span><span class="p">(</span><span class="n">m_results_quarterly</span><span class="p">)</span><span class="w">

</span><span class="n">p2</span><span class="p">(</span><span class="n">m_results_quarterly</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Marginally better results on average from seasonally adjusting\na series prior to modelling and forecasting"</span><span class="p">,</span><span class="w">
           </span><span class="s2">"... and little obvious change from choosing to Box-Cox transform or not"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Quarterly data from the M3 forecasting competition"</span><span class="p">)</span><span class="w">

</span><span class="n">p2</span><span class="p">(</span><span class="n">t_results_monthly</span><span class="p">)</span><span class="w">
</span><span class="n">t1</span><span class="p">(</span><span class="n">t_results_monthly</span><span class="p">)</span><span class="w">

</span><span class="n">p2</span><span class="p">(</span><span class="n">t_results_quarterly</span><span class="p">)</span><span class="w">
</span><span class="n">t1</span><span class="p">(</span><span class="n">t_results_quarterly</span><span class="p">)</span><span class="w">


</span><span class="c1">#--------------------combined results-------------------</span><span class="w">
</span><span class="n">all_results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="w">
   </span><span class="n">m_results_monthly</span><span class="p">,</span><span class="w">
   </span><span class="n">m_results_quarterly</span><span class="p">,</span><span class="w">
   </span><span class="n">t_results_monthly</span><span class="p">,</span><span class="w">
   </span><span class="n">t_results_quarterly</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="w">
      </span><span class="n">collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"M3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Tourism"</span><span class="p">),</span><span class="w"> 
                       </span><span class="nf">c</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">m_results_monthly</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">m_results_quarterly</span><span class="p">),</span><span class="w">
                         </span><span class="n">nrow</span><span class="p">(</span><span class="n">t_results_monthly</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">t_results_quarterly</span><span class="p">))),</span><span class="w">
      </span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"monthly"</span><span class="p">,</span><span class="w"> </span><span class="s2">"quarterly"</span><span class="p">,</span><span class="w"> </span><span class="s2">"monthly"</span><span class="p">,</span><span class="w"> </span><span class="s2">"quarterly"</span><span class="p">),</span><span class="w"> 
                      </span><span class="nf">c</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">m_results_monthly</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">m_results_quarterly</span><span class="p">),</span><span class="w">
                        </span><span class="n">nrow</span><span class="p">(</span><span class="n">t_results_monthly</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">t_results_quarterly</span><span class="p">))),</span><span class="w">
      </span><span class="n">dataset_series</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span><span class="w"> </span><span class="n">frequency</span><span class="p">,</span><span class="w"> </span><span class="n">series</span><span class="p">),</span><span class="w">
      </span><span class="n">collection_frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span><span class="w"> </span><span class="n">frequency</span><span class="p">)</span><span class="w">
   </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">as_tibble</span><span class="p">()</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">all_results</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transform</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seasadj</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mase</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">collection_frequency</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">  </span><span class="o">+</span><span class="w">
   </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_y_log10</span><span class="p">(</span><span class="s2">"Mean absolute scaled error"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> 
        </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2,977 quarterly and monthly datasets from the M3 and Tourism forecasting competitions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Comparison of variants in forecasting methods"</span><span class="p">,</span><span class="w">
           </span><span class="s2">"Box-Cox transformation or not; seasonally adjust the data before model fitting or not."</span><span class="p">)</span><span class="w">

</span><span class="c1">#==========modelling of results======================</span><span class="w">
</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">mase</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transform</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">seasadj</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">dataset_series</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_results</span><span class="p">)</span><span class="w">
</span><span class="n">model_inters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">mase</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">transform</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">seasadj</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">collection</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">dataset_series</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_results</span><span class="p">)</span><span class="w">

</span><span class="n">AIC</span><span class="p">(</span><span class="n">model_inters</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w">

</span><span class="n">stargazer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"html"</span><span class="p">)</span><span class="w">
</span><span class="n">stargazer</span><span class="p">(</span><span class="n">model_inters</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"html"</span><span class="p">)</span><span class="w">



</span><span class="c1"># Interpreting all those interactions is basically impossible as-is, so just for</span><span class="w">
</span><span class="c1"># illustrating results I fit models separately to ETS and ARIMA</span><span class="w">
</span><span class="n">model_ets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">mase</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">transform</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">seasadj</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">dataset_series</span><span class="p">),</span><span class="w"> 
                  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">all_results</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"ETS"</span><span class="p">))</span><span class="w">
</span><span class="n">model_arima</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">mase</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">transform</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">seasadj</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">dataset_series</span><span class="p">),</span><span class="w"> 
                  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">all_results</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"ARIMA"</span><span class="p">))</span><span class="w">


</span><span class="n">stargazer</span><span class="p">(</span><span class="n">model_ets</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"html"</span><span class="p">)</span><span class="w">
</span><span class="n">stargazer</span><span class="p">(</span><span class="n">model_arima</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"html"</span><span class="p">)</span><span class="w">

</span><span class="n">effects_ets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">tidy</span><span class="p">(</span><span class="n">confint</span><span class="p">(</span><span class="n">model_ets</span><span class="p">))[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="p">],</span><span class="w">
                 </span><span class="n">tidy</span><span class="p">(</span><span class="n">model_ets</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="p">],</span><span class="w">
                 </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ETS"</span><span class="p">)</span><span class="w">

</span><span class="n">effects_arima</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">tidy</span><span class="p">(</span><span class="n">confint</span><span class="p">(</span><span class="n">model_arima</span><span class="p">))[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="p">],</span><span class="w">
                     </span><span class="n">tidy</span><span class="p">(</span><span class="n">model_arima</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="p">],</span><span class="w">
                     </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ARIMA"</span><span class="p">)</span><span class="w">

</span><span class="n">effects</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">effects_ets</span><span class="p">,</span><span class="w"> </span><span class="n">effects_arima</span><span class="p">)</span><span class="w">

</span><span class="nf">names</span><span class="p">(</span><span class="n">effects</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"variable"</span><span class="p">,</span><span class="w"> </span><span class="s2">"lower"</span><span class="p">,</span><span class="w"> </span><span class="s2">"upper"</span><span class="p">)</span><span class="w">

</span><span class="n">effects</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">estimate</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upper</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Impact on forecasting, measured by mean absolute scaled error"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Tested on all 2,977 quarterly and monthly datasets from the M3 and Tourism forecasting competitions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Small but noticeable impact of different forecasting methods"</span><span class="p">,</span><span class="w">
</span><span class="s2">"ARIMA works best when seasonally adjusted beforehand rather than seasonality included in the model.
For ETS, no significant evidence either seasonal adjustment strategy is better.
For both models, it seems better not to automatically use a Box-Cox transformation."</span><span class="p">)</span><span class="w">

</span><span class="n">all_results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">transform</span><span class="p">,</span><span class="w"> </span><span class="n">seasadj</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">mase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">mase</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">spread</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">mase</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">(</span><span class="s2">"html"</span><span class="p">)</span></code></pre></figure>



		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2017/01/14/books">Books I like</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2017/01/23/inaugural-speeches">US Presidential inauguration speeches</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>

			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<p>Find me on <a rel="me" href="https://bsky.app/profile/freerangestats.info">Bluesky</a> or <a rel="me" href="https://mastodon.social/@peter_ellis">Mastodon</a>.</p>
			<hr></hr>
			


       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			
			<p>I've never been an academic but have written a few small things and hence have a <a href='https://scholar.google.com/citations?view_op=list_works&hl=en&user=MEtLNDMAAAAJ'>Google Scholar profile</a></p>
			
			<p>I read a lot of books. In the unlikely event you want to see what I think about them or what I'm reading at the moment, <a href='https://www.goodreads.com/user/show/55517482-peter-ellis'>follow me on Goodreads</a>.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			
			<h4>Bluesky feed:</h3>
         <script src="https://cdn.jsdelivr.net/npm/bsky-embed/dist/bsky-embed.es.js" async></script>
<bsky-embed  
  username="freerangestats.info"  
  limit="5"  
>  
</bsky-embed>

    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>