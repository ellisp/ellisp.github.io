      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>R Markdown for documents with logos, watermarks, and corporate styles</title>
      	
         
         
            <meta name ="description" content ="I outline how I structure analytical project folder systems and some hints for matching R Markdown documents to a corporate style guide including adding logos, watermarks, and of course colours and fonts.">
            <meta property="og:description" content ="I outline how I structure analytical project folder systems and some hints for matching R Markdown documents to a corporate style guide including adding logos, watermarks, and of course colours and fonts.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="R Markdown for documents with logos, watermarks, and corporate styles" />
         
            <meta property="og:image" content="http://ellisp.github.io/img/0109-rmarkdown-screenshot.png" />
         
		 
			<meta property="og:url" content="http://freerangestats.info/blog/2017/09/09/rmarkdown.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
				  <li><a href = /blog/2019/08/25/fitting-bins>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">election forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href = "/elections/oz/index.html">Australia federal 2019</a></li>
				  <li><a href = "/elections/combined.html">NZ 2016</a></li>
                  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>R Markdown for documents with logos, watermarks, and corporate styles</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I outline how I structure analytical project folder systems and some hints for matching R Markdown documents to a corporate style guide including adding logos, watermarks, and of course colours and fonts.</p>
	   <p class="meta">09 Sep 2017</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="r-markdown-in-corporate-settings">R Markdown in corporate settings</h2>

<p>I’ve been busy recently writing a paper at work using <a href="http://rmarkdown.rstudio.com/">R Markdown</a>, the wonderful tool provided by the folks at RStudio “to weave together narrative text and code to produce elegantly formatted output”.  I don’t use R Markdown for my blog, because I prefer to separate my analytical scripts from the text and reintegrate the products by hand (I have my reasons, not necessarily good ones, but reasons of a sort).  But in many contexts the integration of the code, output and text in R Markdown is a fantastic way to quickly and easily produce good-looking content.</p>

<p>In most organisations I’ve worked for, documents need to reflect the corporate look and feel.  Typically, details are defined in a style guide and manifested in Microsoft Word and PowerPoint templates.  Important details include permissible fonts, heading styles, design elements’ colours, and so on.  In an organisation which does a lot of statistical graphics, you might also have guidelines for colours and other thematic aspects of plots.</p>

<p>I found myself having to solve a few minor problems to get my R Markdown at work generating a stand-alone HTML file that looks close enough to the look and feel that customers wouldn’t get a jolt when they saw the result and ask me to re-do it in Word.  So today’s blog post jots down some of what I learned, if only so I’ve got it all in one place for myself.</p>

<p>To illustrate this, I set up a GitHub repository of <a href="https://github.com/ellisp/rmarkdown-corporate-eg">source code for a hypothetical project</a> involving some data management, analysis and report writing.  Feel free to clone and re-use it (attribution would be nice).  Here’s a screenshot of the top of my hypothetical report:</p>

<p><a href="http://ellisp.github.io/presentations/rmarkdown-styled-demo.html"><img src="/img/0109-rmarkdown-screenshot.png" width="100%" /></a></p>

<p>Clicking on the image will get you the whole report including some plots of New Zealand’s regional tourism, which I used as readily-available data.</p>

<h2 id="structuring-the-project">Structuring the project</h2>

<p>I divide most of my projects of this sort into four conceptual tasks:</p>

<ul>
  <li><em>setup</em> - loading up packages and defining functions and assets that will be used repeatedly</li>
  <li><em>data munging</em> - download / extraction / creation and management into a stable state to be referred to throughout the project</li>
  <li><em>analysis</em></li>
  <li><em>building outputs</em> such as reports, presentations and web tools</li>
</ul>

<p>These tasks aren’t done in a simple linear manner.  For example, sometimes I start writing parts of the report first.  Nearly always I don’t know what “functions and assets will be used repeatedly” until I find myself doing similar things a few times.</p>

<p>This project is set up as a folder system comprising a single Git repository and RStudio project. I like to have a one-to-one relationship of Git repositories and RStudio projects.  In this project I’ve got four subfolders:</p>

<ul>
  <li><code class="highlighter-rouge">R</code></li>
  <li><code class="highlighter-rouge">prep</code></li>
  <li><code class="highlighter-rouge">data</code></li>
  <li><code class="highlighter-rouge">report-1</code></li>
</ul>

<p>The <code class="highlighter-rouge">R</code> folder has two scripts:</p>

<ul>
  <li><code class="highlighter-rouge">corp-palette.R</code> which defines the corporate font and colour scheme to be used in graphics created by R</li>
  <li><code class="highlighter-rouge">build_doc.R</code> which defines a function to render the R Markdown file into HTML (more on why this is needed later).</li>
</ul>

<p>The <code class="highlighter-rouge">prep</code> folder in this case holds a single script which downloads a dataset from the web, imports it from its Excel format and does some minor data management tasks like defining additional columns for use in future analysis.</p>

<p>The <code class="highlighter-rouge">data</code> folder holds data - both the raw data downloaded from the web, and analysis-ready versions as <code class="highlighter-rouge">.rda</code> files.  The Git project has been told (via the <code class="highlighter-rouge">.gitignore</code> file) to ignore data files so they don’t bloat up the source code repository but are created by the script in <code class="highlighter-rouge">prep</code>.</p>

<p>Finally, the <code class="highlighter-rouge">report-1</code> holds a file written in R Markdown (<code class="highlighter-rouge">report.Rmd</code>) and some other assets like the SVG of the corporate logo.</p>

<p>In a larger project I might have a separate <code class="highlighter-rouge">analysis</code> folder, with scripts doing various analytical tasks.  In this case, all of that is done in R chunks in the <code class="highlighter-rouge">report.Rmd</code> file.</p>

<p>Now, with a project as simple as this I could have had it all in a single .Rmd file which could be distributed by itself, but that approach doesn’t scale up well.  I intensely dislike using a big .Rmd file as my main workflow control.  Getting on top of the caching of R chunks alone is a major cause of frustration.  There are also challenges with working directories, although these have been mitigated by recent developments in the world of <code class="highlighter-rouge">knitr</code>.  But mostly it’s just good practice to think of analytical projects beyond the trivial in size as <em>projects</em>, involving a portable <em>folder system</em> not just individual scripts.</p>

<p>In this approach, the .Rmd file itself doesn’t need to be (and isn’t) 100% reproducible, so I avoid the “knit” button in RStudio which spawns a fresh R session from scratch.  Instead I ensure reproducibility of the project - I should be able to make a fresh clone on a fresh computer with the right R packages on it, source <code class="highlighter-rouge">build.R</code> in a fresh session and have it run.  But the .Rmd file isn’t self-sufficient, and I don’t think that’s a reasonable expectation in a big project (bigger than this toy).</p>

<p>This approach also works well in the common situation that a single project has multiple outputs eg a couple of reports, a Shiny app and a presentation.  It makes little sense for each report and presentation to be self-sufficient and repeat tasks that are really one-off project tasks.</p>

<p>There’s an R script in the root directory of the project called <code class="highlighter-rouge">build.R</code> which basically runs scripts in the other folders in the correct order to re-create the whole exercise from scratch.  Here’s what that script looks like.  Notice I’ve tried to make it as aware of the environment as possible; for example, it doesn’t matter what order the files in the <code class="highlighter-rouge">R</code> subfolder are run in, so it just finds all the files there and runs them in alphabetical order.  This means I don’t need to change the <code class="highlighter-rouge">build.R</code> script when I put a new script in the <code class="highlighter-rouge">R</code> directory.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># ./build.r
# This file downloads and munges data and builds the report/s for the project from scratch
# Peter Ellis 6 September 2017
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rmarkdown</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">openxlsx</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggseas</span><span class="p">)</span><span class="w">    </span><span class="c1"># for seasonal adjustment on the fly
</span><span class="n">library</span><span class="p">(</span><span class="n">forcats</span><span class="p">)</span><span class="w">   </span><span class="c1"># for munging factors
</span><span class="n">library</span><span class="p">(</span><span class="n">extrafont</span><span class="p">)</span><span class="w"> </span><span class="c1"># in case running on windows
</span><span class="n">library</span><span class="p">(</span><span class="n">stringi</span><span class="p">)</span><span class="w">   </span><span class="c1"># for generating pseudo lating lorem ipsum text
</span><span class="w">
</span><span class="c1"># Run all the files in the "R" folder, which create project assets
# like the corporate colours and the function we use to build documents.
</span><span class="n">assets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"R"</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\.R$"</span><span class="p">,</span><span class="w"> </span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">created_assets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">)</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span><span class="w"> </span><span class="n">created_assets</span><span class="p">)</span><span class="w">


</span><span class="c1"># download, reshape, and save the data
</span><span class="n">source</span><span class="p">(</span><span class="s2">"prep/download-mrtes.R"</span><span class="p">)</span><span class="w">

</span><span class="c1"># load in the data (not really necessary)
</span><span class="n">load</span><span class="p">(</span><span class="s2">"data/mrtes.rda"</span><span class="p">)</span><span class="w">

</span><span class="c1"># build the actual report.  Note that the build will happen in the user's home directory (~).
</span><span class="n">build_doc</span><span class="p">(</span><span class="n">subdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"report-1"</span><span class="p">)</span></code></pre></figure>

<h2 id="r-markdown-with-rstudio-server-on-a-mapped-network-drive">R Markdown with RStudio Server on a mapped network drive</h2>

<p>I’m pretty sure there’s a bug associated with the combination of RMarkdown, RStudio Server, Pandoc and mapped network drives.  The long and the short of it is that <code class="highlighter-rouge">rmarkdown::render("document.Rmd")</code> will fail when asked to build a stand-alone HTML file if <code class="highlighter-rouge">document.Rmd</code> is on a mapped network drive.  I really needed an emailable stand-alone HTML file, and at work my only access to R was on RStudio Server; and mapped network drives the only ones RStudio could see that I could access from the Windows file system.</p>

<p>I got past that problem with the following workaround, which made use of the fact that the RStudio Server was set up so I had a home directory (~) which, while not visible to Windows, I could save things in and navigate to and from in the R environment.  So my approach was:</p>

<ul>
  <li>copy all the files I need from the <code class="highlighter-rouge">report-1</code> project sub-folder to my home directory ~</li>
  <li>change working directory to ~ and render the stand-alone HTML there</li>
  <li>copy the HTML file back to the original <code class="highlighter-rouge">report-1</code> sub-folder, clean up the home directory, and return to the project root directory</li>
</ul>

<p>This is all done in the function <code class="highlighter-rouge">build_doc()</code>, which is one of the assets created at the beginning of the project:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="cd">#' Build an R Markdown file that is in a subdirectory
#' 
#' Function to move all files in a subdirectory to the user's home directory, build the markdown file there,
#' and return the built version to the original subdirectory.  Why would you want to do this?  Because
#' R Markdown doesn't build nicely on RStudio Server on a mapped network drive due to a bug in Pandoc, so
#' sometimes you need to move everything to somewhere else.
#' 
#' @param subdir sub directory (relative to the project directory) holding a report and its necessary files
#' @param report_name name of the report, excluding the .Rmd suffix.
#' @param ... other arguments to be passed to rmarkdown::render()
#' @author Peter Ellis
</span><span class="n">build_doc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">subdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"report"</span><span class="p">,</span><span class="w"> </span><span class="n">report_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"report"</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">){</span><span class="w">
  </span><span class="n">proj_dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getwd</span><span class="p">()</span><span class="w">
  </span><span class="nf">on.exit</span><span class="p">(</span><span class="n">setwd</span><span class="p">(</span><span class="n">proj_dir</span><span class="p">))</span><span class="w">
  
  </span><span class="c1"># copy all the files from the report's sub directory to the home directory
</span><span class="w">  </span><span class="n">files</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">subdir</span><span class="p">)</span><span class="w">
  </span><span class="n">file.copy</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w"> </span><span class="n">files</span><span class="p">),</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"~/"</span><span class="p">,</span><span class="w"> </span><span class="n">files</span><span class="p">),</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">  
  
  </span><span class="c1"># go to the home directory and render the report
</span><span class="w">  </span><span class="n">setwd</span><span class="p">(</span><span class="s2">"~"</span><span class="p">)</span><span class="w">
  </span><span class="n">render</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">report_name</span><span class="p">,</span><span class="w"> </span><span class="s2">".Rmd"</span><span class="p">),</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w">  
  
  </span><span class="c1"># copy the built version of the document back to the project:
</span><span class="w">  </span><span class="n">file.copy</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">report_name</span><span class="p">,</span><span class="w"> </span><span class="s2">".html"</span><span class="p">),</span><span class="w"> 
            </span><span class="n">paste0</span><span class="p">(</span><span class="n">proj_dir</span><span class="p">,</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w"> </span><span class="n">subdir</span><span class="p">,</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w"> </span><span class="n">report_name</span><span class="p">,</span><span class="w"> </span><span class="s2">".html"</span><span class="p">),</span><span class="w"> 
            </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># clean up by deleting the copies of the files in the home directory:
</span><span class="w">  </span><span class="n">file.remove</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="w">
  </span><span class="c1"># go back to the project:
</span><span class="w">  </span><span class="n">setwd</span><span class="p">(</span><span class="n">proj_dir</span><span class="p">)</span><span class="w">  
  </span><span class="p">}</span></code></pre></figure>

<p>If you find that useful you can actually get it from my nascent <code class="highlighter-rouge">pssmisc</code> R package where I’m putting odds and pieces like this:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ellisp/pssmisc-r-package/pkg"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">pssmisc</span><span class="p">)</span></code></pre></figure>

<h2 id="approximating-corporate-style-in-html">Approximating corporate style in HTML</h2>

<h3 id="setting-up-the-document">Setting up the document</h3>

<p>A few things I wanted in this situation I need to set up in the YAML front matter of the .Rmd file:</p>

<ul>
  <li>a stand-alone HTML document</li>
  <li>a dynamic and floating table of contents on the left of the screen</li>
  <li>syntax highlighting that works with SQL (not used in my demo project, but my real one at work had to do this)</li>
  <li>incorporate cascading style sheets w</li>
</ul>

<p>So here’s the first 14 lines of the R Markdown <code class="highlighter-rouge">./report-1/report.Rmd</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>---
title: "Demonstration page of R Markdown in combination with corporate theming"
author: "Flash Gordon, consultant economist"
date: "9 September 2017"
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
    self_contained: yes
    css: corp-styles.css
    highlight: pygments
---
</code></pre>
</div>

<h3 id="fonts-and-headings-with-css">Fonts and headings with CSS</h3>

<p>This takes us to the file of Cascading Style Sheet instructions, <code class="highlighter-rouge">corp-styles.css</code>, sitting in the same folder as the report (this is probably a weakness to think through - better to have it in a central location somewhere).  I’m no CSS expert but this is simple enough.  I worked out the correct colours of headings and their sizes from the corporate Word templates, and converted them from point sizes to the percentage size relative to normal text.  Colours and fonts in the below have been made up for this example:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">body</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="n">Calibri</span><span class="p">,</span> <span class="n">helvetica</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="m">226</span><span class="p">,</span> <span class="m">192</span><span class="p">,</span> <span class="m">78</span><span class="p">);</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">127%</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.title</span> <span class="p">{</span>
  <span class="nl">margin-right</span><span class="p">:</span> <span class="m">200px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="m">112</span><span class="p">,</span> <span class="m">111</span><span class="p">,</span> <span class="m">111</span><span class="p">);</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">121%</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h3</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">109%</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">bold</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h4</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">bold</span><span class="p">;</span>
  <span class="nl">font-style</span><span class="p">:</span> <span class="nb">italic</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.watermark</span> <span class="p">{</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0.2</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="nl">left</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">500%</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#00407d</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>In my real world example I had some other things in there too, such as table formatting.</p>

<h3 id="adding-a-logo">Adding a logo</h3>

<p>As well as the headings and the body, notice the definition of the style of the <code class="highlighter-rouge">.title</code> class.  This is the one-off element that is the title of the whole report.  I give it a wide right margin of 200 pixels so there is room for my hideous made-up corporate logo in the top right.  That logo is in the main <code class="highlighter-rouge">report.Rmd</code> file with the code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;img src="logo.svg" style="position:absolute;top:0px;right:0px;" /&gt;
</code></pre>
</div>

<p>…and obviously the file logo.svg is in the same folder as the report.</p>

<h3 id="adding-a-watermark">Adding a watermark</h3>

<p>I wanted a watermark saying “DRAFT” in pale letters that would always be visible for readers.  This worked quite well and was fairly simple.  I just needed to include the single line below in my main <code class="highlighter-rouge">report.Rmd</code>, creating a div of class “watermark”.  The CSS to force objects of this class be fixed in the middle of the page, large in size and opaque is in the <code class="highlighter-rouge">.watermark {...}</code> code in the <code class="highlighter-rouge">corp-styles.css</code> file already shown.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;div class="watermark"&gt;DRAFT&lt;/div&gt;
</code></pre>
</div>

<h2 id="graphics">Graphics</h2>

<p>The final thing to mention is the styling of the graphics produced by R itself.  This is defined in the file <code class="highlighter-rouge">corp-palette.R</code>, already mentioned, which is run at the beginning of the project.  It creates an object <code class="highlighter-rouge">corp_palette</code> to hold my hypothetical corporate colours for statistical graphics, and makes them the default discrete colour scale for <code class="highlighter-rouge">ggplot2</code>.  It also sets an appropriate theme and font, and makes the font the default for the text geom.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># ./R/corp-palette.R
# Defines font and a hypothetical corporate palette, and makes them ggplot2 defaults
</span><span class="w">
</span><span class="n">corp_font</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Calibri"</span><span class="w">

</span><span class="n">theme_set</span><span class="p">(</span><span class="n">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corp_font</span><span class="p">))</span><span class="w">

</span><span class="n">corp_palette</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#800000"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#00004d"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#009900"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#8c1aff"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#5c85d6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#996600"</span><span class="p">)</span><span class="w">

</span><span class="n">update_geom_defaults</span><span class="p">(</span><span class="s2">"text"</span><span class="p">,</span><span class="w">   </span><span class="nf">list</span><span class="p">(</span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corp_font</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corp_palette</span><span class="p">[</span><span class="m">1</span><span class="p">]))</span><span class="w">
</span><span class="n">scale_colour_discrete</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corp_palette</span><span class="p">)</span><span class="w">
</span><span class="n">scale_fill_discrete</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">...</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corp_palette</span><span class="p">)</span></code></pre></figure>

<p>That means I don’t need to specify the colours and fonts for individual charts in my R Markdown file.</p>

<h2 id="end-result">End result</h2>

<p>Enjoy:</p>

<ul>
  <li><a href="http://ellisp.github.io/presentations/rmarkdown-styled-demo.html">built R Markdown -&gt; HTML report</a> with correct fonts, colours (headings and graphs), logo and draft watermark</li>
  <li><a href="https://github.com/ellisp/rmarkdown-corporate-eg">repository of source code</a></li>
</ul>



		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2017/09/09/nzpolls-again">The long view on New Zealand political polls</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2017/09/16/time-varying-house-effects">Time-varying house effects in New Zealand political polls</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics
http://Http://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>