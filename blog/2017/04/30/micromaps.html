      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Luke-warm about micromaps</title>
      	
         
         
            <meta name ="description" content ="Linked micromaps are an ok way of presenting data and are probably the right tool in some circumstances; but they're not as cool as I thought they might be.">
            <meta property="og:description" content ="Linked micromaps are an ok way of presenting data and are probably the right tool in some circumstances; but they're not as cool as I thought they might be.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Luke-warm about micromaps" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0095-eg3.png" />
         
		 
			<meta property="og:url" content="http://localhost:4000/blog/2017/04/30/micromaps.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2024/05/05/pop-projections>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Luke-warm about micromaps</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>Linked micromaps are an ok way of presenting data and are probably the right tool in some circumstances; but they're not as cool as I thought they might be.</p>
	   <p class="meta">30 Apr 2017</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <p>Continuing my exploring methods for spatial visualisation of data in R, today I’m looking at <a href="https://gis.cancer.gov/tools/micromaps/">linked micromaps</a>.  Micromaps are a way of showing statistical graphics for a small subset of regions at a time, with a small map indicating which regions are being looked at in each of the small multiples.  Alberto Cairo has some nice discussion in <a href="http://www.thefunctionalart.com/2013/07/falling-in-love-with-micromaps.html">this blog post</a>.</p>

<h2 id="poverty-and-education-in-the-usa">Poverty and education in the USA</h2>

<p>It’s easier to show than explain.  Here’s one I’ve adapted from the helpfiles of the <a href="https://CRAN.R-project.org/package=micromap">R micromaps package</a> by Quinn Payton, Tony Olsen, Marc Weber, Michael McManus and Tom Kincaid of the US Environmental Protection Agency and generously open-sourced by that agency.  Under the hood, <code class="language-plaintext highlighter-rouge">micromaps</code> uses Hadley Wickham’s <code class="language-plaintext highlighter-rouge">ggplot2</code> to create the graphic assets and (I think) Paul Murrell’s <code class="language-plaintext highlighter-rouge">grid</code> to lay them out in aligned fashion.</p>

<p><img src="/img/0095-eg1.png" width="100%" /></p>

<p>Some links for the <code class="language-plaintext highlighter-rouge">micromaps</code> package:</p>

<ul>
  <li><a href="https://CRAN.R-project.org/package=micromap">Production version</a> on CRAN</li>
  <li><a href="https://www.jstatsoft.org/article/view/v063i02">Introductory article</a> in the Journal of Statistical Software</li>
  <li><a href="https://github.com/USEPA/R-micromap-package-development">Source code</a> on the USEPA GitHub page</li>
</ul>

<p>I used this USA example as my test case for understanding the <code class="language-plaintext highlighter-rouge">micromaps</code> API.  Some of the changes I’ve introduced here include:</p>

<ul>
  <li>Set my own font</li>
  <li>Pale blue background with white gridlines to make them go into the background, ggplot2-style.</li>
  <li>White borders for the grey-fill states that have been previously drawn, so the border lines don’t distract the eye from the five states being referred to in each cluster.</li>
  <li>Tidied up the code for readability</li>
</ul>

<p>Here’s the code that draws this, and sets up the overall session.  Note that the <code class="language-plaintext highlighter-rouge">nzcensus</code> (by me) and <code class="language-plaintext highlighter-rouge">mbiemaps</code> (by New Zealand’s Ministry of Business, Innovation and Employment, my previous employer) are only available on GitHub, not CRAN.  Code to install them is available in a <a href="http://127.0.0.1:4000/blog/2017/04/23/cartograms">previous post</a>.  They’re needed for New Zealand data and maps later on.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">micromap</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">nzcensus</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">extrafont</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">mbiemaps</span><span class="p">)</span><span class="w"> </span><span class="c1"># for the territorial authority map</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">testthat</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">

</span><span class="n">the_font</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Calibri"</span><span class="w">
</span><span class="n">theme_set</span><span class="p">(</span><span class="n">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">))</span><span class="w">

</span><span class="c1">#============polish up the example from the ?lmplot helpfile===============</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="s2">"USstates"</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="s2">"edPov"</span><span class="p">)</span><span class="w">

</span><span class="c1"># convert from SpatialPolygonsDataFrame into a data frame (similar to fortify)</span><span class="w">
</span><span class="n">statePolys</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">create_map_table</span><span class="p">(</span><span class="n">USstates</span><span class="p">,</span><span class="w"> </span><span class="s1">'ST'</span><span class="p">)</span><span class="w">

</span><span class="c1"># draw graphic</span><span class="w">
</span><span class="n">lmplot</span><span class="p">(</span><span class="n">stat.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edPov</span><span class="p">,</span><span class="w">
       </span><span class="n">map.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">statePolys</span><span class="p">,</span><span class="w">
       </span><span class="n">panel.types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'labels'</span><span class="p">,</span><span class="w"> </span><span class="s1">'dot'</span><span class="p">,</span><span class="w"> </span><span class="s1">'dot'</span><span class="p">,</span><span class="s1">'map'</span><span class="p">),</span><span class="w">
       </span><span class="n">panel.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'state'</span><span class="p">,</span><span class="s1">'pov'</span><span class="p">,</span><span class="s1">'ed'</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w">
       </span><span class="n">ord.by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'pov'</span><span class="p">,</span><span class="w">   
       </span><span class="n">grouping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w">
       </span><span class="n">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="s2">"Spectral"</span><span class="p">),</span><span class="w">
       </span><span class="n">median.row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
       </span><span class="c1"># how to merge the two data frames:</span><span class="w">
       </span><span class="n">map.link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'StateAb'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ID'</span><span class="p">),</span><span class="w">
       </span><span class="c1"># stroke colour of the borders of previously-drawn areas:</span><span class="w">
       </span><span class="n">map.color2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w">
       </span><span class="c1"># how to save the result:</span><span class="w">
       </span><span class="n">print.file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0095-eg1.png"</span><span class="p">,</span><span class="w">
       </span><span class="n">print.res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span><span class="p">,</span><span class="w">
       </span><span class="n">plot.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w">
       </span><span class="n">plot.height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w">
       </span><span class="c1"># attributes of the panels:</span><span class="w">
       </span><span class="n">panel.att</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"States"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> 
               </span><span class="n">text.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> 
               </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'right'</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w">
               </span><span class="n">text.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">left.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">right.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent living below\npoverty level"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">xaxis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Percent'</span><span class="p">,</span><span class="w">
               </span><span class="n">xaxis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">),</span><span class="w">
               </span><span class="n">xaxis.labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">),</span><span class="w">
               </span><span class="n">graph.bgcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'lightblue'</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.grid.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey99"</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.border.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">),</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent adults with\n4+ years of college"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">xaxis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Percent'</span><span class="p">,</span><span class="w">
               </span><span class="n">xaxis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">),</span><span class="w">
               </span><span class="n">xaxis.labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">),</span><span class="w">
               </span><span class="n">graph.bgcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'lightblue'</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.grid.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey99"</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.border.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">),</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Light gray means\nhighlighted above'</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"italic"</span><span class="p">)</span><span class="w">
       </span><span class="p">))</span></code></pre></figure>

<p>Most of the polishing code is in the list of lists passed to the <code class="language-plaintext highlighter-rouge">panel.att</code> argument.  Each list refers to the attributes of one of the four panels (state names, poverty dot charts, education dot charts, maps).  I had to do a bit of digging to find out how to control things like grid colour; while doing this it was useful to run one of the three lines of code below to see what attributes are within your control for the different panel types:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">unlist</span><span class="p">(</span><span class="n">labels_att</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">unlist</span><span class="p">(</span><span class="n">dot_att</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">unlist</span><span class="p">(</span><span class="n">map_att</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">)</span></code></pre></figure>

<p>Note that the <code class="language-plaintext highlighter-rouge">lmplot</code> function specifies a file to print the graphic to.  I don’t like this, as it’s breaks some commonly accepted R workflows.  For example, for this blog I usually create in advance all the graphics for each post in SVG format, which scales up nicely if people zoom in on it and is generally the best format (my view) for web graphics.  That can’t be done when <code class="language-plaintext highlighter-rouge">lmplot</code> restricts you to particular device types.  The pattern also doesn’t work well with Yixuan Qiu’s <a href="https://github.com/yixuan/showtext"><code class="language-plaintext highlighter-rouge">showtext</code> R package</a> that I normally use for fonts (it lets me access Google fonts, including the Poppins font I use for most graphics).</p>

<h2 id="new-zealand-census-example">New Zealand census example</h2>

<p>To be sure I understood how to use the technique, I wanted to apply it to some New Zealand maps and data.  I’m used to presenting data at the Territorial Authority level in New Zealand by means of a choropleth map like this one:</p>

<p><img src="/img/0095-choropleth.png" width="100%" /></p>

<p>… which was drawn with this code, using the <code class="language-plaintext highlighter-rouge">TA2013</code> data frame of 2013 census data from my <code class="language-plaintext highlighter-rouge">nzcensus</code> package:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># pre-fortified data frame version of TA level map, from mbiemaps package:</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">ta_simpl_gg</span><span class="p">)</span><span class="w">

</span><span class="c1"># change name in census data to match the name used in ta_simpl_gg</span><span class="w">
</span><span class="n">TA2013</span><span class="o">$</span><span class="n">short_name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">" District"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">TA2013</span><span class="o">$</span><span class="n">TA2013_NAM</span><span class="p">)</span><span class="w">

</span><span class="c1"># filter out some visually inconvenient data:</span><span class="w">
</span><span class="n">ta_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">TA2013</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">short_name</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Chatham Islands Territory"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Area Outside Territorial Authority"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">PercNoReligion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropNoReligion2013</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">

</span><span class="c1"># draw map:   </span><span class="w">
</span><span class="n">ta_simpl_gg</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">left_join</span><span class="p">(</span><span class="n">ta_data</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"NAME"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"short_name"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">arrange</span><span class="p">(</span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MedianIncome2013</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_polygon</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey50"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggmap</span><span class="o">::</span><span class="n">theme_nothing</span><span class="p">(</span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">0.7</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_fill_gradientn</span><span class="p">(</span><span class="s2">"Median individual\nincome"</span><span class="p">,</span><span class="w"> 
                        </span><span class="n">colours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="s2">"Spectral"</span><span class="p">),</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dollar</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">coord_map</span><span class="p">(</span><span class="n">projection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sinusoidal"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Example choropleth map"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: Statistics New Zealand, 2013 Census"</span><span class="p">)</span></code></pre></figure>

<p>Doing this with a linked micromap instead of a choropleth map lets us look at more variables at once, but I can’t say I’m happy with the result:</p>

<p><img src="/img/0095-eg2.png" width="100%" /></p>

<p>My reservations about this graphic:</p>

<ul>
  <li>It feels like there are just too many territorial authorities for this to be a really friendly graphic.</li>
  <li>Also, my map of New Zealand is probably too crinkly and individual districts and cities too small to show up well.</li>
  <li>There’s an awkwardness of New Zealand being tall rather than wide - a smaller aspect ratio than USA.  This seems to make the New Zealand map less well suited to the technique than the USA map.</li>
  <li>It’s hard for the reader to move their eyes back and forth from the district or city name to the dots and to the map.</li>
  <li>I couldn’t work out how (if it is possible) to control the projection of the map, and hence New Zealand looks a little bit stretched and rotated.</li>
</ul>

<p>Here’s the code that drew this, anyway:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># change names of the map data frame to meet lmplot's expectations</span><span class="w">
</span><span class="n">ta_polys2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ta_simpl_gg</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">rename</span><span class="p">(</span><span class="n">coordsx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> 
          </span><span class="n">coordsy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> 
          </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NAME</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">hole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">hole</span><span class="p">),</span><span class="w">
          </span><span class="n">plug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
          </span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">ID</span><span class="p">)))</span><span class="w">

</span><span class="c1"># check merge will be ok</span><span class="w">
</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">ta_polys2</span><span class="o">$</span><span class="n">ID</span><span class="p">)</span><span class="w">       </span><span class="c1"># names of map polygons</span><span class="w">
</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">ta_data</span><span class="o">$</span><span class="n">short_name</span><span class="p">)</span><span class="w"> </span><span class="c1"># names of TAs with census data</span><span class="w">
</span><span class="n">expect_equal</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="o">!</span><span class="n">a</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">b</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="o">!</span><span class="n">b</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">a</span><span class="p">])</span><span class="w">

</span><span class="c1"># draw graphic:</span><span class="w">
</span><span class="n">lmplot</span><span class="p">(</span><span class="n">stat.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ta_data</span><span class="p">,</span><span class="w">
       </span><span class="n">map.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ta_polys2</span><span class="p">,</span><span class="w">
       </span><span class="n">panel.types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'labels'</span><span class="p">,</span><span class="w"> </span><span class="s1">'dot'</span><span class="p">,</span><span class="w"> </span><span class="s1">'dot'</span><span class="p">,</span><span class="s1">'map'</span><span class="p">),</span><span class="w">
       </span><span class="n">panel.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'short_name'</span><span class="p">,</span><span class="s1">'MedianIncome2013'</span><span class="p">,</span><span class="s1">'PercNoReligion'</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w">
       </span><span class="n">ord.by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'MedianIncome2013'</span><span class="p">,</span><span class="w">   
       </span><span class="n">grouping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w">
       </span><span class="n">median.row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
       </span><span class="c1"># how to merge the two data frames:</span><span class="w">
       </span><span class="n">map.link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'short_name'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ID'</span><span class="p">),</span><span class="w">
       </span><span class="c1"># stroke colour of the borders of previously-drawn areas:</span><span class="w">
       </span><span class="n">map.color2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w">
       </span><span class="c1"># how to save the result:</span><span class="w">
       </span><span class="n">print.file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0095-eg2.png"</span><span class="p">,</span><span class="w">
       </span><span class="n">print.res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span><span class="p">,</span><span class="w">
       </span><span class="n">plot.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w">
       </span><span class="n">plot.height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">18</span><span class="p">,</span><span class="w">
       </span><span class="c1"># attributes of the panels:</span><span class="w">
       </span><span class="n">panel.att</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Territorial Authorities"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.2</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">text.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.6</span><span class="p">,</span><span class="w"> 
               </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'right'</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w">
               </span><span class="n">text.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">left.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">right.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">
               </span><span class="n">xaxis.title.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Median\nincome"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">xaxis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Dollars'</span><span class="p">,</span><span class="w">
               </span><span class="n">xaxis.title.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">xaxis.labels.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.bgcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'grey80'</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.grid.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey99"</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.border.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w">
               </span><span class="n">point.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
               </span><span class="n">point.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent individuals\nwith no religion"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">xaxis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Percent'</span><span class="p">,</span><span class="w">
               </span><span class="n">xaxis.title.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">xaxis.labels.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.bgcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'grey80'</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.grid.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey99"</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.border.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w">
               </span><span class="n">point.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
               </span><span class="n">point.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'\n'</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"italic"</span><span class="p">,</span><span class="w">
               </span><span class="n">active.border.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
               </span><span class="n">withdata.border.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
               </span><span class="n">nodata.border.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w">
       </span><span class="p">))</span></code></pre></figure>

<p>Now, there’s a standard way of showing two variables against each other.  We lose the spatial element, but for most purposes I think the good old scatter plot is better for this data:</p>

<p><img src="/img/0095-scatter.svg" width="100%" /></p>

<p>…drawn with:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ta_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MedianIncome2013</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropNoReligion2013</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">short_name</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s2">"Median income"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dollar</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"No religion"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CensusNightPop2013</span><span class="p">),</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey60"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CensusNightPop2013</span><span class="p">),</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_text_repel</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_size_area</span><span class="p">(</span><span class="s2">"Census night population"</span><span class="p">,</span><span class="w"> </span><span class="n">max_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: Statistics New Zealand, census 2013"</span><span class="p">)</span></code></pre></figure>

<h2 id="maybe-better-with-a-smaller-number-of-areas">Maybe better with a smaller number of areas?</h2>

<p>New Zealand has 66 districts and cities (not counting Chatham Islands), but only 16 Regional Councils.  Perhaps the method works better with a smaller number of areas to show:</p>

<p><img src="/img/0095-eg3.png" width="100%" /></p>

<p>… and I think that probably is ok.  But really, all we are showing here is 32 numbers.  It’s an expensive graphic for something that could almost be as meaningfully shown in a table.  All up, my reaction to linked micromaps is one of caution.  Like any visualisation tool, I think they’ll be good in some circumstances, but in others they just won’t seem to easily communicate.</p>

<p>Code for the regional council micromap:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#================regions example============</span><span class="w">
</span><span class="c1"># convert from SpatialPolygonsDataFrame into a data frame (similar to fortify)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">region_simpl</span><span class="p">)</span><span class="w"> </span><span class="c1"># map from mbiemaps</span><span class="w">
</span><span class="n">reg_polys</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">create_map_table</span><span class="p">(</span><span class="n">region_simpl</span><span class="p">,</span><span class="w"> </span><span class="s1">'NAME'</span><span class="p">)</span><span class="w">

</span><span class="n">reg_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">REGC2013</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">PercNoReligion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropNoReligion2013</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">filter</span><span class="p">(</span><span class="n">REGC2013_N</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Area Outside Region"</span><span class="p">)</span><span class="w">

</span><span class="n">lmplot</span><span class="p">(</span><span class="n">stat.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reg_data</span><span class="p">,</span><span class="w">
       </span><span class="n">map.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reg_polys</span><span class="p">,</span><span class="w">
       </span><span class="n">panel.types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'labels'</span><span class="p">,</span><span class="w"> </span><span class="s1">'dot'</span><span class="p">,</span><span class="w"> </span><span class="s1">'dot'</span><span class="p">,</span><span class="s1">'map'</span><span class="p">),</span><span class="w">
       </span><span class="n">panel.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'REGC2013_N'</span><span class="p">,</span><span class="s1">'MedianIncome2013'</span><span class="p">,</span><span class="s1">'PercNoReligion'</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w">
       </span><span class="n">ord.by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'MedianIncome2013'</span><span class="p">,</span><span class="w">   
       </span><span class="n">grouping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w">
       </span><span class="n">median.row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
       </span><span class="c1"># how to merge the two data frames:</span><span class="w">
       </span><span class="n">map.link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'REGC2013_N'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ID'</span><span class="p">),</span><span class="w">
       </span><span class="c1"># stroke colour of the borders of previously-drawn areas:</span><span class="w">
       </span><span class="n">map.color2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w">
       </span><span class="c1"># how to save the result:</span><span class="w">
       </span><span class="n">print.file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0095-eg3.png"</span><span class="p">,</span><span class="w">
       </span><span class="n">print.res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">600</span><span class="p">,</span><span class="w">
       </span><span class="n">plot.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w">
       </span><span class="n">plot.height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w">
       </span><span class="c1"># attributes of the panels:</span><span class="w">
       </span><span class="n">panel.att</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Territorial Authorities"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.2</span><span class="p">,</span><span class="w"> 
               </span><span class="n">text.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> 
               </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'right'</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w">
               </span><span class="n">text.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">left.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">right.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Median\nincome"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">xaxis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Dollars'</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w">
               </span><span class="n">left.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> 
               </span><span class="n">right.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> 
               </span><span class="n">graph.bgcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'grey90'</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.grid.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey99"</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.border.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w">
               </span><span class="n">point.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
               </span><span class="n">point.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.5</span><span class="p">),</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Percent individuals\nwith no religion"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w">
               </span><span class="n">left.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> 
               </span><span class="n">right.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> 
               </span><span class="n">xaxis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Percent'</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.bgcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'grey90'</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.grid.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey99"</span><span class="p">,</span><span class="w">
               </span><span class="n">graph.border.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w">
               </span><span class="n">point.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
               </span><span class="n">point.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.5</span><span class="p">),</span><span class="w">
          </span><span class="nf">list</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'\n'</span><span class="p">,</span><span class="w"> 
               </span><span class="n">panel.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.2</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_font</span><span class="p">,</span><span class="w">
               </span><span class="n">panel.header.face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"italic"</span><span class="p">,</span><span class="w">
               </span><span class="n">active.border.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
               </span><span class="n">withdata.border.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
               </span><span class="n">nodata.border.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
       </span><span class="p">))</span></code></pre></figure>

<h2 id="bonus---area-unit-cartograms">Bonus - area unit cartograms</h2>
<p>Finally, an aside.  My last two blog posts have been about what you might call population-weighted carto-choro-pletho-grams…  I’ve been gradually enhancing this <a href="https://ellisp.shinyapps.io/nzcensus-cartograms/">Shiny web app which lets people play around with visualisations of 2013 census data</a>.  Latest addition is data at the detailed area unit level.  Here’s a screenshot showing which area units have higher proportions of people with a background from the Pacific islands:</p>

<p><img src="/img/0094b-pacific-northisland.png" width="100%" /></p>

<p>Check out the <a href="https://ellisp.shinyapps.io/nzcensus-cartograms/">full app</a> for more.</p>


		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2017/04/25/more-cartograms">More cartograms of New Zealand census data (district and city level)!</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2017/05/06/nz-first">Modelling individual party vote from the 2014 New Zealand election study</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>