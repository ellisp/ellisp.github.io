      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Men's domestic chores and fertility rates - Part II, technical notes</title>
      	
         
         
            <meta name ="description" content ="A few specific notes on technical issues relating to a previous post. On drawing network graphs with different coloured edges; modelling strategy; different specifications of models; and accessing UN SDG and gender inequality data.">
            <meta property="og:description" content ="A few specific notes on technical issues relating to a previous post. On drawing network graphs with different coloured edges; modelling strategy; different specifications of models; and accessing UN SDG and gender inequality data.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Men's domestic chores and fertility rates - Part II, technical notes" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0290-compare-ti-and-s.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2025/08/23/timeuse-technical.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
	        <!--	  <li><a href="/blog/most-popular.html">ordered by popularity</a></li> -->
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2025/09/24/ten-years>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Men's domestic chores and fertility rates - Part II, technical notes</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>A few specific notes on technical issues relating to a previous post. On drawing network graphs with different coloured edges; modelling strategy; different specifications of models; and accessing UN SDG and gender inequality data.</p>
	   <p class="meta">23 Aug 2025</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <p>This post is a collection of more technical notes forming a companion piece to <a href="/blog/2025/08/15/timeuse-summary">the previous post on men’s time spent on domestic chores and total fertility rates at the country level</a>.</p>

<p>The target audience for today’s post is future-me, and anyone else similarly interested in the quite specific issues it is jotting down notes for. Those issues include:</p>

<ul>
  <li>Drawing directed graphs with <code class="language-plaintext highlighter-rouge">ggdag</code> that have different coloured edges</li>
  <li>Accessing the UN Sustainable Development Goals (SDGs) database API</li>
  <li>Data options on gender inequality</li>
  <li>Fitting the same mixed effects model with <code class="language-plaintext highlighter-rouge">lme4::lmer</code>, <code class="language-plaintext highlighter-rouge">mgcv::gamm</code> and <code class="language-plaintext highlighter-rouge">mgcv::gam</code>, comparing results and extracting group-level residuals</li>
  <li>Hand-drawing prediction plots to show the results of models with interactions and comparing that to the <code class="language-plaintext highlighter-rouge">marginaleffects</code> package</li>
  <li>Diagnostics of a simplified version of the model</li>
  <li>Modelling strategy questions relating to researcher degrees of freedom, use of splines and interaction effects</li>
</ul>

<p>My approach to presenting this (both today, and in Part I) is different to my usual one, where I try to make the post itself a stand-alone, reproducible artefact with all the code necessary to produce the results in the post. That approach just didn’t work out in this case; the code was too long and boring to include in the main blog, there are too many different audiences to write for, and I went down too many dead ends in exploring some of the modelling options. Even in this technical companion piece, this post isn’t going to be fully reproducible, but just have the snippets of code that best illustrate the point.</p>

<p>To make up for this, as ever, the full code to produce that blog post is on <a href="https://github.com/ellisp/blog-source/blob/master/_working/0290-house-work.R">GitHub as part of my overall blog-source repository</a>.</p>

<h3 id="directed-graphs-with-different-coloured-edges">Directed graphs with different coloured edges</h3>

<p>For the main post, I had to draw a couple of directed graphs with different coloured edges connecting the nodes. Specifically, I wanted to use a red line to show a negative direction effect, and blue to show a positive, like this:</p>

<object type="image/svg+xml" data="/img/0290-dg-simplified.svg" width="100%"><img src="/img/0290-dg-simplified.png" width="100%" /></object>

<p>This was surprisingly fiddly to do and required a bit of a hack. Specifically, you have to explicitly call the <code class="language-plaintext highlighter-rouge">tidy_dagitty</code> function, which turns a <code class="language-plaintext highlighter-rouge">ggdag</code> graph object of class <code class="language-plaintext highlighter-rouge">dagitty</code> into a data frame of class <code class="language-plaintext highlighter-rouge">tidy_dagitty</code>; then you add a column to that data frame which has the <em>actual colours</em> as its values, conditional on whatever algorithm you need to determine those colours. In this example, I want it to be red when the line segment is connect “opp” (Opportunities for women and girls) to “tfr” (Total fertility rate), and blue otherwise.</p>

<p>As far as I could tell, you can’t just map a column of character or factor values to colour and let the colour scale match it, which would be the approach more consistent with the <code class="language-plaintext highlighter-rouge">ggplot2</code> philosophy. Instead, you only have the choice of an identity scale, which is why that column <code class="language-plaintext highlighter-rouge">edge_type</code> I  add has to have the values “darkred” and “steelblue”. That’s the main trick for doing this.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">dg2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dagify</span><span class="p">(</span><span class="n">tfr</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">opp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">hw</span><span class="w"> </span><span class="p">,</span><span class="w">
             </span><span class="n">hw</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">opp</span><span class="p">,</span><span class="w">

             </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">
               </span><span class="s2">"tfr"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Total fertility rate"</span><span class="p">,</span><span class="w">
               </span><span class="s2">"hw"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Men doing housework"</span><span class="p">,</span><span class="w">
               </span><span class="s2">"opp"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Opportunities for\nwomen and girls"</span><span class="w">
             </span><span class="p">),</span><span class="w">
             </span><span class="n">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tfr"</span><span class="p">,</span><span class="w">
             </span><span class="n">exposure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hw"</span><span class="w">
</span><span class="p">)</span><span class="w">  </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="c1"># explicitly call this usually hidden function so we can colour the edges:</span><span class="w">
  </span><span class="n">ggdag</span><span class="o">::</span><span class="n">tidy_dagitty</span><span class="p">(</span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">124</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="c1"># colour the edges. Need to specify identity of colour here, not use scale_</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">edge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"tfr"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"opp"</span><span class="p">,</span><span class="w"> </span><span class="s2">"darkred"</span><span class="p">,</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">))</span><span class="w">


</span><span class="c1"># Draw the simplified causal graph</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">124</span><span class="p">)</span><span class="w">
</span><span class="n">dg2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xend</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="n">yend</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_dag_node</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_dag_edges</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">edge_colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edge_type</span><span class="p">),</span><span class="w"> 
                 </span><span class="n">arrow_directed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="o">::</span><span class="n">arrow</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="s2">"pt"</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"closed"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_dag_text_repel</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">label</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lab_col</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_dag</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Roboto"</span><span class="p">)</span></code></pre></figure>

<h3 id="accessing-the-un-sdgs-database">Accessing the UN SDGs database</h3>

<p>I couldn’t find a simple way of accessing the United Nations Statistics Division’s invaluable definitive database of the SDG indicators for all countries of the world. By which I mean, it has an API, but I didn’t see anyone who’d written a nice R package to conveniently interact with it. If anyone knows of someone who’s done this, or wants to do it themselves, please let me know.</p>

<p>So I had to write my own API request by myself, like an animal. I did this in what I am sure is a suboptimal way, but it works. From playing around with <a href="https://unstats.un.org/sdgs/UNSDGAPIV5/swagger/index.html">the UN’s API</a> I found the <code class="language-plaintext highlighter-rouge">curl</code> command I wanted to download the data:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -X POST --header 'Content-Type: application/x-www-form-urlencoded' --header 'Accept: application/octet-stream' -d 'seriesCodes=SL_DOM_TSPD' 'https://unstats.un.org/sdgapi/v1/sdg/Series/DataCSV'
</code></pre></div></div>

<p>Then I used functions from Bob Rudis’ <code class="language-plaintext highlighter-rouge">curlconverter</code> R package to convert this to a request for the old-fashioned <code class="language-plaintext highlighter-rouge">httr</code> package to use. As the comments in this code say, I know all this is outmoded; but it works for now.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#-----------downloading some SDG time use data from the UN database-------------</span><span class="w">
</span><span class="c1"># Note sure this is the best way to do this, it was clunky to work out,</span><span class="w">
</span><span class="c1"># but it works. Someone should (or have they already?) build an R package.</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1"># this is all httr, I understand httr2 is the  current thing now, but this still works </span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">curlconverter</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span><span class="w">
</span><span class="n">request</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"curl -X POST --header 'Content-Type: application/x-www-form-urlencoded' --header 'Accept: application/octet-stream' -d 'seriesCodes=SL_DOM_TSPD' 'https://unstats.un.org/sdgapi/v1/sdg/Series/DataCSV'"</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">straighten</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">make_req</span><span class="p">()</span><span class="w">

</span><span class="n">gender_txt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">content</span><span class="p">(</span><span class="n">request</span><span class="p">[[</span><span class="m">1</span><span class="p">]](),</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text"</span><span class="p">)</span><span class="w">

</span><span class="n">gender</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="n">gender_txt</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">clean_names</span><span class="p">()</span></code></pre></figure>

<p>The end results is I want a variable, from that <code class="language-plaintext highlighter-rouge">SL_DOM_TPSD</code> indicator (time spent on domestic chores and care work by sex and urban/rural location) that can be represented like this:</p>

<object type="image/svg+xml" data="/img/0290-time-share-bar.svg" width="100%"><img src="/img/0290-time-share-bar.png" width="100%" /></object>

<p>There are significant data wrangling challenges, though, in particular the different age categories used in each country, the different years that surveys were conducted, and the presence of multiple observations for some but not all countries.</p>

<p>The main reason for including this next snippet is to remind myself of what was needed to do to fiddle with those age categories. For example, note that some countries have values for multiple open ended categories like 3+ and 15+; we need a rule for deciding which of these is best for our desired constructed variable of men’s share of adult domestic domestic and care work (in this case, 15+ is better than 3+, when both are available for a country):</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">count</span><span class="p">(</span><span class="n">gender</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="p">)</span><span class="w">      </span><span class="c1"># two categories, FEMALE and MALE - no TOTAL</span><span class="w">
</span><span class="n">count</span><span class="p">(</span><span class="n">gender</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w">      </span><span class="c1"># many different ages used for different countries</span><span class="w">
</span><span class="n">count</span><span class="p">(</span><span class="n">gender</span><span class="p">,</span><span class="w"> </span><span class="n">location</span><span class="p">)</span><span class="w"> </span><span class="c1"># there's ALLAREA, RURAL and URBAN</span><span class="w">

</span><span class="c1"># should be only one indicator:</span><span class="w">
</span><span class="n">stopifnot</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">gender</span><span class="o">$</span><span class="n">series_description</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="c1"># which is </span><span class="w">
</span><span class="c1"># Proportion of time spent on unpaid domestic chores and care work, by sex, age and location (%) </span><span class="w">

</span><span class="n">time_chores</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="c1"># we don't want rural and urban, just country total:</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"ALLAREA"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="c1"># we want the ages like 15+, 12+ etc, not those like 15-59 with an upper bound</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"^[0-9]*\\+$"</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="c1"># but not the retirees, which some countries include. We want the 15+, not 15+</span><span class="w">
  </span><span class="c1"># and 65+ separately:</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">age</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"65+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"85+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"60+"</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="c1"># calculate the male time spent as a proportion of total (male and female) time spent</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">geo_area_name</span><span class="p">,</span><span class="w"> </span><span class="n">time_period</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">prop_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'MALE'</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'MALE'</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'FEMALE'</span><span class="p">]))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">geo_area_name</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="c1"># Label the latest survey per country. Note that any modelling needs to</span><span class="w">
  </span><span class="c1"># include a country random effect for the multiple observations per country:</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">is_latest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">time_period</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">time_period</span><span class="p">),</span><span class="w"> </span><span class="s2">"Most recent"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Earlier"</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="c1"># limit to just the best age group, closest to adults, for each country/time:</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">geo_area_name</span><span class="p">,</span><span class="w"> </span><span class="n">time_period</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"15+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"16+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"18+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"12+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"10+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"6+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3+"</span><span class="p">)))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">geo_area_name</span><span class="p">,</span><span class="w"> </span><span class="n">time_period</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">iso3_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countrycode</span><span class="p">(</span><span class="n">geo_area_name</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"country.name.en"</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"iso3c"</span><span class="p">))</span></code></pre></figure>

<h3 id="data-on-gender-inequality">Data on gender inequality</h3>

<p>I spent quite a bit of time looking for data on gender inequality independent of the housework question. I wanted something that resembled women’s and girls’ opportunities in education and the economy more broadly. I had various deadends in pursuing this. My first idea was some kind of literacy measure—female literacy at some given age, or for adults overall, as a ratio for equivalent male literacy. But the various sources for this just didn’t have enough observations.</p>

<p>The main sources for literacy would be self-report in a census or possibly a social survey; or a standardised test at a given year of schooling. After some fruitless time with SDGs, the World Bank’s World Development Indicators, and various other sources, I concluded that neither of these seem to be readily available in a comparable basis for enough years that matched with the year-country combinations that I had time-use data for.</p>

<p>I ended up using the <a href="https://hdr.undp.org/data-center/thematic-composite-indices/gender-inequality-index#/indicies/GII">Gender Inequality Index (GII) from the UNDP</a> instead. Now, this index is complex and relies on a bunch of indicators that are obviously going to be at least as hard to measure as literacy—like level of secondary education (needs admin data or survey or census) and maternal mortality ratio (needs good civil registry, or survey data as a less satisfactory alternative). Here’s how the GII is constructed:</p>

<p><img src="/img/0290-gii-diagram.png" width="100%" /></p>

<p>But the GII is available for all country-year combinations, which simply can’t be based on direct observations of these variables. Obviously the UNDP do a bunch of modelling to interpolate all the missing values. I didn’t look into this but just trusted the UNDP to have done the best job possible. It’s certainly very convenient to get this measure of gender inequality for so many countries (206 ‘countries’, but this includes some regional groupings), and for so many years.</p>

<object type="image/svg+xml" data="/img/0290-gii-lollipop.svg" width="100%"><img src="/img/0290-gii-lollipop.png" width="100%" /></object>

<p>There were multiple ways to download this GII data from the Human Development Reports website, but it turns out the best is to download all the Human Development Report data for the latest year in a single, big CSV:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># You can download all the HDR components (including GII):</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"hdr25.csv"</span><span class="w">

</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="n">df</span><span class="p">)){</span><span class="w">
  </span><span class="n">download.file</span><span class="p">(</span><span class="s2">"https://hdr.undp.org/sites/default/files/2025_HDR/HDR25_Composite_indices_complete_time_series.csv"</span><span class="p">,</span><span class="w">
                </span><span class="n">destfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">hdr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code></pre></figure>

<p>From there it’s straightforward data wrangling to extract just the GII data and combine with my other datasets using year and the ISO three character codes for countries to join by.</p>

<h3 id="fitting-the-same-mixed-effects-model-with-lmer-gamm-and-gam">Fitting the same mixed effects model with <code class="language-plaintext highlighter-rouge">lmer</code>, <code class="language-plaintext highlighter-rouge">gamm</code> and <code class="language-plaintext highlighter-rouge">gam</code></h3>

<h4 id="specifying-models">Specifying models</h4>

<p>One of the things I wanted to sort in this post was the near equivalence of some of the many different ways of specifying and fitting a mixed effects model in R. There’s a good post from Gavin Simpson on <a href="https://fromthebottomoftheheap.net/2021/02/02/random-effects-in-gams/">‘Using random effects in GAMs with mgcv’</a> that I referred to repeatedly in preparing this.</p>

<p>Specifically, I wanted to check that these four models, set out below, are all very similar. By which I actually mean the last three are <em>identical</em> statistically, but have different ways of being estimated and/or the formula written down; and the first is a statistically different model in terms of probability distributions and link functions, but effectively very very similar indeed to the other three:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># note response variable is ltfr, defined earlier as log(tfr):</span><span class="w">
</span><span class="n">model2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">ltfr</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">gdprppppc</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">prop_male</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country_fac</span><span class="p">),</span><span class="w"> 
               </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_ready</span><span class="p">)</span><span class="w">

</span><span class="n">model7a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gamm</span><span class="p">(</span><span class="n">tfr</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">gdprppppc</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">prop_male</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">s</span><span class="p">(</span><span class="n">country_fac</span><span class="p">,</span><span class="w"> </span><span class="n">bs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'re'</span><span class="p">),</span><span class="w"> 
               </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_ready</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quasipoisson</span><span class="p">)</span><span class="w">


</span><span class="n">model7b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gamm</span><span class="p">(</span><span class="n">tfr</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">gdprppppc</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">prop_male</span><span class="p">,</span><span class="w">
               </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">country_fac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
               </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_ready</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quasipoisson</span><span class="p">)</span><span class="w">

</span><span class="n">model7c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gam</span><span class="p">(</span><span class="n">tfr</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">gdprppppc</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">prop_male</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="n">s</span><span class="p">(</span><span class="n">country_fac</span><span class="p">,</span><span class="w"> </span><span class="n">bs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'re'</span><span class="p">),</span><span class="w"> 
                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_ready</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quasipoisson</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"REML"</span><span class="p">)</span></code></pre></figure>

<p>These are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">model2</code> - fit with <code class="language-plaintext highlighter-rouge">lme4::lmer</code>, response variable is log-transformed first and then response is Gaussian, country level random effect is specified with <code class="language-plaintext highlighter-rouge">1 | country_fac</code> formula notation. Note that I <em>can’t</em> use <code class="language-plaintext highlighter-rouge">glmer</code> becuase it doesn’t allow family = quasipoisson.</li>
  <li><code class="language-plaintext highlighter-rouge">model7a</code> - fit with <code class="language-plaintext highlighter-rouge">mgcv::gamm</code> which is an iterative process where the mixed effects are with with <code class="language-plaintext highlighter-rouge">lmer</code> and smoothing splines are done with <code class="language-plaintext highlighter-rouge">gam</code>, iterate till converges. The end result contains the final version of both the <code class="language-plaintext highlighter-rouge">lme</code> model and the <code class="language-plaintext highlighter-rouge">gam</code> model. There’s no pre-transformation done of the response variable because we are using a generalized linear model with quasipoisson family - that is, variance is proportional to the mean, but not forced to be equal to it. The random country level effect is specified with <code class="language-plaintext highlighter-rouge">s(country_fac, bs = 're')</code> (<code class="language-plaintext highlighter-rouge">re</code> stands for random effects), which is passed on to <code class="language-plaintext highlighter-rouge">lme</code> that treats it as <code class="language-plaintext highlighter-rouge">Formula: ~1 | country_fac</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">model7b</code> - identical to 7a except the random effects are specified by <code class="language-plaintext highlighter-rouge">random = list(country_fac = ~ 1)</code></li>
  <li><code class="language-plaintext highlighter-rouge">model7c</code> - fit with <code class="language-plaintext highlighter-rouge">mgcv::gam</code>, using the same model specification as <code class="language-plaintext highlighter-rouge">model7b</code>. Unlike <code class="language-plaintext highlighter-rouge">gamm</code>, this does all the work within <code class="language-plaintext highlighter-rouge">gam</code> itself, there’s no iterating to the functions of the <code class="language-plaintext highlighter-rouge">lme4</code> package. There are limitations imposed as a result - the random effects can’t be correlated with eachother, and you can’t specify complex error structures (autocorrelation etc) like you could with <code class="language-plaintext highlighter-rouge">gamm</code> or <code class="language-plaintext highlighter-rouge">lmer</code>. But I don’t have a need for either of these things. <strong>Importantly</strong> <code class="language-plaintext highlighter-rouge">model7c</code> has to use restricted maximum likelihood as its estimation method if we want it to get equivalent results to the <code class="language-plaintext highlighter-rouge">lmer</code>-based methods.</li>
</ul>

<p>In the end, none of these models were referred to in my main post because I went for an approach based purely on the use of <code class="language-plaintext highlighter-rouge">gam()</code> and with various non-linear effects even in the base, null model. But it was a very useful learning experience for me to work out exactly what is and isn’t different in a bunch of similar model specifications.</p>

<h4 id="getting-the-same-fixed-coefficients">Getting the same fixed coefficients</h4>

<p>Here is code to extract the coefficients for the fixed effects from these four essentially identical models:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Fixed coefficients of the four similar linear models:</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">model7a</span><span class="o">$</span><span class="n">lme</span><span class="p">)</span><span class="o">$</span><span class="n">tTable</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">mod7a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">mod7b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pull</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">summary</span><span class="p">(</span><span class="n">model7b</span><span class="o">$</span><span class="n">lme</span><span class="p">)</span><span class="o">$</span><span class="n">tTable</span><span class="p">),</span><span class="w"> </span><span class="n">Value</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">mod7c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pull</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">summary</span><span class="p">(</span><span class="n">model7c</span><span class="p">)</span><span class="o">$</span><span class="n">p.table</span><span class="p">),</span><span class="w"> </span><span class="n">Estimate</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">mod2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixef</span><span class="p">(</span><span class="n">model2</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">across</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">),</span><span class="w"> </span><span class="n">round</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">))</span></code></pre></figure>

<p>which gives</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                          mod7a mod7b mod7c  mod2
X(Intercept)               3.55  3.55  3.53  3.65
Xgii                       1.30  1.30  1.30  1.27
Xlog(gdprppppc)           -0.34 -0.34 -0.34 -0.35
Xprop_male                -8.17 -8.17 -8.12 -8.52
Xlog(gdprppppc):prop_male  0.87  0.87  0.86  0.90
</code></pre></div></div>

<p>The biggest difference in the coefficients is with model2, not surprising because it has the biggest difference in its specification from the other three. The log transformation is done before modelling and the response is then treated as Gaussian, as opposed to the quasipoisson link and variance functions approach of the other three.</p>

<p>Note that from the above snippet of code that not least of the differences between these models is the different techniques used to extract those fixed coefficients.</p>

<h4 id="getting-the-same-group-level-random-effects">Getting the same group level random effects</h4>

<p>Another check that these models are basically the same was to compare the country-level random effects. For example, is the “Oman” effect going to be the same in each of these four models?</p>

<p>To answer this I first had to work out how to extract the random effects from the versions that used the <code class="language-plaintext highlighter-rouge">s(country_fac, bs = 're')</code> notation to set the random effects. It turns out the best way to do this is with the <a href="https://gavinsimpson.github.io/gratia/"><code class="language-plaintext highlighter-rouge">gratia</code> package</a> by Gavin Simpson (again), which has the <code class="language-plaintext highlighter-rouge">smooth_coefs</code> function for this and related purposes. So this next chunk of code extracts all those country effects and draws a pairs plot of them.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">tibble</span><span class="p">(</span><span class="w">
   </span><span class="n">rf2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ranef</span><span class="p">(</span><span class="n">model2</span><span class="p">)[[</span><span class="m">1</span><span class="p">]][,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w">
   </span><span class="n">rf7a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">smooth_coefs</span><span class="p">(</span><span class="n">model7a</span><span class="p">,</span><span class="w"> </span><span class="s2">"s(country_fac)"</span><span class="p">),</span><span class="w">
   </span><span class="n">rf7b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ranef</span><span class="p">(</span><span class="n">model7b</span><span class="o">$</span><span class="n">lme</span><span class="p">)[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w">
   </span><span class="n">rf7c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">smooth_coefs</span><span class="p">(</span><span class="n">model7c</span><span class="p">,</span><span class="w"> </span><span class="s2">"s(country_fac)"</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
   </span><span class="n">ggpairs</span><span class="p">()</span></code></pre></figure>

<p>Which gives this result, with a pleasing high correlation in the country effects of the four different models:</p>

<object type="image/svg+xml" data="/img/0290-country-effects-pairs.svg" width="100%"><img src="/img/0290-country-effects-pairs.png" width="100%" /></object>

<p>Again, model2 is a little different from the other three, for the same reason. I’m actually struck with how much we get near-identical results in a model that does the log transformation before modelling to those that use a log link function.</p>

<h3 id="showing-marginal-effects">Showing marginal effects</h3>

<p>At some point when playing around with the different ways of specifying models I was having trouble understanding some of the output—some coefficients I thought should be identical weren’t—and started building my own, very basic predicted mean values, by multiplying numbers by the coefficients. The original problem went away when I discovered some mistake or other, but I repurposed what I’d done into the code to produce this plot.</p>

<p>This is the sort of plot I’d been imagining to use to illustrate the interaction of the male housework variable with GDP per capita. I’d been expecting to see something like this once I’d seen the direction of the trend swap around in high income countries compared to low income countries:</p>

<object type="image/svg+xml" data="/img/0290-home-made-preds.svg" width="100%"><img src="/img/0290-home-made-preds.png" width="100%" /></object>

<p>This plot was produced with this very hacked-together, brittle, function that multiplies variables by their coefficients:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Manual way of building a plot. Not even using predict()</span><span class="w">
</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fixef</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span><span class="w">

</span><span class="cd">#' Predict TFR given those coefficients</span><span class="w">
</span><span class="n">calc_tfr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">prop_male</span><span class="p">,</span><span class="w"> </span><span class="n">gdp</span><span class="p">,</span><span class="w"> </span><span class="n">gii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">model_ready</span><span class="o">$</span><span class="n">gii</span><span class="p">)){</span><span class="w">
  </span><span class="nf">exp</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> 
      </span><span class="n">b</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gii</span><span class="w"> </span><span class="o">+</span><span class="w"> 
      </span><span class="n">b</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">gdp</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
      </span><span class="n">b</span><span class="p">[</span><span class="m">4</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">prop_male</span><span class="w"> </span><span class="o">+</span><span class="w"> 
      </span><span class="n">b</span><span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">prop_male</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">gdp</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Home-made prediction plot to show the interaction effect:</span><span class="w">
</span><span class="n">tibble</span><span class="p">(</span><span class="n">prop_male</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.45</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w">
       </span><span class="n">gdp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">3000</span><span class="p">,</span><span class="w"> </span><span class="m">10000</span><span class="p">,</span><span class="w"> </span><span class="m">80000</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">tfr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">calc_tfr</span><span class="p">(</span><span class="n">prop_male</span><span class="p">,</span><span class="w"> </span><span class="n">gdp</span><span class="p">)),</span><span class="w">
         </span><span class="n">gdp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dollar</span><span class="p">(</span><span class="n">gdp</span><span class="p">),</span><span class="w">
         </span><span class="n">gdp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_relevel</span><span class="p">(</span><span class="n">gdp</span><span class="p">,</span><span class="w"> </span><span class="s2">"$3,000"</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop_male</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdp</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tfr</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_ready</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Proportion of adult housework done by men"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Predicted total fertility rate"</span><span class="p">,</span><span class="w">
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Interaction of income, housework done by men on fertility rate"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Calculations done for a hypothetical country that otherwise has the average Gender Inequality Index"</span><span class="p">,</span><span class="w">
       </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PPP GDP per capita"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">full_caption</span><span class="p">)</span></code></pre></figure>

<p>It’s not something I’d use for real because I’d want to calculate the standard errors at each point too. At some point, we say that’s what the various package authors gave us the <code class="language-plaintext highlighter-rouge">predict</code> method for the classes they made holding fitted models. But even using <code class="language-plaintext highlighter-rouge">predict</code> and applying it to a carefully chosen grid of values is made easy these days by the <a href="https://doi.org/10.18637/jss.v111.i09"><code class="language-plaintext highlighter-rouge">marginaleffects</code> package</a>, by Vincent Arel-Bundock, Noah Greifer and Andrew Heiss. I was using this for the first serious time in this exercise.</p>

<p>It turns out that <code class="language-plaintext highlighter-rouge">marginaleffects</code> is great for this purpose; easy to use to get you a nearly good enough plot. Here’s the results of the <code class="language-plaintext highlighter-rouge">marginaleffects::predict_plot()</code></p>

<object type="image/svg+xml" data="/img/0290-margeff-preds.svg" width="100%"><img src="/img/0290-margeff-preds.png" width="100%" /></object>

<p>It’s like my home-made plot, but better in at least one respect; it has confidence intervals. There were some hitches in scales and guides:</p>

<ul>
  <li>the y axis really wanted to be labelled on the scale of the linear predictor, and in the end I let it have its way and add a secondardy axis on the right hand side labelled on the original scale</li>
  <li>controling the colour scale looked to be non-trivial, as did labelling it with $ signs. In the end I didn’t persist on this; there are ways to get <code class="language-plaintext highlighter-rouge">plot_predictions</code> to give you the data rather than draw a plot, but I didn’t slow things down.</li>
</ul>

<p>Here’s the nice and simple code to draw that; the “nice and simple” bit partiuclarly referring to the easy way you can specify the variables’ values to illustrate. Once I’d realised how easy this was, I used it for the rest of the blog post, including the considerably more complex generalized additive models that were my actual preferred models.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot_predictions</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
  </span><span class="s2">"prop_male"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"gdprppppc"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3000</span><span class="p">,</span><span class="w"> </span><span class="m">10000</span><span class="p">,</span><span class="w"> </span><span class="m">80000</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">trans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transform_exp</span><span class="p">(),</span><span class="w">
                     </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">)),</span><span class="w">
                     </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">,</span><span class="w">
                     </span><span class="n">sec.axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sec_axis</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Total Fertility Rate"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log(total fertility rate)"</span><span class="p">,</span><span class="w">
       </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PPP GDP per capita"</span><span class="p">,</span><span class="w">
       </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PPP GDP per capita"</span><span class="p">,</span><span class="w">
       </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Proportion of adult housework done by men"</span><span class="p">,</span><span class="w">
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Interaction of income, housework done by men on fertility rate"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Calculations done for a hypothetical country that otherwise has the average Gender Inequality Index"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">full_caption</span><span class="p">)</span><span class="w">
</span><span class="c1"># note the warning that this only takes into account the uncertainty of</span><span class="w">
</span><span class="c1"># fixed-effect parameters. This is probably ok? if we are interested in </span><span class="w">
</span><span class="c1"># the causality rather than predicting new countries?</span></code></pre></figure>

<h3 id="modelling-choices-and-checks">Modelling choices and checks</h3>

<h4 id="detoured-into-the-garden-of-forking-paths">Detoured into the garden of forking paths?</h4>
<p>Now, all that stuff in the previous section is mostly cosmetics. Keen readers will have noticed that the model described there is not the one I used in the main blog at all. In particular, it has a straightforward linear interaction of GDP per capita and male housework, whereas I ultimately used a smoothed spline interaction instead; I added a smoothed time effect; and made gender inequality index also a non-linear spline.</p>

<p>To refresh memories, the two models contrasted in the main blog were these two:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">model4b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gam</span><span class="p">(</span><span class="n">tfr</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">gii</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">gdprppppc</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">country_fac</span><span class="p">,</span><span class="w"> </span><span class="n">bs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'re'</span><span class="p">),</span><span class="w"> 
                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_ready</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quasipoisson</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"REML"</span><span class="p">)</span><span class="w">

</span><span class="n">model6b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gam</span><span class="p">(</span><span class="n">tfr</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">gii</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">gdprppppc</span><span class="p">),</span><span class="w"> </span><span class="n">prop_male</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">country_fac</span><span class="p">,</span><span class="w"> </span><span class="n">bs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'re'</span><span class="p">),</span><span class="w"> 
                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_ready</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quasipoisson</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"REML"</span><span class="p">)</span></code></pre></figure>

<p>I found <code class="language-plaintext highlighter-rouge">model6b</code> explained virtually no extra deviance compared to <code class="language-plaintext highlighter-rouge">model4b</code>. The difference between <code class="language-plaintext highlighter-rouge">model6b</code> and the <code class="language-plaintext highlighter-rouge">model2</code> used above is all the <code class="language-plaintext highlighter-rouge">s()</code> splines, and the nuisance effect of <code class="language-plaintext highlighter-rouge">time_period</code> being controlled for.</p>

<p>If you look at the plot in the previous section showing the marginal effect of increased male domestic work from the linear model with no splines, it appears to be significant. And the output seems to confirm this—the summary below shows the male domestic work as negatively related to fertility, and its interaction with GDP per capita as positively related (so for higher GDP per capita AND higher levels of male housework, total fertility rate goes up). These are clearly significant at conventional levels. And <strong>this is the opposite of what I reported in my blog</strong>, which was that there was no male housework impact on fertility when we control for gender inequality and GDP per capita.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; summary(model2, cor = FALSE)
Linear mixed model fit by REML ['lmerMod']
Formula: ltfr ~ gii + log(gdprppppc) * prop_male + (1 | country_fac)
   Data: model_ready

REML criterion at convergence: -149.8

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-3.03513 -0.41571  0.07449  0.46057  2.51483 

Random effects:
 Groups      Name        Variance Std.Dev.
 country_fac (Intercept) 0.037475 0.1936  
 Residual                0.008724 0.0934  
Number of obs: 172, groups:  country_fac, 79

Fixed effects:
                         Estimate Std. Error t value
(Intercept)               3.65360    0.60667   6.022
gii                       1.26916    0.20080   6.320
log(gdprppppc)           -0.34957    0.06275  -5.571
prop_male                -8.51667    2.05957  -4.135
log(gdprppppc):prop_male  0.90124    0.21501   4.192
</code></pre></div></div>

<p>This is where I come to a problem that actually worries me—did I go down the garden of forking paths? You could accuse me of making the model more complex—by adding a time effect, non-linear gender inequality effect and GDP per capita effects—until I got the desired result, of no remaining deviance explained by male time spent on housework.</p>

<p>My defence against this has to be that I always intended to add in these non-linear effects, and that I’d only stopped to specify these models without them because I wanted to check out the <code class="language-plaintext highlighter-rouge">lmer</code> v <code class="language-plaintext highlighter-rouge">gam</code> v <code class="language-plaintext highlighter-rouge">gamm</code> specification question. And this is true. But it’s also true that I had expected that even without non-linear splines added, the male time on housework would be non-significant; an expectation that turned out to be mistaken.</p>

<p>In fact, before going down the <code class="language-plaintext highlighter-rouge">lmer</code> v <code class="language-plaintext highlighter-rouge">gam</code> v <code class="language-plaintext highlighter-rouge">gamm</code> rabbit hole, I had started with a <code class="language-plaintext highlighter-rouge">model0</code>, specified by this:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># A basic null model:</span><span class="w">
</span><span class="n">model0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">ltfr</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">gdprppppc</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country_fac</span><span class="p">),</span><span class="w"> 
                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_ready</span><span class="p">)</span></code></pre></figure>

<p>I had then done this diagnostic check, and a plot of the residual fertility rate against male housework (bottom right panel in the plot below):</p>

<object type="image/svg+xml" data="/img/0290-diagnose-0.svg" width="100%"><img src="/img/0290-diagnose-0.png" width="100%" /></object>

<p>This seemed (visually) like only random noise remained, and I probably got careless in assuming that splines and stuff, while where I wanted to head, weren’t essential, hence it was ok to fit these linear models first. It’s just that when it turned out that there was an apparent “significant” effect from doing this, I was left with a dirty taste in my mouth that I was trying fitting models until I found the one that suited my expectation (of no male housework effect after controlling for gender inequality and GDP per capita).</p>

<p>Luckily, this is only a blog; no-one expects me to pre-register my analytical plan for it; and anyway I am convinced of the substance of the final finding; and I really do remember intending to use the versions with splines. But I’m guessing a lot of researchers feel this when they exercise their researcher degrees of freedom.</p>

<h4 id="spline-v-tensor-product-smooths">Spline v tensor product smooths</h4>

<p>When I posted the main blog, <a href="https://bsky.app/profile/stephenjwild.bsky.social/post/3lwgwggqdtc2z">Stephen Wild made the following comment</a>: “I’m curious about <code class="language-plaintext highlighter-rouge">s(log(gdprppppc), prop_male)</code> in your model rather than <code class="language-plaintext highlighter-rouge">ti(log(gdprppppc), prop_male)</code>”. In fact, I hadn’t considered this option, and I should have. So after this comment I went back and fit a new model with tensor product smooths. Note that it’s also necessary to add the <code class="language-plaintext highlighter-rouge">ti(prop_male) + ti(log(gdprppppc)</code> single terms explicitly in this case, unlike when using <code class="language-plaintext highlighter-rouge">s()</code>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">model6c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gam</span><span class="p">(</span><span class="n">tfr</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">gii</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
                   </span><span class="n">ti</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">gdprppppc</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ti</span><span class="p">(</span><span class="n">prop_male</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ti</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">gdprppppc</span><span class="p">),</span><span class="w"> </span><span class="n">prop_male</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
                   </span><span class="n">s</span><span class="p">(</span><span class="n">country_fac</span><span class="p">,</span><span class="w"> </span><span class="n">bs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'re'</span><span class="p">),</span><span class="w"> 
                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_ready</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quasipoisson</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"REML"</span><span class="p">)</span></code></pre></figure>

<p>That way of specifying the individual terms with eg <code class="language-plaintext highlighter-rouge">ti(prop_male)</code> isn’t one of those suggested <a href="https://gavinsimpson.github.io/nso-2022-workshop/03-gams/index.html#48">by Gavin Simpson here</a>; I think it’s ok though. If not I’ll doubtless have a future blog trying to get this straight in my head.</p>

<p>Now, ideally I would have a digression here where I explain the theoretical and practical differences between spline and tensor product smooths and when to use each, but I’m not feeling up to that. One thing I know is that a tensor product smooth is invariant to changes in the original scale of the variable, which would make it more robust if you’re concerned about different scales of your different variables; this seems to me the main point emphasised when this issue is discussed in Gavin Simpson’s <a href="https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331">definitive book on generalized additive models in R</a></p>

<p>Anyway, in this particular case there’s little to chose from, as seen in this thrown together collection of plots. Those in the top show the GDP per capita and male housework effects when using a tensor product smooth; those at the bottom are the same when using a spline:</p>

<p><img src="/img/0290-compare-ti-and-s.png" width="100%" /></p>

<p>My hunch is that the tensor product smooth is a bit better here, but I won’t change history by editing the main blog to use it. The addition of the <code class="language-plaintext highlighter-rouge">male_prop</code> variable still isn’t statistically ‘significant’; while we can see that for higher income countries there is a bit of an upwards slope (in the top right panel of the collection of plots above), it’s not explaining a material amount of extra material.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; summary(model6c)

Family: quasipoisson 
Link function: log 

Formula:
tfr ~ s(time_period) + s(gii, k = 3) + ti(log(gdprppppc)) + ti(prop_male) + 
    ti(log(gdprppppc), prop_male) + s(country_fac, bs = "re")

Parametric coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.68636    0.02561    26.8   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Approximate significance of smooth terms:
                                edf Ref.df      F  p-value    
s(time_period)                2.742  3.357  5.425 0.001134 ** 
s(gii)                        1.342  1.458 33.437  &lt; 2e-16 ***
ti(log(gdprppppc))            3.485  3.652  6.563 0.000112 ***
ti(prop_male)                 1.000  1.001  0.418 0.519799    
ti(log(gdprppppc),prop_male)  1.761  1.940  2.119 0.175333    
s(country_fac)               64.879 78.000  7.850  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

R-sq.(adj) =  0.964   Deviance explained = 97.7%
-REML = -176.7  Scale est. = 0.013138  n = 172

&gt; anova(model6c, model4c)
Analysis of Deviance Table

Model 1: tfr ~ s(time_period) + s(gii, k = 3) + ti(log(gdprppppc)) + ti(prop_male) + 
    ti(log(gdprppppc), prop_male) + s(country_fac, bs = "re")
Model 2: tfr ~ s(time_period) + s(gii, k = 3) + ti(log(gdprppppc)) + s(country_fac, 
    bs = "re")
  Resid. Df Resid. Dev      Df Deviance F Pr(&gt;F)
1    82.875     1.2599                          
2    86.013     1.2055 -3.1375 0.054375  
</code></pre></div></div>

<p>There’s negligible extra deviance explained by the model with the <code class="language-plaintext highlighter-rouge">prop_male</code> and its GDP interaction, compared to the simpler model without them.</p>

<h3 id="concluding-remarks">Concluding remarks</h3>

<p>Actually, I don’t really have much to add here.</p>

<p>I could have talked more about some of this, eg that unexplained <code class="language-plaintext highlighter-rouge">k=3</code> in the spline for gender inequality, and my thinking about diagnostic plots for GAMs (and my rushed, imperfect implementation of it); but at some point there are diminishing marginal returns. I’ve covered off the main things here; mostly things that I think future-me will want to refer to next time I’m doing similar things.</p>

<p>For some people, it’s probably worth checking out the <a href="https://github.com/ellisp/blog-source/blob/master/_working/0290-house-work.R">full script of original code</a> if there’s additional points of interest or questions.</p>


		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2025/08/15/timeuse-summary">Men's domestic chores and fertility rates - Part I</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2025/09/07/png">Some Papua New Guinea data doodles</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>

			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<p>Find me on <a rel="me" href="https://bsky.app/profile/freerangestats.info">Bluesky</a> or <a rel="me" href="https://mastodon.social/@peter_ellis">Mastodon</a>.</p>
			<hr></hr>
			


       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			
			<p>I've never been an academic but have written a few small things and hence have a <a href='https://scholar.google.com/citations?view_op=list_works&hl=en&user=MEtLNDMAAAAJ'>Google Scholar profile</a></p>
			
			<p>I read a lot of books. In the unlikely event you want to see what I think about them or what I'm reading at the moment, <a href='https://www.goodreads.com/user/show/55517482-peter-ellis'>follow me on Goodreads</a>.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			
			<h4>Bluesky feed:</h3>
         <script src="https://cdn.jsdelivr.net/npm/bsky-embed/dist/bsky-embed.es.js" async></script>
<bsky-embed  
  username="freerangestats.info"  
  limit="5"  
>  
</bsky-embed>

    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>