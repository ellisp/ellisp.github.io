      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Sankey plots can work, but need polishing like any other graphic</title>
      	
         
         
            <meta name ="description" content ="I set out to improve a Sankey plot that had been shared as an example of how bad they are, and hopefully show that some careful design decisions and polish can make these plot useful for purposes like seeing cohorts' progress (up, down, same) over time.">
            <meta property="og:description" content ="I set out to improve a Sankey plot that had been shared as an example of how bad they are, and hopefully show that some careful design decisions and polish can make these plot useful for purposes like seeing cohorts' progress (up, down, same) over time.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Sankey plots can work, but need polishing like any other graphic" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0297-polished-sankey.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2025/06/25/sankey-charts.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
	        <!--	  <li><a href="/blog/most-popular.html">ordered by popularity</a></li> -->
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2025/08/15/timeuse-summary>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Sankey plots can work, but need polishing like any other graphic</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I set out to improve a Sankey plot that had been shared as an example of how bad they are, and hopefully show that some careful design decisions and polish can make these plot useful for purposes like seeing cohorts' progress (up, down, same) over time.</p>
	   <p class="meta">25 Jun 2025</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <p>So a <a href="https://bsky.app/profile/emilymoin.com/post/3ls7jdqgp6224">critical discussion of Sankey plots</a> floated across my feed on Bluesky recently, and one reply included an ugly example and the comment “Anybody who thought that this illustration enhanced clarity lives in an alternative reality”. The actual chart I’ve included at the bottom of this post. I agree it’s pretty unhelpful, but I thought I saw potential, and said so. This blog is me seeing if in fact something can be done with it.</p>

<p>The post that started the discussion was Emily Moin saying “Sankey diagrams are just as bad as pie charts, and also worse because conventional wisdom has not rejected them yet so I still have to look at them”. As it happens, I think that even pie charts have their (very limited) place so long as they are carefuly chosen (not when too many categories, for example) and properly polished for the audience. So I guess I am being consistent in thinking that Sankey charts can also be useful.</p>

<p>Here’s what I think is wrong with the original graphic (which is reproduced later in this post), which I think is tracking the progression of patients experiencing symptoms of varying severity over a period of six weeks:</p>
<ul>
  <li>The labels clutter the image and have a lot of redundant information repeated multiple times (“Severity Week…”)</li>
  <li>The weeks and severity are both measured in numbers and presented together in the labels, making a significant cognitive load to parse the labels (“Severity Week 0: 3” takes some effort to work out the severity is 3 and the week is 0, which is exactly the sort of thing you want to intuit directly from position or colour in a plot rather than have to read it)</li>
  <li>The colours aren’t colour-blind friendly.</li>
  <li>Although the colours are mapped appropriately to the severity scale (blue for low severity, green to mid and red for high) there’s no legend to draw this to the reader’s attention, and because of the ordering of ribbons on the page (see next point) this sequencing of colours is never obvious to the reader.</li>
  <li>The nodes representing severity in a given week aren’t in any fixed order on the page, and change from week to week. They seem to have been chosen more to get the severity levels with more patients towards the centre of the chart. This stops the reader getting any easy reading of severity (which could have been mapped to vertical position in the plotting area) and adds to the cluttered and complex feel of the plot - for example by having the blue ribbon for severity 2 jumping from near the bottom of the plot in weeks 0 and 1 to the top in weeks 3 and 6.</li>
</ul>

<p>You’ll need to go down a bit in the post to see that original graphic; you’ll see that the combined effect of these problems is indeed one of complexity and clutter. I think the last point - the severity nodes swapping places vertically - is the most important.</p>

<p>I had a go at improving this and came up with a couple of alternatives, using <a href="https://github.com/davidsjoberg/ggsankey">David Sjoberg’s <code class="language-plaintext highlighter-rouge">ggsankey</code> R package</a>. Here’s a Sankey plot version:</p>

<object type="image/svg+xml" data="/img/0297-polished-sankey.svg" width="100%"><img src="/img/0297-polished-sankey.png" width="100%" /></object>

<p>… and here’s an alluvial plot version. Alluvial plots are similar to Sankey plots but have no spaces between the nodes, which means in this case you can read the nodes vertically at each week similarly to a stacked bar chart:</p>
<object type="image/svg+xml" data="/img/0297-polished-alluvial.svg" width="100%"><img src="/img/0297-polished-alluvial.png" width="100%" /></object>

<p>Here’s the original graphic for comparison:</p>

<p><img src="/img/0297-severity-sankey.jpg" width="100%" /></p>

<p>I’m pretty confident that either the Sankey or alluvial plot are definite improvements and give a better sense of the average severity in each week, and the overall trend (which is more blue, low severity cases). While still giving a sense of people moving in multiple directions (sometimes upwards) from each severity-week combination. So I think I’ve addressed the main points here:</p>
<ul>
  <li>Decluttered the labels by having axis labels for “Week zero”, “Week one”, etc; meaning we don’t need to repeat this in each node. And the node label is now just the single number of the severity.</li>
  <li>Avoided the cognitive load of week and severity both being numerals, partly by the simplified labels above and partly by spelling out weeks in English words (one, three, etc) rather than numerals.</li>
  <li>Chosen a more colour-blind friendly palette based on the Brewer Red-Yellow-Blue scheme rather than Red-Green-Blue</li>
  <li>I still don’t have a legend, but I think it is now much clearer to the reader that red is high severity and blue is low, because of the vertical sequencing of the nodes…</li>
  <li>… which is the main fix here - I’ve strictly ordered the 1,2,3,4,5,6,7 severity nodes vertically so they never swap positions. This means less crossing-of-the-beams and hence less feel of complexity in the plot. Most importantly, it gives the eye an easy way to judge the proportion of people in each severity level by vertical position and size on the page.</li>
</ul>

<p>I’ve left all the code at the end because most of it was about me trying to put together by hand a dataset that resembles that in the original flow chart. Then I had to calibrate it in R to fix the problems in my hand-made version. This included problems like the number of people changing from week to week, and the number of people entering a particular severity state in one week not matching the number exiting it. Once that stuff is dealt with, drawing the actual plot is a relatively simple <code class="language-plaintext highlighter-rouge">ggplot2</code> and <code class="language-plaintext highlighter-rouge">ggsankey</code> chunk of code.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">janitor</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glue</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">
</span><span class="n">remotes</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"davidsjoberg/ggsankey"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggsankey</span><span class="p">)</span><span class="w"> </span><span class="c1"># one fairly straightforward approach to sankey charts / flow diagrams</span><span class="w">

</span><span class="c1"># read in some data. This was very crudely hand-entered with some</span><span class="w">
</span><span class="c1"># rough visual judgements based from a chart that I don't know the</span><span class="w">
</span><span class="c1"># origin of I saw on the internet. So treat as made-up example data:</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/ellisp/blog-source/refs/heads/master/data/complicated-sankey-data.csv"</span><span class="p">,</span><span class="w"> 
              </span><span class="n">col_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ccccd"</span><span class="p">,</span><span class="w">
              </span><span class="c1"># we want the NAs in the original to be characters, not actual NA:</span><span class="w">
              </span><span class="n">na</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"missing"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">clean_names</span><span class="p">()</span><span class="w">

</span><span class="c1">#------------tidying up data---------------</span><span class="w">
</span><span class="c1"># we have some adjustments to deal with because of having made up data</span><span class="w">

</span><span class="c1"># An extra bunch of rows of data that are needed by the Sankey function to</span><span class="w">
</span><span class="c1"># to make the week 6 nodes show up:</span><span class="w">
</span><span class="n">extras</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">week_to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"6"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="w">
    </span><span class="n">week_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"6"</span><span class="p">,</span><span class="w">
    </span><span class="n">week_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> 
    </span><span class="n">severity_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">severity_to</span><span class="p">)</span><span class="w">

</span><span class="cd">#' Convenience relabelling function for turning week numbers into a factor:</span><span class="w">
</span><span class="n">weekf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">case_when</span><span class="p">(</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"Week zero"</span><span class="p">,</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"Week one"</span><span class="p">,</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"Week three"</span><span class="p">,</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"Week six"</span><span class="w">
  </span><span class="p">)</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Week zero"</span><span class="p">,</span><span class="s2">"Week one"</span><span class="p">,</span><span class="s2">"Week three"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Week six"</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># going to start by treating all flow widths as proportions </span><span class="w">
</span><span class="n">total_people</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">

</span><span class="c1"># add in the extra data rows to show the final week of nodes,</span><span class="w">
</span><span class="c1"># and relabel the weeks:</span><span class="w">
</span><span class="n">d2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">rbind</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span><span class="w">  </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">week_from</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">weekf</span><span class="p">(</span><span class="n">week_from</span><span class="p">),</span><span class="w">
         </span><span class="n">week_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weekf</span><span class="p">(</span><span class="n">week_to</span><span class="p">))</span><span class="w">

</span><span class="c1"># there should be the same total number of people each week,</span><span class="w">
</span><span class="c1"># and the same number of people leaving each "node" (a severity-week</span><span class="w">
</span><span class="c1"># combination) as arrived at it on the flow from the last week.</span><span class="w">
</span><span class="c1"># we have a little iterative process to clean this up. If we had</span><span class="w">
</span><span class="c1"># real data, none of this would be necessary; this is basically</span><span class="w">
</span><span class="c1"># because I made up data with some rough visual judgements:</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">){</span><span class="w">
  </span><span class="c1"># scale the data so the population stays the same week by week</span><span class="w">
  </span><span class="c1"># (adds up to total_people, which is 1, so are proportions)</span><span class="w">
  </span><span class="n">d2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">week_from</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">total_people</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">week_to</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">total_people</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w">   
  
  </span><span class="c1"># how many people arrived at each node (week-severity combination)?</span><span class="w">
  </span><span class="n">tot_arrived</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">week_from</span><span class="p">,</span><span class="w"> </span><span class="n">severity_from</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">arrived_sev_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">week_to</span><span class="p">,</span><span class="w"> </span><span class="n">severity_to</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">arrived_sev_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">  
    </span><span class="n">distinct</span><span class="p">(</span><span class="n">week_to</span><span class="p">,</span><span class="w"> </span><span class="n">severity_to</span><span class="p">,</span><span class="w"> </span><span class="n">arrived_sev_to</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># scale the data leaving the node to match what came in:</span><span class="w">
  </span><span class="n">d2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">left_join</span><span class="p">(</span><span class="n">tot_arrived</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"week_from"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"week_to"</span><span class="p">,</span><span class="w">
                                  </span><span class="s2">"severity_from"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"severity_to"</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">week_from</span><span class="p">,</span><span class="w"> </span><span class="n">severity_from</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_else</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">arrived_sev_to</span><span class="p">),</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> 
                                 </span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">arrived_sev_to</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">arrived_sev_to</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># manual check - these should all be  basically the same numbers</span><span class="w">
</span><span class="n">filter</span><span class="p">(</span><span class="n">tot_arrived</span><span class="p">,</span><span class="w"> </span><span class="n">week_to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Week one"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">severity_to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">filter</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">week_to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Week one"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">severity_to</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w">
</span><span class="n">filter</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">week_from</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Week one"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">severity_from</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w">


</span><span class="c1">#--------------draw plot-------------</span><span class="w">

</span><span class="c1"># palette that is colourblined-ok and shows sequence. This</span><span class="w">
</span><span class="c1"># actually wasn't too bad in the original, but it got lost</span><span class="w">
</span><span class="c1"># in the vertical shuffling of all the severity nodes:</span><span class="w">
</span><span class="n">pal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="nf">c</span><span class="p">(</span><span class="s2">"grey"</span><span class="p">,</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="s2">"RdYlBu"</span><span class="p">)[</span><span class="m">7</span><span class="o">:</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">pal</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"NA"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">)</span><span class="w">

</span><span class="c1"># Draw the actual chart. First, the base of chart, common to both:</span><span class="w">
</span><span class="n">p0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">uncount</span><span class="p">(</span><span class="n">weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">severity_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">severity_from</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"NA"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">)),</span><span class="w">
         </span><span class="n">severity_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">severity_to</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"NA"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">)))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">week_from</span><span class="p">,</span><span class="w"> 
             </span><span class="n">next_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">week_to</span><span class="p">,</span><span class="w">
             </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">severity_from</span><span class="p">,</span><span class="w"> 
             </span><span class="n">next_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">severity_to</span><span class="p">,</span><span class="w">
             </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">severity_from</span><span class="p">,</span><span class="w">
             </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">severity_from</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># default has a lot of white space between y axis and the data</span><span class="w">
  </span><span class="c1"># so reduce the expansion of x axis to reduce that</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">expand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pal</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Chart is still cluttered, but decreasing severity over time is apparent.
To achieve this, vertical sequencing is mapped to severity, and repetitive labels have been moved into the axis guides."</span><span class="p">,</span><span class="w">
       </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Data has been hand-synthesised to be close to an original plot of unknown provenance."</span><span class="p">)</span><span class="w"> 

</span><span class="c1"># Sankey plot:</span><span class="w">
</span><span class="n">p1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p0</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_sankey</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_sankey_label</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_sankey</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Roboto"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">,</span><span class="w">
        </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sarala"</span><span class="p">),</span><span class="w">
        </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Severity of an unknown disease shown in a Sankey chart"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Alluvial plot:</span><span class="w">
</span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p0</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_alluvial</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_alluvial_label</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_alluvial</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Roboto"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">,</span><span class="w">
        </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sarala"</span><span class="p">),</span><span class="w">
        </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Severity of an unknown disease shown in an alluvial chart"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Number of people"</span><span class="p">)</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span><span class="w"> </span><span class="c1"># Sankey plot</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span><span class="w"> </span><span class="c1"># alluvial plot</span></code></pre></figure>

<p>[Edited 8 July 2025 for black panel backgrounds for the Sankey and alluvial charts.]</p>


		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2025/06/14/more-on-fragile-p-values">More on power and 'fragile' p-values</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2025/08/15/timeuse-summary">Men's domestic chores and fertility rates - Part I</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<p>Find me on <a rel="me" href="https://bsky.app/profile/freerangestats.info">Bluesky</a> or <a rel="me" href="https://mastodon.social/@peter_ellis">Mastodon</a>.</p>
			<hr></hr>
			
			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>