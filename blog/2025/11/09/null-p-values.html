      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Distribution of p-values under the null hypothesis for discrete data</title>
      	
         
         
            <meta name ="description" content ="p-values under the null hypothesis do not necessarily have a uniform distribution.">
            <meta property="og:description" content ="p-values under the null hypothesis do not necessarily have a uniform distribution.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Distribution of p-values under the null hypothesis for discrete data" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0299-histogram-sig-only-1e+05.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2025/11/09/null-p-values.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
	        <!--	  <li><a href="/blog/most-popular.html">ordered by popularity</a></li> -->
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2025/11/30/pacific-population>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Distribution of p-values under the null hypothesis for discrete data</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>p-values under the null hypothesis do not necessarily have a uniform distribution.</p>
	   <p class="meta">09 Nov 2025</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="motivation">Motivation</h2>

<p>A few months back in a side skirmish during the great p-curve controversy, <a href="https://bsky.app/profile/rmcelreath.bsky.social/post/3lvx73m6jc22o">Richard McElreath mentioned</a> that p-values under the null hypothesis are not always uniformly distributed, as is sometimes claimed. This prompted me to check out the phenomenon. I’ll admit I had in my head the basic idea that p-values are indeed uniformly distributed if the null hypothesis is true. It turns out this is only ‘often’ the case, not always.</p>

<p>As is commonly the case for this blog, the main motivation was to make sure I understood something myself, so there’s nothing particularly new for the world in this blog. But it might be interesting for some. There were a few odd fishhooks.</p>

<p>I wanted to check the case where we are comparing the number of “successes” in a relatively small sample of binary success/failure outcomes, split into two groups. The null hypothesis is that the underlying probability for success is the same in each group. I wanted to see the distribution of the p-value for a test of this null hypothesis with sample sizes of 10, 100 or 1000 observations in each group; for different values of the underlying probability of success, and for when the groups’ sample size is random but mean 100.</p>

<h2 id="calculating-the-p-value">Calculating the p value</h2>

<p>The fishhooks were in how to calculate the p value. I actually went for three different ways:</p>
<ul>
  <li>My lazy approximation way is to estimate the variance of the difference between the two sample proportions under the null hypothesis and rely on asymptotic normality to get a probability of the value being as extreme as it actually is. This has the disadvantage of being known to be not particularly right particularly when the sample is small or the probability of success is close to 1 or 0. The advantage is I didn’t need to look anything up and it was easy to vectorise. This method is called <code class="language-plaintext highlighter-rouge">pval_hand</code> in the plot below.</li>
  <li>A better method is to use the <a href="https://en.wikipedia.org/wiki/Fisher's_exact_test">Fisher exact test</a>, as per the famous lady-tasting-tea analysis, but the out of the box method I was using (from the <code class="language-plaintext highlighter-rouge">corpora</code> R package by Stephanie Evert) doesn’t work when the observed successes in both samples is zero. This method is called <code class="language-plaintext highlighter-rouge">pval_fisher</code> in the plot below.</li>
  <li>The most out-of-the-box method of all is to use the <code class="language-plaintext highlighter-rouge">prop.test()</code> function from the <code class="language-plaintext highlighter-rouge">stats</code> package built into R. The disadvantage here was the bother in vectorising this function to run efficiently with large numbers of simulations. This method is called <code class="language-plaintext highlighter-rouge">pval_proptest</code> in the plot below.</li>
</ul>

<p>Because I was nervous about whether these methods might give materially different results I started by comparing the results they gave, with different sample sizes and underlying parameters, with just 1,000 repetitions for each combination of sample size and parameter. This gives this comparison:</p>

<object type="image/svg+xml" data="/img/0299-pairs-1000.svg" width="100%"><img src="/img/0299-pairs-1000.png" width="100%" /></object>

<p>So we can see that the <code class="language-plaintext highlighter-rouge">pval_fisher</code> and <code class="language-plaintext highlighter-rouge">pval_proptest</code> methods give effectively the same results, whereas my hand-made method has a significant number of discrepancies. Because of this I decided to stick with Evert’s <code class="language-plaintext highlighter-rouge">corpora::fisher.pval</code>. I just hardened it up with a wrapper function to define the p value (chance of seeing data as extreme as this, if the null hypothesis is true) to be 1 if the observed successes are 0 in both samples:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">corpora</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">GGally</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glue</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">frs</span><span class="p">)</span><span class="w"> </span><span class="c1"># for svg_png()</span><span class="w">

</span><span class="cd">#' Version of fisher.pval that won't break if k1 and k2 both 0</span><span class="w">
</span><span class="n">tough_fisher</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="p">,</span><span class="w"> </span><span class="n">n2</span><span class="p">,</span><span class="w"> </span><span class="n">set_both_zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">){</span><span class="w">
  </span><span class="n">problems</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">k1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="n">k1</span><span class="p">[</span><span class="n">problems</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
  </span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">corpora</span><span class="o">::</span><span class="n">fisher.pval</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="p">,</span><span class="w"> </span><span class="n">n2</span><span class="p">)</span><span class="w">
  </span><span class="n">temp</span><span class="p">[</span><span class="n">problems</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">set_both_zero</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># note needed a decision on what to do when k1 and k2 are both zero. I think</span><span class="w">
</span><span class="c1"># p value is 1 here, as p is the "probability of seeing data at least as extreme</span><span class="w">
</span><span class="c1"># as this if the null hypothesis of no difference is true". Not sure why Fisher's</span><span class="w">
</span><span class="c1"># exact test returns an error, worth looking into that. </span></code></pre></figure>

<h2 id="results">Results</h2>

<p>So with that problem out of the way, I set out to calculate lots of p-values. I did this in the situations</p>
<ul>
  <li>where the two groups were equally sized with 10, 100, or 1,000 observations each; or where they are a random number of observations, mean 100, still the same for each of the two groups; and</li>
  <li>with an underlying probability of success of 0.2, 0.5, or 0.8.</li>
</ul>

<p>The intution for some of the reason of why the p-values aren’t uniformly distributed is that with a finite sample and a a discrete outcome, there are only a finite number of possible values for the p-value. So of course it can’t have a perfectly uniform distribution, which implies a p-value taking any value between 0 and 1 with equal probability. Further down we see (approximately) how many possible values the p-value takes. The smaller the sample sizes, the more we would expect to see divergence from normality.</p>

<p>And that is exactly what we do see. Here is the full distribution of p-values for 100,000 simulations of each combination:</p>

<object type="image/svg+xml" data="/img/0299-histogram-1e+05.svg" width="100%"><img src="/img/0299-histogram-1e+05.png" width="100%" /></object>

<p>… and here is the distribution just of the p-values that are conventionally “significant” ie below 0.05:</p>

<object type="image/svg+xml" data="/img/0299-histogram-sig-only-1e+05.svg" width="100%"><img src="/img/0299-histogram-sig-only-1e+05.png" width="100%" /></object>

<p>I think there are a few interesting subtleties here. In particular:</p>

<ul>
  <li>When the size of the two groups is a random variable (but still equal) then the distribution of p-values is much more uniform (but still not exactly uniform). Basically there are many more possibiliities for the p-values to take with this extra randomness.</li>
  <li>The p-values are more non-uniform when the underlying probability for success is 0.5 in each case rather than 0.2 or 0.8</li>
  <li>The p-values can still be very non-uniform even with a large sample size of 1,000 observations per group (if underlying probability of success is close to 0.5)</li>
</ul>

<p>Here’s a potentialy interesting little insight into one of the reasons why this works that way - the <em>number</em> of different unique p-values that we get for each combination of sample size and underlying probabilities:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  size_lab    `Prob=0.2` `Prob=0.5` `Prob=0.8`
  &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;      &lt;int&gt;
1 n=10                32         38         31
2 n=100              391        533        403
3 n=1000            2915       3853       2903
4 n=Pois(100)       9812      12582       9898
</code></pre></div></div>

<p>I’m not drawing any conclusions in any metascience debates here. Just noting this interesting phenomenon in the distribution of p-values.</p>

<p>Here’s the rest of the code for doing these simulations.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Takes about 30 seconds with 100,000 reps</span><span class="w">
</span><span class="n">st</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">system.time</span><span class="p">({</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">reps</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1e3</span><span class="p">,</span><span class="w"> </span><span class="m">1e5</span><span class="p">)){</span><span class="w">
    </span><span class="n">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span><span class="w">
    
    </span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">expand_grid</span><span class="p">(</span><span class="w">
      </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reps</span><span class="p">),</span><span class="w">
      </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
      </span><span class="n">mutate</span><span class="p">(</span><span class="n">size_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">size</span><span class="p">),</span><span class="w"> </span><span class="s2">"n=Pois(100)"</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"n={size}"</span><span class="p">)),</span><span class="w">
             </span><span class="n">prob_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"Prob={prob}"</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
      </span><span class="n">mutate</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">size</span><span class="p">),</span><span class="w"> </span><span class="n">rpois</span><span class="p">(</span><span class="n">n</span><span class="p">(),</span><span class="w"> </span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
      </span><span class="n">mutate</span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">n</span><span class="p">(),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prob</span><span class="p">),</span><span class="w">
            </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">n</span><span class="p">(),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prob</span><span class="p">),</span><span class="w">
            </span><span class="c1"># observed proportions p1 and p2 from the two populations</span><span class="w">
            </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w">
            </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w">
            </span><span class="c1"># under null hypothesis, the equal probability of both pops:</span><span class="w">
            </span><span class="n">pmid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
            </span><span class="c1"># observed difference of the two proportions:</span><span class="w">
            </span><span class="n">delt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">p1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p2</span><span class="p">),</span><span class="w">
            </span><span class="c1"># variance of each of p1 and p2: p(1-p)/n</span><span class="w">
            </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pmid</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pmid</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w">
            </span><span class="c1"># standard deviation of the sum of two of those variances</span><span class="w">
            </span><span class="n">sddelt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">s1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s1</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
      </span><span class="c1"># calculate p values</span><span class="w">
      </span><span class="n">mutate</span><span class="p">(</span><span class="n">pval_hand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pnorm</span><span class="p">(</span><span class="n">delt</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sddelt</span><span class="p">)),</span><span class="w">
             </span><span class="n">pval_fisher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tough_fisher</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">),</span><span class="w">
             </span><span class="n">pval_proptest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w">
  
    </span><span class="k">if</span><span class="p">(</span><span class="n">reps</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">10000</span><span class="p">){</span><span class="w">
      </span><span class="c1"># when the number of reps is fairly small, I draw a pairs plot just to</span><span class="w">
      </span><span class="c1"># compare the different ways of calculating p values:</span><span class="w">
      </span><span class="c1"># - prop.test (out of the box R method). I couldn't find an easy way to vectorize this, </span><span class="w">
      </span><span class="c1">#   is why it is only done here, via a loop. when reps is small</span><span class="w">
      </span><span class="c1"># - pval_hand (my home made approximate method)</span><span class="w">
      </span><span class="c1"># - pval_fisher (Fisher exact test, but toughened up as above to give 1 when both k1 and k2 are 0)</span><span class="w">
      </span><span class="c1"># The main conclusion from this is that my by-hand aproximation isn't great!</span><span class="w">
      </span><span class="n">system.time</span><span class="p">({</span><span class="w">
        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">d</span><span class="p">)){</span><span class="w">
          </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
          </span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s2">"pval_proptest"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">prop.test</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">x2</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">size</span><span class="p">))</span><span class="o">$</span><span class="n">p.value</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">})</span><span class="w">
      </span><span class="c1"># 5 seconds for reps=1000</span><span class="w">
      
      </span><span class="n">plot1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(){</span><span class="w">
        </span><span class="n">d</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
          </span><span class="n">select</span><span class="p">(</span><span class="n">pval_hand</span><span class="o">:</span><span class="n">pval_proptest</span><span class="p">,</span><span class="w"> </span><span class="n">size_lab</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
          </span><span class="n">ggpairs</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
          </span><span class="n">print</span><span class="p">()</span><span class="w">
      </span><span class="p">}</span><span class="w">
      
      </span><span class="n">svg_png</span><span class="p">(</span><span class="n">plot1</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"0299-pairs-{reps}"</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w">      
    </span><span class="p">}</span><span class="w">
  
  
    </span><span class="n">plot2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
      </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pval_fisher</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">size_lab</span><span class="w">  </span><span class="o">~</span><span class="w"> </span><span class="n">prob_lab</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free_y"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Distribution of all p values when a null hypothesis is true"</span><span class="p">,</span><span class="w">
          </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Equal size binomial samples drawn from two populations with same underying probability"</span><span class="p">,</span><span class="w">
          </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"P value from Fisher's exact test
    (when zero positive cases in both samples, p value is set to one)"</span><span class="p">,</span><span class="w">
          </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"Count of simulations (out of {comma(reps)})"</span><span class="p">))</span><span class="w">
  
    </span><span class="n">plot3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">pval_fisher</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pval_fisher</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">size_lab</span><span class="w">  </span><span class="o">~</span><span class="w"> </span><span class="n">prob_lab</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free_y"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Distribution of significant (&lt;0.05) p values when a null hypothesis is true"</span><span class="p">,</span><span class="w">
         </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Equal size binomial samples drawn from two populations with same underying probability"</span><span class="p">,</span><span class="w">
         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"P value from Fisher's exact test
  (when zero positive cases in both samples, p value is set to one)"</span><span class="p">,</span><span class="w">
         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"Count of simulations (out of {comma(reps)})"</span><span class="p">))</span><span class="w">
  
      
    </span><span class="n">svg_png</span><span class="p">(</span><span class="n">plot2</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"0299-histogram-{reps}"</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w">     
    </span><span class="n">svg_png</span><span class="p">(</span><span class="n">plot3</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"0299-histogram-sig-only-{reps}"</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w">      
  
  </span><span class="p">}</span><span class="w">
</span><span class="p">})</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">st</span><span class="p">)</span><span class="w">

</span><span class="c1"># Number of unique p-values</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">prob_lab</span><span class="p">,</span><span class="w"> </span><span class="n">size_lab</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">number_p_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">pval_fisher</span><span class="p">)))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">spread</span><span class="p">(</span><span class="n">prob_lab</span><span class="p">,</span><span class="w"> </span><span class="n">number_p_values</span><span class="p">)</span></code></pre></figure>



		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2025/10/18/homicide-and-gini">Inequality and homicide, within-country and between country</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2025/11/30/pacific-population">Visual summaries of population in Pacific islands</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>

			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<p>Find me on <a rel="me" href="https://bsky.app/profile/freerangestats.info">Bluesky</a> or <a rel="me" href="https://mastodon.social/@peter_ellis">Mastodon</a>.</p>
			<hr></hr>
			


       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			
			<p>I've never been an academic but have written a few small things and hence have a <a href='https://scholar.google.com/citations?view_op=list_works&hl=en&user=MEtLNDMAAAAJ'>Google Scholar profile</a></p>
			
			<p>I read a lot of books. In the unlikely event you want to see what I think about them or what I'm reading at the moment, <a href='https://www.goodreads.com/user/show/55517482-peter-ellis'>follow me on Goodreads</a>.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			
			<h4>Bluesky feed:</h3>
         <script src="https://cdn.jsdelivr.net/npm/bsky-embed/dist/bsky-embed.es.js" async></script>
<bsky-embed  
  username="freerangestats.info"  
  limit="5"  
>  
</bsky-embed>

    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>