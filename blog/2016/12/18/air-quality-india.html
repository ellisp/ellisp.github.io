      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Air quality in Indian cities</title>
      	
         
         
            <meta name ="description" content ="Air pollution in Indian cities is unambiguously seasonal, and also might have a Diwali impact.">
            <meta property="og:description" content ="Air pollution in Indian cities is unambiguously seasonal, and also might have a Diwali impact.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Air quality in Indian cities" />
         
            <meta property="og:image" content="http://ellisp.github.io/img/0073-decomp.png" />
         
		 
			<meta property="og:url" content="http://freerangestats.info/blog/2016/12/18/air-quality-india.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2020/11/14/aid-attitudes>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Air quality in Indian cities</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>Air pollution in Indian cities is unambiguously seasonal, and also might have a Diwali impact.</p>
	   <p class="meta">18 Dec 2016</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="seasonal-air-pollution-in-india">Seasonal air pollution in India</h2>
<p>The motivation for this blog post was a conference paper I recently heard that analysed five years of daily pollution data in an India city with a non-seasonal auto-regressive integrated moving average (ARIMA) model.  In discussion after the presentation, there were differing views on whether such data should be modelled with a seasonal approach, and I wanted to look at some data to see for myself (disclaimer - I was one of the pro-seasonal camp).</p>

<p>To cut to the chase, ultimately I was looking at this sort of obviously seasonal result:</p>

<p><img src="/img/0073-decomp.png" alt="decomp" /></p>

<h2 id="open-air-quality-data">Open Air Quality Data</h2>
<p>But first thing was to get some data.  I didn’t have access to the original data but was aware of other sources, with shorter time spans, but hopefully still enough for my purposes.  My first call was the <a href="https://openaq.org/#/locations?page=3&amp;countries=AU&amp;_k=iz4lwf">openaq Air Quality Data</a> site and in particular the excellent <code class="highlighter-rouge">ropenaq</code> R package which speaks to the openaq API and makes it easy to access their data.  This looked very promising, but the data available are for far too short a period for me.  Here is the six months or so of data which is all that is available for Ahmedabad.</p>

<p><img src="/img/0073-openaq.svg" alt="openaq" /></p>

<p>For the record, here’s the R code that downloaded that data (nearly 23,000 observations - many observations per day) and drew the graph, and also set up the session for everything else done in the rest of this post</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Might need to uncomment out and run these next two lines if not already installed:
# devtools::install_github("Ather-Energy/ggTimeSeries")
# devtools::install_github("masalmon/usaqmindia")
</span><span class="w">
</span><span class="c1"># load up functionality
</span><span class="n">library</span><span class="p">(</span><span class="n">ropenaq</span><span class="p">)</span><span class="w"> </span><span class="c1"># sourced from OpenAQ, see https://github.com/ropensci/ropenaq
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">usaqmindia</span><span class="p">)</span><span class="w"> </span><span class="c1"># sourced from US Air Quality Monitoring, see https://github.com/masalmon/usaqmindia
</span><span class="n">library</span><span class="p">(</span><span class="n">forecastHybrid</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">seasonal</span><span class="p">)</span><span class="w">   </span><span class="c1"># for Diwali dates
</span><span class="n">library</span><span class="p">(</span><span class="n">ggseas</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="p">(</span><span class="n">holiday</span><span class="p">)</span><span class="w"> </span><span class="c1"># will be using this for "diwali"
</span><span class="w">
</span><span class="c1">#============openaq experiment================
# based on the example on the package page on GitHub
</span><span class="n">how_many</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">attr</span><span class="p">(</span><span class="n">aq_measurements</span><span class="p">(</span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ahmedabad"</span><span class="p">),</span><span class="w"> </span><span class="s2">"meta"</span><span class="p">)</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">how_many</span><span class="o">$</span><span class="n">found</span><span class="w"> </span><span class="c1"># unfortunately only goes back to mid 2015
</span><span class="n">results_ls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">
</span><span class="c1"># Limit is 1000 observations at once, so we bring them all in 1000 at a time:
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">ceiling</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1000</span><span class="p">)){</span><span class="w">
   </span><span class="n">results_ls</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aq_measurements</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"IN"</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ahmedabad"</span><span class="p">,</span><span class="w"> 
                                      </span><span class="n">date_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2010-01-01"</span><span class="p">,</span><span class="w"> 
                                      </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">   
   </span><span class="n">cat</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># convert into a data frame:
</span><span class="n">results_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="s2">"rbind"</span><span class="p">,</span><span class="w"> </span><span class="n">results_ls</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">arrange</span><span class="p">(</span><span class="n">dateLocal</span><span class="p">)</span><span class="w">

</span><span class="c1"># draw exploratory graph
</span><span class="n">results_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dateLocal</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
   </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">parameter</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free_y"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Air pollutants in Ahmedabad, 2016"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Value"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: OpenAQ"</span><span class="p">)</span></code></pre></figure>

<h2 id="us-embassy-and-consulate-india-air-quality-monitoring">US Embassy and Consulate India Air Quality Monitoring</h2>

<p>Luckily, the <a href="https://github.com/ropensci/ropenaq">GitHub page for the <code class="highlighter-rouge">ropenaq</code> R package</a> referenced a second R package, <a href="https://github.com/masalmon/usaqmindia"><code class="highlighter-rouge">usaqmindia</code></a>.  This package has tidied and bundled up various source CSV and PDF files <a href="https://in.usembassy.gov/embassy-consulates/new-delhi/air-quality-data/">published by the US State Department</a> on particulate matter concentrations in five Indian cities.  The R package might not be completely current, but it looks pretty good.  The particulate matter data are “commonly referred to as PM 2.5 because they are less than or equal to 2.5 microns in diameter”.</p>

<p>If your Indian geography is as rusty as mine you may appreciate this map of the five cities in question:</p>

<p><img src="/img/0073-map.svg" alt="map" /></p>

<p>… which was made with this code using the <code class="highlighter-rouge">ggmap</code> R package (yes, I looked up those latitude and longitudes and copied and pasted them by hand - there are better ways of doing this in general, but for just five cities this was simplest):</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#=========map of india========
</span><span class="n">cities</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_frame</span><span class="p">(</span><span class="w">
   </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Chennai"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Delhi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hyderabad"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Kolkata"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mumbai"</span><span class="p">),</span><span class="w">
   </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">13.067439</span><span class="p">,</span><span class="w"> </span><span class="m">28.644800</span><span class="p">,</span><span class="w"> </span><span class="m">17.387140</span><span class="p">,</span><span class="w"> </span><span class="m">22.572645</span><span class="p">,</span><span class="w"> </span><span class="m">19.0759837</span><span class="p">),</span><span class="w">
   </span><span class="n">long</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">80.2784700</span><span class="p">,</span><span class="w"> </span><span class="m">77.216721</span><span class="p">,</span><span class="w"> </span><span class="m">78.491684</span><span class="w">	</span><span class="p">,</span><span class="w"> </span><span class="m">88.363892</span><span class="p">,</span><span class="w">	</span><span class="m">72.8776559</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">india</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_map</span><span class="p">(</span><span class="s2">"India"</span><span class="p">,</span><span class="w"> </span><span class="n">zoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">maptype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"satellite"</span><span class="p">)</span><span class="w">

</span><span class="n">ggmap</span><span class="p">(</span><span class="n">india</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cities</span><span class="p">,</span><span class="w">  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">city</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme_nothing</span><span class="p">()</span></code></pre></figure>

<p>The original data published by the US has multiple observations for the five cities for most days, and some days missing observations altogether.  It’s not easy to spot patterns with this irregular data.  Here’s how it looks out of the box:</p>

<p><img src="/img/0073-six-cities-orig.svg" alt="raw" /></p>

<p>… which was created with this:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#=========US Air Quality Monitoring===========
</span><span class="n">data</span><span class="p">(</span><span class="s2">"pm25_india"</span><span class="p">)</span><span class="w">

</span><span class="n">pm25_india</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conc</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_line</span><span class="p">()</span></code></pre></figure>

<p>Those observations at concentration levels of 2000 looks suspicious for two reasons:</p>

<ul>
  <li>they are so high compared to other levels.  It’s plausible there are massive spikes some days, but it’s also plausible there’s something over-sensitive about the measuring device.  I lack the subject matter expertise and resources to decide, so simply note that I might want to carefully use robust methods.</li>
  <li>they are exactly 2000, which looks like some kind of truncation (ie the real values may be more than 2000, and 2000 is just the maximum value of the censors).</li>
</ul>

<p>To see patterns I want more regularised data.  As a first go, I tried taking the trimmed mean average observation for each day.  This gave me this graphic:</p>

<p><img src="/img/0073-six-cities-daily.svg" alt="daily" /></p>

<p>This is getting me somewhere.  The patterns in Kolkata and Mumbai are looking plausibly regular now.  This daily aggregation was made on the fly with this code:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># daily aggregation
</span><span class="n">pm25_india</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">datetime</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">avvalue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">conc</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avvalue</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free_y"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_line</span><span class="p">()</span></code></pre></figure>

<h2 id="aggregate-to-monthly-data">Aggregate to monthly data</h2>

<p>There are still a fair few days missing data altogether (apparent in the plot above by breaks in the lines).  So I decided that for my purposes it made sense to aggregate the data by month.  There’s all sorts of information that’s chucked out by this - variation on days within the month, and hours within the day; subtle treatment of the different number of days by month etc.  But it’s good enough for my purposes of examining seasonality, and in fact this summarising/aggregation process is probably the best way to investigate a broad annual seasonal pattern.  Just because we have large amount of irregular, granular data doesn’t mean we’re compelled to leave it in that state for analysis.  Here’s how it looks when aggregated at a monthly level:</p>

<p><img src="/img/0073-six-cities-monthly.svg" alt="monthly" /></p>

<p>Looking at the pattern for each month, the seasonality is very apparent; there is much more particulate matter in the air in the winter-centred November to February period, most noticeably in the four northern cities (ie less so in Chennai).  I don’t know enough about the subject matter to speculate if this is related purely to weather (the dominant factor being the <a href="https://en.wikipedia.org/wiki/Monsoon_of_South_Asia">May to November monsoon</a>), or to human response to seasons.</p>

<p><img src="/img/0073-monthplot.svg" alt="monthplots" /></p>

<p>We can decompose the monthly series into the trend, seasonal and random elements using the <code class="highlighter-rouge">ggseas</code> package to get a simultaneous view of scale and seasonality.  The GitHub page of the <code class="highlighter-rouge">usaqmindia</code> R package draws attention to the importance of the Hindu <a href="https://en.wikipedia.org/wiki/Diwali">Diwali ‘festival of lights’</a> - which involves fireworks, burning effigies, lamps, and general celebrations - for the particulate matter concentrations, so I’m interested in annotating graphics with those months. This gives us the graphic I started the post with:</p>

<p><img src="/img/0073-decomp.svg" alt="decomp" /></p>

<p>Here’s the code that did the above aggregation and analysis.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># monthly aggregation graphic:
</span><span class="n">pm25_india</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">mon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substring</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">mon</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">avvalue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">conc</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
   </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">mon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">mon</span><span class="p">,</span><span class="w"> </span><span class="s2">"-15"</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mon</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avvalue</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free_y"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey50"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">stat_stl</span><span class="p">(</span><span class="n">s.window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Airborne fine particulate matter in Indian cities (PM2.5)"</span><span class="p">,</span><span class="w">
           </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Showing original and seasonally adjusted"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Seasonal adjustment does not take Diwali into account"</span><span class="p">,</span><span class="w"> 
        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Trimmed mean monthly PM2.5 concentration"</span><span class="p">,</span><span class="w">
        </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Data: U.S. Embassy and Consulates in India"</span><span class="p">)</span><span class="w">
		
</span><span class="c1"># Create time series objects
</span><span class="n">pm25_monthly_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm25_india</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">mon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substring</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">mon</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">avvalue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">conc</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
   </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">spread</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">avvalue</span><span class="p">)</span><span class="w"> 

</span><span class="n">pm25_monthly_ts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm25_monthly_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">mon</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">map</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="n">ts</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2013</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)})</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">do.call</span><span class="p">(</span><span class="n">cbind</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w">

</span><span class="c1"># Month-plots
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">font.main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">){</span><span class="w">
   </span><span class="n">monthplot</span><span class="p">(</span><span class="n">pm25_monthly_ts</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">bty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w">
             </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
             </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">pm25_monthly_ts</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span><span class="w">   
   </span><span class="n">grid</span><span class="p">()</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#-------------Decomposition graphics----------------------   
# named palette assigning a colour to each city
</span><span class="n">palette</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="s2">"Set1"</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Delhi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Kolkata"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mumbai"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hyderabad"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Chennai"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Note that Diwali was in November 2013, October 2014, November 2015 in the relevant years
</span><span class="n">diwali</span><span class="p">[</span><span class="m">114</span><span class="o">:</span><span class="m">116</span><span class="p">]</span><span class="w">


</span><span class="c1"># Decomposition graphic:
</span><span class="n">pm25_monthly_ts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="n">pm25_monthly_ts</span><span class="p">),</span><span class="w">
          </span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="n">time</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">gather</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
   </span><span class="c1"># imputation: if value is missing, give it mean for that month and city:
</span><span class="w">   </span><span class="n">group_by</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="c1"># order city levels for drawing legend (there are better ways for doing this programmatically):
</span><span class="w">   </span><span class="n">mutate</span><span class="p">(</span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Delhi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Kolkata"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mumbai"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hyderabad"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Chennai"</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggsdc</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">city</span><span class="p">),</span><span class="w"> </span><span class="n">s.window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"right"</span><span class="p">)</span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Vertical lines show the month of Diwali, and any impact is seen in the 'irregular' series."</span><span class="p">,</span><span class="w"> 
        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Trimmed mean monthly PM2.5 concentration"</span><span class="p">,</span><span class="w">
        </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Data: U.S. Embassy and Consulates in India"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">palette</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Airborne fine particulate matter in Indian cities (PM2.5)"</span><span class="p">,</span><span class="w">
           </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Diwali makes an impact but is part of a broader seasonality"</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">month</span><span class="p">(</span><span class="n">diwali</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">diwali</span><span class="p">))[</span><span class="m">114</span><span class="o">:</span><span class="m">116</span><span class="p">],</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey50"</span><span class="p">)</span></code></pre></figure>

<h2 id="delhi-time-series-analysis">Delhi time series analysis</h2>

<p>Diwali’s date is in a different month from year to year, which means we have a naturally occuring experiment that lets us distinguish between the underlying seasonal impact of any month, and the particular effect of Diwali.  To investigate this further, I had a look at just the Delihi data, which is more complete than that of the other four cities even when aggregated to monthly level.</p>

<p>Here are graphics of the auto-correlation and partial auto-correlation functions of the Delhi monthly time series.  These show the strength of relationship between any particular observation and lagged versions of the series.  A lag of 1.0 means 12 months in this case.  The patterns we see are typical of a series with a noticeable seasonal impact and a strong relationship to the observation of the previous month:</p>

<p><img src="/img/0073-acf.svg" alt="acf" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">delhi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm25_monthly_ts</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"Delhi"</span><span class="p">]</span><span class="w">

</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">bty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">font.main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">acf</span><span class="p">(</span><span class="n">delhi</span><span class="p">)</span><span class="w">
</span><span class="n">pacf</span><span class="p">(</span><span class="n">delhi</span><span class="p">)</span></code></pre></figure>

<p>For analysis I was a little worried about second order stationarity, in particular whether the variance of monthly observations is higher when the mean observations are higher.  I also had in mind the possibility of using a model for forecasting.  While not shown in this already-too-long post, forecasting based on the original data hand a tendency for the lower range of the prediction interval to be negative, which isn’t possible and suggested the need for a transformation.  All these problems can be fixed by a <a href="https://en.wikipedia.org/wiki/Power_transform">Box-Cox power transform</a>.  The <code class="highlighter-rouge">BoxCox.lambda</code> function used below uses Guerrero’s 1993 method for choosing a value of <script type="math/tex">\lambda</script> that minimises the coefficient of variation of the time series.  With an estimated value of 0.21 for Delhi’s data (somewhere between a logarithm value of 0 and a square-root-like value of 0.5) this is well in the range of rule of thumb transformation commonly used for this sort of time series.</p>

<p>I use <script type="math/tex">\lambda = 0.21</script> for fitting an ARIMA model with a dummy variable for whether Diwali occurred in the month:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">BoxCox.lambda</span><span class="p">(</span><span class="n">delhi</span><span class="p">)</span><span class="w"> </span><span class="c1"># about 0.21.  Note that if we don't use this in forecasting there would be a tendency to forecast &lt; 0
</span><span class="w">
</span><span class="n">diwalix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">window</span><span class="p">(</span><span class="n">genhol</span><span class="p">(</span><span class="n">diwali</span><span class="p">),</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">(</span><span class="n">delhi</span><span class="p">),</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="p">(</span><span class="n">delhi</span><span class="p">))</span><span class="w">

</span><span class="n">mod0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">delhi</span><span class="p">,</span><span class="w"> </span><span class="n">xreg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diwalix</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.21</span><span class="p">)</span><span class="w">
</span><span class="n">mod0</span></code></pre></figure>

<p>That gives us these results, showing some modest evidence of a gentle drift downwards as well as a Diwali impact (0.46, with a standard error of 0.29 - well after all, it is only three years) within a seasonal ARIMA context</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Series</span><span class="o">:</span><span class="w"> </span><span class="n">delhi</span><span class="w"> 
</span><span class="n">ARIMA</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">)[</span><span class="m">12</span><span class="p">]</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">drift</span><span class="w">         
</span><span class="n">Box</span><span class="w"> </span><span class="n">Cox</span><span class="w"> </span><span class="n">transformation</span><span class="o">:</span><span class="w"> </span><span class="n">lambda</span><span class="o">=</span><span class="w"> </span><span class="m">0.21</span><span class="w"> 

</span><span class="n">Coefficients</span><span class="o">:</span><span class="w">
         </span><span class="n">ar1</span><span class="w">     </span><span class="n">sar1</span><span class="w">    </span><span class="n">drift</span><span class="w">  </span><span class="n">diwalix</span><span class="w">
      </span><span class="m">0.5400</span><span class="w">  </span><span class="m">-0.7709</span><span class="w">  </span><span class="m">-0.0164</span><span class="w">   </span><span class="m">0.4626</span><span class="w">
</span><span class="n">s.e.</span><span class="w">  </span><span class="m">0.1561</span><span class="w">   </span><span class="m">0.0990</span><span class="w">   </span><span class="m">0.0082</span><span class="w">   </span><span class="m">0.2969</span><span class="w">

</span><span class="n">sigma</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="n">estimated</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="m">0.1691</span><span class="o">:</span><span class="w">  </span><span class="n">log</span><span class="w"> </span><span class="n">likelihood</span><span class="o">=</span><span class="m">-20.41</span><span class="w">
</span><span class="n">AIC</span><span class="o">=</span><span class="m">50.83</span><span class="w">   </span><span class="n">AICc</span><span class="o">=</span><span class="m">53.14</span><span class="w">   </span><span class="n">BIC</span><span class="o">=</span><span class="m">58.16</span></code></pre></figure>

<p>A 95% confidence interval <code class="highlighter-rouge">confint(mod0)</code> for the Diwali impact is between -0.12 and +1.04 on the transformed scale.  This range includes zero so this analysis isn’t sufficient by itself to conclude it has an impact.  However, the power of this test would be pretty low (one of the prices paid for by the aggregation to the monthly level) and my intuitive Bayesian inside would be happy to say it is more likely than not that there is some impact of Diwali on particulate matter in the atmosphere in Delhi.</p>


		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2016/12/10/extrapolation">Extrapolation is tough for trees!</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2016/12/24/forecastHybrid-0.3">forecastHybrid 0.3.0 on CRAN</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
			<p>My day job is Chief Data Scientist at <a href='https://www.nousgroup.com/'>Nous Group</a>, an international management consultancy with over 400 people working across Australia, the UK and Canada. <a href='mailto:peter.ellis@nousgroup.com.au'>Contact me</a> if you are interested working with us on a grand challenge or broad agenda.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics
http://Http://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>