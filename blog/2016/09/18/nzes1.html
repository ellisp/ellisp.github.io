      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>New Zealand Election Study individual level data</title>
      	
         
         
            <meta name ="description" content ="Individual level data on voting behaviour are freely available from the New Zealand Election Study and everyone should have a go at analysing them!">
            <meta property="og:description" content ="Individual level data on voting behaviour are freely available from the New Zealand Election Study and everyone should have a go at analysing them!">
         
         <meta property="og:site_name" content="Peter's stats stuff" />
         <meta property="og:title" content="New Zealand Election Study individual level data" />
         
            <meta property="og:image" content="http://ellisp.github.io/img/0057-hagar.png" />
         
		 
			<meta property="og:url" content="http://ellisp.github.io/blog/2016/09/18/nzes1.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
           
          <link href="/css/bootstrap.min.css" rel ="stylesheet">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet">
            <link href="/css/custom.css" rel ="stylesheet">     
		<link href="/css/syntax.css" rel ="stylesheet">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="Peter's stats stuff by Peter Ellis"
      href="/feed.xml">


      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Peter's stats stuff</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">All blog posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">Ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">Ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">Grouped by subject matter</a></li>
                  <li><a href = /blog/2017/08/19/quantiles-gini>Most recent post</a></li>
				  <li><a href="/blog/nz.html">All blog posts with data about New Zealand</a></li>
				  <li><a href="/blog/voting.html">All blog posts on voting behaviour</a></li>
                 </ul>
            </li>
              <li><a href="/blog/showcase.html">Showcase</a></li>
              <li><a href="/presentations/index.html">Presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">NZ Election forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/elections/elections.html">Model A (recommended)</a></li>
				  <li><a href="https://ellisp.shinyapps.io/nz-election-2017/">Explore coalitions and assumptions</a></li>
				  <li><a href = "/elections/state-space.html">Model B ("state space")</a></li>
				  <li><a href = "/elections/combined.html">Combined model</a></li>
                  <li><a href="/elections/changelog.html">Log of changes to forecasts</a></li>
				  <li><a href="https://github.com/ellisp/nz-election-forecast">Source code on GitHub (external site)</a></li>
				  <li><a href="/blog/voting.html">All blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			    <div class="jumbotron">
      <div class="container">
        <h1>New Zealand Election Study individual level data</h1>
         <p class="meta">18 Sep 2016</p>
        
      </div>
    </div>




<div class = "post-summary">
<h2>At a glance:</h2>
   Individual level data on voting behaviour are freely available from the New Zealand Election Study and everyone should have a go at analysing them!
   <hr></hr>
</div>

<div class="post">
<div class="col-md-2">

</div>
  <div class="col-md-8">

  <h2 id="individual-level-data-is-essential-to-understand-voting-behaviour">Individual level data is essential to understand voting behaviour</h2>
<p>My previous analysis has occasionally come up against the problem <a href="/blog/2016/04/16/nzelect4">“only individual level data could resolve that,”</a>.  Since I last wrote that, the New Zealand Election Study data for the 2014 General Election have become available, and this post is my first glance at it.  The <a href="http://www.nzes.org/">New Zealand Election Study</a> makes available data on nine general elections (back to 1990) and looks to be a great resource.  Some time in the last half dozen years they took a decision to publish it all pro-actively with minimal (nearly zero) gate-keeping, which is a great thing.</p>

<p><em>Caveat: I have no association whatsover with the New Zealand Election Study.  Any errors are mine and in fact I looked at the actual data for the first time today, so treat anything I say with caution.</em></p>

<h2 id="how-to-get-the-data">How to get the data</h2>
<p>The data are available from the <a href="http://www.nzes.org/">New Zealand Election Study</a> website in SPSS format.  There is a brief online form to fill in so they can keep track of who is using their data.  Because of this, I’m not planning on publishing a copy of the data or incorporating it into the <code class="highlighter-rouge">nzelect</code> R package.  The download is straightforward with a minimum of red tape (just the one form, no credentials or gate-keeping).  To get it into R, the code below will work with just the necessary tweak to wherever the zip file containing the 2014 data has been saved.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"hadley/ggplot2"</span><span class="p">)</span><span class="w"> </span><span class="c1"># for dev version with subtitles and captions
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">foreign</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">survey</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">forcats</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gridExtra</span><span class="p">)</span><span class="w">

</span><span class="c1"># Data downloaded from http://www.nzes.org/exec/show/data and because
# they want you to fill in a form to know who is using the data, I
# won't re-publish it myself
</span><span class="n">unzip</span><span class="p">(</span><span class="s2">"D:/Downloads/NZES2014GeneralReleaseApril16.sav.zip"</span><span class="p">)</span><span class="w">

</span><span class="n">nzes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.spss</span><span class="p">(</span><span class="s2">"NZES2014GeneralReleaseApril16.sav"</span><span class="p">,</span><span class="w"> 
                  </span><span class="n">to.data.frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">trim.factor.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="n">varlab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="nf">attributes</span><span class="p">(</span><span class="n">nzes</span><span class="p">)</span><span class="o">$</span><span class="n">variable.labels</span><span class="p">)</span></code></pre></figure>

<p>The data have 2,835 rows and 438 columns.  The column names are the variable names from the original SPSS file.  In the code above, I extract the more verbose “variable labels” that each column refers to and store them in a data frame with a single column, <code class="highlighter-rouge">varlab</code>.  The entries in <code class="highlighter-rouge">varlab</code> can now be referred to by their row name, for example:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&gt;</span><span class="w"> </span><span class="n">varlab</span><span class="p">[</span><span class="s2">"dredincome"</span><span class="p">,]</span><span class="w">
                                                                                    </span><span class="n">dredincome</span><span class="w"> 
</span><span class="s2">"E17: how likely that your household's income could be severely reduced in the next 12 months"</span><span class="w"> </span></code></pre></figure>

<p>There’s an exciting range of questions in here, and when I’ve got my head around them I’ll be doing some interesting analysis; particularly once I get efficient code to join it up with the Census data in my <a href="/blog/2016/08/04/nzcensus-gam-elastic-lm"><code class="highlighter-rouge">nzcensus</code> package</a>.  I think that much of the analysis by others to date has been with SPSS, so I’ll publish any useful R code I develop for others to use too.</p>

<h2 id="weights">Weights</h2>
<p>The data have weights to correct for:</p>

<ul>
  <li>deliberate over-sampling (I think of Maori, although I haven’t yet tracked down a definitive description of the sample design)</li>
  <li>accidental (ie from response rate) disproportionate sampling by age, gender and education</li>
  <li>disproportionate representation of voters and non-voters</li>
</ul>

<p>I’m pretty sure the correct final weight to use is the column <code class="highlighter-rouge">dwtfin</code>.</p>

<p>Note - the weight column sums to the sample size (not to the population).  This minimises the chance of an SPSS-related disaster.  Unless the specialist complex surveys module is paid for and used, SPSS interprets weights as frequencies, and hence will give completely wrong standard errors and confidence intervals if the weights add up to anything other than sample size.  I think that they are still wrong when the weights add up to sample size, but not by an order of magnitude!  (SPSS’ limitations in this regard were an important reason in moving to R at my work in 2011, but I digress.)</p>

<p>Here’s my prep code before doing further analysis.  When I get into this for real, this is likely to be much bigger, and I’ll develop special script/s specifically to do data cleaning and tidying.  For now, all I do is make a summary variable that groups party vote for some of the smaller parties into an “other party” category; and set up the data with a survey design object using <a href="https://cran.r-project.org/package=survey">Thomas Lumley’s <code class="highlighter-rouge">survey</code> package</a>, which is the go-to point for anyone studying complex (ie weighted) surveys in R.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Main parties, in rough sequence of conservative to progressive.  Don't complain to me if you don't like the ordering.
</span><span class="n">mainparties</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"No Vote"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Conservative"</span><span class="p">,</span><span class="w"> </span><span class="s2">"National"</span><span class="p">,</span><span class="w"> </span><span class="s2">"NZ First"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Labour"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Green"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Internet?Mana Party"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Other party"</span><span class="p">)</span><span class="w">
</span><span class="n">nzes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nzes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">vpartysum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">nzes</span><span class="o">$</span><span class="n">dvpartyvote</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">mainparties</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">nzes</span><span class="o">$</span><span class="n">dvpartyvote</span><span class="p">),</span><span class="w"> </span><span class="s2">"Other party"</span><span class="p">),</span><span class="w">
          </span><span class="n">vpartysum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">vpartysum</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mainparties</span><span class="p">),</span><span class="w">
          </span><span class="n">vpartysum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_recode</span><span class="p">(</span><span class="n">vpartysum</span><span class="p">,</span><span class="w"> </span><span class="s2">"Internet /\nMana Party"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Internet?Mana Party"</span><span class="p">))</span><span class="w">

</span><span class="c1"># create a survey design object for easy of analysing with correct weights, etc - 
# this is particularly important if doing modelling down the track
</span><span class="n">nzes_svy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svydesign</span><span class="p">(</span><span class="o">~</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nzes</span><span class="p">,</span><span class="w"> </span><span class="n">weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">dwtfin</span><span class="p">)</span></code></pre></figure>

<p>New Zealanders in particularly will be interested in the answer to this question, presumably asked as a proxy of how closely people follow politics:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&gt;</span><span class="w"> </span><span class="n">varlab</span><span class="p">[</span><span class="s2">"dfinance"</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
                                                      </span><span class="n">dfinance</span><span class="w"> 
</span><span class="s2">"E7: who was minister of finance before 2014 general election"</span><span class="w"> 
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">svytable</span><span class="p">(</span><span class="o">~</span><span class="n">dfinance</span><span class="p">,</span><span class="w"> </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nzes_svy</span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">dfinance</span><span class="w">
</span><span class="n">Judith</span><span class="w"> </span><span class="n">Collins</span><span class="w">   </span><span class="n">Bill</span><span class="w"> </span><span class="n">English</span><span class="w">     </span><span class="n">Tony</span><span class="w"> </span><span class="n">Ryall</span><span class="w">     </span><span class="n">Nick</span><span class="w"> </span><span class="n">Smith</span><span class="w">     </span><span class="n">Don</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">know</span><span class="w"> 
            </span><span class="m">64</span><span class="w">           </span><span class="m">2298</span><span class="w">              </span><span class="m">6</span><span class="w">             </span><span class="m">13</span><span class="w">            </span><span class="m">404</span><span class="w"> </span></code></pre></figure>

<p>Most people who ventured an opinion got it right; about one in seven didn’t know.</p>

<h2 id="example-analysis---perceptions-of-nicky-hagars-dirty-politics-bookhttpsdirtypoliticsnzcomabout">Example analysis - perceptions of Nicky Hagar’s <a href="https://dirtypoliticsnz.com/about/"><em>Dirty Politics</em> book</a></h2>

<p>I was interested to see that one of the questions was:</p>

<p><code class="highlighter-rouge">"B12: how much truth in Nicky Hager's Dirty Politics book" </code></p>

<p>Non New Zealanders may wish to read the <a href="https://en.wikipedia.org/wiki/Dirty_Politics">Wikipedia article on <em>Dirty Politics</em></a> for context.  The book was released a bit over a month before the 2014 election and at times dominated the news leading up to it.  It had a number of revelations, critical in particular of the National Party (which was in government prior to the 2014 election, and won again in 2014), focusing on its relations with right wing bloggers.  It’s not surprising that political scientists wanted to collect data about voters’ views of the book in relation to voting behaviour.</p>

<h3 id="complex-relations-of-categorical-variables-via-a-mosaic-plot">Complex relations of categorical variables via a mosaic plot</h3>
<p>I thought I’d use this as my first bit of familiarisation with the data, and I started with this graphic:</p>

<p><img src="/img/0057-mosaic.svg" alt="mosaic" /></p>

<p>This is a mosaic plot, which is used to show relationships between categorical variables.  The columns show individuals’ party vote, and the number of boxes down shows the view of Mr Hagar’s book.  For example, the large blue rectangle second from the top under the “National” heading represents survey respondents who said they party-voted National, and thought there was “a little truth” in Mr Hagar’s book.  In addition:</p>

<ul>
  <li>The <em>size</em> of each rectangle is proportionate to the size of total number of voters estimated to be in that combination of views and voting behaviour.</li>
  <li>The <em>colour</em> of each rectangle indicates how much that combination of variables differs from what would be expected if the two variables (voting, and view of the book) were unrelated.  Blue indicates “surprisingly large number” and red indicates “surprisingly small number” - where ‘surprise’ means “not predicted by the null model of no relationship”.</li>
</ul>

<p>We can see a pattern of views pretty much along party lines.  Compared to the null hypothesis of independence (which of course was never plausible in this instance), there are ‘surprisingly’ many National Voters who think there is little or no truth, and suprisingly few who think there is some or a lot of truth.  The pattern is reversed for Labour, Green and Internet / Mana voters, none of which would <em>really</em> surprise anyone who was following the news at all during the election campaign.  Interestingly, there seems no relation between the view of the <em>Dirty Politics</em> book and voting Conservative (warning for overseas readers - the Conservative Party in New Zealand is much smaller and newer than its UK namesake).</p>

<p>Interestingly, there’s a noticeably large number of non-voters in the “some truth” category, which could fit in with a frustration / cynicism / “pox on both your houses” narrative.  Relatively few non-voters thought there was “no truth” in Mr Hagar’s book.</p>

<p>Here’s the code to make this graphic.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#-------------Example analayis - attitudes to the Dirty Politics book---------------
</span><span class="n">dirtypol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svytable</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">vpartysum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ddirtypol</span><span class="p">,</span><span class="w"> </span><span class="n">nzes_svy</span><span class="p">)</span><span class="w">

</span><span class="c1"># Mosaic plot.  Difficult for non-specialists to interpret
</span><span class="n">mosaicplot</span><span class="p">(</span><span class="n">dirtypol</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="m">-5</span><span class="p">],</span><span class="w"> </span><span class="n">shade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">las</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> 
           </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">varlab</span><span class="p">[</span><span class="s2">"ddirtypol"</span><span class="p">,</span><span class="w"> </span><span class="p">],</span><span class="w"> 
           </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Party vote"</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span></code></pre></figure>

<h3 id="and-via-bar-charts">.. and via bar charts</h3>
<p>The mosaic plot is a nice graphic and I often use mosaic plots in exploratory and analytical stages of an analytical project; but rarely is it a good tool for communication to people who aren’t specialists.  A better graphic for that purpose is this one, using the same information but in two plots that use more well-known format:</p>

<p><img src="/img/0057-hagar.svg" alt="bars" /></p>

<p>The messages are still there.  Perhaps it’s less stark and immediate than the mosaic plot, but it’s got a better chance of general understanding.  I’ll use this one for Twitter I think.</p>

<p>Here’s the code to create those two bar charts; main interest will be for those interested in “extreme ggplot2 polishing” practices.  Also worth noting - I’m warming to Hadley Wickham’s <a href="https://cran.r-project.org/web/packages/forcats/index.html"><code class="highlighter-rouge">forcats</code> R package</a> for manipulating factors, very useful in this context for controlling the order that categories are drawn in a plot..</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># party colours taken from https://en.wikipedia.org/wiki/List_of_political_parties_in_New_Zealand
# except for "other or no vote" which matches "don't know" in p3 plot
</span><span class="n">party_cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"grey90"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#00AEEF"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#00529F"</span><span class="p">,</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#d82a20"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#098137"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#770808"</span><span class="p">,</span><span class="w"> </span><span class="s2">"grey80"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#770808"</span><span class="p">,</span><span class="w"> 
                </span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="s2">"PuRd"</span><span class="p">)[</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">party_cols</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">mainparties</span><span class="p">,</span><span class="w"> </span><span class="s2">"Internet /\nMana Party"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Other or no vote"</span><span class="p">)</span><span class="w">

</span><span class="n">total1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dirtypol</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">ddirtypol</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">Freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">Freq</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">vpartysum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"TOTAL\nregardless of party"</span><span class="p">)</span><span class="w">

</span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dirtypol</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">rbind</span><span class="p">(</span><span class="n">total1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">vpartysum</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">ddirtypol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_rev</span><span class="p">(</span><span class="n">ddirtypol</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Freq</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">Freq</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">ddirtypol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_relevel</span><span class="p">(</span><span class="n">ddirtypol</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">ddirtypol</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">]))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vpartysum</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ddirtypol</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey60"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"right"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PuRd"</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_legend</span><span class="p">(</span><span class="n">reverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Voter views on 'How much truth in Nicky Hager's Dirty Politics book'"</span><span class="p">,</span><span class="w">
           </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Compared to party vote in the 2014 General Election\n\n
           Views about Mr Hagar's book, within each group of party voters"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="m">.80</span><span class="p">,</span><span class="w"> </span><span class="s2">"lines"</span><span class="p">))</span><span class="w"> 
  
</span><span class="n">total2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dirtypol</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">vpartysum</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">Freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">Freq</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">ddirtypol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"TOTAL regardless\nof views on book"</span><span class="p">)</span><span class="w"> 

</span><span class="n">p</span><span class="m">4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dirtypol</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">rbind</span><span class="p">(</span><span class="n">total2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">vpartysum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_collapse</span><span class="p">(</span><span class="n">vpartysum</span><span class="p">,</span><span class="w"> </span><span class="s2">"Other or no vote"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Other party"</span><span class="p">,</span><span class="w"> </span><span class="s2">"No Vote"</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">vpartysum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_relevel</span><span class="p">(</span><span class="n">vpartysum</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">vpartysum</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="m">7</span><span class="p">]))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">vpartysum</span><span class="p">,</span><span class="w"> </span><span class="n">ddirtypol</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">Freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">Freq</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">ddirtypol</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Freq</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">Freq</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ddirtypol</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vpartysum</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey60"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">38</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"right"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="s2">"Party vote"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">party_cols</span><span class="p">,</span><span class="w"> </span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_legend</span><span class="p">(</span><span class="n">reverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"\n\n\n\nProportion voting for each party\n"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: New Zealand Election Study, analysed in http://ellisp.github.io"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w">
           </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"             Party votes, within each category of views about Mr Hagar's book"</span><span class="p">)</span><span class="w">

   
</span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">p</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<h3 id="just-the-numbers">Just the numbers</h3>
<p>People might want the summarised numbers behind the charts, here they are:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt; # Views about Mr Hagar's book, within each group of party voters (columns add to 100)
&gt; round(prop.table(xtabs(Freq ~ ddirtypol + vpartysum, data = as.data.frame(dirtypol)), margin = 2) * 100, 0)
				vpartysum
ddirtypol        No Vote Conservative National NZ First Labour Green Internet /\nMana Party Other party
  No truth             3            2       13        3      2     0                      0           5
  A little truth      12           21       33       11      7     4                      0          15
  Some truth          24           19       20       30     33    26                     18          20
  A lot of truth      10           16        2       25     30    40                     61          17
  Don't know          51           41       31       31     27    29                     21          43
&gt; 
&gt; # Party votes, within each category of views about Mr Hagar's book (rows add to 100)
&gt; round(prop.table(xtabs(Freq ~ ddirtypol + vpartysum, data = as.data.frame(dirtypol)), margin = 1) * 100, 0)
				vpartysum
ddirtypol        No Vote Conservative National NZ First Labour Green Internet /\nMana Party Other party
  No truth            10            1       73        4      7     0                      0           5
  A little truth      14            3       64        4      8     2                      0           5
  Some truth          22            2       29        8     26     8                      1           5
  A lot of truth      15            3        5       10     37    20                      4           6
  Don't know          32            3       30        6     15     6                      1           7
</code></pre>
</div>


</div>

<div class = "container">
   <div class="col-md-4">
    
        <a rel="prev" href="/blog/2016/09/16/version-control">
        <p>&larr; Older</p>
        <p>Why you need version control</p>
        
        </a>
    
    </div>
    <div class="col-md-4">
    </div>
    <div class="col-md-4" style="text-align: right;">
     
        <a rel="next" href="/blog/2016/10/12/ggsdc-rents">
        <p>Newer &rarr;</p>
        <p>Update of `ggseas` for seasonal decomposition on the fly</p>
        
        </a>
    
      </div>
      </div>
      
      
      
</div>


   
    <div id="disqus_thread"></div>

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    
    
   
			
			</div><!-- /.container -->

         

   <div class = "container footer">
			<footer>
	    		<gcse:search></gcse:search>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.  Or follow <a href = "/feed.r.xml">posts in this blog featuring R with RSS</a>.</p>
			
            <p>This blog is built with <a href = "http://jekyllrb.com/">Jekyll</a>, <a href = "http://getbootstrap.com/">Bootstrap</a>, <a href = "https://www.ruby-lang.org/en/">Ruby</a> and <a href = "https://cran.r-project.org/">R</a>.  Read my <a href="/about/acknowledgements.html">acknowledgements</a> for a little more on how.  I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>

			<div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="true" data-share="false"></div>
			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Peter's stats stuff</span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			

			</footer>
    </div>



  
</body>
</html>
   




         
