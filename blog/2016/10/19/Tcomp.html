      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Tourism forecasting competition data in the Tcomp R package</title>
      	
         
         
            <meta name ="description" content ="A new R package `Tcomp` makes data from the 2010 tourism forecasting competition available in a format designed to facilitate the fitting and testing of en masse automated forecasts, consistent with the M1 and M3 forecasting competition data in the `Mcomp` R package.">
            <meta property="og:description" content ="A new R package `Tcomp` makes data from the 2010 tourism forecasting competition available in a format designed to facilitate the fitting and testing of en masse automated forecasts, consistent with the M1 and M3 forecasting competition data in the `Mcomp` R package.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Tourism forecasting competition data in the Tcomp R package" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0063-results.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2016/10/19/Tcomp.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2024/12/14/us-death-rates>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Tourism forecasting competition data in the Tcomp R package</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>A new R package `Tcomp` makes data from the 2010 tourism forecasting competition available in a format designed to facilitate the fitting and testing of en masse automated forecasts, consistent with the M1 and M3 forecasting competition data in the `Mcomp` R package.</p>
	   <p class="meta">19 Oct 2016</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="tourism-competition-data">Tourism competition data</h2>
<p>The tourism forecasting competition described in <a href="http://robjhyndman.com/papers/forecompijf.pdf">Athanasopoulos et al (2011)</a> was an important investigation into domain-specific time-series forecasting; a different approach from the broader-scope “M” series forecasting competitions which covered multiple areas.  Tourism is important to me in my day job and the article referenced above has been influential in how we construct New Zealand’s official tourism forecasts.  I have an interest in making the data from that competition as widely available as possible, and this week was able to release the <a href="https://CRAN.R-project.org/package=Tcomp"><code class="language-plaintext highlighter-rouge">Tcomp</code> R package on CRAN</a> that has a conveniently shaped version of the data from that competition.</p>

<p>The best introduction is in the <a href="https://cran.r-project.org/web/packages/Tcomp/vignettes/tourism-comp.html">package vignette</a>.</p>

<p>Only the univariate version of the data is available.  This is unfortunate in a slightly counter-intuitive way - one of the more important findings from the competition was that univariate methods of forecasting performed better than more complex methods that relied on relationships between the variables of interest (eg tourism numbers and spend) and other economic explanatory variables (eg economic growth in market countries).  So although we know from the competititon that those explanatory variables are of less value than might be hoped, we can’t explore that finding as much as we would like as the explanatory variables aren’t available for re-use.  That’s not the fault of the organisers of the competition, just a reality of the availability of data and the conditions under which it was provided to them.</p>

<h2 id="contents-of-the-tcomp-r-package">Contents of the Tcomp R package</h2>

<p>In the new <code class="language-plaintext highlighter-rouge">Tcomp</code> package, the data is stored in a single object, <code class="language-plaintext highlighter-rouge">tourism</code>.  <code class="language-plaintext highlighter-rouge">tourism</code> is a list of class <code class="language-plaintext highlighter-rouge">Mcomp</code> that has 1,311 elements.  The <code class="language-plaintext highlighter-rouge">Mcomp</code> S3 class is inherited from Hyndman’s <code class="language-plaintext highlighter-rouge">Mcomp</code> R package.  Each element in <code class="language-plaintext highlighter-rouge">tourism</code> has the information needed to fit and test a forecast to single univariate time series.  For example, the training series is always a <code class="language-plaintext highlighter-rouge">ts</code> object called <code class="language-plaintext highlighter-rouge">x</code>.  To plot the 34th training time series is as simple as:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">Tcomp</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">tourism</span><span class="p">[[</span><span class="m">34</span><span class="p">]]</span><span class="o">$</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/0063-x-only.svg" alt="xonly" /></p>

<p>We immediately see the strong seasonality that is characteristic of much tourism data.</p>

<p>Because <code class="language-plaintext highlighter-rouge">tourism</code> inherits classes from the <code class="language-plaintext highlighter-rouge">Mcomp</code> package, methods provided in that package apply to the <code class="language-plaintext highlighter-rouge">tourism</code> object and its elements.  For example, the <code class="language-plaintext highlighter-rouge">plot</code> method superimposes the test dataset on the graphic of the training dataset, so we can see what happened next after the first part of the competition training series #34:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot</span><span class="p">(</span><span class="n">tourism</span><span class="p">[[</span><span class="m">34</span><span class="p">]])</span></code></pre></figure>

<p><img src="/img/0063-basic.svg" alt="basic" /></p>

<p>See the <a href="https://cran.r-project.org/web/packages/Tcomp/Tcomp.pdf">helpfiles</a> or the <a href="https://cran.r-project.org/web/packages/Tcomp/vignettes/tourism-comp.html">vignette</a> for more details.</p>

<h2 id="building-blocks">Building blocks</h2>

<p>Part of the development of the <code class="language-plaintext highlighter-rouge">Tcomp</code> package was a moderately rigorous testing and validation process, which included attempting to reproduce the results in <a href="http://robjhyndman.com/papers/forecompijf.pdf">Athanasopoulos et al (2011)</a>.  This was successful for the mean absolute percentage error of the naive forecasts, giving assurance that the data extract-transform-load was succesful (a naive forecast is that the value next period will be the same as last period for non seasonal data, or the the last period one cycle previously for seasonal data).  One step to facilitate the testing was the <code class="language-plaintext highlighter-rouge">forecast_comp</code> function which is now shipped with the <code class="language-plaintext highlighter-rouge">Tcomp</code> package and designed to facilitate rule of thumb comparison of forecast results for a selection of standard forecast methods:</p>

<ul>
  <li><a href="https://www.otexts.org/fpp/8/7">auto-regression integrate moving average (ARIMA)</a>;</li>
  <li><a href="https://www.otexts.org/fpp/7/7">exponential smoothing state space</a>;</li>
  <li><a href="http://www.robjhyndman.com/papers/Theta.pdf">theta method</a>; and</li>
  <li><a href="https://www.otexts.org/fpp/2/3">naive </a>.</li>
</ul>

<p>Here is that convenience function in action.  It returns a data frame, the first four rows of which are the mean absolute percentage error (MAPE) for different forecast horizons (columns), and the final four rows are mean absolute scaled error (MASE).  For both MAPE and MASE, smaller is better.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">forecast_comp</span><span class="p">(</span><span class="n">tourism</span><span class="p">[[</span><span class="m">500</span><span class="p">]],</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">##           2     4    6     8</span><span class="w">
</span><span class="c1">## ARIMA  8.87  1.12 1.27  1.26</span><span class="w">
</span><span class="c1">## ETS   10.48  4.56 1.04  3.14</span><span class="w">
</span><span class="c1">## Theta  6.82 11.01 1.59 11.15</span><span class="w">
</span><span class="c1">## Naive  4.77 10.53 2.43 11.86</span><span class="w">
</span><span class="c1">## ARIMA  1.17  0.13 0.16  0.15	</span><span class="w">
</span><span class="c1">## ETS    1.38  0.52 0.13  0.36</span><span class="w">
</span><span class="c1">## Theta  0.90  1.25 0.19  1.29</span><span class="w">
</span><span class="c1">## Naive  0.63  1.20 0.30  1.37</span></code></pre></figure>

<p><img src="/img/0063-t500.svg" alt="t500" /></p>

<p>Because <code class="language-plaintext highlighter-rouge">forecast_comp</code> is a generic function that works with all <code class="language-plaintext highlighter-rouge">Mdata</code> S3 class objects, it also works with objects from Hyndman’s <code class="language-plaintext highlighter-rouge">Mcomp</code> package:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">Mcomp</span><span class="p">)</span><span class="w">
</span><span class="n">forecast_comp</span><span class="p">(</span><span class="n">M3</span><span class="p">[[</span><span class="m">1000</span><span class="p">]],</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/0063-M31000.svg" alt="M1000" /></p>

<h2 id="more-comprehensive-use">More comprehensive use</h2>

<p>The main purpose of large collections of time series data like this is rigorous study of different approaches to forecasting.  Here’s a simple taster of what I hope the <code class="language-plaintext highlighter-rouge">Tcomp</code> package will be used for.  In this section, I assess the relative accuracy of several forecasting methods: ARIMA, ETS, combination of ARIMA and ETS, naive, and Theta, using quarterly tourism data.  Here’s the summary results (Theta wins, so long as the forecasting horizon of interest is four or more quarters):</p>

<p><img src="/img/0063-results.svg" alt="results" /></p>

<p>Notice how much easier it is to predict four quarters ahead rather than six or eight.</p>

<blockquote>
  <p>“It’s tough to make predictions, particularly about the future.”</p>
</blockquote>

<p><em>(attributed to <a href="http://quoteinvestigator.com/2013/10/20/no-predict/">Yogi Berra amongst others</a> but it’s not sure who really said this first)</em></p>

<p>We see that, perhaps a little depressingly, it’s hard to beat the naive forecast that next quarter’s result will be the same as a year ago; or the simple <a href="http://www.robjhyndman.com/papers/Theta.pdf">theta method</a>.  The naive method is particularly effective for one cycle after the last data point (ie horizon equals four or eight, in this instance).  Ho hum, c’est la vie.  The average of the ETS and ARIMA methods performs better than either individually, consistent with previous findings about the value of ensemble forecasts.  Many questions are begged by this set of results, which could be explored fruitfully with this and other real-life data.</p>

<p>Here’s the code for this mini-competition.  It shows how to use the <code class="language-plaintext highlighter-rouge">tourism</code> data and make the most of parallel processing to speed things up.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#------setup-------</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">forecastHybrid</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">english</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">directlabels</span><span class="p">)</span><span class="w">

</span><span class="c1">#----------------------helper function for comparing forecasts---------</span><span class="w">
</span><span class="cd">#' Function to perform five forecasts to all members of a set of series</span><span class="w">
</span><span class="cd">#' ARIMA, ETS, Theta, Naive and ensemble of ETS and ARIMA</span><span class="w">
</span><span class="cd">#' @param the_series a list of class Mcomp containing series of class Mdata</span><span class="w">
</span><span class="cd">#' @param tests a list of horizons over which to return the MASE of the forecast</span><span class="w">
</span><span class="cd">#' @return a list of results</span><span class="w">
</span><span class="n">accuracy_point</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">the_series</span><span class="p">,</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">the_series</span><span class="o">$</span><span class="n">h</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_series</span><span class="o">$</span><span class="n">x</span><span class="w">
   </span><span class="n">xx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_series</span><span class="o">$</span><span class="n">xx</span><span class="w">
   </span><span class="n">h</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_series</span><span class="o">$</span><span class="n">h</span><span class="w">
   
   </span><span class="c1"># determine best value for BoxCox transformation, </span><span class="w">
   </span><span class="c1"># but limit it to between 0 and 1</span><span class="w">
   </span><span class="n">bc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">BoxCox.lambda</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
   </span><span class="n">bc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">bc</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
   
   </span><span class="c1"># fit ARIMA and ETS models</span><span class="w">
   </span><span class="n">mod1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hybridModel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">models</span><span class="w"> </span><span class="o">=</span><span class="s2">"ae"</span><span class="p">,</span><span class="w"> 
                       </span><span class="n">a.args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bc</span><span class="p">),</span><span class="w"> </span><span class="n">e.args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bc</span><span class="p">))</span><span class="w">
   
   </span><span class="c1"># create forecasts</span><span class="w">
   </span><span class="n">fc1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">mod1</span><span class="o">$</span><span class="n">auto.arima</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   </span><span class="n">fc2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">mod1</span><span class="o">$</span><span class="n">ets</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   </span><span class="n">fc3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">thetaf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   </span><span class="n">fc4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">snaive</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   </span><span class="n">fc5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">mod1</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   
   </span><span class="c1"># estimate MASE for all the values of tests</span><span class="w">
   </span><span class="n">MASEs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">tests</span><span class="p">))</span><span class="w">
   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">tests</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">this_test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tests</span><span class="p">[[</span><span class="n">j</span><span class="p">]]</span><span class="w">
      </span><span class="n">MASEs</span><span class="p">[,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc1</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">],</span><span class="w"> 
                      </span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc2</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">],</span><span class="w"> 
                      </span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc3</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">],</span><span class="w"> 
                      </span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc4</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">],</span><span class="w">
                      </span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc5</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">])</span><span class="w">                                                                                                                                                            
   </span><span class="p">}</span><span class="w">
   
   </span><span class="n">colnames</span><span class="p">(</span><span class="n">MASEs</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">":"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">tests</span><span class="p">))</span><span class="w">
   </span><span class="n">rownames</span><span class="p">(</span><span class="n">MASEs</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ARIMA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ETS"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Theta"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Naive"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ARIMA-ETS average"</span><span class="p">)</span><span class="w">
   </span><span class="nf">return</span><span class="p">(</span><span class="n">MASEs</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#------------Set up multi core cluster----------------</span><span class="w">
</span><span class="c1"># set up cluster with number of cores minus one</span><span class="w">
</span><span class="n">cores</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">detectCores</span><span class="p">()</span><span class="w">
</span><span class="n">cluster</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">makePSOCKcluster</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cores</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="c1"># set up the functionality on the cluster</span><span class="w">
</span><span class="n">clusterEvalQ</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="n">library</span><span class="p">(</span><span class="n">Tcomp</span><span class="p">)</span><span class="w">
   </span><span class="n">library</span><span class="p">(</span><span class="n">forecastHybrid</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="n">clusterExport</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="s2">"accuracy_point"</span><span class="p">)</span><span class="w">


</span><span class="c1">#-----------------Fit to tourism data----------------------</span><span class="w">
</span><span class="c1"># takes a few minutes on my laptop:</span><span class="w">
</span><span class="n">results_point</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parLapply</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w">
                           </span><span class="n">subset</span><span class="p">(</span><span class="n">tourism</span><span class="p">,</span><span class="w"> </span><span class="s2">"quarterly"</span><span class="p">),</span><span class="w">
                           </span><span class="n">accuracy_point</span><span class="p">,</span><span class="w">
                           </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">))</span><span class="w">

</span><span class="n">stopCluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span><span class="w">

</span><span class="c1">#----------------presenting results-----------</span><span class="w">
</span><span class="n">results_point_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">do.call</span><span class="p">(</span><span class="s2">"rbind"</span><span class="p">,</span><span class="w"> </span><span class="n">results_point</span><span class="p">))</span><span class="w">
</span><span class="n">results_point_df</span><span class="o">$</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">row.names</span><span class="p">(</span><span class="n">results_point_df</span><span class="p">)</span><span class="w">
</span><span class="n">results_point_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">results_point_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">gather</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span><span class="w"> </span><span class="n">MASE</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">horizon</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">MASE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">MASE</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">horizon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">horizon</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"ARIMA-ETS average"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hybrid"</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">))</span><span class="w">

</span><span class="n">results_point_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">horizon</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MASE</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_colour_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Set1"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Forecasting horizon"</span><span class="p">,</span><span class="w">
        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Mean Absolute Scaled Error (lower is better)"</span><span class="p">,</span><span class="w">
        </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: 2010 tourism competition data in Tcomp R package"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"It's hard to beat a naive forecast or a Theta forecast"</span><span class="p">,</span><span class="w">
           </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Comparison of forecasting methods with tourism competition data"</span><span class="p">)</span></code></pre></figure>



		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2016/10/15/snz-api">Statistics New Zealand experimental API initiative</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2016/10/29/538-pollsters">FiveThirtyEight's polling data for the US Presidential election</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<p>Find me on <a rel="me" href="https://mastodon.social/@peter_ellis">Mastodon</a>.</p>
			<hr></hr>
			
			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>