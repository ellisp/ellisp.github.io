      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Tourism forecasting competition data in the Tcomp R package</title>
      	
         
         
            <meta name ="description" content ="A new R package `Tcomp` makes data from the 2010 tourism forecasting competition available in a format designed to facilitate the fitting and testing of en masse automated forecasts, consistent with the M1 and M3 forecasting competition data in the `Mcomp` R package.">
            <meta property="og:description" content ="A new R package `Tcomp` makes data from the 2010 tourism forecasting competition available in a format designed to facilitate the fitting and testing of en masse automated forecasts, consistent with the M1 and M3 forecasting competition data in the `Mcomp` R package.">
         
         <meta property="og:site_name" content="Peter's stats stuff" />
         <meta property="og:title" content="Tourism forecasting competition data in the Tcomp R package" />
         
            <meta property="og:image" content="http://ellisp.github.io/img/0063-results.png" />
         
         <meta property="og:url" content="http://ellisp.github.io/blog/2016/10/19/538-pollsters/" />
         <meta property="og:author" content= "https://www.facebook.com/peter.ellis.353" />
         <meta property="og:type" content="article" />
           
          <link href="/css/bootstrap.min.css" rel ="stylesheet">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet">
            <link href="/css/custom.css" rel ="stylesheet">     
		<link href="/css/syntax.css" rel ="stylesheet">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>

   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="Peter's stats stuff by Peter Ellis"
      href="/feed.xml">


      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Peter's stats stuff</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">All blog posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">Ordered by date</a></li>
                  <li><a href="/blog/index_by_tag.html">Grouped by subject matter</a></li>
                  <li><a href = /blog/2016/10/19/538-pollsters>Most recent post</a></li>
                 </ul>
            </li>
              <li><a href="/blog/showcase.html">Showcase</a></li>
              <li><a href="/presentations/index.html">Presentations</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			    <div class="jumbotron">
      <div class="container">
        <h1>Tourism forecasting competition data in the Tcomp R package</h1>
         <p class="meta">19 Oct 2016</p>
        
      </div>
    </div>




<div class = "post-summary">
<h2>TL;DR Summary:</h2>
   A new R package `Tcomp` makes data from the 2010 tourism forecasting competition available in a format designed to facilitate the fitting and testing of en masse automated forecasts, consistent with the M1 and M3 forecasting competition data in the `Mcomp` R package.
   <hr></hr>
</div>

<div class="post">
<div class="col-md-2">

</div>
  <div class="col-md-8">

  <h2 id="tourism-competition-data">Tourism competition data</h2>
<p>The tourism forecasting competition described in <a href="http://robjhyndman.com/papers/forecompijf.pdf">Athanasopoulos et al (2011)</a> was an important investigation into domain-specific time-series forecasting; a different approach from the broader-scope “M” series forecasting competitions which covered multiple areas.  Tourism is important to me in my day job and the article referenced above has been influential in how we construct New Zealand’s official tourism forecasts.  I have an interest in making the data from that competition as widely available as possible, and this week was able to release the <a href="https://CRAN.R-project.org/package=Tcomp"><code class="highlighter-rouge">Tcomp</code> R package on CRAN</a> that has a conveniently shaped version of the data from that competition.</p>

<p>The best introduction is in the <a href="https://cran.r-project.org/web/packages/Tcomp/vignettes/tourism-comp.html">package vignette</a>.</p>

<p>Only the univariate version of the data is available.  This is unfortunate in a slightly counter-intuitive way - one of the more important findings from the competition was that univariate methods of forecasting performed better than more complex methods that relied on relationships between the variables of interest (eg tourism numbers and spend) and other economic explanatory variables (eg economic growth in market countries).  So although we know from the competititon that those explanatory variables are of less value than might be hoped, we can’t explore that finding as much as we would like as the explanatory variables aren’t available for re-use.  That’s not the fault of the organisers of the competition, just a reality of the availability of data and the conditions under which it was provided to them.</p>

<h2 id="contents-of-the-tcomp-r-package">Contents of the Tcomp R package</h2>

<p>In the new <code class="highlighter-rouge">Tcomp</code> package, the data is stored in a single object, <code class="highlighter-rouge">tourism</code>.  <code class="highlighter-rouge">tourism</code> is a list of class <code class="highlighter-rouge">Mcomp</code> that has 1,311 elements.  The <code class="highlighter-rouge">Mcomp</code> S3 class is inherited from Hyndman’s <code class="highlighter-rouge">Mcomp</code> R package.  Each element in <code class="highlighter-rouge">tourism</code> has the information needed to fit and test a forecast to single univariate time series.  For example, the training series is always a <code class="highlighter-rouge">ts</code> object called <code class="highlighter-rouge">x</code>.  To plot the 34th training time series is as simple as:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">Tcomp</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">tourism</span><span class="p">[[</span><span class="m">34</span><span class="p">]]</span><span class="o">$</span><span class="n">x</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/0063-x-only.svg" alt="xonly" /></p>

<p>We immediately see the strong seasonality that is characteristic of much tourism data.</p>

<p>Because <code class="highlighter-rouge">tourism</code> inherits classes from the <code class="highlighter-rouge">Mcomp</code> package, methods provided in that package apply to the <code class="highlighter-rouge">tourism</code> object and its elements.  For example, the <code class="highlighter-rouge">plot</code> method superimposes the test dataset on the graphic of the training dataset, so we can see what happened next after the first part of the competition training series #34:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot</span><span class="p">(</span><span class="n">tourism</span><span class="p">[[</span><span class="m">34</span><span class="p">]])</span></code></pre></figure>

<p><img src="/img/0063-basic.svg" alt="basic" /></p>

<p>See the <a href="https://cran.r-project.org/web/packages/Tcomp/Tcomp.pdf">helpfiles</a> or the <a href="https://cran.r-project.org/web/packages/Tcomp/vignettes/tourism-comp.html">vignette</a> for more details.</p>

<h2 id="building-blocks">Building blocks</h2>

<p>Part of the development of the <code class="highlighter-rouge">Tcomp</code> package was a moderately rigorous testing and validation process, which included attempting to reproduce the results in <a href="http://robjhyndman.com/papers/forecompijf.pdf">Athanasopoulos et al (2011)</a>.  This was successful for the mean absolute percentage error of the naive forecasts, giving assurance that the data extract-transform-load was succesful (a naive forecast is that the value next period will be the same as last period for non seasonal data, or the the last period one cycle previously for seasonal data).  One step to facilitate the testing was the <code class="highlighter-rouge">forecast_comp</code> function which is now shipped with the <code class="highlighter-rouge">Tcomp</code> package and designed to facilitate rule of thumb comparison of forecast results for a selection of standard forecast methods:</p>

<ul>
  <li><a href="https://www.otexts.org/fpp/8/7">auto-regression integrate moving average (ARIMA)</a>;</li>
  <li><a href="https://www.otexts.org/fpp/7/7">exponential smoothing state space</a>;</li>
  <li><a href="http://www.robjhyndman.com/papers/Theta.pdf">theta method</a>; and</li>
  <li><a href="https://www.otexts.org/fpp/2/3">naive </a>.</li>
</ul>

<p>Here is that convenience function in action.  It returns a data frame, the first four rows of which are the mean absolute percentage error (MAPE) for different forecast horizons (columns), and the final four rows are mean absolute scaled error (MASE).  For both MAPE and MASE, smaller is better.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">forecast_comp</span><span class="p">(</span><span class="n">tourism</span><span class="p">[[</span><span class="m">500</span><span class="p">]],</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">##           2     4    6     8
## ARIMA  8.87  1.12 1.27  1.26
## ETS   10.48  4.56 1.04  3.14
## Theta  6.82 11.01 1.59 11.15
## Naive  4.77 10.53 2.43 11.86
## ARIMA  1.17  0.13 0.16  0.15	
## ETS    1.38  0.52 0.13  0.36
## Theta  0.90  1.25 0.19  1.29
</span><span class="err">##</span><span class="w"> </span><span class="n">Naive</span><span class="w">  </span><span class="m">0.63</span><span class="w">  </span><span class="m">1.20</span><span class="w"> </span><span class="m">0.30</span><span class="w">  </span><span class="m">1.37</span></code></pre></figure>

<p><img src="/img/0063-t500.svg" alt="t500" /></p>

<p>Because <code class="highlighter-rouge">forecast_comp</code> is a generic function that works with all <code class="highlighter-rouge">Mdata</code> S3 class objects, it also works with objects from Hyndman’s <code class="highlighter-rouge">Mcomp</code> package:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">Mcomp</span><span class="p">)</span><span class="w">
</span><span class="n">forecast_comp</span><span class="p">(</span><span class="n">M</span><span class="m">3</span><span class="p">[[</span><span class="m">1000</span><span class="p">]],</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/0063-M31000.svg" alt="M1000" /></p>

<h2 id="more-comprehensive-use">More comprehensive use</h2>

<p>The main purpose of large collections of time series data like this is rigorous study of different approaches to forecasting.  Here’s a simple taster of what I hope the <code class="highlighter-rouge">Tcomp</code> package will be used for.  In this section, I assess the relative accuracy of several forecasting methods: ARIMA, ETS, combination of ARIMA and ETS, naive, and Theta, using quarterly tourism data.  Here’s the summary results (Theta wins, so long as the forecasting horizon of interest is four or more quarters):</p>

<p><img src="/img/0063-results.svg" alt="results" /></p>

<p>Notice how much easier it is to predict four quarters ahead rather than six or eight.</p>

<blockquote>
  <p>“It’s tough to make predictions, particularly about the future.”</p>
</blockquote>

<p><em>(attributed to <a href="http://quoteinvestigator.com/2013/10/20/no-predict/">Yogi Berra amongst others</a> but it’s not sure who really said this first)</em></p>

<p>We see that, perhaps a little depressingly, it’s hard to beat the naive forecast that next quarter’s result will be the same as a year ago; or the simple <a href="http://www.robjhyndman.com/papers/Theta.pdf">theta method</a>.  The naive method is particularly effective for one cycle after the last data point (ie horizon equals four or eight, in this instance).  Ho hum, c’est la vie.  The average of the ETS and ARIMA methods performs better than either individually, consistent with previous findings about the value of ensemble forecasts.  Many questions are begged by this set of results, which could be explored fruitfully with this and other real-life data.</p>

<p>Here’s the code for this mini-competition.  It shows how to use the <code class="highlighter-rouge">tourism</code> data and make the most of parallel processing to speed things up.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#------setup-------
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">forecastHybrid</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">english</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">directlabels</span><span class="p">)</span><span class="w">

</span><span class="c1">#----------------------helper function for comparing forecasts---------
</span><span class="cd">#' Function to perform five forecasts to all members of a set of series
#' ARIMA, ETS, Theta, Naive and ensemble of ETS and ARIMA
#' @param the_series a list of class Mcomp containing series of class Mdata
#' @param tests a list of horizons over which to return the MASE of the forecast
#' @return a list of results
</span><span class="n">accuracy_point</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">the_series</span><span class="p">,</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">the_series</span><span class="o">$</span><span class="n">h</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_series</span><span class="o">$</span><span class="n">x</span><span class="w">
   </span><span class="n">xx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_series</span><span class="o">$</span><span class="n">xx</span><span class="w">
   </span><span class="n">h</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_series</span><span class="o">$</span><span class="n">h</span><span class="w">
   
   </span><span class="c1"># determine best value for BoxCox transformation, 
</span><span class="w">   </span><span class="c1"># but limit it to between 0 and 1
</span><span class="w">   </span><span class="n">bc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">BoxCox.lambda</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
   </span><span class="n">bc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">bc</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
   
   </span><span class="c1"># fit ARIMA and ETS models
</span><span class="w">   </span><span class="n">mod1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hybridModel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">models</span><span class="w"> </span><span class="o">=</span><span class="s2">"ae"</span><span class="p">,</span><span class="w"> 
                       </span><span class="n">a.args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bc</span><span class="p">),</span><span class="w"> </span><span class="n">e.args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bc</span><span class="p">))</span><span class="w">
   
   </span><span class="c1"># create forecasts
</span><span class="w">   </span><span class="n">fc1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">mod1</span><span class="o">$</span><span class="n">auto.arima</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   </span><span class="n">fc2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">mod1</span><span class="o">$</span><span class="n">ets</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   </span><span class="n">fc3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">thetaf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   </span><span class="n">fc4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">snaive</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   </span><span class="n">fc5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">mod1</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w">
   
   </span><span class="c1"># estimate MASE for all the values of tests
</span><span class="w">   </span><span class="n">MASEs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">tests</span><span class="p">))</span><span class="w">
   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">tests</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">this_test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tests</span><span class="p">[[</span><span class="n">j</span><span class="p">]]</span><span class="w">
      </span><span class="n">MASEs</span><span class="p">[,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc1</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">],</span><span class="w"> 
                      </span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc2</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">],</span><span class="w"> 
                      </span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc3</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">],</span><span class="w"> 
                      </span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc4</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">],</span><span class="w">
                      </span><span class="n">accuracy</span><span class="p">(</span><span class="n">fc5</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_test</span><span class="p">)[</span><span class="s2">"Test set"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MASE"</span><span class="p">])</span><span class="w">                                                                                                                                                            
   </span><span class="p">}</span><span class="w">
   
   </span><span class="n">colnames</span><span class="p">(</span><span class="n">MASEs</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">":"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">tests</span><span class="p">))</span><span class="w">
   </span><span class="n">rownames</span><span class="p">(</span><span class="n">MASEs</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ARIMA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ETS"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Theta"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Naive"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ARIMA-ETS average"</span><span class="p">)</span><span class="w">
   </span><span class="nf">return</span><span class="p">(</span><span class="n">MASEs</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#------------Set up multi core cluster----------------
# set up cluster with number of cores minus one
</span><span class="n">cores</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">detectCores</span><span class="p">()</span><span class="w">
</span><span class="n">cluster</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">makePSOCKcluster</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cores</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="c1"># set up the functionality on the cluster
</span><span class="n">clusterEvalQ</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="n">library</span><span class="p">(</span><span class="n">Tcomp</span><span class="p">)</span><span class="w">
   </span><span class="n">library</span><span class="p">(</span><span class="n">forecastHybrid</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="n">clusterExport</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="s2">"accuracy_point"</span><span class="p">)</span><span class="w">


</span><span class="c1">#-----------------Fit to tourism data----------------------
# takes a few minutes on my laptop:
</span><span class="n">results_point</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parLapply</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w">
                           </span><span class="n">subset</span><span class="p">(</span><span class="n">tourism</span><span class="p">,</span><span class="w"> </span><span class="s2">"quarterly"</span><span class="p">),</span><span class="w">
                           </span><span class="n">accuracy_point</span><span class="p">,</span><span class="w">
                           </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">))</span><span class="w">

</span><span class="n">stopCluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span><span class="w">

</span><span class="c1">#----------------presenting results-----------
</span><span class="n">results_point_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">do.call</span><span class="p">(</span><span class="s2">"rbind"</span><span class="p">,</span><span class="w"> </span><span class="n">results_point</span><span class="p">))</span><span class="w">
</span><span class="n">results_point_df</span><span class="o">$</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">row.names</span><span class="p">(</span><span class="n">results_point_df</span><span class="p">)</span><span class="w">
</span><span class="n">results_point_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">results_point_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">gather</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span><span class="w"> </span><span class="n">MASE</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">horizon</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">MASE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">MASE</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">horizon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">horizon</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"ARIMA-ETS average"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hybrid"</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">))</span><span class="w">

</span><span class="n">results_point_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">horizon</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MASE</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_colour_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Set1"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Forecasting horizon"</span><span class="p">,</span><span class="w">
        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Mean Absolute Scaled Error (lower is better)"</span><span class="p">,</span><span class="w">
        </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: 2010 tourism competition data in Tcomp R package"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"It's hard to beat a naive forecast or a Theta forecast"</span><span class="p">,</span><span class="w">
           </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Comparison of forecasting methods with tourism competition data"</span><span class="p">)</span></code></pre></figure>



</div>

<div class = "container">
   <div class="col-md-4">
    
        <a rel="prev" href="/blog/2016/10/19/Tcomp">
        <p>&larr; Older</p>
        <p>Tourism forecasting competition data in the Tcomp R package</p>
        
        </a>
    
    </div>
    <div class="col-md-4">
    </div>
    <div class="col-md-4" style="text-align: right;">
    
      </div>
      </div>
      
      
      
</div>


   
    <div id="disqus_thread"></div>

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    
    
   
			
			</div><!-- /.container -->

         

   <div class = "container footer">
			<footer>
	    		
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.  Or follow <a href = "/feed.r.xml">posts in this blog featuring R with RSS</a>.</p>
			
            <p>This blog is built with <a href = "http://jekyllrb.com/">Jekyll</a>, <a href = "http://getbootstrap.com/">Bootstrap</a>, <a href = "https://www.ruby-lang.org/en/">Ruby</a> and <a href = "https://cran.r-project.org/">R</a>.  Read my <a href="/about/acknowledgements.html">acknowledgements</a> for a little more on how.  I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>

			<div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="true" data-share="false"></div>
			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Peter's stats stuff</span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			
			

			</footer>
    </div>



  
</body>
</html>
   




         
