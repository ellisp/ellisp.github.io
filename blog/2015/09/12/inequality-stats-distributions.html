      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Sampling distribution of Gini coefficient</title>
      	
         
         
            <meta name ="description" content ="I explore the sampling distributions of estimates of Gini coefficients from a sample, using the New Zealand Income Survey 2011.  At the actual sample size of nearly 30,000, sampling error is negligible, and as low as a sample size of 1,000 a 95% confidence interval is (0.48, 0.55), precise enough for most purposes and certainly good enough given the non-sampling vagaries of the underlying data.  I discuss why individual and weekly income data - which is all I have to hand - returns a higher measure of inequality than does annual household income, the more usual and internationally-comparable (and completely valid) measure.">
            <meta property="og:description" content ="I explore the sampling distributions of estimates of Gini coefficients from a sample, using the New Zealand Income Survey 2011.  At the actual sample size of nearly 30,000, sampling error is negligible, and as low as a sample size of 1,000 a 95% confidence interval is (0.48, 0.55), precise enough for most purposes and certainly good enough given the non-sampling vagaries of the underlying data.  I discuss why individual and weekly income data - which is all I have to hand - returns a higher measure of inequality than does annual household income, the more usual and internationally-comparable (and completely valid) measure.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Sampling distribution of Gini coefficient" />
         
            <meta property="og:image" content="http://ellisp.github.io/img/0008-lorenz.png" />
         
		 
			<meta property="og:url" content="http://freerangestats.info/blog/2015/09/12/inequality-stats-distributions.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
				  <li><a href = /blog/2018/08/01/business-expectations>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">nz election forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href = "/elections/combined.html">combined model (recommended)</a></li>
                  <li><a href="https://ellisp.shinyapps.io/nz-election-2017/">explore coalitions and assumptions</a></li>
				  <li><a href="/elections/elections.html">model A "generalized additive model"</a></li>
				  <li><a href = "/elections/state-space.html">model B "state space"</a></li>
				  <li><a href="/elections/changelog.html">log of changes to forecasts</a></li>
				  <li><a href="https://github.com/ellisp/nz-election-forecast">source code on GitHub</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Sampling distribution of Gini coefficient</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I explore the sampling distributions of estimates of Gini coefficients from a sample, using the New Zealand Income Survey 2011.  At the actual sample size of nearly 30,000, sampling error is negligible, and as low as a sample size of 1,000 a 95% confidence interval is (0.48, 0.55), precise enough for most purposes and certainly good enough given the non-sampling vagaries of the underlying data.  I discuss why individual and weekly income data - which is all I have to hand - returns a higher measure of inequality than does annual household income, the more usual and internationally-comparable (and completely valid) measure.</p>
	   <p class="meta">12 Sep 2015</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="inequality-measures">Inequality measures</h2>

<p>Part of my motivation for <a href="/blog/2015/08/15/importing-nzis-surf.html">importing the New Zealand Income Survey</a>(NZIS) simulated unit record file provided by Statistics New Zealand was to explore the characteristics of various measures of inequality.  In particular, I’m interested in what happens to the <a href="https://en.wikipedia.org/wiki/Sampling_distribution">sampling distributions</a> as sample size changes of the following summary statistics:</p>

<ul>
  <li>Gini coefficient (ie the area between a Lorenz curve and the line of perfect equality)</li>
  <li>P90/P10 (ie income at the 90% richest percentile divided by that at the 10% percentile)</li>
  <li>P80/P20 (as above, but the 80 and 20 percentiles</li>
  <li>Top 1% income as a percentage of all income</li>
  <li>Top 0.1% income as a percentage of all income</li>
</ul>

<p>A Lorenz curve is an attempt to show the full shape of the income distribution at once.  It maps the cumulative proportion of the population against the cumulative proportion of income (or whatever variable of interest) that they own.  In the example below, you can read that the poorest 50% of New Zealand individuals, for example, earn around 13% of total income in a given week</p>

<p><img src="/img/0008-lorenz.svg" alt="lorenz-plot" /></p>

<p>This plot was produced with the following R code, which requires the data to have been imported to a database called PlayPen in accordance with the <a href="/blog/2015/08/15/importing-nzis-surf.html">previous post</a>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">RODBC</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ineq</span><span class="p">)</span><span class="w">     </span><span class="c1"># for Lc and Gini
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">showtext</span><span class="p">)</span><span class="w"> </span><span class="c1"># for fonts
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">  </span><span class="c1"># for str_wrap
</span><span class="w">
</span><span class="n">font.add.google</span><span class="p">(</span><span class="s2">"Poppins"</span><span class="p">,</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">)</span><span class="w">
</span><span class="n">showtext.auto</span><span class="p">()</span><span class="w">

</span><span class="n">PlayPen</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">odbcConnect</span><span class="p">(</span><span class="s2">"PlayPen_Prod"</span><span class="p">)</span><span class="w">
</span><span class="n">sqlQuery</span><span class="p">(</span><span class="n">PlayPen</span><span class="p">,</span><span class="w"> </span><span class="s2">"use nzis11"</span><span class="p">)</span><span class="w">

</span><span class="n">inc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sqlQuery</span><span class="p">(</span><span class="n">PlayPen</span><span class="p">,</span><span class="w"> </span><span class="s2">"select income from vw_mainheader"</span><span class="p">)</span><span class="o">$</span><span class="n">income</span><span class="w">

</span><span class="n">lorenz</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Lc</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span><span class="w">
</span><span class="n">lorenz_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">prop_pop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lorenz</span><span class="o">$</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">income</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lorenz</span><span class="o">$</span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">mutate</span><span class="p">(</span><span class="n">prop_equality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop_pop</span><span class="p">)</span><span class="w">

</span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">lorenz_df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop_pop</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">income</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_ribbon</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop_equality</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">income</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yellow"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_abline</span><span class="p">(</span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s2">"\nCumulative proportion of population"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Cumulative proportion of income\n"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">coord_equal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">annotate</span><span class="p">(</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="m">0.53</span><span class="p">,</span><span class="w"> </span><span class="m">0.32</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Inequality\ngap"</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">annotate</span><span class="p">(</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Complete equality line"</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
   </span><span class="n">ggtitle</span><span class="w"> </span><span class="p">(</span><span class="w">
      </span><span class="n">str_wrap</span><span class="p">(</span><span class="s2">"Cumulative distribution of New Zealand individual weekly income from all sources"</span><span class="p">,</span><span class="w"> </span><span class="m">46</span><span class="p">))</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="n">grid.text</span><span class="p">(</span><span class="s2">"Source: Statistics New Zealand\nNational Income Survey 2011 SURF"</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">0.23</span><span class="p">,</span><span class="w"> 
       </span><span class="n">gp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpar</span><span class="p">(</span><span class="n">fontfamily</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">))</span></code></pre></figure>

<h3 id="choice-of-measures">Choice of measures</h3>
<p>Income inequality is notoriously difficult to measure, and the P90/P10 and P80/P20 measures are attempts to deal with the patchy information available particuarly at the top level (the super rich don’t slum it filling in surveys, and are often expected to be particularly disinclined to reveal how rich they are voluntarily; and there are strong incentives to minimise income in a tax context).  However, the P90/P10 and similar measures have been criticised (for example, by Thomas Picketty in  his excellent book <a href="http://www.amazon.com/Capital-Twenty-First-Century-Thomas-Piketty/dp/1491534656">Capital in the 21st Century</a>) on several grounds, the most important of which seem to me to be:</p>

<ul>
  <li>They ignore what is going on in the top 10% or top 20%, which might be precisely the point of most interest</li>
  <li>They are unstable, because by dividing by the income (or wealth) measure of the lowest 10% or 20% you are dividing by a very low number, and small changes in measurement (for example, how one counts household furniture, if looking at wealth inequality) make big changes to the measure even though inequality to most minds is unchanged.</li>
</ul>

<p>These arguments seem to me cogent, although I see reasons for keeping those measures too.  Picketty prefers to talk about the income or wealth of the bottom 50%, the next 40%, then the top 10% and 1%.  He dislikes the Gini coefficient because it is difficult to explain (on which I agree with him) and for not really showing the true inequality (on which I disagree).  I disagree on the latter point because I think that the Gini coefficient is actually the logical extension of his approach of looking at the cumulative income or wealth of the bottom 50%, next 40% etc; all the Gini coefficient does is take it to the extreme, and it gives a genuinely good measure of total inequality (assuming the source data are ok), including the impact of the top 10%, 1%, 0.1%, etc.</p>

<h2 id="gini-coefficient">Gini coefficient</h2>
<p>The curve above yields a Gini coefficient of 0.51, which is high compared to the Gini coefficients that are commonly reported.  For example <a href="http://www.stats.govt.nz/browse_for_stats/snapshots-of-nz/nz-social-indicators/Home/Standard%20of%20living/income-inequality.aspx">Statistics New Zealand via the OECD report a Gini coefficient of 0.33</a> for household income.  There are three reasons (at least) for the discrepancy, which make the NZIS a poor choice for inequality measures that are comparable to the most commonly used (although still ok for my purposes):</p>

<ul>
  <li>The NZIS is an individual measure, whereas most reported measures are done at the household level.  In previous posts I’ve discussed the large numbers of zero income individuals in the NZIS.  Many of these will be part of households with positive total income, contributing to a lower level of inequality in a household-based measure.  There’s arguments for both methods, I think - it’s not hard to imagine the <a href="https://scholar.google.co.nz/scholar?q=feminist+critique+of+measuring+income+at+the+household+level&amp;hl=en&amp;as_sdt=0&amp;as_vis=1&amp;oi=scholart&amp;sa=X&amp;ved=0CBkQgQMwAGoVChMIjrKF6t3wxwIVR8emCh17uwXw">feminist argument for paying more attention to intra-household income differences</a>.</li>
  <li>Conventionally these sorts of measures are done on an annual basis.  Again, this will lead to a more equal distribution than a snapshot of a single week.  There’s nothing magic about annual income (why not ten years? per lifetime? or a month?), but it is a strong and understandable convention.</li>
  <li>Most income inequality measures are based on income after taxes and transfers (or if both before and after are used, more emphasis is usually given to ‘after taxes and transfers’).  My interpretation of the “gross weekly income from all sources” described in the <a href="http://www.stats.govt.nz/tools_and_services/microdata-access/nzis-2011-cart-surf.aspx">technical notes for the NZIS SURF</a> is that it represents income after transfers, but prior to tax.</li>
</ul>

<p>Let’s be clear - I’m not saying my Gini coefficient is better than Statistics New Zealand’s.  If anyone claims I’m criticising the official measure you’re misrepresenting me and please don’t!  In this post, I’m exploring the technical characteristics of estimates of Gini coefficients, and I happen to have weekly, individual gross income rather than annual, household, after taxes-and-transfers income to do it with.</p>

<h3 id="weekly-versus-annual-measures">Weekly versus annual measures?</h3>
<p>Let’s explore that weekly issue a bit more.  Consider two extremes:</p>

<ul>
  <li>If everyone’s weekly income is unchanging and the week that we’ve sampled is representative of every week for them, the annual inequality will be identical to the weekly ie 0.51</li>
  <li>If income in one week bears no relation to income in the other weeks, but each week an individual gets a random draw from the pool of possible incomes, the annual inequality will be substantively less - around 0.09</li>
</ul>

<p>For those not familiar with the Gini coefficient, 1 means complete inequality (ie one person receives all the income) and 0 means complete inequality (everyone gets exactly the same income).  0.09 is far lower than any observed economic inequalities, and reflects the absurdity of everyone’s weekly income being random - cleaners don’t spend the occasional week as CEO of a large firm.  However, one certainly expects some degree of smoothing.</p>

<p>Taking all those factors into account, the weekly individual income Gini coefficient of 0.51 does not contradict the official household annual figure of 0.33 (which is a relief, of course).  Here’s how I worked out that 0.09 number, with a little simulation based on resampling the observed data:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Gini</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span><span class="w">                   </span><span class="c1"># 0.51
</span><span class="w">
</span><span class="c1"># if completely constant each week
</span><span class="n">Gini</span><span class="p">(</span><span class="n">inc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">52</span><span class="p">)</span><span class="w">              </span><span class="c1"># 0.51
</span><span class="w">
</span><span class="c1"># create incomes that simulate each week being a random pull from the pool
</span><span class="n">random_incomes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_frame</span><span class="p">(</span><span class="w">
   </span><span class="n">income</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span><span class="w"> </span><span class="m">52</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">inc</span><span class="p">),</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
   </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">inc</span><span class="p">),</span><span class="w"> </span><span class="m">52</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">income</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">income</span><span class="p">))</span><span class="w">

</span><span class="n">Gini</span><span class="p">(</span><span class="n">random_incomes</span><span class="o">$</span><span class="n">income</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="m">0.09</span></code></pre></figure>

<h3 id="must-be-positive-non-zero">“Must be positive non zero”?</h3>
<p>The literature on Gini coefficients says it can only be fitted to positive, non zero data but I see no practical problem with fitting them to a dataset with zeroes and negative values, even one with a <a href="/blog/2015/09/05/creating-a-scale-transformation.html">large number of zeroes like the NZIS</a>.  Including negative numbers means the Lorenz curve briefly dips below zero, and it becomes possible to have a Gini coefficient greater than 1 (for example, if one person has a positive income and everyone else has negative), but this doesn’t strike me as a reason for not using it.  The result is intuitively ok and there are no computational difficulties so long as at least one number is positive and the sum of the positive numbers is enough to outweigh the sum of the negative numbers.  If anyone can think of a reason for only applying Gini coefficients and Lorenz curves to strictly positive data let me know.</p>

<h3 id="sampling-distribution-of-a-gini-coefficient">Sampling distribution of a Gini coefficient</h3>
<p>So the question I’m seeking to answer is, how do inequality statistics like the Gini coefficient and the others stand up with small samples of real data?  Putting aside non-sampling error (like people misleading the interviewers), what happens with a smaller survey?  I know from <a href="http://www.statsdirect.com/help/default.htm#nonparametric_methods/gini.htm">various sources online</a> that “The small sample variance properties of G are not known, and large sample approximations to the variance of G are poor”.</p>

<p>I’m interested in both the shape of the distribution of estimates of these figures, and their standard errors ie how far out from the “true” value we’d expect the estimates to be.  The NZIS has a sample of around 29,000; let’s shrink that down to 30 and see how much the estimated Gini coefficient changes with different randomly selected bunches of 30 people, compared to 1,000, and the original sample of around 30,000.  Note that the horizontal axes on the plots below are on differing scales - I did this to keep a visual sense of the shape of the distribution.</p>

<p><img src="/img/0008-density-gini-n30.svg" alt="n30" />
<img src="/img/0008-density-gini-n1000.svg" alt="n1000" />
<img src="/img/0008-density-gini-n30000.svg" alt="n30000" /></p>

<p>This estimator behaves better than I thought it would with real data that has all the weird and wonderful extremes we get with individual economic variables.  Certainly by the time the sample size gets up to 1,000 or so there are no outrageous values and the range of estimated values is reasonably narrow, although wide enough to beware of comparisons of small differences at that sample size.  This is in contrast to the sample size of 30, where clearly in one instance we got a sample with one high earner and many zeros or negatives, resulting in a Gini coefficient of more than 1!  Make a note not to estimate a population’s inequality from such a small sample.  For the actual sample size of the New Zealand Income Survey of nearly 30,000, sampling error is negligible.  Now, if only we could say the same for the non-sampling error - so much harder to quantify, so much harder to control for.  But subject for reflections at a later date.</p>

<p>The above analysis was done by creating a function to conduct the simulation and draw the plot for a given sample size n:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sim_gini</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">reps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">){</span><span class="w">
   </span><span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
      </span><span class="n">trial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">reps</span><span class="p">,</span><span class="w">
      </span><span class="n">estimate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="n">reps</span><span class="p">))</span><span class="w">
   
   </span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w"> </span><span class="c1"># for reproducibility
</span><span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">reps</span><span class="p">){</span><span class="w">
      </span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s2">"estimate"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> 
         </span><span class="n">Gini</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
   </span><span class="p">}</span><span class="w">
   
   </span><span class="n">print</span><span class="p">(</span><span class="n">results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">estimate</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">geom_density</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">geom_rug</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">ggtitle</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Distribution of estimated Gini coefficient, n ="</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)))</span><span class="w">
   
   </span><span class="n">grid.text</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Standard error: "</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">sd</span><span class="p">(</span><span class="n">results</span><span class="o">$</span><span class="n">estimate</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">)),</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">0.6</span><span class="p">,</span><span class="w"> 
             </span><span class="n">gp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpar</span><span class="p">(</span><span class="n">fontfamily</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">))</span><span class="w">
   
   </span><span class="n">grid.text</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"95% Confidence interval:\n"</span><span class="p">,</span><span class="w"> 
                    </span><span class="n">paste</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">quantile</span><span class="p">(</span><span class="n">results</span><span class="o">$</span><span class="n">estimate</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.025</span><span class="p">,</span><span class="w"> </span><span class="m">0.975</span><span class="p">)),</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">", "</span><span class="p">)),</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> 
             </span><span class="n">gp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpar</span><span class="p">(</span><span class="n">fontfamily</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">,</span><span class="w"> </span><span class="n">fontsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">))</span><span class="w">
 </span><span class="p">}</span><span class="w">
 
</span><span class="n">sim_gini</span><span class="p">(</span><span class="m">30</span><span class="p">)</span><span class="w">

</span><span class="n">sim_gini</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span><span class="w">

</span><span class="n">sim_gini</span><span class="p">(</span><span class="m">30000</span><span class="p">)</span></code></pre></figure>

<p>Further exploration of the other inequality measures and their distributions will wait for another post, as this one is long enough already.</p>


		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2015/09/07/transforming-breaks-in-a-scale">Transforming the breaks to match a scale</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2015/09/19/timeseries-same-acf">Autocorrelation functions of materially different time series</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics
http://Http://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>