      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>A (not too talkative) twitterbot is born</title>
      	
         
         
            <meta name ="description" content ="I've set up a twitter bot who (infrequently) retweets popular tweets about rstats with praise, repeats assorted R wisdom, and babbles about R.">
            <meta property="og:description" content ="I've set up a twitter bot who (infrequently) retweets popular tweets about rstats with praise, repeats assorted R wisdom, and babbles about R.">
         
         <meta property="og:site_name" content="Peter's stats stuff" />
         <meta property="og:title" content="A (not too talkative) twitterbot is born" />
         
            <meta property="og:image" content="http://ellisp.github.io/img/0027-cloud.png" />
         
         <meta property="og:url" content="http://ellisp.github.io/blog/2015/12/29/Rrobot-born/" />
         <meta property="og:author" content= "https://www.facebook.com/peter.ellis.353" />
         <meta property="og:type" content="article" />
           
          <link href="/css/bootstrap.min.css" rel ="stylesheet">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet">
            <link href="/css/custom.css" rel ="stylesheet">     
		<link href="/css/syntax.css" rel ="stylesheet">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>

   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="Peter's stats stuff by Peter Ellis"
      href="/feed.xml">


      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Peter's stats stuff</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">All blog posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">Ordered by date</a></li>
                  <li><a href="/blog/index_by_tag.html">Grouped by subject matter</a></li>
                  <li><a href = /blog/2016/08/16/dualaxes>Most recent post</a></li>
                 </ul>
            </li>
              <li><a href="/blog/showcase.html">Showcase</a></li>
              <li><a href="/presentations/index.html">Presentations</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			    <div class="jumbotron">
      <div class="container">
        <h1>A (not too talkative) twitterbot is born</h1>
         <p class="meta">29 Dec 2015</p>
        
      </div>
    </div>




<div class = "post-summary">
<h2>TL;DR Summary:</h2>
   I've set up a twitter bot who (infrequently) retweets popular tweets about rstats with praise, repeats assorted R wisdom, and babbles about R.
   <hr></hr>
</div>

<div class="post">
<div class="col-md-2">

</div>
  <div class="col-md-8">

  <h2 id="twitter-bots">Twitter bots</h2>
<p>One of my holiday projects was to get my head around how Twitter bots work, and the best (only?) way of course is to make one.  Apparently <a href="http://www.techtimes.com/articles/12840/20140812/twitter-acknowledges-14-percent-users-bots-5-percent-spam-bots.htm">about one in seven Twitter accounts is a computer program</a> rather than a human user (although of course there are humans behind, and responsible, for all the robots).  That’s 23 million bots (and that figure is 16 months old).</p>

<p>Some of these bots are doing useful things (for a broad enough definition of useful - this is Twitter, after all), like <a href="https://twitter.com/deepselfie">@deepselfie</a> by Andrej Karpathy which will <a href="http://karpathy.github.io/2015/10/25/selfie/">rate the quality of selfie photos</a>. Others are just annoying like <a href="https://twitter.com/datascience_tn">datascience_tn</a>, a presumably well meaning attempt to promote discussion on data science and set up a community in Tunisia, but which spams a whole bunch of hashtags with tweets and retweets at a rate approximating one post per second (I don’t know for sure that @datascience_tn is a computer program, but if it’s a human they’ve got some pretty fast typing and clicking abilities and indefatigable patience).</p>

<p>While some of those bots are useful, five percent of all Twitter users are spam bots, that aren’t useful to anyone.</p>

<h3 id="ethics">Ethics</h3>
<p>People are morally responsible for what is done by the things they create and unleash on the world, so it was with a bit of trepidation that I set out to do anything that would clutter an already cluttered twitterverse.</p>

<p>My first idea had been to create a sort of “gossip-bot”, to see how realistic I could make an automated follower of celebrity - retweeting trending posts, passing on stories, making them up… I quickly realised that could go horribly wrong.</p>

<p>Several ethical obligations seem to spring to mind:</p>

<ul>
  <li>not to clutter up hash tag channels with excessive spam-like posts and re-tweets</li>
  <li>not to post anything untrue that could be mistaken by anyone reading it (ie anyone in the world) as true and libellous or mean</li>
  <li>not to accrue any personal gains through deception (eg by creating a bot to systematically retweet and favourite my own tweets and make me look more popular and influential than I am).</li>
</ul>

<p>There’s probably more.</p>

<h3 id="happyrrobot">HappyRrobot</h3>
<p>So, bearing that in mind, I gave myself a modest objective, enough to build the skills I wanted in this space and do something whimsical and amusing (at least for me) without doing any damage.  I chose the general theme of R and the #rstats hash tag as a starting point, hoping that at least more people in that space would appreciate the joke than get upset.  And so <a href="https://twitter.com/HappyRrobot">HappyRrobot</a> was born.</p>

<p>So far this is what it can do:</p>

<ul>
  <li>Twice a day it searches the #rstats channel and retweets, with random praise, one of the more popular recent status updates with that hash tag</li>
  <li>Once a day it updates its own status with one of:
    <ul>
      <li>An <a href="https://cran.r-project.org/web/packages/fortunes/index.html">R <code class="highlighter-rouge">fortune</code> cookie</a> (limited to those shorter than 140 characters)</li>
      <li>A babbled, mixed up extract of the <a href="https://cran.r-project.org/doc/manuals/r-release/R-admin.html">R installation and administration</a> guide</li>
      <li>A babbled, mixed up extract of the <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.html">An Introduction to R</a> guide</li>
    </ul>
  </li>
  <li>Twice a month it scans the splash page of R-bloggers and tweets a wordcloud:</li>
</ul>

<p><img src="/img/0027-cloud.png" alt="wordcloud" /></p>

<h3 id="how-its-done">How it’s done</h3>
<p>It turned out to be outrageously easy to do this thanks to the <a href="https://cran.r-project.org/web/packages/twitteR/index.html"><code class="highlighter-rouge">twitteR</code> package by Jeff Gentry</a>.  A word of warning - the Twitter API has not been stable in recent years, so if you Google for how to speak to it from R or Python make sure you’re using only recent links.</p>

<p>The basic steps are set out in <a href="http://www.r-datacollection.com/blog/Programming-a-Twitter-bot/">this post where Simon Munzert shows how to program a Twitter bot to send nagging messages to PhD students</a>.</p>

<p>For some people including me, the main barrier to entry is having access to a server that can run scripts on a regular basis.  In my case, I’ve now got an old physical machine running Ubuntu server that lets me do this and similar things; if I were taking it more seriously though (and hence worried about backups, continuous service, etc) I’d want to pay Amazon (not very much, they’re cheap) to provide it through their EC2 service.</p>

<p>The full set of code that does the various robot tasks is spread over a number of files and folders and can be inspected (or forked…) from <a href="https://github.com/ellisp/Rrobot">GitHub</a>.  If I don’t lose interest I might do some more ambitious things - I’d wanted to make it more interactive than it currently is, and now that I’ve worked out the basics of reading others’ tweets, replying and retweeting I have only the small matter of getting something for it to say.  But that would be part of a bigger natural language processing project for me to learn about, some time in the future (and I would probably move to other subject matter).</p>

<p>Here are some examples of code from that repository.</p>

<p>Here’s the file that finds a fortune of less than 140 characters (after its author is pasted to the end) and puts it into the <code class="highlighter-rouge">tweettxt</code> object for later use.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">fortunes</span><span class="p">)</span><span class="w">

</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
   </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">character</span><span class="p">(),</span><span class="w">
   </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(),</span><span class="w">
   </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">360</span><span class="p">){</span><span class="w">
   </span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"'"</span><span class="p">,</span><span class="w"> </span><span class="n">fortune</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">$</span><span class="n">quote</span><span class="p">,</span><span class="w"> </span><span class="s2">"' "</span><span class="p">,</span><span class="w"> </span><span class="n">fortune</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">$</span><span class="n">author</span><span class="p">,</span><span class="w"> </span><span class="s2">"."</span><span class="p">)</span><span class="w">
   </span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stri_length</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">f</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">140</span><span class="p">)</span><span class="w"> 
</span><span class="n">tweettxt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">f</span><span class="m">2</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<p>Here’s the main daily tweeting file.  It calls a script that sets up the robot’s credentials (which I haven’t published on GitHub), and another that defines some functions including a simple <code class="highlighter-rouge">retweet()</code> function (I couldn’t find one like this in twitteR but it was simple enough to make).  Then it decides whether to call the fortunes script (as above), or one of those that babbles in the style of a classic R manual.  It tweets the result, and saves its tweets to a local log.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#--------------set up---------------
</span><span class="n">library</span><span class="p">(</span><span class="n">twitteR</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringi</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">base64enc</span><span class="p">)</span><span class="w">

</span><span class="n">source</span><span class="p">(</span><span class="s2">"credentials_setup.R"</span><span class="p">)</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"utils/functions.R"</span><span class="p">)</span><span class="w">

</span><span class="c1">#---------------main loop-------------
</span><span class="n">rnd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="k">if</span><span class="p">(</span><span class="n">rnd</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.7</span><span class="p">){</span><span class="w">
   </span><span class="n">source</span><span class="p">(</span><span class="s2">"tweeting/fortunes.R"</span><span class="p">)</span><span class="w">   
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">rnd</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.3</span><span class="p">){</span><span class="w">
   </span><span class="n">source</span><span class="p">(</span><span class="s2">"tweeting/R-intro.R"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="n">source</span><span class="p">(</span><span class="s2">"tweeting/R-admin.R"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">tweet</span><span class="p">(</span><span class="n">tweettxt</span><span class="p">)</span><span class="w">
</span><span class="n">line</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">Sys.time</span><span class="p">()),</span><span class="w"> </span><span class="n">tweettxt</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">)</span><span class="w">
</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="o">=</span><span class="s2">"tweets.log"</span><span class="p">,</span><span class="w"> </span><span class="n">append</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<p>Then I need a shell script that will run the relevant R file in batch mode:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="c"># Main tweeting loop - run once a day</span>
<span class="nb">cd</span> ~/Rrobot

R CMD BATCH tweeting/main.R</code></pre></figure>

<p>And finally, in my <code class="highlighter-rouge">crontab</code> file, I have entries that run the various scripts when needed, at set times of the day (and days of the month, for the R-bloggers word cloud).</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">PATH</span><span class="o">=</span>/home/ellisp/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
37 8 <span class="k">*</span>    <span class="k">*</span> <span class="k">*</span> /home/ellisp/Rrobot/cron_scripts/main_tweet
12 6 2,17 <span class="k">*</span> <span class="k">*</span> /home/ellisp/Rrobot/cron_scripts/rblog_cloud_tweet
18 18,11  <span class="k">*</span>   <span class="k">*</span> <span class="k">*</span> /home/ellisp/Rrobot/cron_scripts/retweet</code></pre></figure>

<p>If you have a Windows server these last two steps would be different, but still straightforward; Simon Munzert’s post shows how to do that.</p>

<h3 id="acknowledgements">Acknowledgements</h3>
<p>As well as <code class="highlighter-rouge">twitteR</code> this project depended heavily on the whimsical but pleasant <code class="highlighter-rouge">praise</code> plus a bunch of the usual suspects for me: <code class="highlighter-rouge">dplyr</code>, <code class="highlighter-rouge">tm</code>, <code class="highlighter-rouge">wordcloud</code>, <code class="highlighter-rouge">stringr</code>, <code class="highlighter-rouge">stringi</code>, <code class="highlighter-rouge">rvest</code>.</p>


</div>

<div class = "container">
   <div class="col-md-4">
    
        <a rel="prev" href="/blog/2015/12/26/commuting-network">
        <p>&larr; Older</p>
        <p>Network charts of commuting in New Zealand with R and D3</p>
        
        </a>
    
    </div>
    <div class="col-md-4">
    </div>
    <div class="col-md-4" style="text-align: right;">
     
        <a rel="next" href="/blog/2016/01/23/nzis-estimates">
        <p>Newer &rarr;</p>
        <p>Filling in the gaps - highly granular estimates of income and population for New Zealand from survey data</p>
        
        </a>
    
      </div>
      </div>
      
      
      
</div>


   
    <div id="disqus_thread"></div>

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    
    
   
			
			</div><!-- /.container -->

         

   <div class = "container footer">
			<footer>
	    		
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.  Or follow <a href = "/feed.r.xml">posts in this blog featuring R with RSS</a>.</p>
			
            <p>This blog is built with <a href = "http://jekyllrb.com/">Jekyll</a>, <a href = "http://getbootstrap.com/">Bootstrap</a>, <a href = "https://www.ruby-lang.org/en/">Ruby</a> and <a href = "https://cran.r-project.org/">R</a>.  Read my <a href="/about/acknowledgements.html">acknowledgements</a> for a little more on how.  I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>

			<div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="true" data-share="false"></div>
			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Peter's stats stuff</span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			
			

			</footer>
    </div>



  
</body>
</html>
   




         
