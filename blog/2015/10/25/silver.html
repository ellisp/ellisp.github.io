      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Silver flows in the seventeenth and eighteenth centuries</title>
      	
         
         
            <meta name ="description" content ="I rework into a simple animated GIF a classic set of two diagrams, originally by Jan DeVries in 2003, showing the flow of silver between continents in the seventeenth and eighteenth centuries.">
            <meta property="og:description" content ="I rework into a simple animated GIF a classic set of two diagrams, originally by Jan DeVries in 2003, showing the flow of silver between continents in the seventeenth and eighteenth centuries.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Silver flows in the seventeenth and eighteenth centuries" />
         
            <meta property="og:image" content="http://ellisp.github.io/img/0015-silver.gif" />
         
		 
			<meta property="og:url" content="http://freerangestats.info/blog/2015/10/25/silver.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
				  <li><a href = /blog/2020/07/18/victoria-r-convolution>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">election forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/elections/nz-2020/index.html">NZ 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Silver flows in the seventeenth and eighteenth centuries</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I rework into a simple animated GIF a classic set of two diagrams, originally by Jan DeVries in 2003, showing the flow of silver between continents in the seventeenth and eighteenth centuries.</p>
	   <p class="meta">25 Oct 2015</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="silver-trade">Silver trade</h2>
<p>I’ve been reading  Ronald Findlay and Kevin H. O’Rourke’s 2009 book <a href="http://press.princeton.edu/titles/8493.html"><em>Power and Plenty: Trade, War, and the World Economy in the Second Millennium</em></a> and finding it an excellent piece of big picture economic history.</p>

<p>I felt the urge to re-express one of their figures (Figure 4.7 in the original).  The original is made up of two flow diagrams, summarising a fantastic piece of work by Jan DeVries pulling together the best understanding of where silver was traded from and to in the seventeenth and eighteenth centuries.  Here’s my reworked effort:</p>

<p><img src="/img/0015-silver.gif" width="100%" /></p>

<p>Some points worth noting:</p>

<ul>
  <li>Substantial amounts of silver remained in Europe.  The trade was not, by a long shot, all about shipping silver <a href="https://en.wikipedia.org/wiki/Economy_of_the_Ming_dynasty">from the Americas to China</a> via Europe, although this was clearly a significant feature.</li>
  <li>In the earlier period, there was more silver travelling from the Americas via the Pacific (stopping off at Manila) to China and the rest of East Asian than via Europe and the Cape of Good Hope.  By the mid eighteenth century, the Europe/Cape route was far larger.</li>
  <li>Although the Chinese Ming dynasty fell in 1644, suspiciously soon after the <a href="https://en.wikipedia.org/wiki/Tokugawa_shogunate">seclusion of Japan from the outside world in 1635</a>, the fall can’t be blamed on a shortage of silver because the decline was compensated for by increases from the Americas.</li>
  <li>Not all the silver going via the Baltic and Levant “routes” makes it to East Asia.  Some stays in the Middle East and Russia.  In the diagram above this is shown by the ribbons flowing from the Baltic and Levant to South East Asia being only half the width of those flowing from Western Europe to the Baltic and Levant.  I’m not entirely happy with this aspect of the diagram, but it’s good enough for now.</li>
</ul>

<h2 id="the-original">The original</h2>
<p>I don’t have access to DeVries’ original 2003 article:</p>

<ul>
  <li>“Connecting Europe and Asia: a quantitative analysis of the Cape-route trade, 1497– 1795”. In <em>Global Connections and Monetary History, 1470– 1800</em> (ed. D. O. Flynn, A. Gir ´ ldez, and R. von Glahn). Aldershot: Ashgate.,</li>
</ul>

<p>but it must be an impressive piece of detective work.  <a href="http://history.berkeley.edu/people/jan-devries">Jan de Vries has a web page at Berkeley.</a>  Here’s his flow diagrams as reproduced by Findlay and O’Rourke:</p>

<p><img src="/img/0015-silver-screenshot.png" alt="original" /></p>

<p>Note that the caption says the flows are in kilogrammes per year, but it’s obvious from the text that this is a typo and in fact the measures are in tonnes per year.</p>

<h2 id="re-creating-it">Re-creating it</h2>
<p>I wanted to improve this diagram in several ways to give it a more immediate visual impact related to the underlying data:</p>

<ul>
  <li>use colour rather than shape to indicate which areas were producers and which were consumers</li>
  <li>use width of lines to show volumes so it becomes a <a href="https://en.wikipedia.org/wiki/Sankey_diagram">Sankey diagram</a></li>
  <li>use animation to facilitate direct comparison of the two periods</li>
</ul>

<p>In combination, this should be more effective than the wireframe original at drawing the viewer’s eye to the increase in volume in the Americas - Atlantic - Europe - Cape - Asia triangle, and the reduction to nothing in flows from Japan when the Tokugawa regime shut that country to the world and expelled the Portuguese traders who had been making a nice living carrying between China and Japan.</p>

<p>I also rounded a few decimal numbers that in the original gave a false idea of precision.</p>

<p>To do this efficiently for two diagrams that have the same basic structure, I created a project-specific function in R for the purpose of drawing a Sankey chart for different levels of silver flows.  The two images are created separately as PNG files, and then I use <a href="http://www.imagemagick.org/script/index.php">ImageMagick</a> to tie them together into an animated GIF.  To allow the whole thing to be run programmatically from R, I send the command to ImageMagick from R, effectively using R as a shell script for that part of the program.  This means I don’t need to leave my R development environment to run iterations of the program (for example, while tweaking exactly where each continent’s label is placed on the page).</p>

<p>The actual drawing of the plots is done by January Weiner’s excellent <a href="https://cran.r-project.org/web/packages/riverplot/index.html"><code class="highlighter-rouge">riverplot</code></a> R package.  Until <code class="highlighter-rouge">riverplot</code> came out some time in the last year or so, drawing Sankey charts was either a pain, or impossible without specialist software.  It’s great that we can now draw and polish (to a degree) Sankey charts without leaving the R environment.</p>

<p>One trick needed for this, common when you want to set a scale to be the same in multiple plots, was to draw an invisible (ie white) ribbon connecting two invisible nodes at the top of the diagram, reflecting movement of 650 tonnes per year of silver between two imaginary locations.  This value is controlled by the <code class="highlighter-rouge">cal_width</code> argument in my <code class="highlighter-rouge">silver()</code> function below.  As 650 is equal to or larger than any of the actual flows, it forms the calibration value against which all the other ribbon widths are defined.  This means the widths of the ribbons in the two images are comparable and on the same scale.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">riverplot</span><span class="p">)</span><span class="w">   </span><span class="c1"># for Sankey charts
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">showtext</span><span class="p">)</span><span class="w">    </span><span class="c1"># for fonts
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
   
</span><span class="n">font.add.google</span><span class="p">(</span><span class="s2">"Poppins"</span><span class="p">,</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">)</span><span class="w">
</span><span class="n">showtext.auto</span><span class="p">()</span><span class="w">


</span><span class="n">silver</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">node_values</span><span class="p">,</span><span class="w"> </span><span class="n">edge_values</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> 
                   </span><span class="n">pal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"orange"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cyan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"grey90"</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myfont"</span><span class="p">,</span><span class="w">
                   </span><span class="n">cal_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">650</span><span class="p">){</span><span class="w">
   </span><span class="c1"># Function that draws a Sankey chart of intercontinental silver flows
</span><span class="w">   </span><span class="c1"># @node_values - the number of production / consumption / travel to be added
</span><span class="w">   </span><span class="c1">#   to America, Western Europe, Levant, Baltic, Cape, Japan, SE Asia, Atlantic, Pacific, Sea of Japan
</span><span class="w">   </span><span class="c1"># @edge_values - the width of the connections in this order:
</span><span class="w">   </span><span class="c1">#    America to Pacific to South East Asia
</span><span class="w">   </span><span class="c1">#    America to Atlantic to Western Europe
</span><span class="w">   </span><span class="c1">#    Western Europe to Baltic to South East Asia
</span><span class="w">   </span><span class="c1">#    Western Europe to Levant to South East Asia
</span><span class="w">   </span><span class="c1">#    Western Europe to Cape to South East Asia
</span><span class="w">   </span><span class="c1">#    Japan to Sea of Japan to South East Asia
</span><span class="w">   </span><span class="c1"># @title title for plot
</span><span class="w">   </span><span class="c1"># @pal vector of colours for producers, consumers, and travel routes respectively
</span><span class="w">   </span><span class="c1"># @family font family to use
</span><span class="w">   </span><span class="c1"># @cal_width width of an invisible white ribbon to draw, implicitly the maximum, 
</span><span class="w">   </span><span class="c1">#    so scale is constant for multiple plots
</span><span class="w">   
   </span><span class="c1"># edge_values comes in as just a single number and we need two edges for 
</span><span class="w">   </span><span class="c1"># each (eg America to Pacific to SE Asia is two edges)
</span><span class="w">   </span><span class="n">edge_values</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">edge_values</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
   
   </span><span class="c1"># we don't know how much of the silver that goes via the Baltic and the Levant
</span><span class="w">   </span><span class="c1"># actually gets to Asia (as opposed to staying in middle East and Russia),
</span><span class="w">   </span><span class="c1"># so to represent this we halve the width of those two edges:
</span><span class="w">   </span><span class="n">edge_values</span><span class="p">[</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">edge_values</span><span class="p">[</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">)]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="w">
   
   </span><span class="n">nodes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
      
      </span><span class="c1"># The X and Y coordinates of the nodes (Americas, Atlantic, etc) are 
</span><span class="w">      </span><span class="c1"># just chosen by hand:
</span><span class="w">      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">4.7</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w">   </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">8.5</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">),</span><span class="w">
      </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w">   </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4.5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w">   </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w">
      </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">],</span><span class="w">
      </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"America"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Western Europe"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Levant"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Baltic"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Cape of\nGood Hope"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Japan"</span><span class="p">,</span><span class="w"> </span><span class="s2">"South &amp;\nEast Asia"</span><span class="p">,</span><span class="w"> 
                 </span><span class="s2">"Atlantic"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Pacific"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">),</span><span class="w">
      </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">node_values</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">),</span><span class="w">
      </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">pal</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)],</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="s2">"white"</span><span class="p">),</span><span class="w">
      </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">mutate</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">),</span><span class="w">
             </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"\n59.3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"59.3"</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="p">))</span><span class="w">
   
   </span><span class="n">edges</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
      </span><span class="c1"># Each N1 - N2 pair connects two nodes eg A-I connects America to Atlantic:
</span><span class="w">      </span><span class="n">N</span><span class="m">1</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"I"</span><span class="p">,</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"H"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"D"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"C"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"E"</span><span class="p">,</span><span class="w">  </span><span class="s2">"F"</span><span class="p">,</span><span class="w"> </span><span class="s2">"J"</span><span class="p">,</span><span class="w"> </span><span class="s2">"K"</span><span class="p">),</span><span class="w">
      </span><span class="n">N</span><span class="m">2</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="nf">c</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span><span class="w"> </span><span class="s2">"G"</span><span class="p">,</span><span class="w"> </span><span class="s2">"H"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"D"</span><span class="p">,</span><span class="w"> </span><span class="s2">"G"</span><span class="p">,</span><span class="w"> </span><span class="s2">"C"</span><span class="p">,</span><span class="w"> </span><span class="s2">"G"</span><span class="p">,</span><span class="w"> </span><span class="s2">"E"</span><span class="p">,</span><span class="w"> </span><span class="s2">"G"</span><span class="p">,</span><span class="w">  </span><span class="s2">"J"</span><span class="p">,</span><span class="w"> </span><span class="s2">"G"</span><span class="p">,</span><span class="w"> </span><span class="s2">"L"</span><span class="p">),</span><span class="w">
      </span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">edge_values</span><span class="p">,</span><span class="w"> </span><span class="n">cal_width</span><span class="p">)</span><span class="w">
   </span><span class="p">)</span><span class="w">
   
   </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">makeRiver</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="w"> </span><span class="n">edges</span><span class="p">)</span><span class="w">
   </span><span class="n">my_style</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">default.style</span><span class="p">()</span><span class="w">
   </span><span class="n">my_style</span><span class="o">$</span><span class="n">textcol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"grey20"</span><span class="w">
   </span><span class="n">my_style</span><span class="o">$</span><span class="n">srt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w">
   
   </span><span class="n">par</span><span class="p">(</span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">family</span><span class="p">)</span><span class="w">
   </span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">default_style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_style</span><span class="p">,</span><span class="w"> </span><span class="n">plot_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.9</span><span class="p">)</span><span class="w">
   </span><span class="n">grid.text</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.94</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w">
             </span><span class="n">gp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpar</span><span class="p">(</span><span class="n">fontfamily</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">family</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">))</span><span class="w">
   </span><span class="n">grid.text</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.13</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.12</span><span class="p">,</span><span class="w"> 
             </span><span class="n">str_wrap</span><span class="p">(</span><span class="s2">"Source: DeVries (2003), reproduced in Findlay and O'Rourke (2007) 'Power and Plenty'"</span><span class="p">,</span><span class="w"> </span><span class="m">34</span><span class="p">),</span><span class="w">
             </span><span class="n">gp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpar</span><span class="p">(</span><span class="n">fontfamily</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">family</span><span class="p">,</span><span class="w"> </span><span class="n">fontface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"italic"</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.7</span><span class="p">))</span><span class="w">
   </span><span class="n">legend</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Producer"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Trade route"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Consumer"</span><span class="p">),</span><span class="w"> 
          </span><span class="n">bty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pal</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)],</span><span class="w"> </span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># draw the two images
</span><span class="n">png</span><span class="p">(</span><span class="s2">"01.png"</span><span class="p">,</span><span class="w"> </span><span class="m">800</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
   </span><span class="n">silver</span><span class="p">(</span><span class="w">
      </span><span class="n">node_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">368</span><span class="p">,</span><span class="w"> </span><span class="m">158</span><span class="p">,</span><span class="w"> </span><span class="m">38</span><span class="p">,</span><span class="w"> </span><span class="m">56</span><span class="p">,</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="s2">"?"</span><span class="p">,</span><span class="w"> </span><span class="s2">"91-126"</span><span class="p">,</span><span class="w"> </span><span class="m">268</span><span class="p">,</span><span class="w"> </span><span class="s2">"17-51"</span><span class="p">,</span><span class="w"> </span><span class="s2">"59"</span><span class="p">),</span><span class="w"> 
      </span><span class="n">edge_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">34</span><span class="p">,</span><span class="w">  </span><span class="m">268</span><span class="p">,</span><span class="w">  </span><span class="m">56</span><span class="p">,</span><span class="w">  </span><span class="m">38</span><span class="p">,</span><span class="w"> </span><span class="m">15.5</span><span class="p">,</span><span class="w"> </span><span class="m">59.3</span><span class="p">),</span><span class="w"> 
      </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Intercontinental flows of silver, tonnes per year, 1600 to 1650"</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">

</span><span class="n">png</span><span class="p">(</span><span class="s2">"02.png"</span><span class="p">,</span><span class="w"> </span><span class="m">800</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">silver</span><span class="p">(</span><span class="w">
   </span><span class="n">node_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">650</span><span class="p">,</span><span class="w"> </span><span class="m">230</span><span class="p">,</span><span class="w"> </span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">160</span><span class="p">,</span><span class="w"> </span><span class="s2">"?"</span><span class="p">,</span><span class="w"> </span><span class="s2">"175-211"</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="s2">"15-51"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0"</span><span class="p">),</span><span class="w"> 
   </span><span class="n">edge_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">33.1</span><span class="p">,</span><span class="w">  </span><span class="m">500</span><span class="p">,</span><span class="w">  </span><span class="m">50</span><span class="p">,</span><span class="w">  </span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="m">160</span><span class="p">,</span><span class="w"> </span><span class="m">0.00</span><span class="p">),</span><span class="w"> 
   </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Intercontinental flows of silver, tonnes per year, 1725 to 1750"</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">

</span><span class="c1"># combine them into an animated GIF
</span><span class="n">system</span><span class="p">(</span><span class="s1">'"C:\\Program Files\\ImageMagick-6.9.1-Q16\\convert" -loop 0 -delay 250 *.png "silver.gif"'</span><span class="p">)</span><span class="w">

</span><span class="c1"># move the asset over to where needed for the blog
</span><span class="n">file.copy</span><span class="p">(</span><span class="s2">"silver.gif"</span><span class="p">,</span><span class="w"> </span><span class="s2">"../img/0015-silver.gif"</span><span class="p">,</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># cleanup
</span><span class="n">unlink</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"0?.png"</span><span class="p">,</span><span class="w"> </span><span class="s2">"silver.gif"</span><span class="p">))</span></code></pre></figure>



		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2015/10/10/X13ARIMA-SEATS">Seasonal adjusment on the fly with X-13ARIMA-SEATS, seasonal and ggplot2</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2015/10/30/MTAGDP">Modelled Territorial Authority GDP for New Zealand</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics
http://Http://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>