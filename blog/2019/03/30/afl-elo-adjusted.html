      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Better predictions for AFL from adjusted Elo ratings</title>
      	
         
         
            <meta name ="description" content ="I improve my AFL predictions by adjusting Elo ratings for home team advantage (varying by home team) and with a more data-driven approach to parameters for the actual ratings.">
            <meta property="og:description" content ="I improve my AFL predictions by adjusting Elo ratings for home team advantage (varying by home team) and with a more data-driven approach to parameters for the actual ratings.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Better predictions for AFL from adjusted Elo ratings" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0148-best-preds.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2019/03/30/afl-elo-adjusted.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
	        <!--	  <li><a href="/blog/most-popular.html">ordered by popularity</a></li> -->
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/pacific.html">all posts with data about Pacific island countries and territories</a></li>
                  <li><a href="/blog/nz.html">all posts with data about New Zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2026/02/08/social-table-visualisations>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Better predictions for AFL from adjusted Elo ratings</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I improve my AFL predictions by adjusting Elo ratings for home team advantage (varying by home team) and with a more data-driven approach to parameters for the actual ratings.</p>
	   <p class="meta">30 Mar 2019</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <blockquote>
  <p>Warning - this post discusses gambling odds and even describes me placing small $5 bets, which I can easily afford to lose. In no way should this be interpreted as advice to anyone else to do the same, and I accept absolutely no liability for anyone who treats this blog post as a basis for gambling advice. If you find yourself losing money at gambling or suspect you or someone close to you has a gambling problem, please seek help from <a href="https://www.gamblinghelponline.org.au/">https://www.gamblinghelponline.org.au/</a> or other services.</p>
</blockquote>

<h2 id="appreciating-home-team-advantage">Appreciating home team advantage</h2>

<p>Last week <a href="/blog/2019/03/23/afl-elo">I blogged about using Elo ratings to predict the winners in the Australian Football League</a> (AFL) to help me blend in with the locals in my Melbourne workplace footy-tipping competition. Several people pointed out that my approach ignored the home team advantage, which is known to be a significant factor in the AFL. How significant? Well, here’s the proportion of games won by the home team in each season since the AFL’s beginning:</p>

<p><img src="/img/0148-home-history.png" width="100%" /></p>

<p>Overall, 59% of games in the AFL history have been won by the home team, although that proportion varies materially from season to season. Another way of putting this - if my AFL prediction system was as simple as “always pick the home team” I would expect (overall) to score a respectable 59% of successful picks.</p>

<p>My first inclination in response to this was just to add 0.09 to the chance of the home team winning from my model’s base probability, but first I thought I should check whether this adjustment varies by team. Well, it does, somewhat dramatically. This next chart, based on just modern era games (1997 and onwards), defines the home advantage as the proportion of home games won minus the proportion of away games won, divided by 2. The all-teams all-seasons average for this figure would be 0.09.</p>

<p><img src="/img/0148-hometeam-snap.png" width="100%" /></p>

<p>The teams that are conspicuously high on this measure are all non-Melbourne teams:</p>

<ul>
  <li>Geelong</li>
  <li>Adelaide</li>
  <li>West Coast</li>
  <li>Fremantle</li>
  <li>Greater Western Sydney</li>
</ul>

<p>Gold Coast (another non-Melbourne team, for any non-Australians reading) would show up as material if a success <em>ratio</em> measure were used instead of my simple (and crude) additive indicator; because their overall win rate is so low.  Sydney and perhaps Brisbane stand out as good performers overall that don’t have as marked a home town advantage (or away-town disadvantage) as their non-Melbourne peers.</p>

<p>I presume this issue is well known to AFL afficianados. With the majority (or at least plurality - I haven’t counted) of games played in Melbourne, Melbourne-based clubs generally play many of their “away” matches still relatively close to players’ homes. Whereas (for example) the West Coast Eagles flying across the Nullarbor for a match is bound to cost their players, compared to the alternative situation of being at home and making the opponents fly west instead.</p>

<p>Geelong surprised me - Geelong is much closer to Melbourne than the inter-state teams, so no long flights are involved. But simply travelling even an hour up the M1, added to the enthusiastic partisanship of Geelong-Melbourne fan rivalry, perhaps explains the strong advantage.</p>

<p>Here’s the R code that performs these steps:</p>

<ul>
  <li>load in functionality for the analysis</li>
  <li>download the AFL results from 1897 onwards from afltables using the <code class="language-plaintext highlighter-rouge">fitzRoy</code> package and store in the object <code class="language-plaintext highlighter-rouge">r</code> (for “results”)</li>
  <li>draw the chart of home win rates per season</li>
  <li>estimate and plot teams’ recent-decades home advantage</li>
  <li>create a new <code class="language-plaintext highlighter-rouge">r2</code> object with home and away advantage and disadvantage adjustments for probabilities</li>
</ul>

<p><em>Post continues after code extract</em></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#================Setup and get data============</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">fitzRoy</span><span class="p">)</span><span class="w">   </span><span class="c1"># for reading AFL scores</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">frs</span><span class="p">)</span><span class="w">       </span><span class="c1"># for Elo functions</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">Cairo</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">foreach</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">doParallel</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">clipr</span><span class="p">)</span><span class="w">

</span><span class="n">the_caption</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Source: afltables via fitZroy; analysis by freerangestats.info"</span><span class="w">
</span><span class="n">update_geom_defaults</span><span class="p">(</span><span class="s2">"line"</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">))</span><span class="w">

</span><span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_match_results</span><span class="p">()</span><span class="w">

</span><span class="c1"># reshape and organise the data:</span><span class="w">
</span><span class="n">r</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename_all</span><span class="p">(</span><span class="n">tolower</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename_all</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"\\."</span><span class="p">,</span><span class="w"> </span><span class="s2">"_"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)})</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">home_team</span><span class="p">,</span><span class="w"> </span><span class="n">away_team</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">location</span><span class="p">,</span><span class="w"> </span><span class="n">team</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">game</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">margin</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"_team"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">location</span><span class="p">),</span><span class="w">
         </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"home"</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">margin</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">starting_elo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1500</span><span class="p">,</span><span class="w">
         </span><span class="n">new_elo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1500</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">game</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># sequence so the winner is the first listed each time for each game:</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">game</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">(</span><span class="n">winner</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">season</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="w"> </span><span class="n">team</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">round</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w">

</span><span class="c1">#==================analysis of the home team advantage===================</span><span class="w">

</span><span class="c1"># Proportion of home winners over full range of history:</span><span class="w">
</span><span class="n">r</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"home"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">season</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">prop_home</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">winner</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">season</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop_home</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Percentage of games won by the home team"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent_format</span><span class="p">(</span><span class="n">accuracy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">  
  </span><span class="n">labs</span><span class="p">(</span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_caption</span><span class="p">,</span><span class="w">
       </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Home teams win around 59 percent of the time in the AFL"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Home team advantage from 1997 onwards - the modern era:</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">team</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="w">
            </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="w">
            </span><span class="n">home_wins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">winner</span><span class="p">[</span><span class="n">location</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"home"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s2">"1997-01-01"</span><span class="p">]),</span><span class="w">
            </span><span class="n">away_wins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">winner</span><span class="p">[</span><span class="n">location</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"away"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s2">"1997-01-01"</span><span class="p">]),</span><span class="w">
            </span><span class="n">home_adv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">home_wins</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">away_wins</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">home_adv</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s2">"2000-01-01"</span><span class="p">)</span><span class="w">

</span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">away_wins</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">home_wins</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">team</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">home_adv</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_abline</span><span class="p">(</span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">away_wins</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">away_wins</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent_format</span><span class="p">(</span><span class="n">accuracy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent_format</span><span class="p">(</span><span class="n">accuracy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_viridis_c</span><span class="p">(</span><span class="s2">"Home\nadvantage"</span><span class="p">,</span><span class="w">
    </span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"D"</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent_format</span><span class="p">(</span><span class="n">accuracy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
    </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">14</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Wins at home compared to away in the AFL, 1997 to present"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"All teams win more at home than away."</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Proportion of away games won"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Proportion of home games won"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_caption</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"right"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">expand_limits</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">0.85</span><span class="p">),</span><span class="w">
                </span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.15</span><span class="p">,</span><span class="w"> </span><span class="m">0.55</span><span class="p">))</span><span class="w">

</span><span class="n">adjustments</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">home</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">home_adv</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
         </span><span class="n">away</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">home_adv</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="w"> </span><span class="n">home</span><span class="p">,</span><span class="w"> </span><span class="n">away</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">location</span><span class="p">,</span><span class="w"> </span><span class="n">location_adjustment</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">team</span><span class="p">)</span><span class="w">

</span><span class="n">r2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">adjustments</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"team"</span><span class="p">,</span><span class="w"> </span><span class="s2">"location"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">location_adjustment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replace_na</span><span class="p">(</span><span class="n">location_adjustment</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w">
         </span><span class="n">predicted_winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span></code></pre></figure>

<h2 id="choosing-a-better-set-of-parameters">Choosing a better set of parameters</h2>

<p>Seeing as I had to revisit my predictive method to adjust for home and away advantage/disadvantage, I decided to also take a more systematic approach to some parameters that I had set either arbitrarily or without noticing they were parameters in last week’s post. These fit into two areas:</p>

<ul>
  <li>The FIBS-based Elo rating method I use requires a “match length” parameter. Longer matches mean the better player is more likely to win, and also lead to larger adjustments in Elo ratings once the result is known. I had used the winning margin as a proxy/equivalent for match length, reasoning that a team that won by a large amount had shown their superiority in a similar way to a backgammon player winning a longer match. But should a 30 point margin count as match length of 30 (ie equivalent to points) or 5 (equivalent to goals) or something in-between? And what margin or “match length” should I use for predicting future games, where even a margin of 1 is enough to win? And even more philosophically, is margin really related to the backgammon concept of match length in a linear way, or should there be discounting of larger margins? Today, I created three parameters to scale the margin, to choose a margin for predicting future matches, and put the scaled margin to the power of a number from zero to one for non-linearity.</li>
  <li>Elo ratings are by the nature sticky and based on a player/team’s whole career. I had noted that I got better performance in predicting the 2018 season by restarting all teams’ ratings at 1500 at the beginning of the 2017 season. But this is fairly crude. The FIBS Elo rating method has a parameter for teams’ past experience which in effect lets you control how responsive the rating is to new information (the idea being to help new players in a competition quickly move from 1500 up or down to their natural level). I have now added to this with a “new round factor” which shrinks ratings for the first game of the season towards 1500, effectively discounting past experience</li>
</ul>

<p>Here’s the code that describes and defines those parameters a bit better, in an enhanced version of my <code class="language-plaintext highlighter-rouge">afl_elos()</code> function I introduced last week.</p>

<p><em>Post continues after code extract</em></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#---------------Function to determine ratings for one particular set of parameters-----------------</span><span class="w">

</span><span class="cd">#' Calculate Elo ratings for a historical set of AFL results</span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="cd">#' @param r a data frame with columns including date, team, game, starting_elo, new_elo</span><span class="w">
</span><span class="cd">#' @param sc scaling factor for dividing the winning margin by to convert it to "match length" </span><span class="w">
</span><span class="cd">#' for Elo calculation purposes (FIBS method requires a match length)</span><span class="w">
</span><span class="cd">#' @param pred_margin the prediction margin in points to use as match length for prediction purposes.</span><span class="w">
</span><span class="cd">#' Note that this gets divided by sc so it is on the same scale as the historical margins.</span><span class="w">
</span><span class="cd">#' @param margin_power parameter that scaled prediction margin is put to the power of in the match length</span><span class="w">
</span><span class="cd">#' calculation. 0 will mean all match lengths are 1 (so sc and pred_margin make no difference)</span><span class="w">
</span><span class="cd">#' @param experience how much experience (sum of previous match length) teams are presumed to have, for the</span><span class="w">
</span><span class="cd">#' FIBS-style Elo rating. Numbers below 400 make the rating adjustments more responsive to recent results.</span><span class="w">
</span><span class="cd">#' @param new_round_factor how much to shrink Elo ratings towards 1500 in the first match of each season.</span><span class="w">
</span><span class="cd">#' 1 means no shrinkage, 0 means every team starts the season fresh with a rating of 1500 regardless of </span><span class="w">
</span><span class="cd">#' past performance.</span><span class="w">
</span><span class="n">afl_elos</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">pred_margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">margin_power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">new_round_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
  </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">game</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">arrange</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">game</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">(</span><span class="n">winner</span><span class="p">))</span><span class="w">
  
  </span><span class="n">all_games</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">r</span><span class="o">$</span><span class="n">game</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># This seems inherently iterative so perhaps a loop is the logical way to do it:</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">g</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">all_games</span><span class="p">){</span><span class="w">
    
    </span><span class="n">this_game</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="o">$</span><span class="n">game</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">mutate</span><span class="p">(</span><span class="n">starting_elo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">round</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
                                   </span><span class="p">(</span><span class="n">starting_elo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1500</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">new_round_factor</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1500</span><span class="p">,</span><span class="w">
                                   </span><span class="n">starting_elo</span><span class="p">))</span><span class="w">
    
    </span><span class="c1"># er: calculate elo rating arising from this game to use for changes in ratings</span><span class="w">
    </span><span class="n">er</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">elo_rating</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_game</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"starting_elo"</span><span class="p">],</span><span class="w"> 
                     </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_game</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"starting_elo"</span><span class="p">],</span><span class="w">
                     </span><span class="n">winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a"</span><span class="p">,</span><span class="w">
                     </span><span class="n">ml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">this_game</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"margin"</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">margin_power</span><span class="p">),</span><span class="w">
                     </span><span class="n">axp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experience</span><span class="p">,</span><span class="w">
                     </span><span class="n">bxp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experience</span><span class="p">,</span><span class="w">
                     </span><span class="n">a_adv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_game</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"location_adjustment"</span><span class="p">],</span><span class="w">
                     </span><span class="n">b_adv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_game</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"location_adjustment"</span><span class="p">])</span><span class="w">
    
    </span><span class="c1"># er: calculate elo rating arising from this game to use for the prediction, for use in</span><span class="w">
    </span><span class="c1"># measureing prediction success</span><span class="w">
    </span><span class="n">er2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">elo_rating</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_game</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"starting_elo"</span><span class="p">],</span><span class="w"> 
                     </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_game</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"starting_elo"</span><span class="p">],</span><span class="w">
                     </span><span class="n">winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a"</span><span class="p">,</span><span class="w">
                     </span><span class="n">ml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">pred_margin</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">margin_power</span><span class="p">),</span><span class="w">
                     </span><span class="n">axp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experience</span><span class="p">,</span><span class="w">
                     </span><span class="n">bxp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">experience</span><span class="p">,</span><span class="w">
                     </span><span class="n">a_adv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_game</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"location_adjustment"</span><span class="p">],</span><span class="w">
                     </span><span class="n">b_adv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this_game</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"location_adjustment"</span><span class="p">])</span><span class="w">
    
    
    </span><span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="o">$</span><span class="n">game</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="s2">"new_elo"</span><span class="p">]</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">er</span><span class="o">$</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">er</span><span class="o">$</span><span class="n">b</span><span class="p">))</span><span class="w">
    </span><span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="o">$</span><span class="n">game</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="s2">"predicted_winner"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">er2</span><span class="o">$</span><span class="n">winproba</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">er2</span><span class="o">$</span><span class="n">winproba</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
    </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">group_by</span><span class="p">(</span><span class="n">team</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">mutate</span><span class="p">(</span><span class="n">starting_elo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lag</span><span class="p">(</span><span class="n">new_elo</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1500</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">ungroup</span><span class="p">()</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">season</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lubridate</span><span class="o">::</span><span class="n">year</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">game</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">successful_prediction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted_winner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">winner</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w">
  
  </span><span class="nf">return</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>This function is now pretty slow when run on the whole AFL history form 1897. Unlike last week, it calls the underlying <code class="language-plaintext highlighter-rouge">frs::elo_rating()</code> function for each game twice - once (the object <code class="language-plaintext highlighter-rouge">er</code> above) to determine the ratings after the match outcome is known, and once to determine the prediction of the match’s result, for benchmarking purposes (the object <code class="language-plaintext highlighter-rouge">er2</code>). Last week I didn’t need to use <code class="language-plaintext highlighter-rouge">elo_rating()</code> twice, because the prediction of the winner was as simple as choosing the team with the highest Elo rating going in to the match. Now, we have to calculate the actual probability of winning, adjusted for home and away advantage and disadvantage. This calculation depends on the parameter choices that impact on converting margin to “match length” and what winning margin we base our predictions on, so the calculation is an additional one to the change in rating that came about from the actual result of the game.</p>

<p>There are doubtless efficiencies that could be made, but I’m not enthused to spend too much time refactoring at this point…</p>

<p>I have no theories and hardly any hunches on what parameter combinations will give the best performance, so the only way to choose a set is to try many and pick the one that would have worked best in predicting AFL games to date. I defined about 2,500 combinations of parameters, removed some that were effective duplicates (because if <code class="language-plaintext highlighter-rouge">margin_power</code> is 0, then the value of <code class="language-plaintext highlighter-rouge">sc</code> and <code class="language-plaintext highlighter-rouge">pred_margin</code> are immaterial) and for the purposes of this blog ran just 100 random prediction competitions, based on the games from 1950 onwards. With each individual run taking five minutes or more, I used parallel processing to do 7 runs simultaneously and get the total time for those 100 runs down to about 90 minutes, all I was prepared to do today for the purposes of this blog. I might run it for a longer period of time overnight later.</p>

<p>The top twenty parameter sets from this competition are in the table below. The best combination of factors led to an overall prediction success of about 69%, which is better than last week’s 65%, the crude “always pick the home team” success of 59% and a coin flip of 50%; but not as much better as I hoped. Clearly picking these winners is hard - AFL is more like backgammon or poker in terms of predicting outcomes than it is like chess.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">sc</th>
      <th style="text-align: right">pred_margin</th>
      <th style="text-align: right">margin_power</th>
      <th style="text-align: right">experience</th>
      <th style="text-align: right">new_round_factor</th>
      <th style="text-align: right">success_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">30</td>
      <td style="text-align: right">0.8333333</td>
      <td style="text-align: right">100</td>
      <td style="text-align: right">0.4</td>
      <td style="text-align: right">0.6853485</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">0.8333333</td>
      <td style="text-align: right">200</td>
      <td style="text-align: right">0.8</td>
      <td style="text-align: right">0.6839260</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">1.0000000</td>
      <td style="text-align: right">100</td>
      <td style="text-align: right">0.6</td>
      <td style="text-align: right">0.6828829</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">10</td>
      <td style="text-align: right">0.8333333</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0.4</td>
      <td style="text-align: right">0.6822191</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">0.6666667</td>
      <td style="text-align: right">100</td>
      <td style="text-align: right">0.8</td>
      <td style="text-align: right">0.6812707</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">0.8333333</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0.8</td>
      <td style="text-align: right">0.6806069</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">1.0000000</td>
      <td style="text-align: right">400</td>
      <td style="text-align: right">0.8</td>
      <td style="text-align: right">0.6785206</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">10</td>
      <td style="text-align: right">1.0000000</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0.8</td>
      <td style="text-align: right">0.6777620</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">0.5000000</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0.8</td>
      <td style="text-align: right">0.6776671</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">10</td>
      <td style="text-align: right">1.0000000</td>
      <td style="text-align: right">300</td>
      <td style="text-align: right">0.8</td>
      <td style="text-align: right">0.6774775</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">30</td>
      <td style="text-align: right">0.8333333</td>
      <td style="text-align: right">200</td>
      <td style="text-align: right">0.6</td>
      <td style="text-align: right">0.6762447</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">10</td>
      <td style="text-align: right">1.0000000</td>
      <td style="text-align: right">300</td>
      <td style="text-align: right">0.6</td>
      <td style="text-align: right">0.6747274</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">0.8333333</td>
      <td style="text-align: right">400</td>
      <td style="text-align: right">0.6</td>
      <td style="text-align: right">0.6676150</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">10</td>
      <td style="text-align: right">0.6666667</td>
      <td style="text-align: right">100</td>
      <td style="text-align: right">0.8</td>
      <td style="text-align: right">0.6668563</td>
    </tr>
    <tr>
      <td style="text-align: right">6</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">1.0000000</td>
      <td style="text-align: right">100</td>
      <td style="text-align: right">1.0</td>
      <td style="text-align: right">0.6661925</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">30</td>
      <td style="text-align: right">0.5000000</td>
      <td style="text-align: right">100</td>
      <td style="text-align: right">1.0</td>
      <td style="text-align: right">0.6634424</td>
    </tr>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">10</td>
      <td style="text-align: right">0.5000000</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0.4</td>
      <td style="text-align: right">0.6629682</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">0.6666667</td>
      <td style="text-align: right">100</td>
      <td style="text-align: right">1.0</td>
      <td style="text-align: right">0.6617354</td>
    </tr>
    <tr>
      <td style="text-align: right">6</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">0.8333333</td>
      <td style="text-align: right">100</td>
      <td style="text-align: right">0.6</td>
      <td style="text-align: right">0.6592698</td>
    </tr>
    <tr>
      <td style="text-align: right">6</td>
      <td style="text-align: right">30</td>
      <td style="text-align: right">0.6666667</td>
      <td style="text-align: right">200</td>
      <td style="text-align: right">0.8</td>
      <td style="text-align: right">0.6570887</td>
    </tr>
  </tbody>
</table>

<p>The best models had a modest shrinkage of ratings towards 1500 (<code class="language-plaintext highlighter-rouge">new_round_factor</code> of 0.4 to 0.8, compared to 0 which would mean everyone starting at 1500 in each round 1); and modest if any non-linearity in the conversion of winning margin to a notional “match length”. They had relatively low levels of “experience”, effectively increasing the importance of recent results and downplaying long term momentum; while treating match results in points (<code class="language-plaintext highlighter-rouge">sc = 1</code>) and predicting based on a relatively large margin.</p>

<p>I only had time to try a random sample of parameter combinations, and would be very lucky indeed if I have ended up with the best set. How confident can I be that I’ve got something close enough? Here’s the distribution of success rates for that post 1950 series:</p>

<p><img src="/img/0148-density-success.svg" width="100%" /></p>

<p>Without over-thinking it, it’s reasonable to infer a few more extreme values on the right are possible if we looked at the full set of parameters; but that they wouldn’t be <em>that much</em> more successful. It’s certainly good enough for a workplace footy tipping competition.</p>

<p>Here’s the predictive success of the best model over time, now applied to the full range of data not just the post 1950 period for which it was optimised:</p>

<p><img src="/img/0148-best-preds.svg" width="100%" /></p>

<p>… and the code that did the above “parameter competition”, using the <code class="language-plaintext highlighter-rouge">foreach</code> and <code class="language-plaintext highlighter-rouge">doParallel</code> R packages for parallel processing to bring the elapsed time down to reasonable levels:</p>

<p><em>Post continues after code extract</em></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#---------------Define all possible combinations of parameters---------------------</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">expand.grid</span><span class="p">(</span><span class="w">
  </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w">
  </span><span class="n">pred_margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">),</span><span class="w">
  </span><span class="n">margin_power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">6</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w">
  </span><span class="n">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w">
  </span><span class="n">new_round_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">5</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># if margin_power is 0 then sc and pred_margin make no difference, so we can drop a few</span><span class="w">
  </span><span class="c1"># paramter combinations:</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">margin_power</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">sc</span><span class="p">),</span><span class="w">
         </span><span class="n">pred_margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">margin_power</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">margin_power</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">distinct</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># sort in random order, as we're not going to have time to run all combinations</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">rnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">n</span><span class="p">()))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">rnd</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">row_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">rnd</span><span class="p">)</span><span class="w">


</span><span class="c1">#-------------------------Run the model with a subset of the combinations of parameters------------------</span><span class="w">
</span><span class="n">cluster</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">makeCluster</span><span class="p">(</span><span class="m">7</span><span class="p">)</span><span class="w"> </span><span class="c1"># only any good if you have at least 7 processors :)</span><span class="w">
</span><span class="n">registerDoParallel</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span><span class="w">

</span><span class="n">clusterEvalQ</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">library</span><span class="p">(</span><span class="n">foreach</span><span class="p">)</span><span class="w">
  </span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
  </span><span class="n">library</span><span class="p">(</span><span class="n">frs</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">

</span><span class="n">clusterExport</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"r2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"afl_elos"</span><span class="p">,</span><span class="w"> </span><span class="s2">"params"</span><span class="p">))</span><span class="w">

</span><span class="c1"># 519 seconds for 10 sets of parameters. So can do about 1.1 per minute (with 7 processors); 180 will take 3 hours.</span><span class="w">
</span><span class="n">system.time</span><span class="p">({</span><span class="w">
  </span><span class="n">suppressWarnings</span><span class="p">(</span><span class="n">rm</span><span class="p">(</span><span class="n">res</span><span class="p">))</span><span class="w">
  </span><span class="n">res60</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">foreach</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">.combine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbind</span><span class="p">)</span><span class="w"> </span><span class="o">%dopar%</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
    
    </span><span class="n">success_rate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
            </span><span class="n">filter</span><span class="p">(</span><span class="n">season</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">1950</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
			</span><span class="n">afl_elos</span><span class="p">(</span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">sc</span><span class="p">,</span><span class="w">
               </span><span class="n">pred_margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">pred_margin</span><span class="p">,</span><span class="w">
               </span><span class="n">margin_power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">margin_power</span><span class="p">,</span><span class="w">
               </span><span class="n">experience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">experience</span><span class="p">,</span><span class="w">
               </span><span class="n">new_round_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">new_round_factor</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">filter</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"home"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">summarise</span><span class="p">(</span><span class="n">sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">successful_prediction</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">pull</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w">
    
    </span><span class="nf">return</span><span class="p">(</span><span class="n">data.frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">row_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">success_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">success_rate</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">})</span><span class="w">

</span><span class="n">stopCluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span><span class="w">

</span><span class="c1">#------------------Examine results------------------------------</span><span class="w">

</span><span class="n">params_with_res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"row_num"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">success_rate</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">success_rate</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">row_num</span><span class="p">)</span><span class="w"> 

</span><span class="n">params_with_res</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">kable</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">write_clip</span><span class="p">()</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">params_with_res</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">success_rate</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_density</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_rug</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Distribution of success rates in parameter contest"</span><span class="p">)</span><span class="w">

</span><span class="n">best_params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">params_with_res</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="n">elos_best</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">afl_elos</span><span class="p">(</span><span class="n">sc</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="n">best_params</span><span class="o">$</span><span class="n">sc</span><span class="p">,</span><span class="w">
           </span><span class="n">pred_margin</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">best_params</span><span class="o">$</span><span class="n">pred_margin</span><span class="p">,</span><span class="w">
           </span><span class="n">margin_power</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">best_params</span><span class="o">$</span><span class="n">margin_power</span><span class="p">,</span><span class="w">
           </span><span class="n">experience</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">best_params</span><span class="o">$</span><span class="n">experience</span><span class="p">,</span><span class="w">
           </span><span class="n">new_round_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">best_params</span><span class="o">$</span><span class="n">new_round_factor</span><span class="p">)</span><span class="w">

</span><span class="n">elos_best</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"away"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s2">"2019-01-01"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">season</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">successful_prediction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">successful_prediction</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">season</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">successful_prediction</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Percentage of successful predictions"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent_format</span><span class="p">(</span><span class="n">accuracy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Predictions of past AFL games"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"Using the best combination found of parameters for Elo ratings and shrinkage during the off-season.
Prediction success of 70% is difficult to achieve in the modern era."</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_caption</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span></code></pre></figure>

<h2 id="this-weeks-predictions-are">This weeks’ predictions are…</h2>

<p>To turn this model into my tips for this week, I need to extract the final Elo ratings from the best model, join them with the actual fixture and then use the model to predict actual probabilities of winning.  Here’s what I get:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">home</th>
      <th style="text-align: left">away</th>
      <th style="text-align: right">home_elo</th>
      <th style="text-align: right">away_elo</th>
      <th style="text-align: right">home_adjustment</th>
      <th style="text-align: right">away_adjustment</th>
      <th style="text-align: right">final_prob</th>
      <th style="text-align: left">winner</th>
      <th style="text-align: right">fair_returns_home</th>
      <th style="text-align: right">fair_returns_away</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Richmond</td>
      <td style="text-align: left">Collingwood</td>
      <td style="text-align: right">1623.362</td>
      <td style="text-align: right">1552.782</td>
      <td style="text-align: right">0.0392339</td>
      <td style="text-align: right">-0.0305072</td>
      <td style="text-align: right">0.6527701</td>
      <td style="text-align: left">Richmond</td>
      <td style="text-align: right">1.531933</td>
      <td style="text-align: right">2.879936</td>
    </tr>
    <tr>
      <td style="text-align: left">Sydney</td>
      <td style="text-align: left">Adelaide</td>
      <td style="text-align: right">1506.489</td>
      <td style="text-align: right">1476.328</td>
      <td style="text-align: right">0.0467485</td>
      <td style="text-align: right">-0.0632875</td>
      <td style="text-align: right">0.6457876</td>
      <td style="text-align: left">Sydney</td>
      <td style="text-align: right">1.548497</td>
      <td style="text-align: right">2.823164</td>
    </tr>
    <tr>
      <td style="text-align: left">Essendon</td>
      <td style="text-align: left">St Kilda</td>
      <td style="text-align: right">1507.538</td>
      <td style="text-align: right">1404.657</td>
      <td style="text-align: right">0.0505882</td>
      <td style="text-align: right">-0.0428714</td>
      <td style="text-align: right">0.7132448</td>
      <td style="text-align: left">Essendon</td>
      <td style="text-align: right">1.402043</td>
      <td style="text-align: right">3.487295</td>
    </tr>
    <tr>
      <td style="text-align: left">Port Adelaide</td>
      <td style="text-align: left">Carlton</td>
      <td style="text-align: right">1544.746</td>
      <td style="text-align: right">1340.797</td>
      <td style="text-align: right">0.0571146</td>
      <td style="text-align: right">-0.0257644</td>
      <td style="text-align: right">0.8077331</td>
      <td style="text-align: left">Port Adelaide</td>
      <td style="text-align: right">1.238033</td>
      <td style="text-align: right">5.201104</td>
    </tr>
    <tr>
      <td style="text-align: left">Geelong</td>
      <td style="text-align: left">Melbourne</td>
      <td style="text-align: right">1552.818</td>
      <td style="text-align: right">1521.317</td>
      <td style="text-align: right">0.0747884</td>
      <td style="text-align: right">-0.0402286</td>
      <td style="text-align: right">0.6523510</td>
      <td style="text-align: left">Geelong</td>
      <td style="text-align: right">1.532917</td>
      <td style="text-align: right">2.876464</td>
    </tr>
    <tr>
      <td style="text-align: left">West Coast</td>
      <td style="text-align: left">GWS</td>
      <td style="text-align: right">1543.355</td>
      <td style="text-align: right">1565.494</td>
      <td style="text-align: right">0.0699069</td>
      <td style="text-align: right">-0.0648148</td>
      <td style="text-align: right">0.6084577</td>
      <td style="text-align: left">West Coast</td>
      <td style="text-align: right">1.643499</td>
      <td style="text-align: right">2.554003</td>
    </tr>
    <tr>
      <td style="text-align: left">North Melbourne</td>
      <td style="text-align: left">Brisbane Lions</td>
      <td style="text-align: right">1461.086</td>
      <td style="text-align: right">1483.270</td>
      <td style="text-align: right">0.0406327</td>
      <td style="text-align: right">-0.0558655</td>
      <td style="text-align: right">0.5701814</td>
      <td style="text-align: left">North Melbourne</td>
      <td style="text-align: right">1.753828</td>
      <td style="text-align: right">2.326563</td>
    </tr>
    <tr>
      <td style="text-align: left">Hawthorn</td>
      <td style="text-align: left">Footscray</td>
      <td style="text-align: right">1567.933</td>
      <td style="text-align: right">1482.579</td>
      <td style="text-align: right">0.0490421</td>
      <td style="text-align: right">-0.0383632</td>
      <td style="text-align: right">0.6873887</td>
      <td style="text-align: left">Hawthorn</td>
      <td style="text-align: right">1.454781</td>
      <td style="text-align: right">3.198861</td>
    </tr>
    <tr>
      <td style="text-align: left">Gold Coast</td>
      <td style="text-align: left">Fremantle</td>
      <td style="text-align: right">1382.276</td>
      <td style="text-align: right">1483.175</td>
      <td style="text-align: right">0.0402515</td>
      <td style="text-align: right">-0.0729052</td>
      <td style="text-align: right">0.4955912</td>
      <td style="text-align: left">Fremantle</td>
      <td style="text-align: right">2.017792</td>
      <td style="text-align: right">1.982519</td>
    </tr>
  </tbody>
</table>

<p>That <code class="language-plaintext highlighter-rouge">final_prob</code> column is the estimated probability of the home team winning.</p>

<p>As you can see, I translate my probabilities into a “fair return”, which I’m using to scan for opportunities with poorly chosen odds from the bookies. These opportunities don’t arrive very often as the bookies are professionals, but when they are paying 50% more than the model predicts to be “fair” I’m going to punt $5 and we’ll see how we go at the end of the season. So far I’m $26 up from this strategy but it’s early days and I’m far from assured the luck will continue.</p>

<p>Judging from the tips and odds by the public, the only controversial picks in the above are for North Melbourne to beat Brisbane and Gold Coast to be nearly a coin flip in contest with Fremantle. In both cases my algorithm is tipping a home advantage to equalise the comparative relative strength of the away team. For the North Melbourne match, the bookies agree with me, whereas the tippers on tipping.afl.com.au are going for a Brisbane win, so I think we can say that reasonable people disagree about the outcome there and it is uncertain. For the other match, I have grave doubts about Gold Coast’s chances against Fremantle (who had a stellar victory last weekend), but am inclined to think the $3.50 return bookies are offering to pay for a Gold Coast win is over-generous and underestimating how much Fremantle struggle when playing away from home. So that’s my recommended match to watch for a potential surprise outcome.</p>

<p>At the time of writing, the first two of these predictions in my table above have already gone astray (for me, the average punters and the average tippers) in the Thursday and Friday night matchs, as 2019 continues its run of surprise results. Collingwood and Adelaide both pulled off against-the-odds wins against teams that were both stronger on paper and playing at home. I won’t say my predictions were “wrong”, because when you say something has a 0.6 chance of happening and it doesn’t, there’s a good chance you were just unlucky, not wrong.</p>

<p>But as they say, prediction is hard, particularly about the future.</p>

<p>Final chunk of R code for today - converting the model into predictions for this round:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#==================Predictions for this round!=====================</span><span class="w">
</span><span class="n">elos_latest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">elos_best</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">team</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">new_elo</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="w"> </span><span class="n">elo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_elo</span><span class="p">)</span><span class="w">

</span><span class="n">fixture</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="w">
  </span><span class="n">home</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Richmond"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Sydney"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Essendon"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Port Adelaide"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Geelong"</span><span class="p">,</span><span class="w"> </span><span class="s2">"West Coast"</span><span class="p">,</span><span class="w">
           </span><span class="s2">"North Melbourne"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hawthorn"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Gold Coast"</span><span class="p">),</span><span class="w">
  </span><span class="n">away</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Collingwood"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Adelaide"</span><span class="p">,</span><span class="w"> </span><span class="s2">"St Kilda"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Carlton"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Melbourne"</span><span class="p">,</span><span class="w"> </span><span class="s2">"GWS"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Brisbane Lions"</span><span class="p">,</span><span class="w"> 
           </span><span class="s2">"Footscray"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Fremantle"</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">fixture</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">elos_latest</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"home"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"team"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">home_elo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elo</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">elos_latest</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"away"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"team"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">away_elo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elo</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">adjustments</span><span class="p">,</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"home"</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"home"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"team"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">home_adjustment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location_adjustment</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">location</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">adjustments</span><span class="p">,</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"away"</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"away"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"team"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">away_adjustment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location_adjustment</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">location</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">final_prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elo_prob</span><span class="p">(</span><span class="n">home_elo</span><span class="p">,</span><span class="w"> </span><span class="n">away_elo</span><span class="p">,</span><span class="w"> 
                               </span><span class="n">ml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">best_params</span><span class="o">$</span><span class="n">pred_margin</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">best_params</span><span class="o">$</span><span class="n">sc</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">best_params</span><span class="o">$</span><span class="n">margin_power</span><span class="p">,</span><span class="w"> 
                               </span><span class="n">a_adv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">home_adjustment</span><span class="p">,</span><span class="w"> 
                               </span><span class="n">b_adv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">away_adjustment</span><span class="p">),</span><span class="w">
         </span><span class="n">winner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">final_prob</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">home</span><span class="p">,</span><span class="w"> </span><span class="n">away</span><span class="p">),</span><span class="w">
         </span><span class="n">fair_returns_home</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">final_prob</span><span class="p">,</span><span class="w">
         </span><span class="n">fair_returns_away</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="w"> </span><span class="n">final_prob</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">kable</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">write_clip</span><span class="p">()</span></code></pre></figure>

<p>That’s all.</p>

<p>Here’s the R packages used in producing this post:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">thankr</span><span class="o">::</span><span class="n">shoulders</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">maintainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_squish</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"&lt;.+&gt;"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">maintainer</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">maintainer</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">`Number packages`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">no_packages</span><span class="p">),</span><span class="w">
            </span><span class="n">packages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">", "</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">clipr</span><span class="o">::</span><span class="n">write_clip</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">maintainer</th>
      <th style="text-align: right">Number packages</th>
      <th style="text-align: left">packages</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Hadley Wickham</td>
      <td style="text-align: right">15</td>
      <td style="text-align: left">assertthat, dplyr, forcats, ggplot2, gtable, haven, httr, lazyeval, modelr, plyr, rvest, scales, stringr, tidyr, tidyverse</td>
    </tr>
    <tr>
      <td style="text-align: left">R Core Team</td>
      <td style="text-align: right">12</td>
      <td style="text-align: left">base, compiler, datasets, graphics, grDevices, grid, methods, parallel, stats, tools, utils, nlme</td>
    </tr>
    <tr>
      <td style="text-align: left">Yihui Xie</td>
      <td style="text-align: right">5</td>
      <td style="text-align: left">evaluate, highr, knitr, rmarkdown, xfun</td>
    </tr>
    <tr>
      <td style="text-align: left">Kirill Müller</td>
      <td style="text-align: right">4</td>
      <td style="text-align: left">DBI, hms, pillar, tibble</td>
    </tr>
    <tr>
      <td style="text-align: left">Winston Chang</td>
      <td style="text-align: right">4</td>
      <td style="text-align: left">extrafont, extrafontdb, R6, Rttf2pt1</td>
    </tr>
    <tr>
      <td style="text-align: left">Gábor Csárdi</td>
      <td style="text-align: right">3</td>
      <td style="text-align: left">cli, crayon, pkgconfig</td>
    </tr>
    <tr>
      <td style="text-align: left">Jim Hester</td>
      <td style="text-align: right">3</td>
      <td style="text-align: left">glue, withr, readr</td>
    </tr>
    <tr>
      <td style="text-align: left">Lionel Henry</td>
      <td style="text-align: right">3</td>
      <td style="text-align: left">purrr, rlang, tidyselect</td>
    </tr>
    <tr>
      <td style="text-align: left">Rich Calaway</td>
      <td style="text-align: right">3</td>
      <td style="text-align: left">doParallel, foreach, iterators</td>
    </tr>
    <tr>
      <td style="text-align: left">Yixuan Qiu</td>
      <td style="text-align: right">3</td>
      <td style="text-align: left">showtext, showtextdb, sysfonts</td>
    </tr>
    <tr>
      <td style="text-align: left">Dirk Eddelbuettel</td>
      <td style="text-align: right">2</td>
      <td style="text-align: left">digest, Rcpp</td>
    </tr>
    <tr>
      <td style="text-align: left">Jennifer Bryan</td>
      <td style="text-align: right">2</td>
      <td style="text-align: left">cellranger, readxl</td>
    </tr>
    <tr>
      <td style="text-align: left">Jeroen Ooms</td>
      <td style="text-align: right">2</td>
      <td style="text-align: left">curl, jsonlite</td>
    </tr>
    <tr>
      <td style="text-align: left">Simon Urbanek</td>
      <td style="text-align: right">2</td>
      <td style="text-align: left">audio, Cairo</td>
    </tr>
    <tr>
      <td style="text-align: left">Achim Zeileis</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">colorspace</td>
    </tr>
    <tr>
      <td style="text-align: left">Alex Hayes</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">broom</td>
    </tr>
    <tr>
      <td style="text-align: left">Brodie Gaslam</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">fansi</td>
    </tr>
    <tr>
      <td style="text-align: left">Charlotte Wickham</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">munsell</td>
    </tr>
    <tr>
      <td style="text-align: left">Deepayan Sarkar</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">lattice</td>
    </tr>
    <tr>
      <td style="text-align: left">James Day</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">fitzRoy</td>
    </tr>
    <tr>
      <td style="text-align: left">James Hester</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">xml2</td>
    </tr>
    <tr>
      <td style="text-align: left">Jeremy Stephens</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">yaml</td>
    </tr>
    <tr>
      <td style="text-align: left">Joe Cheng</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">htmltools</td>
    </tr>
    <tr>
      <td style="text-align: left">Justin Talbot</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">labeling</td>
    </tr>
    <tr>
      <td style="text-align: left">Kamil Slowikowski</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">ggrepel</td>
    </tr>
    <tr>
      <td style="text-align: left">Kevin Ushey</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">rstudioapi</td>
    </tr>
    <tr>
      <td style="text-align: left">Luke Tierney</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">codetools</td>
    </tr>
    <tr>
      <td style="text-align: left">Marek Gagolewski</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">stringi</td>
    </tr>
    <tr>
      <td style="text-align: left">Matthew Lincoln</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">clipr</td>
    </tr>
    <tr>
      <td style="text-align: left">Max Kuhn</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">generics</td>
    </tr>
    <tr>
      <td style="text-align: left">Michel Lang</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">backports</td>
    </tr>
    <tr>
      <td style="text-align: left">Patrick O. Perry</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">utf8</td>
    </tr>
    <tr>
      <td style="text-align: left">Peter Ellis</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">frs</td>
    </tr>
    <tr>
      <td style="text-align: left">Rasmus Bååth</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">beepr</td>
    </tr>
    <tr>
      <td style="text-align: left">Simon Garnier</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">viridisLite</td>
    </tr>
    <tr>
      <td style="text-align: left">Stefan Milton Bache</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">magrittr</td>
    </tr>
    <tr>
      <td style="text-align: left">Vitalie Spinu</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">lubridate</td>
    </tr>
  </tbody>
</table>


		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2019/03/23/afl-elo">AFL teams Elo ratings and footy-tipping</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2019/03/31/fed-election-page">Website with Australian federal election forecasts</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>

			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<p>Find me on <a rel="me" href="https://bsky.app/profile/freerangestats.info">Bluesky</a> or <a rel="me" href="https://mastodon.social/@peter_ellis">Mastodon</a>.</p>
			<hr></hr>
			


       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			
			<p>I've never been an academic but have written a few small things and hence have a <a href='https://scholar.google.com/citations?view_op=list_works&hl=en&user=MEtLNDMAAAAJ'>Google Scholar profile</a></p>
			
			<p>I read a lot of books. In the unlikely event you want to see what I think about them or what I'm reading at the moment, <a href='https://www.goodreads.com/user/show/55517482-peter-ellis'>follow me on Goodreads</a>.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			
			<h4>Bluesky feed:</h3>
         <script src="https://cdn.jsdelivr.net/npm/bsky-embed/dist/bsky-embed.es.js" async></script>
<bsky-embed  
  username="freerangestats.info"  
  limit="5"  
>  
</bsky-embed>

    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>