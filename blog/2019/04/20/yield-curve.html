      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Animating the US Treasury yield curve rates</title>
      	
         
         
            <meta name ="description" content ="I ponder the limitations of animation, and how much work is needed to turn a fun animation into a great story.">
            <meta property="og:description" content ="I ponder the limitations of animation, and how much work is needed to turn a fun animation into a great story.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Animating the US Treasury yield curve rates" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0151-all-years-one-frame.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2019/04/20/yield-curve.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2024/07/27/aging-pacific>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Animating the US Treasury yield curve rates</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I ponder the limitations of animation, and how much work is needed to turn a fun animation into a great story.</p>
	   <p class="meta">20 Apr 2019</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <p>My eye was caught by <a href="https://twitter.com/RobinWigg/status/1113761015106363392">this tweet by Robin Wigglesworth</a> of the Financial Times with an Alan Smith animation of the US Treasury yield curve from 2005 to 2009. It’s a nice graphic and it made me wonder what it would look like over a longer period.</p>

<p>The “yield curve” is the name given to the graphic showing the different annual rates paid on investors who in effect lend money to the US Treasury. In normal circumstances, investors who are prepared to make the loan on a long term basis demand higher effective interest rates as compensation for risk associated with inflation and future interest rates. When the situation goes in the other direction, and higher effective returns come from shorter term investments, it’s commonly seen as a sign of a coming recession. This isn’t because the “inverted yield curve” causes the recession, but because (amongst other things) it reflects investors’ fears that interest rates are about to be cut (in response to lower economic growth), hence best to lock in the return you can get now.</p>

<h2 id="animation-options">Animation options</h2>

<p>Anyway, here is my version of the animation, now with 29 years of daily data, streaming from You Tube (because it was too large to embed directly in my web page):</p>

<iframe width="600" height="450 " src="http://www.youtube.com/embed/fJ6BqrihUBA?autoplay=1" frameborder="0">
</iframe>

<p>Alternatively, here’s a streamlined social-media-friendly version (as a GIF) that has monthly averages and scoots through a bit quicker.</p>

<p><img src="/img/0151-yield-anim-monthly.gif" width="100%" /></p>

<p>I’m not sure these are great graphics. For one thing, with three frames for every day with data reported, the daily version is over 20,000 frames long and even at 25 frames per second that’s a pretty tedious thing to watch - 14.5 minutes in fact. More generally, it suffers from the common problems of animated statistical graphics:</p>

<ul>
  <li>you have to be looking at just the right time to see the interesting things - like the yield inversion and other volatility in that 2006 to 2008 period</li>
  <li>some changes over time are actually less obvious to the viewer than if they could be presented on a single page.</li>
</ul>

<p>In the <a href="https://www.ft.com/content/cf9eb29a-5220-11e9-9c76-bf4a0ce37d49">original FT article</a>, there’s a more focused animation by Smith, this one showing just the last 15 months, emphasising the yield inverstion at the end of that period. It’s quite effective in telling a very pointed story, rather than trying to show a long history in a single animation.</p>

<h2 id="static-alternatives">Static alternatives</h2>

<p>Animations aren’t always the best. In fact, it’s surely significant that I loathe video tutorials because I can’t flick my eye directly to the part I want but have to sit through the whole thing - even at high speed this is frustrating. Animations can have a similar problem.</p>

<p>For showing the longer history at a glance, consider this alternative presentation, still related to the animation’s visual structure. This has all 8,000 or so yield curves from those 29 years on a single static chart, each one drawn with 10% opacity to avoid colouring the page solid.</p>

<p><img src="/img/0151-all-years-one-frame.svg" width="100%" /></p>

<p>What I like about this version is that because it’s all there at once, you can make the comparisons across a broader period of time than is possible with the animation. You can see:</p>

<ul>
  <li>The secular decrease in rates over this time period</li>
  <li>The period around 2005 when there were no 30 year rates for some reason</li>
  <li>The different yield inversions in context - showing as upwards swooshes in blue, green and yellow (for different periods) at the left of the graph</li>
</ul>

<p>Plus it’s very pretty.</p>

<p>Finally, how about a much more traditional time series line chart. I actually find this the easiest to interpret of them all.</p>

<p><img src="/img/0151-trad-line.svg" width="100%" /></p>

<ul>
  <li>The secular decrease is obvious again.</li>
  <li>The carefully chosen colours let you compare the different terms quite easily.</li>
  <li>This is the most dramatic depictiton of the way the shorter term yields hit the floor after 2008.</li>
  <li>Easiest chart of them all to interpret because of the familiar convention of the horizontal axis meaning time</li>
  <li>Still very pretty.</li>
</ul>

<h2 id="reflections">Reflections</h2>

<p>So what do I think?</p>

<blockquote>
  <p>Sometimes static graphs are beter than animations. Sometimes an old fashioned time series plot is better than less standard innovations. To make an animation tell a good story you often need more polishing, annotation and framing, not less.</p>
</blockquote>

<p>More information on yield curves is easy to find on the Internet, and the <a href="https://www.ft.com/content/cf9eb29a-5220-11e9-9c76-bf4a0ce37d49">piece in the Financial Times that Wigglesworth was referring to</a> is worth a read. Here’s one of their very professional graphics:</p>

<p><a href="https://www.ft.com/content/cf9eb29a-5220-11e9-9c76-bf4a0ce37d49"><img src="/img/0151-ft-timeseries.png" width="100%" /></a></p>

<p>One of the things that makes a difference to this, and to the animations in the same story, is the careful use of annotations to tell a story. That’s definitely what it takes to get a graphic to the next level, but it’s not something I’ve got time for right now.</p>

<p>Here’s the code for this (apart from that last one from the FT) - all pretty straightforward. Grabbing the data is easy with Wickham’s <code class="language-plaintext highlighter-rouge">rvest</code> R package, and animations are so much easier than a few years ago thanks to Thomas Pedersen’s <code class="language-plaintext highlighter-rouge">gganimate</code>. And let’s not forget the Viridis colours, originally developed for Python by Nathaniel Smith and Stefan van der Walt, and ported into an R package by Simon Garnier. In these graphics I use three variants of the Viridis colour schemes to represent different variables - the difference between long and short term yields at any one point in time, year, and the term of the yield. In each case, the variable I am trying to show is fundamentally ordered, and Viridis is at its best in showing that ordered nature in its colour.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#------------------------------load up functionality and import data-------------</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gganimate</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">svglite</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">frs</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">

</span><span class="n">the_caption</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Data from https://www.treasury.gov/, analysis by freerangestats.info"</span><span class="w">

</span><span class="c1"># we read in the data a year at a time because although there is a page with all 29 years of data,</span><span class="w">
</span><span class="c1"># it was too difficult to read in all at once ie it crashed my humble laptop. So we define a function</span><span class="w">
</span><span class="c1"># to get one year's data:</span><span class="w">
</span><span class="n">read_a_year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">y</span><span class="p">){</span><span class="w">
  </span><span class="n">url_stub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://www.treasury.gov/resource-center/data-chart-center/interest-rates/pages/TextView.aspx?data=yieldYear&amp;year=XXXX"</span><span class="w">
  </span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"XXXX"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">url_stub</span><span class="p">)</span><span class="w">
  
  </span><span class="n">yield_page</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">
  </span><span class="n">yield_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as_tibble</span><span class="p">(</span><span class="n">html_table</span><span class="p">(</span><span class="n">yield_page</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)[[</span><span class="m">2</span><span class="p">]]</span><span class="w"> </span><span class="p">)</span><span class="w">
  
  </span><span class="nf">return</span><span class="p">(</span><span class="n">yield_data</span><span class="p">)</span><span class="w">
  
</span><span class="p">}</span><span class="w">

</span><span class="c1"># bring in the data one year at a time.</span><span class="w">
</span><span class="n">yields_l</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="m">1990</span><span class="o">:</span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="n">read_a_year</span><span class="p">)</span><span class="w">

</span><span class="c1"># clean and reshape the data with some handy variables for charting</span><span class="w">
</span><span class="n">periods</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="w">
  </span><span class="n">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">20</span><span class="p">,</span><span class="m">30</span><span class="p">),</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"mo"</span><span class="p">,</span><span class="w"> </span><span class="s2">"yr"</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">8</span><span class="p">))),</span><span class="w">
  </span><span class="n">period_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="m">180</span><span class="p">,</span><span class="w"> </span><span class="m">365.25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">20</span><span class="p">,</span><span class="m">30</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">yields</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="s2">"rbind"</span><span class="p">,</span><span class="w"> </span><span class="n">yields_l</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"%m/%d/%y"</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">Date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">suppressWarnings</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"period"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">ratio_5_30</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="n">period</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"30 yr"</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="n">period</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"5 yr"</span><span class="p">],</span><span class="w">
         </span><span class="n">yield_av</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">),</span><span class="w">
         </span><span class="n">yield_30yr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="n">period</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"30 yr"</span><span class="p">],</span><span class="w">
         </span><span class="n">yield_3mo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="n">period</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"3 mo"</span><span class="p">],</span><span class="w">
         </span><span class="n">diff303</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yield_30yr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yield_3mo</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> 


</span><span class="c1">#----------------All dates in one chart---------------------  </span><span class="w">
</span><span class="n">col_br</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="w">
  </span><span class="n">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1990</span><span class="p">,</span><span class="w"> </span><span class="m">2000</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">),</span><span class="w">
  </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1990</span><span class="p">,</span><span class="w"> </span><span class="m">2000</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">),</span><span class="w"> </span><span class="s2">"-03-01"</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">date_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="w">

</span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">yields</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
</span><span class="c1">#  filter(Date &lt; as.Date("1990-01-31")) %&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">period_n</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">Date</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_path</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_viridis_c</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w">
                         </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pull</span><span class="p">(</span><span class="n">col_br</span><span class="p">,</span><span class="w"> </span><span class="n">date_n</span><span class="p">),</span><span class="w">
                         </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pull</span><span class="p">(</span><span class="n">col_br</span><span class="p">,</span><span class="w"> </span><span class="n">lab</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Treasury yield curve rate"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">periods</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="o">:</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="o">$</span><span class="n">period_n</span><span class="p">,</span><span class="w">
                     </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">periods</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="o">:</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="o">$</span><span class="n">period</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_caption</span><span class="p">)</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span><span class="w">


</span><span class="c1">#--------------animated MP4 version----------</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">yields</span><span class="w">  </span><span class="c1">#%&gt;% </span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"1991-02-28"</span><span class="p">))</span><span class="w">

</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">period_n</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">distinct</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">yield_3mo</span><span class="p">,</span><span class="w"> </span><span class="n">yield_30yr</span><span class="p">),</span><span class="w">
               </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10958</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yield_3mo</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yield_30yr</span><span class="p">),</span><span class="w">
               </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey50"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff303</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Treasury yield curve rate"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">periods</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="o">:</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="o">$</span><span class="n">period_n</span><span class="p">,</span><span class="w">
                     </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">periods</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="o">:</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="o">$</span><span class="n">period</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_viridis_c</span><span class="p">(</span><span class="s2">"Premium for long term lending:\n30 year yield minus 3 month yield"</span><span class="p">,</span><span class="w"> 
                         </span><span class="n">option</span><span class="o">=</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"US Treasury Yield Curve Rates, 1990 to 2019"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Date: {frame_time}'</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_caption</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">transition_time</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span><span class="w"> 



</span><span class="c1"># Save the frames in the file system and then manually knit into an animation, because</span><span class="w">
</span><span class="c1"># there are so many and so large that I like to keep control of the two steps:</span><span class="w">
</span><span class="n">dir.create</span><span class="p">(</span><span class="s2">"tmp"</span><span class="p">)</span><span class="w">
</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">150</span><span class="w">
</span><span class="n">animate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">nframes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">d</span><span class="o">$</span><span class="n">Date</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"png"</span><span class="p">,</span><span class="w"> </span><span class="n">fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w">
        </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cairo-png"</span><span class="p">,</span><span class="w"> </span><span class="n">antialias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"subpixel"</span><span class="p">,</span><span class="w"> 
        </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="m">4.3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w">
        </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file_renderer</span><span class="p">(</span><span class="n">dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp"</span><span class="p">,</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">

</span><span class="n">od</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">setwd</span><span class="p">(</span><span class="s2">"tmp"</span><span class="p">)</span><span class="w">
</span><span class="n">system</span><span class="p">(</span><span class="s2">"ffmpeg -i gganim_plot%04d.png  -pix_fmt yuv420p -s 900x646 -c:v libx264 -r 30 movie.mp4"</span><span class="p">)</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="n">od</span><span class="p">)</span><span class="w">


</span><span class="c1">#----------------traditional time series version-----------</span><span class="w">
</span><span class="n">p3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">yields</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="w"> </span><span class="n">period_n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">period</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_viridis_d</span><span class="p">(</span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Term"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Treasury yield curve rate"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_caption</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"US Treasury Yield Curve Rates, 1990 to 2019"</span><span class="p">)</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span><span class="w">


</span><span class="c1">#-----------------Gif version for Twitter------------</span><span class="w">
</span><span class="c1"># shorter version with just one main observation per month</span><span class="w">
</span><span class="n">d2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">yields</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">mon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">month</span><span class="p">(</span><span class="n">Date</span><span class="p">),</span><span class="w">
         </span><span class="n">yr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">Date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">mon</span><span class="p">,</span><span class="w"> </span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">period_n</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w">
            </span><span class="n">yield_3mo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">yield_3mo</span><span class="p">),</span><span class="w">
            </span><span class="n">yield_30yr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">yield_30yr</span><span class="p">),</span><span class="w">
            </span><span class="n">diff303</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">diff303</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">mon</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"-"</span><span class="p">),</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"%Y-%m-%d"</span><span class="p">))</span><span class="w">
  

</span><span class="n">a2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">period_n</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_segment</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">distinct</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">yield_3mo</span><span class="p">,</span><span class="w"> </span><span class="n">yield_30yr</span><span class="p">),</span><span class="w">
               </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">xend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10958</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yield_3mo</span><span class="p">,</span><span class="w"> </span><span class="n">yend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yield_30yr</span><span class="p">),</span><span class="w">
               </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey50"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff303</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Treasury yield curve rate"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">periods</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="o">:</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="o">$</span><span class="n">period_n</span><span class="p">,</span><span class="w">
                     </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">periods</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="o">:</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="o">$</span><span class="n">period</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_viridis_c</span><span class="p">(</span><span class="s2">"Premium for long term lending:\n30 year yield minus 3 month yield"</span><span class="p">,</span><span class="w"> 
                         </span><span class="n">option</span><span class="o">=</span><span class="w"> </span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"US Treasury Yield Curve Rates, 1990 to 2019"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Date: {frame_time}'</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_caption</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">transition_time</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span><span class="w"> 



</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">150</span><span class="w">
</span><span class="n">animate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">nframes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">d2</span><span class="o">$</span><span class="n">Date</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"png"</span><span class="p">,</span><span class="w"> </span><span class="n">fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w">
        </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cairo-png"</span><span class="p">,</span><span class="w"> </span><span class="n">antialias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"subpixel"</span><span class="p">,</span><span class="w"> 
        </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="m">4.3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w">

</span><span class="n">anim_save</span><span class="p">(</span><span class="s2">"0151-yield-anim150.gif"</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">thankr</span><span class="o">::</span><span class="n">shoulders</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">maintainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_squish</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"&lt;.+&gt;"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">maintainer</span><span class="p">)),</span><span class="w">
         </span><span class="n">maintainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">maintainer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"R-core"</span><span class="p">,</span><span class="w"> </span><span class="s2">"R Core Team"</span><span class="p">,</span><span class="w"> </span><span class="n">maintainer</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">maintainer</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">`Number packages`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">no_packages</span><span class="p">),</span><span class="w">
            </span><span class="n">packages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">", "</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">`Number packages`</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">clipr</span><span class="o">::</span><span class="n">write_clip</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">maintainer</th>
      <th style="text-align: right">Number packages</th>
      <th style="text-align: left">packages</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Hadley Wickham</td>
      <td style="text-align: right">15</td>
      <td style="text-align: left">assertthat, dplyr, forcats, ggplot2, gtable, haven, httr, lazyeval, modelr, plyr, rvest, scales, stringr, tidyr, tidyverse</td>
    </tr>
    <tr>
      <td style="text-align: left">R Core Team</td>
      <td style="text-align: right">11</td>
      <td style="text-align: left">base, compiler, datasets, graphics, grDevices, grid, methods, stats, tools, utils, nlme</td>
    </tr>
    <tr>
      <td style="text-align: left">Gábor Csárdi</td>
      <td style="text-align: right">4</td>
      <td style="text-align: left">cli, crayon, pkgconfig, progress</td>
    </tr>
    <tr>
      <td style="text-align: left">Kirill Müller</td>
      <td style="text-align: right">4</td>
      <td style="text-align: left">DBI, hms, pillar, tibble</td>
    </tr>
    <tr>
      <td style="text-align: left">Lionel Henry</td>
      <td style="text-align: right">4</td>
      <td style="text-align: left">purrr, rlang, svglite, tidyselect</td>
    </tr>
    <tr>
      <td style="text-align: left">Winston Chang</td>
      <td style="text-align: right">4</td>
      <td style="text-align: left">extrafont, extrafontdb, R6, Rttf2pt1</td>
    </tr>
    <tr>
      <td style="text-align: left">Yihui Xie</td>
      <td style="text-align: right">4</td>
      <td style="text-align: left">evaluate, knitr, rmarkdown, xfun</td>
    </tr>
    <tr>
      <td style="text-align: left">Jim Hester</td>
      <td style="text-align: right">3</td>
      <td style="text-align: left">glue, withr, readr</td>
    </tr>
    <tr>
      <td style="text-align: left">Thomas Lin Pedersen</td>
      <td style="text-align: right">3</td>
      <td style="text-align: left">farver, gganimate, tweenr</td>
    </tr>
    <tr>
      <td style="text-align: left">Yixuan Qiu</td>
      <td style="text-align: right">3</td>
      <td style="text-align: left">showtext, showtextdb, sysfonts</td>
    </tr>
    <tr>
      <td style="text-align: left">Dirk Eddelbuettel</td>
      <td style="text-align: right">2</td>
      <td style="text-align: left">digest, Rcpp</td>
    </tr>
    <tr>
      <td style="text-align: left">Jennifer Bryan</td>
      <td style="text-align: right">2</td>
      <td style="text-align: left">cellranger, readxl</td>
    </tr>
    <tr>
      <td style="text-align: left">Simon Urbanek</td>
      <td style="text-align: right">2</td>
      <td style="text-align: left">audio, Cairo</td>
    </tr>
    <tr>
      <td style="text-align: left">Achim Zeileis</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">colorspace</td>
    </tr>
    <tr>
      <td style="text-align: left">Alex Hayes</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">broom</td>
    </tr>
    <tr>
      <td style="text-align: left">Charlotte Wickham</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">munsell</td>
    </tr>
    <tr>
      <td style="text-align: left">David Gohel</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">gdtools</td>
    </tr>
    <tr>
      <td style="text-align: left">Deepayan Sarkar</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">lattice</td>
    </tr>
    <tr>
      <td style="text-align: left">Gabor Csardi</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">prettyunits</td>
    </tr>
    <tr>
      <td style="text-align: left">James Hester</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">xml2</td>
    </tr>
    <tr>
      <td style="text-align: left">Jeremy Stephens</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">yaml</td>
    </tr>
    <tr>
      <td style="text-align: left">Jeroen Ooms</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">jsonlite</td>
    </tr>
    <tr>
      <td style="text-align: left">Joe Cheng</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">htmltools</td>
    </tr>
    <tr>
      <td style="text-align: left">Kamil Slowikowski</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">ggrepel</td>
    </tr>
    <tr>
      <td style="text-align: left">Kevin Ushey</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">rstudioapi</td>
    </tr>
    <tr>
      <td style="text-align: left">Marek Gagolewski</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">stringi</td>
    </tr>
    <tr>
      <td style="text-align: left">Matthew Lincoln</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">clipr</td>
    </tr>
    <tr>
      <td style="text-align: left">Max Kuhn</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">generics</td>
    </tr>
    <tr>
      <td style="text-align: left">Michel Lang</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">backports</td>
    </tr>
    <tr>
      <td style="text-align: left">Peter Ellis</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">frs</td>
    </tr>
    <tr>
      <td style="text-align: left">Rasmus Bååth</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">beepr</td>
    </tr>
    <tr>
      <td style="text-align: left">Stefan Milton Bache</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">magrittr</td>
    </tr>
    <tr>
      <td style="text-align: left">Vitalie Spinu</td>
      <td style="text-align: right">1</td>
      <td style="text-align: left">lubridate</td>
    </tr>
  </tbody>
</table>


		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2019/04/07/fonts-and-stuff">Using svglite with web fonts</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2019/04/22/AES-intro">Familiarisation with the Australian Election Study</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>