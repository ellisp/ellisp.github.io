      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Design effects for stratified sub-populations</title>
      	
         
         
            <meta name ="description" content ="I look at the two different sorts of design effects that Stata will report for estimates from sub-populations of a complex survey, which vary depending on whether or not the hypothetical simple random sample we are comparing the complex survey to has the same sub-population sample sizes as the actual sample.">
            <meta property="og:description" content ="I look at the two different sorts of design effects that Stata will report for estimates from sub-populations of a complex survey, which vary depending on whether or not the hypothetical simple random sample we are comparing the complex survey to has the same sub-population sample sizes as the actual sample.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Design effects for stratified sub-populations" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0263-scatter.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2024/11/16/design-effects.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2025/06/14/more-on-fragile-p-values>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Design effects for stratified sub-populations</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I look at the two different sorts of design effects that Stata will report for estimates from sub-populations of a complex survey, which vary depending on whether or not the hypothetical simple random sample we are comparing the complex survey to has the same sub-population sample sizes as the actual sample.</p>
	   <p class="meta">16 Nov 2024</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <p>So, some months ago, I spent a few hours over a few days puzzled by something that turned out to be straighforwardly written up in the Stata manual, but not easily findable anywhere else. So I want to write it up, if only to have somewhere for future me to find it easily.</p>

<p>It’s all about the <a href="https://en.wikipedia.org/wiki/Design_effect">design effect in a complex survey</a>. The definition of a design effect given by Wikipedia is fine:</p>

<blockquote>
  <p>“In survey methodology, the design effect … is a measure of the expected impact of a sampling design on the variance of an estimator for some parameter of a population. It is calculated as the ratio of the variance of an estimator based on a sample from an (often) complex sampling design, to the variance of an alternative estimator based on a simple random sample (SRS) of the same number of elements.”</p>
</blockquote>

<p>So a design effect of 1 means the variance of your estimator (and hence its standard error) is the same in your complex survey design as if you’d just sampled simply from the population at random. Values higher than 1 are the norm, and mean that you have a higher variance in your estimate as a price of something else in your complex design (for example, maybe you are sampling clusters that live closer together to make it easier for interviewers to interview several households at once, which reduces cost but increases variance).</p>

<p>My puzzle related to when you are estimating some measure of interest over different levels of a categorical variable that features in the sample design (say, the unemployment rate in different states of Australia, in a survey where the sample was stratified by state), and in particular when some levels been over-sampled and some under-sampled. By which I mean, the fraction of the total population that has been sampled is different for different levels of this variable. Perhaps Tasmania (a small state) was over-sampled from to make sure there were enough people to report on unemployment separately for Tasmania.</p>

<p>A concrete example I’m going to use is a survey that was stratified by province, and some provinces have had a high proportion of the population sampled for some reason that we don’t need to worry about, but let’s presume it’s a good one (like, wanting a minimum number of people from each province to report the estimate of interest with a reasonably small confidence interval). The variable of interest in this survey is <code class="language-plaintext highlighter-rouge">likes_cats</code> which is either 1 or 0 and indicates whether the survey respondent likes cats. (Warning - no attempt has been made to make the proportion who likes cats in this made up data resemble reality).</p>

<p>The thing that started me on this as a problem was noticing differences between Stata and R output, so I’ll be structuring the blog around that. I guess this also serves the useful case of an example of the same survey being analysed in both environments.</p>

<p>The data I’m using is made up, but based on real life data that I’ve mangled, re-simulated, and generally fiddled with to avoid any privacy questions. Let’s start by downloading it, importing it to R, and specifying the survey design using Thomas Lumley’s <code class="language-plaintext highlighter-rouge">survey</code> package.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">survey</span><span class="p">)</span><span class="w">

</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://raw.githubusercontent.com/ellisp/blog-source/refs/heads/master/_working/simulated-survey.csv"</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"simulated-survey.csv"</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="n">df</span><span class="p">)){</span><span class="w">
  </span><span class="n">download.file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">destfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">sim_surv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">

</span><span class="c1"># Specify survey design - stratified by province, and 2 stages, both with finite populations</span><span class="w">
</span><span class="n">sim_surv_des</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">svydesign</span><span class="p">(</span><span class="o">~</span><span class="n">neighborhood</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ind_id</span><span class="p">,</span><span class="w"> </span><span class="n">weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">fweight</span><span class="p">,</span><span class="w"> 
                          </span><span class="n">strata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">province</span><span class="p">,</span><span class="w"> 
                          </span><span class="n">fpc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">nb_in_province</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop_in_neighborhood</span><span class="p">,</span><span class="w">
                          </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim_surv</span><span class="p">,</span><span class="w"> </span><span class="n">nest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<p>And here’s doing the same in Stata, other than the downloading part given we’ve already done that once:</p>

<figure class="highlight"><pre><code class="language-stata" data-lang="stata"><span class="c1">** Simple Stata demo of survey design and calcualtion, assumes data has been</span>
<span class="c1">** previously downloaded in the accompanying R script</span>
<span class="k">clear</span>

<span class="k">import</span><span class="w"> </span><span class="n">delimited</span><span class="w"> </span><span class="n">simulated</span><span class="o">-survey.</span><span class="n">csv</span><span class="w"> </span>

<span class="c1">** make a numeric version of province, as over() can't work with strings:</span>
<span class="k">encode</span><span class="w"> </span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="n">gen</span><span class="p">(</span><span class="n">province_n</span><span class="p">)</span>

<span class="c1">** Set up survey design = complex 2 stages design stratified sample</span>
<span class="c1">** first step of sampling design is selection of neighborhoods from each province with finite neighborhoods,</span>
<span class="c1">** second step is individuals select from the finite population in each neighborhood</span>
<span class="n">svyset</span><span class="w"> </span><span class="n">neighborhood</span><span class="w"> </span><span class="p">[</span><span class="n">pweight</span><span class="o">=</span><span class="n">fweight</span><span class="p">],</span><span class="w"> </span><span class="n">singleunit</span><span class="p">(</span><span class="n">centered</span><span class="p">)</span><span class="w"> </span><span class="c1">/// </span>
<span class="w">  </span><span class="n">strata</span><span class="p">(</span><span class="n">province</span><span class="p">)</span><span class="w"> </span><span class="n">fpc</span><span class="p">(</span><span class="n">nb_in_province</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ind_id</span><span class="p">,</span><span class="w"> </span><span class="n">fpc</span><span class="p">(</span><span class="n">pop_in_neighborhood</span><span class="p">)</span><span class="w">		</span></code></pre></figure>

<p>These are pretty similar workflows. Stata has the extra step - for Reasons - of encoding a string variable we’re going to want to use later as numeric. R’s <code class="language-plaintext highlighter-rouge">svydesign</code> function and the Stata <code class="language-plaintext highlighter-rouge">svyset</code> function do essentially identical jobs in a pretty similar way, telling the software the stratified, two stage design we’re going to be using and giving it the columns to look at for the finite population corrections. Our sample design is to pick a number of neighbourhoods in each province, and then a number of individuals in each neighbourhood, so we’re interested in both the total number of neighbourhoods in each province and the total number of individuals in each neighbourhood.</p>

<p>(Note - in real life I would be declaring that the sun of <code class="language-plaintext highlighter-rouge">fweight</code> in each province has been calibrated to match the population total in that province, but doing this introduced some further limitations with Stata that I decided were distractions, to look at some other time.)</p>

<p>To check that we’re in agreement, let’s start by asking both environments the proportion of people that like cats, the standard error of that proportion, and the design effect.</p>

<p>In R:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&gt;</span><span class="w"> </span><span class="n">svymean</span><span class="p">(</span><span class="o">~</span><span class="n">likes_cats</span><span class="p">,</span><span class="w"> </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim_surv_des</span><span class="p">,</span><span class="w"> </span><span class="n">deff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
                </span><span class="n">mean</span><span class="w">        </span><span class="n">SE</span><span class="w">   </span><span class="n">DEff</span><span class="w">
</span><span class="n">likes_cats</span><span class="w"> </span><span class="m">0.5320009</span><span class="w"> </span><span class="m">0.0065751</span><span class="w"> </span><span class="m">1.8673</span></code></pre></figure>

<p>And in Stata:</p>

<figure class="highlight"><pre><code class="language-stata" data-lang="stata"><span class="o">.</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">Population</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="n">design</span><span class="w"> </span><span class="n">effects</span>
<span class="o">.</span><span class="w"> </span><span class="n">svy</span><span class="o">:</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="n">likes_cats</span>
<span class="o">.</span><span class="w"> </span><span class="n">estat</span><span class="w"> </span><span class="n">effect</span>

<span class="o">----------------------------------------------------------</span>
<span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="n">Linearized</span>
<span class="w">             </span><span class="o">|</span><span class="w">       </span><span class="n">Mean</span><span class="w">   </span><span class="o">Std.</span><span class="w"> </span><span class="n">Err</span><span class="o">.</span><span class="w">       </span><span class="n">DEFF</span><span class="w">      </span><span class="n">DEFT</span>
<span class="o">-------------+--------------------------------------------</span>
<span class="w">  </span><span class="n">likes_cats</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.5320009</span><span class="w">   </span><span class="m">.0065751</span><span class="w">     </span><span class="m">1.86726</span><span class="w">   </span><span class="m">1.31766</span>
<span class="o">----------------------------------------------------------</span>
<span class="n">Note</span><span class="o">:</span><span class="w"> </span><span class="n">Weights</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">represent</span><span class="w"> </span><span class="n">population</span><span class="w"> </span><span class="n">totals</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">deff</span><span class="w"> </span><span class="kr">to</span>
<span class="w">      </span><span class="n">be</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">FPC</span><span class="p">;</span><span class="w"> </span><span class="n">however</span><span class="p">,</span><span class="w"> </span><span class="n">deft</span><span class="w"> </span><span class="n">is</span>
<span class="w">      </span><span class="n">invariant</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">weights</span><span class="o">.</span></code></pre></figure>

<p>(Some of Stata’s output has been edited out)</p>

<p>OK, so we see that both systems agree that 0.5320009 of people like cats, that the standard error for this is 0.0065751, and the design effect is 1.86726.</p>

<p>So far so good, but what we are interested in is what proportion of people <em>in each province</em> like cats. Here is what R has to say about this:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&gt;</span><span class="w"> </span><span class="n">svyby</span><span class="p">(</span><span class="o">~</span><span class="n">likes_cats</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim_surv_des</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svymean</span><span class="p">,</span><span class="w"> </span><span class="n">deff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="n">province</span><span class="w"> </span><span class="n">likes_cats</span><span class="w">         </span><span class="n">se</span><span class="w"> </span><span class="n">DEff.likes_cats</span><span class="w">
</span><span class="n">A</span><span class="w">        </span><span class="n">A</span><span class="w">  </span><span class="m">0.6657223</span><span class="w"> </span><span class="m">0.01910098</span><span class="w">        </span><span class="m">1.676309</span><span class="w">
</span><span class="n">B</span><span class="w">        </span><span class="n">B</span><span class="w">  </span><span class="m">0.6345405</span><span class="w"> </span><span class="m">0.01423610</span><span class="w">        </span><span class="m">1.257485</span><span class="w">
</span><span class="n">C</span><span class="w">        </span><span class="n">C</span><span class="w">  </span><span class="m">0.6096537</span><span class="w"> </span><span class="m">0.02125743</span><span class="w">        </span><span class="m">2.050192</span><span class="w">
</span><span class="n">D</span><span class="w">        </span><span class="n">D</span><span class="w">  </span><span class="m">0.5706099</span><span class="w"> </span><span class="m">0.02251630</span><span class="w">        </span><span class="m">2.852858</span><span class="w">
</span><span class="n">E</span><span class="w">        </span><span class="n">E</span><span class="w">  </span><span class="m">0.4392845</span><span class="w"> </span><span class="m">0.01633982</span><span class="w">        </span><span class="m">1.748840</span><span class="w">
</span><span class="nb">F</span><span class="w">        </span><span class="nb">F</span><span class="w">  </span><span class="m">0.6783198</span><span class="w"> </span><span class="m">0.01831859</span><span class="w">        </span><span class="m">2.103528</span><span class="w">
</span><span class="n">G</span><span class="w">        </span><span class="n">G</span><span class="w">  </span><span class="m">0.4153480</span><span class="w"> </span><span class="m">0.01535588</span><span class="w">        </span><span class="m">1.217967</span><span class="w">
</span><span class="n">H</span><span class="w">        </span><span class="n">H</span><span class="w">  </span><span class="m">0.4066567</span><span class="w"> </span><span class="m">0.01329190</span><span class="w">        </span><span class="m">1.258354</span></code></pre></figure>

<p>…and here is Stata:</p>

<figure class="highlight"><pre><code class="language-stata" data-lang="stata"><span class="o">.</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">Strata</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="n">design</span><span class="w"> </span><span class="n">effects</span>
<span class="o">.</span><span class="w"> </span><span class="n">svy</span><span class="o">:</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="n">likes_cats</span><span class="p">,</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="n">province_n</span><span class="p">)</span><span class="w"> </span>
<span class="o">.</span><span class="w"> </span><span class="n">estat</span><span class="w"> </span><span class="n">effect</span><span class="w">                          </span>

<span class="o">----------------------------------------------------------</span>
<span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="n">Linearized</span>
<span class="w">        </span><span class="n">Over</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="n">Mean</span><span class="w">   </span><span class="o">Std.</span><span class="w"> </span><span class="n">Err</span><span class="o">.</span><span class="w">       </span><span class="n">DEFF</span><span class="w">      </span><span class="n">DEFT</span>
<span class="o">-------------+--------------------------------------------</span>
<span class="n">likes_cats</span><span class="w">   </span><span class="o">|</span>
<span class="w">           </span><span class="n">A</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.6657223</span><span class="w">    </span><span class="m">.019101</span><span class="w">     </span><span class="m">.637551</span><span class="w">   </span><span class="m">.769941</span>
<span class="w">           </span><span class="n">B</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.6345405</span><span class="w">   </span><span class="m">.0142361</span><span class="w">      </span><span class="m">1.3455</span><span class="w">   </span><span class="m">1.11852</span>
<span class="w">           </span><span class="n">C</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.6096537</span><span class="w">   </span><span class="m">.0212574</span><span class="w">     </span><span class="m">2.31479</span><span class="w">   </span><span class="m">1.46709</span>
<span class="w">           </span><span class="n">D</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.5706099</span><span class="w">   </span><span class="m">.0225163</span><span class="w">     </span><span class="m">3.13267</span><span class="w">    </span><span class="m">1.7067</span>
<span class="w">           </span><span class="n">E</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.4392845</span><span class="w">   </span><span class="m">.0163398</span><span class="w">     </span><span class="m">2.01139</span><span class="w">   </span><span class="m">1.36757</span>
<span class="w">           </span><span class="n">F</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.6783198</span><span class="w">   </span><span class="m">.0183186</span><span class="w">       </span><span class="m">1.895</span><span class="w">   </span><span class="m">1.32741</span>
<span class="w">           </span><span class="n">G</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="m">.415348</span><span class="w">   </span><span class="m">.0153559</span><span class="w">     </span><span class="m">.597809</span><span class="w">   </span><span class="m">.745558</span>
<span class="w">           </span><span class="n">H</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.4066567</span><span class="w">   </span><span class="m">.0132919</span><span class="w">     </span><span class="m">1.74908</span><span class="w">   </span><span class="m">1.27528</span>
<span class="o">----------------------------------------------------------</span></code></pre></figure>

<p>This time the point estimates and the standard errors are different, but the design effects are radically different. For example, in province A, R gives a design effect of 1.68 (meaning that the variance of the estimate is 68% bigger as a result of the complex survey sampling design), but Stata gives 0.64 (meaning the variance of the estimate is 36% <em>lower</em> because of the design).</p>

<p>Why is this so? In particular, how can the design effects be different, when the estimated standard errors are identical?</p>

<p>Well, the answer turns out to be pretty straightforward. In <a href="https://www.stata.com/manuals/svyestat.pdf">the Stata manual for <code class="language-plaintext highlighter-rouge">estat effect</code></a> it says we have an option <code class="language-plaintext highlighter-rouge">srssubpop</code> which will “report design effects, assuming simple random sampling <strong>within subpopulation</strong>” (emphasis added) and:</p>

<blockquote>
  <p>…by default, DEFF and DEFT are computed using an estimate of the SRS variance for sampling <strong>from the entire population</strong>.</p>
</blockquote>

<p>As per Wikipedia, the design effect is a comparison of the actual estimated standard error of the proportion of people who like cats in each province, with the standard error “you would have got with a simple random sampling design” (it is actually the ratio of the variances, which is the squared standard error, but as we are typically thinking in terms of standard error and that is what both R and Stata return, I’m emphasising that part of the concet).</p>

<p>But there are two ways of looking at this variance that “you would have got with a simple random sampling design”.</p>

<p>One way is to say that you have the sample numbers in each province that you have, but let’s pretend the design that gave it to you was just simple random sampling, and calculate the standard error accordingly; square both standard errors and divide one by the other. This is what is happening in R.</p>

<p>The other ways is to reflect on one more step, and say “hang on, if we’d really had a simple random sample, we wouldn’t have these sample sizes in the first place. For example, we’ve only got 864 samples in province A because we deliberately oversampled there. If we’d used simple random sampling, it would have been more like 362. Let’s compare our standard errors from the actual sample to <em>the standard errors we would have likely got from simple random sampling, including less people in province A and more in province G than we actually got</em>.” This is what is happening in Stata. That’s why province A has that design effect of 0.64 - the stratified sample design gave us extra samples in province A, so the design is actually giving us <em>reduced</em> variance there, compared to a genuine simple random sample.</p>

<p>So the reason this second method has a design effect of less than 1 for province A is that it says “the only reason you have so many people in your sample from province A is the stratification part of the sampling design. So when we want to say ‘what impact has the design had on our estimates’, it’s only fair to say that the estimate you’ve got is a lot more precise than you would have under simple random sampling.”</p>

<p>I actually find this a pretty intutitive interpretation, if we want to use the design effect as a short hand for “what impact has our design had on this particular estimate’s variance”. Of course a lot of this is largely academic; design effects are only really worried about by specialists, and they are often focused on as a single number for the survey as a whole (focusing on the impact of the design on the key variable of interest, estimated for the whole population), which doesn’t vary by either method. And the two methods of getting design effect will only vary much when, like in our case, the categorical variable you are splicing your sample up into for estimation purposes happens to be the very variable that you used as a basis for over- and under-sampling in the first place.</p>

<p>Stata conveniently gives you an easy option to use the alternative method of calculating a design effect, just adding the <code class="language-plaintext highlighter-rouge">, srssubpop</code> option to the <code class="language-plaintext highlighter-rouge">estat effect</code> command:</p>

<figure class="highlight"><pre><code class="language-stata" data-lang="stata"><span class="o">.</span><span class="w"> </span><span class="n">estat</span><span class="w"> </span><span class="n">effect</span><span class="p">,</span><span class="w"> </span><span class="n">srssubpop</span><span class="w">                          </span>

<span class="o">----------------------------------------------------------</span>
<span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="n">Linearized</span>
<span class="w">        </span><span class="n">Over</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="n">Mean</span><span class="w">   </span><span class="o">Std.</span><span class="w"> </span><span class="n">Err</span><span class="o">.</span><span class="w">       </span><span class="n">DEFF</span><span class="w">      </span><span class="n">DEFT</span>
<span class="o">-------------+--------------------------------------------</span>
<span class="n">likes_cats</span><span class="w">   </span><span class="o">|</span>
<span class="w">           </span><span class="n">A</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.6657223</span><span class="w">    </span><span class="m">.019101</span><span class="w">     </span><span class="m">1.67631</span><span class="w">   </span><span class="m">1.18258</span>
<span class="w">           </span><span class="n">B</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.6345405</span><span class="w">   </span><span class="m">.0142361</span><span class="w">     </span><span class="m">1.25748</span><span class="w">   </span><span class="m">1.08378</span>
<span class="w">           </span><span class="n">C</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.6096537</span><span class="w">   </span><span class="m">.0212574</span><span class="w">     </span><span class="m">2.05019</span><span class="w">   </span><span class="m">1.38623</span>
<span class="w">           </span><span class="n">D</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.5706099</span><span class="w">   </span><span class="m">.0225163</span><span class="w">     </span><span class="m">2.85286</span><span class="w">   </span><span class="m">1.63379</span>
<span class="w">           </span><span class="n">E</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.4392845</span><span class="w">   </span><span class="m">.0163398</span><span class="w">     </span><span class="m">1.74884</span><span class="w">   </span><span class="m">1.28105</span>
<span class="w">           </span><span class="n">F</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.6783198</span><span class="w">   </span><span class="m">.0183186</span><span class="w">     </span><span class="m">2.10353</span><span class="w">   </span><span class="m">1.39313</span>
<span class="w">           </span><span class="n">G</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="m">.415348</span><span class="w">   </span><span class="m">.0153559</span><span class="w">     </span><span class="m">1.21797</span><span class="w">   </span><span class="m">1.02739</span>
<span class="w">           </span><span class="n">H</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="m">.4066567</span><span class="w">   </span><span class="m">.0132919</span><span class="w">     </span><span class="m">1.25835</span><span class="w">   </span><span class="m">1.09248</span>
<span class="o">----------------------------------------------------------</span></code></pre></figure>

<p>We see these design effects exactly match those from R, eg the design effect for province A is now 1.676.</p>

<p>Here’s what the Stata manual says about which method to choose:</p>

<blockquote>
  <p>“Typically, srssubpop is used when computing subpopulation estimates by strata or by groups of strata.”</p>
</blockquote>

<p>This is a little terse but I presume the logic here is that if you stratified your sample, perhaps you want to compare to simple random sampling within those strata - not to from the population as a whole. In otherwords, you’re not really comparing your complex survey design to the simples of all simple random sampling, but to stratified random sampling.</p>

<p>The <code class="language-plaintext highlighter-rouge">survey</code> package in R defaults to the equivalent of Stata’s <code class="language-plaintext highlighter-rouge">srssubpop</code> option. As far as I could tell, R doesn’t give an equivalently easy way to get the design effects that Stata defaults to. But they aren’t hard to calculate yourself. The table below is meant to be a step-by-step guide to how this was done:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">avg_weight</code> is the average individual weight of sample units in each province. Lower weights mean that each sampled person represents less of the total population than is the case for heigher weights.</li>
  <li><code class="language-plaintext highlighter-rouge">p</code> is the estimated proportion of people in that province that like cats, calculated straight from the data</li>
  <li><code class="language-plaintext highlighter-rouge">n</code> is the actual sample size</li>
  <li><code class="language-plaintext highlighter-rouge">N</code> is the population size in that province</li>
  <li><code class="language-plaintext highlighter-rouge">even_n</code> is the hypothetical approximate sample size you would have drawn from that population under simple random sampling</li>
  <li><code class="language-plaintext highlighter-rouge">se_with_actual_n</code> is the standard error, pretending there is no complex survey design to worry about, with the actual number of samples in that province. In other words <code class="language-plaintext highlighter-rouge">sqrt(p * (1 - p) / n * (N - n) / (N - 1))</code> which is the usual standard error for a proportion, with finite population correction.</li>
  <li><code class="language-plaintext highlighter-rouge">se_with_even_n</code> is the same but calculated with the hypothetical more even sample size if you’d hard real simple random sampling. So same as the above, but using <code class="language-plaintext highlighter-rouge">even_n</code> instead of <code class="language-plaintext highlighter-rouge">n</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">se_complex</code> is the actual standard error, taking into account the complex survey design.</li>
  <li><code class="language-plaintext highlighter-rouge">DEff_1</code> is <code class="language-plaintext highlighter-rouge">(se_complex / se_with_even_n) ^ 2</code> ie the Stata default method</li>
  <li><code class="language-plaintext highlighter-rouge">DEff_2</code> is <code class="language-plaintext highlighter-rouge">(se_complex / se_with_actual_n) ^ 2</code> ie the R default method</li>
</ul>

<hr />

<table>
  <thead>
    <tr>
      <th style="text-align: left">province</th>
      <th style="text-align: right">avg_weight</th>
      <th style="text-align: right">p</th>
      <th style="text-align: right">n</th>
      <th style="text-align: right">N</th>
      <th style="text-align: right">even_n</th>
      <th style="text-align: right">se_with_actual_n</th>
      <th style="text-align: right">se_with_even_n</th>
      <th style="text-align: right">se_complex</th>
      <th style="text-align: right">DEff_1</th>
      <th style="text-align: right">DEff_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">A</td>
      <td style="text-align: right">6.033866</td>
      <td style="text-align: right">0.6657223</td>
      <td style="text-align: right">854</td>
      <td style="text-align: right">5152.921</td>
      <td style="text-align: right">362</td>
      <td style="text-align: right">0.0147457</td>
      <td style="text-align: right">0.0239095</td>
      <td style="text-align: right">0.0191010</td>
      <td style="text-align: right">0.6382190</td>
      <td style="text-align: right">1.677948</td>
    </tr>
    <tr>
      <td style="text-align: left">B</td>
      <td style="text-align: right">15.167991</td>
      <td style="text-align: right">0.6345405</td>
      <td style="text-align: right">1345</td>
      <td style="text-align: right">20400.948</td>
      <td style="text-align: right">1432</td>
      <td style="text-align: right">0.0126908</td>
      <td style="text-align: right">0.0122711</td>
      <td style="text-align: right">0.0142361</td>
      <td style="text-align: right">1.3458988</td>
      <td style="text-align: right">1.258358</td>
    </tr>
    <tr>
      <td style="text-align: left">C</td>
      <td style="text-align: right">15.946476</td>
      <td style="text-align: right">0.6096537</td>
      <td style="text-align: right">1013</td>
      <td style="text-align: right">16153.780</td>
      <td style="text-align: right">1134</td>
      <td style="text-align: right">0.0148393</td>
      <td style="text-align: right">0.0139691</td>
      <td style="text-align: right">0.0212574</td>
      <td style="text-align: right">2.3157141</td>
      <td style="text-align: right">2.052091</td>
    </tr>
    <tr>
      <td style="text-align: left">D</td>
      <td style="text-align: right">15.539426</td>
      <td style="text-align: right">0.5706099</td>
      <td style="text-align: right">1291</td>
      <td style="text-align: right">20061.399</td>
      <td style="text-align: right">1408</td>
      <td style="text-align: right">0.0133260</td>
      <td style="text-align: right">0.0127205</td>
      <td style="text-align: right">0.0225163</td>
      <td style="text-align: right">3.1331916</td>
      <td style="text-align: right">2.854927</td>
    </tr>
    <tr>
      <td style="text-align: left">E</td>
      <td style="text-align: right">16.230320</td>
      <td style="text-align: right">0.4392845</td>
      <td style="text-align: right">1515</td>
      <td style="text-align: right">24588.934</td>
      <td style="text-align: right">1726</td>
      <td style="text-align: right">0.0123520</td>
      <td style="text-align: right">0.0115194</td>
      <td style="text-align: right">0.0163398</td>
      <td style="text-align: right">2.0120421</td>
      <td style="text-align: right">1.749924</td>
    </tr>
    <tr>
      <td style="text-align: left">F</td>
      <td style="text-align: right">12.927955</td>
      <td style="text-align: right">0.6783198</td>
      <td style="text-align: right">1263</td>
      <td style="text-align: right">16328.008</td>
      <td style="text-align: right">1146</td>
      <td style="text-align: right">0.0126258</td>
      <td style="text-align: right">0.0133060</td>
      <td style="text-align: right">0.0183186</td>
      <td style="text-align: right">1.8953402</td>
      <td style="text-align: right">2.105066</td>
    </tr>
    <tr>
      <td style="text-align: left">G</td>
      <td style="text-align: right">7.497966</td>
      <td style="text-align: right">0.4153480</td>
      <td style="text-align: right">1088</td>
      <td style="text-align: right">8157.787</td>
      <td style="text-align: right">572</td>
      <td style="text-align: right">0.0139086</td>
      <td style="text-align: right">0.0198700</td>
      <td style="text-align: right">0.0153559</td>
      <td style="text-align: right">0.5972474</td>
      <td style="text-align: right">1.218938</td>
    </tr>
    <tr>
      <td style="text-align: left">H</td>
      <td style="text-align: right">19.407325</td>
      <td style="text-align: right">0.4066567</td>
      <td style="text-align: right">1631</td>
      <td style="text-align: right">31653.346</td>
      <td style="text-align: right">2221</td>
      <td style="text-align: right">0.0118457</td>
      <td style="text-align: right">0.0100508</td>
      <td style="text-align: right">0.0132919</td>
      <td style="text-align: right">1.7489189</td>
      <td style="text-align: right">1.259086</td>
    </tr>
  </tbody>
</table>

<hr />

<p>For variables not highly correlated with the over/under-sampling structure, the design effects will not vary by much the two methods. For variables that <em>are</em>, the Stata manual suggests using the <code class="language-plaintext highlighter-rouge">srssubpop</code>. What this suggests to me is that it is safe to use the <code class="language-plaintext highlighter-rouge">srssubpop</code> option more generally - when it makes much difference is precisely the time that it is more likely to be used.</p>

<p>I (literally) can’t have a blog post without a plot, so here is an attempt to show some of the key information from that table visually. I tried a few different ways to show this visually, and ultimately opted for just comparing two ratios - that of the design effect from one method compared to the other, and the actual sample size compared to the expected sample size under unstratified simple random sampling.</p>

<object type="image/svg+xml" data="/img/0263-scatter.svg" width="100%"><img src="/img/0263-scatter.png" width="100%" /></object>

<p>Here’s the code that calculated that table and drew the plot:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim_surv</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">province</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">avg_weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">fweight</span><span class="p">),</span><span class="w">
            </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weighted.mean</span><span class="p">(</span><span class="n">likes_cats</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fweight</span><span class="p">),</span><span class="w">
            </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">(),</span><span class="w">
            </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">fweight</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">even_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span><span class="w">
         </span><span class="n">se_with_actual_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">p</span><span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span><span class="w">
         </span><span class="n">se_with_even_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">p</span><span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">even_n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">even_n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)),</span><span class="w">
         </span><span class="n">se_complex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svyby</span><span class="p">(</span><span class="o">~</span><span class="n">likes_cats</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim_surv_des</span><span class="p">,</span><span class="w"> </span><span class="n">deff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svymean</span><span class="p">)</span><span class="o">$</span><span class="n">se</span><span class="p">,</span><span class="w">
         </span><span class="n">DEff_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">se_complex</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">se_with_even_n</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
         </span><span class="n">DEff_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">se_complex</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">se_with_actual_n</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> 

</span><span class="n">results</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">ratio_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">even_n</span><span class="p">,</span><span class="w">
         </span><span class="n">ratio_deff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEff_2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">DEff_1</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ratio_n</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ratio_deff</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">province</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_abline</span><span class="p">(</span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">,</span><span class="w"> </span><span class="n">fontface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Oversampling ratio for actual sample\n(&gt;1 is oversampled, &lt;1 is undersampled)"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Design effect ratio"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ratio of 'srssubpop' design effect to Stata default design effect
Grey line shows equality of the two ratios."</span><span class="p">,</span><span class="w">
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Two types of design effect"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_equal</span><span class="p">()</span></code></pre></figure>

<p>Cheerio.</p>


		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2024/11/06/simplex-regression-coefficients">Regressions where the coefficients are a simplex.</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2024/11/30/ponzi-schemes">Simulating Ponzi schemes</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<p>Find me on <a rel="me" href="https://mastodon.social/@peter_ellis">Mastodon</a>.</p>
			<hr></hr>
			
			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>