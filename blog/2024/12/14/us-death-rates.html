      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Death rates by cause of death</title>
      	
         
         
            <meta name ="description" content ="I explore death rates by cause of death with OECD data, for the USA and other countries. Causes of death that are relatively high in the USA include assaults, accidents, suicides; diseases of the nervous systems (including Alzheimer's); and diseases of the circulatory system (including heart attacks).">
            <meta property="og:description" content ="I explore death rates by cause of death with OECD data, for the USA and other countries. Causes of death that are relatively high in the USA include assaults, accidents, suicides; diseases of the nervous systems (including Alzheimer's); and diseases of the circulatory system (including heart attacks).">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Death rates by cause of death" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0285-us-1719-lim.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2024/12/14/us-death-rates.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
	        <!--	  <li><a href="/blog/most-popular.html">ordered by popularity</a></li> -->
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2025/09/07/png>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Death rates by cause of death</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I explore death rates by cause of death with OECD data, for the USA and other countries. Causes of death that are relatively high in the USA include assaults, accidents, suicides; diseases of the nervous systems (including Alzheimer's); and diseases of the circulatory system (including heart attacks).</p>
	   <p class="meta">14 Dec 2024</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="overview">Overview</h2>
<p>OK, so the USA health system is very much in the news. One thing that has been getting a lot of coverage, not least because it was explicitly referred to in a written statement from the guy who seems to have murdered UnitedHealthcare CEO Brian Thompson, is the low life expectancy in the USA compared to the amount spent in that country on health services. So I have seen several variants on this chart going around:</p>

<object type="image/svg+xml" data="/img/0285-life-exp-scatter.svg" width="100%"><img src="/img/0285-life-exp-scatter.png" width="100%" /></object>

<p>It’s more common for the charts you see to focus on the upper right quadrant of that chart, relatively wealthy countries, in which case the USA is an even more prominent outlier. I like to see the whole world as context, not least because it shows other countries (including a couple in my working life patch, Tuvalu and Nauru) have as large a disappointing gap in life expectancy from what you might hope given income, spend on health, etc. There’s also some countries - like Sri Lanka, Thailand and Bangladesh - with relatively high life expectancy given income and health spend.</p>

<p>Now, it only takes a moment’s reflection to realise that this isn’t just a matter of spend quality, effectiveness and efficiency of the health system. Life expectancy is heavily determined by other things. Most obviously:</p>
<ul>
  <li>if people can’t afford enough food, they die earlier for reasons related to malnutrition</li>
  <li>if people eat too much and too unhealthy types of food, they die earlier from diseases related to obesity (diabetes, heart attacks, etc)</li>
  <li>if housing is poor they are more likely to get diseases like tuberculosis</li>
  <li>when water and sanitation is unsafe, people (including children, with a big impact on life expectancy) will die of cholera, diarrhea, typhoid, etc.</li>
  <li>if high numbers of young people commit suicide, die in accidents or are murdered it will directly and substantially reduce life expectancy.</li>
</ul>

<p>These are all “public health” issues, but the causes and solutions are (mostly) not to be found in health expenditure but in general economic and social conditions. I say ‘mostly’ because of course health interventions can indeed make a difference to people with diabetes, mental health problems contemplating suicide, people who have been assaulted but picked up by the emergency services before dying, etc. But these are very much “ambulance at the bottom of the cliff” measures rather than a fence at the top.</p>

<p>Of course all this is well known in the right circles, and in fact an article had come out some weeks before Thompson’s murder showing how the low life expectancy in the USA was materially impacted by deaths associated with <a href="https://www.aamcresearchinstitute.org/our-work/data-snapshot/narrowing-gap">alcohol, drugs and firearms</a>:</p>

<blockquote>
  <p>“In 2022, there were more than 48,000 firearm-related deaths (more than half were recorded as suicides…); nearly 108,000 drug-related deaths; and more than 51,000 alcohol-induced deaths.While these numbers made up a small fraction of the nearly 3.3 million deaths in 2022 in the United States, they disproportionately affected children and younger adults — and, as a result, lowered the U.S. life expectancy at birth. If these deaths were eliminated (and other causes of death remained the same), life expectancy at birth would increase by 1.6 years.”</p>
</blockquote>

<p>So remembering that when I read the ‘manifesto’ of Thompson’s alleged killer prompted me to look into death rates by cause of death myself. There is good data on this from the OECD, and not just for OECD countries. Here is my best chart I came up with illustrating the issues for the USA:</p>

<object type="image/svg+xml" data="/img/0285-us-1719-lim.svg" width="100%"><img src="/img/0285-us-1719-lim.png" width="100%" /></object>

<p>As you can see, the horizontal axis in that  chart shows the difference in the age-standardised death rate between the USA and a set of comparison countries. The comparison countries I chose are those with a higher life expectancy than the USA that also had cause of death data available in the OECD database. In effect, these are the countries the USA might try to catch up to, if it were seeking to improve its life expecancy.</p>

<p>What we see in this chart is that indeed, the cause of death that is most disproportionately high in the USA is ‘external’ - assaults, accidents and suicides. With relation to cancer - one of the diseases where the health system is most important in terms of treatment prolonging life - the USA has unusually low death rates. (Also for the mysterious ‘symptoms, signs, ill-defined causes’ cause of death, which unfortunately seems to be a measurement anomaly that is much more present in a small number of countries than others).</p>

<p>The second most relatively high cause of death for the US compared to its comparator countries is diseases of the nervous system, which includes Alzheimer’s. Then we have circulatory problems (eg heart attacks) and respiratory (influenza, pneumonia etc).</p>

<p>I drew lots more charts, some of which are highlighted in the rest of this blog, but if you’re interested in them systematically here are PDFs that include the chart for each country available for different time periods: <a href="/img/0285-all-countries-2017-2019.pdf">2017 to 2019</a> and for <a href="/img/0285-all-countries-2021.pdf">2021</a>. Adobe Acrobat on full screen mode (crtl-l) works well to flick through these. I considered making a Shiny app to let people explore this but decided the PDFs actually work better.</p>

<h2 id="more-detail">More detail</h2>

<p>OK that was the no-code summary but here is some more detail including how I drew those charts, some interesting variants including for other countries, and a bit of an exploration of which countries suffer most from which causes of death.</p>

<h3 id="drawing-the-life-expectancy-scatter-plot">Drawing the life expectancy scatter plot</h3>

<p>First, here is the code for the life expectancy chart. You can see I am drawing the data from the World Bank’s World Development Indicators. There’s quite a lag in reporting both these figures which comes from the complexity of collecting the data and analysing them; 2021 was the year that had the most complete data for a large number of countries.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#===============Setup==================</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rsdmx</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">janitor</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glue</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggbiplot</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">WDI</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">

</span><span class="cd">#' Collapse a character vector</span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="cd">#' @param ... passed through to \code{paste()}</span><span class="w">
</span><span class="cd">#' @details</span><span class="w">
</span><span class="cd">#' this is just a convenience wrapper around paste()</span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="n">pastec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">...</span><span class="p">){</span><span class="w">
  </span><span class="n">paste</span><span class="p">(</span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">', '</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#===============Part 1 - life expectancy compared to health spend============</span><span class="w">
</span><span class="c1">#---------------life expectancy--</span><span class="w">

</span><span class="c1"># had to explore a bit to find the indicators to use</span><span class="w">
</span><span class="c1"># w &lt;- WDIsearch("health")</span><span class="w">
</span><span class="c1"># View(w)</span><span class="w">

</span><span class="n">h</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">WDI</span><span class="p">(</span><span class="n">indicator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">health_spend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SH.XPD.CHEX.PC.CD"</span><span class="p">,</span><span class="w"> 
                       </span><span class="n">life_exp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SP.DYN.LE00.IN"</span><span class="p">),</span><span class="w">
         </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2020</span><span class="p">)</span><span class="w"> 

</span><span class="c1"># find the 'countries' that are really groupings of countries         </span><span class="w">
</span><span class="n">h</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">iso2c</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ZW"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ZM"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ZA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"XK"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> 
             </span><span class="o">!</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"^[XZ]"</span><span class="p">,</span><span class="w"> </span><span class="n">iso2c</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
             </span><span class="n">iso2c</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"EU"</span><span class="p">,</span><span class="w"> </span><span class="s2">"V1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"V2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"V3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"V4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"OE"</span><span class="p">))))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">distinct</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">iso2c</span><span class="p">)</span><span class="w">


</span><span class="n">h2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">h</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">
  </span><span class="c1"># remove regions and groupings (which have ISO2 code beginning with Z or X</span><span class="w">
  </span><span class="c1"># but leave in 4 countries with real codes beginning Z or X)</span><span class="w">
  </span><span class="c1"># and also knock out some specific things like EU, OECD average, etc</span><span class="w">
  </span><span class="n">filter</span><span class="p">((</span><span class="n">iso2c</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ZW"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ZM"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ZA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"XK"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> 
            </span><span class="o">!</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"^[XZ]"</span><span class="p">,</span><span class="w"> </span><span class="n">iso2c</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
                </span><span class="n">iso2c</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"EU"</span><span class="p">,</span><span class="w"> </span><span class="s2">"V1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"V2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"V3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"V4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"OE"</span><span class="p">))))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">drop_na</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="c1"># originally i picked the latest year for each country, but in so many</span><span class="w">
  </span><span class="c1"># cases it was 2021 I decided to just force it to be 2021</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2021</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w">

</span><span class="c1"># going ot use this model to identify 'outlier' countries worth labelling</span><span class="w">
</span><span class="n">mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">life_exp</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">health_spend</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h2</span><span class="p">)</span><span class="w">

</span><span class="c1"># add the residuals of hte model and label any countries not from 2021 (this</span><span class="w">
</span><span class="c1"># label change was more necessary when I had multiple years in the data, but</span><span class="w">
</span><span class="c1"># I've left it in for future reference)</span><span class="w">
</span><span class="n">h3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">h2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">mod</span><span class="p">)),</span><span class="w">
         </span><span class="n">country_yr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2021</span><span class="p">,</span><span class="w"> 
                             </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"{country}, {year}"</span><span class="p">)))</span><span class="w">

</span><span class="c1"># Draw scatter plot</span><span class="w">
</span><span class="n">h3</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">health_spend</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">life_exp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lightgreen"</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># label some interesting countries:</span><span class="w">
  </span><span class="n">geom_text_repel</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> 
                    </span><span class="n">filter</span><span class="p">(</span><span class="n">h3</span><span class="p">,</span><span class="w">
                           </span><span class="n">health_spend</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">8500</span><span class="w"> </span><span class="o">|</span><span class="w"> 
                             </span><span class="n">life_exp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">84</span><span class="w"> </span><span class="o">|</span><span class="w"> 
                             </span><span class="n">life_exp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">55</span><span class="w"> </span><span class="o">|</span><span class="w">
                             </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">-10</span><span class="w"> </span><span class="o">|</span><span class="w">
                             </span><span class="n">res</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w">
                  </span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country_yr</span><span class="p">,</span><span class="w">
                      </span><span class="c1"># annoying ggrepel couldn't put Norway in a good position automatically</span><span class="w">
                      </span><span class="c1"># so I am going to move it ad hoc:</span><span class="w">
                      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Norway"</span><span class="p">,</span><span class="w"> </span><span class="n">health_spend</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1.189</span><span class="p">,</span><span class="w"> </span><span class="n">health_spend</span><span class="p">)),</span><span class="w">
                  </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">,</span><span class="w"> 
                  </span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">125</span><span class="p">,</span><span class="w">
                  </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_log10</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dollar</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Health expenditure per capita (US dollars, logarithmic scale)"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Life expectancy"</span><span class="p">,</span><span class="w">
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Health expenditure is associated with higher life expectancy"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"USA is a high income outlier, but many poorer countries also have poor life expectancy given health spend per person."</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: data for 2021 from the World Development Indicators; analysis by freerangestats.info"</span><span class="p">)</span></code></pre></figure>

<p>Probably the only noteworthy thing in that code was that I explicitly fit a model of expected life expectancy given a level of health spending, purely to use the residuals from that model to identify outliers to draw on the chart. An interesting example of a model servicing a visualisation rather than the other way around.</p>

<h3 id="wrangling-cause-of-death-data-and-metadata-and-drawing-the-cause-of-death-plots">Wrangling cause of death data and metadata and drawing the cause of death plots</h3>

<p>Next, how did I get the data for the cause of death from the OECD? It’s all available in OECD.Stat, and you can use the <a href="https://data-explorer.oecd.org/vis?_ga=2.241262853.682686041.1734140631-789640812.1734140631&amp;tm=cause%20of%20death&amp;pg=0&amp;snb=13&amp;df[ds]=dsDisseminateFinalDMZ&amp;df[id]=DSD_HEALTH_STAT%40DF_COM&amp;df[ag]=OECD.ELS.HD&amp;df[vs]=1.0&amp;dq=.A......_T.STANDARD....&amp;pd=2015%2C&amp;to[TIME_PERIOD]=false">Data Explorer</a> to find the data you want. Once there you can use the ‘Developer API’ button to get a link to both the metadata and the data itself. We need the metadata in this case because the data download just has codes for cause of death, and we want the full names.</p>

<p>The meta data is extensive and comes in the form of a complex nested XML object, in SDMX format. We use this at my work but I personally am not an expert so there was a bit of fiddling to find and extract the codelists that I wanted.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#===============Part 2 - comparing various cause of death numbers=========</span><span class="w">

</span><span class="c1">#--------------metadata for causes of death------------------</span><span class="w">
</span><span class="n">md</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readSDMX</span><span class="p">(</span><span class="s2">"https://sdmx.oecd.org/public/rest/dataflow/OECD.ELS.HD/DSD_HEALTH_STAT@DF_COM/1.0?references=all"</span><span class="p">)</span><span class="w">

</span><span class="c1"># English names for each of the code lists</span><span class="w">
</span><span class="n">sapply</span><span class="p">(</span><span class="n">md</span><span class="o">@</span><span class="n">codelists</span><span class="o">@</span><span class="n">codelists</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="o">@</span><span class="n">Name</span><span class="o">$</span><span class="n">en</span><span class="p">)</span><span class="w">
</span><span class="c1"># noting number 7 is Cause of death and 2 is area ie country</span></code></pre></figure>

<p>That last command extracts from the <code class="language-plaintext highlighter-rouge">md</code> S4 object (hold your breath): the English element from the <code class="language-plaintext highlighter-rouge">Name</code> slot from the <code class="language-plaintext highlighter-rouge">codelists</code> slot from the <code class="language-plaintext highlighter-rouge">codelists</code> slot (yes, that’s nested <code class="language-plaintext highlighter-rouge">codelists</code> slots). It gives us this list of the codelists available:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; sapply(md@codelists@codelists, \(x)x@Name$en)
 [1] "Codelist for age"                          
 [2] "Codelist for reference areas and geocoding"
 [3] "Codelist for concept \"Sex\""              
 [4] "Codelist for Unit of measure"              
 [5] "Codelist for calculation methodology"      
 [6] "Codelist for cancer site"                  
 [7] "Cause of death"                            
 [8] "Codelist for diseases"                     
 [9] "Gestation period threshold"                
[10] "Health status"                             
[11] "Codelist for health status measures"       
[12] "Socio-economic status"                     
[13] "Decimals"                                  
[14] "Code list for concept \"Frequency\""       
[15] "Observation Status"                        
[16] "Code list for the Unit Multiplier" 
</code></pre></div></div>
<p>I only need numbers 2 and 7, which I extracted in this hacky way:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="cd">#' convenience function for extracting codelists from sdmx metadata</span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="cd">#' This is not very robust but does the job for today</span><span class="w">
</span><span class="n">extract_codes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">description_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"description"</span><span class="p">){</span><span class="w">
  </span><span class="n">codes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">md</span><span class="o">@</span><span class="n">codelists</span><span class="o">@</span><span class="n">codelists</span><span class="p">[[</span><span class="n">id</span><span class="p">]]</span><span class="o">@</span><span class="n">Code</span><span class="w">
  </span><span class="n">lookup</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="o">@</span><span class="n">id</span><span class="p">),</span><span class="w"> 
         </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">unlist</span><span class="p">(</span><span class="n">x</span><span class="o">@</span><span class="n">name</span><span class="p">)))</span><span class="w">
  </span><span class="nf">names</span><span class="p">(</span><span class="n">lookup</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">description_name</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">lookup</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">cod_codes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extract_codes</span><span class="p">(</span><span class="n">md</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="s2">"cause_of_death"</span><span class="p">)</span><span class="w"> 
</span><span class="n">area_codes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extract_codes</span><span class="p">(</span><span class="n">md</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"country"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="c1"># country is still a list within a list so need to extract further</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="n">x</span><span class="p">[</span><span class="s1">'en'</span><span class="p">]}))</span><span class="w">
</span><span class="p">)</span></code></pre></figure>

<p>That gives me code-to-description lookup tables for both the cause of death and area (ie country) codes.</p>

<p>Now, the cause of death codes are hierarchical and some of them are parents of others. For example, tuberculosis is a subset of ‘Certain infectious and parasitic diseases’ and if you include them both you are in a sense double-counting. I decided for my purposes I only wanted the highest level codes. This must be encoded in the SDMX somewhere (because the OECD Data Explorer shows it correctly), but I couldn’t find it in the metadata. For example, the snippet below just returns all NAs for the <code class="language-plaintext highlighter-rouge">parentCode</code> slot in the metadata that I would have thought should indicate a parent when one existed (like for Tuberculosis).</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># the codeelists Code should have parentCode to show the hierarchical nature</span><span class="w">
</span><span class="c1"># of the cause of death codes, but it doesn't seem to be there</span><span class="w">
</span><span class="n">sapply</span><span class="p">(</span><span class="n">md</span><span class="o">@</span><span class="n">codelists</span><span class="o">@</span><span class="n">codelists</span><span class="p">[[</span><span class="m">7</span><span class="p">]]</span><span class="o">@</span><span class="n">Code</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="o">@</span><span class="n">parentCode</span><span class="p">)</span></code></pre></figure>

<p>In the end I had to make by hand a vector of the highest level codes, by printing to the console all the codes we had and eliminating the ones that the Data Explorer showed me were children of others:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># you are meant to be able to get parent codes from this but they all look to be</span><span class="w">
</span><span class="c1"># NA (see above( so I couldn't see how to do this. So instead I've made a list</span><span class="w">
</span><span class="c1"># by hand of all those at the top level of hte classification</span><span class="w">
</span><span class="n">high_level_cod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">
  </span><span class="s2">"Certain infectious and parasitic diseases"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Neoplasms"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Diseases of the blood and blood-forming organs"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Endocrine, nutritional and metabolic diseases"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Mental and behavioural disorders"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Diseases of the nervous system"</span><span class="w"> </span><span class="p">,</span><span class="w">
  </span><span class="s2">"Diseases of the respiratory system"</span><span class="w"> </span><span class="p">,</span><span class="w">
  </span><span class="s2">"Diseases of the circulatory system"</span><span class="w"> </span><span class="p">,</span><span class="w">
  </span><span class="s2">"Diseases of the digestive system"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Diseases of the skin and subcutaneous tissue"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Diseases of the musculoskeletal system and connective tissue"</span><span class="w"> </span><span class="p">,</span><span class="w">
  </span><span class="s2">"Diseases of the genitourinary system"</span><span class="w">  </span><span class="p">,</span><span class="w">
  </span><span class="s2">"Certain conditions originating in the perinatal period"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Congenital malformations, deformations and chromosomal abnormalities"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Symptoms, signs, ill-defined causes"</span><span class="w"> </span><span class="p">,</span><span class="w">
  </span><span class="s2">"External causes of mortality"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Codes for special purposes: COVID-19"</span><span class="w"> 
</span><span class="p">)</span></code></pre></figure>

<p>OK, so now we can import the data, and join it to the codelist looks I made earlier:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># The actual death rates (standardised by age)</span><span class="w">
</span><span class="n">death_rates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readSDMX</span><span class="p">(</span><span class="s2">"https://sdmx.oecd.org/public/rest/data/OECD.ELS.HD,DSD_HEALTH_STAT@DF_COM,1.0/.A..DT_10P5HB.._T...STANDARD....?startPeriod=2015&amp;dimensionAtObservation=AllDimensions"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">as_tibble</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">clean_names</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">cod_codes</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"death_cause"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"code"</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">area_codes</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ref_area"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"code"</span><span class="p">))</span></code></pre></figure>

<p>It took me a while but I realised eventually I had a challenge that not all countries had data for all years. The first few versions of charts I drew were misleading in comparing (for example) countries with data only up to 2019 with countries like the USA that had data up to 2021, or Australia which has data to 2022. In a stable time when cause of death doesn’t change much year by year this might not matter, but that doesn’t describe the 2020s! My mistake made it look like the USA was worse relatively speaking in terms of Covid-19 deaths than they actually are. Here’s some summaries of how many countries have data each year:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; # A problem, its different sets of countries for each year
&gt; count(death_rates, time_period)
# A tibble: 8 × 2
  time_period     n
  &lt;chr&gt;       &lt;int&gt;
1 2015         2144
2 2016         2154
3 2017         2059
4 2018         2057
5 2019         2047
6 2020         1908
7 2021         1414
8 2022          439
&gt; 
&gt; death_rates |&gt;
+   count(country, time_period) |&gt;
+   count(country, sort = TRUE, name = "number_years") |&gt;
+   count(number_years, name = "number_countries")
# A tibble: 6 × 2
  number_years number_countries
         &lt;int&gt;            &lt;int&gt;
1            2                3
2            4                1
3            5                3
4            6               11
5            7               19
6            8                9
&gt; 
&gt; death_rates |&gt;
+   count(country, time_period) |&gt;
+   count(time_period, sort = TRUE, name = "number_countries") 
# A tibble: 8 × 2
  time_period number_countries
  &lt;chr&gt;                  &lt;int&gt;
1 2015                      45
2 2016                      45
3 2017                      43
4 2018                      43
5 2019                      43
6 2020                      39
7 2021                      29
8 2022                       9
</code></pre></div></div>
<p>Some countries have as few as 2 years of data (noting that I set 2015 as the starting point myself); most have 6 or 7.</p>

<p>OK, so once I’d recovered from that fishhook, and had a bit of trial and error with drawing charts, I eventually put all my code doing this into this single-analysis (ie not portable, only for use in this script) function. You can see it takes arguments for the years being used, which countries to compare to, and different ways of colouring the bars. I only ended up using the version that colours them according to the all-country average value because that seemed to me to give extra information for minimal extra visual clutter; but the alternative is ok too.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="cd">#' Draw a bar chart for one country showing its death rates in comparison to an average</span><span class="w">
</span><span class="n">bar_one_country</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">the_country</span><span class="p">,</span><span class="w"> 
                            </span><span class="n">comparison_countries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w">
                            </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w">
                            </span><span class="n">st_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">120</span><span class="p">,</span><span class="w">
                            </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2017</span><span class="o">:</span><span class="m">2019</span><span class="p">,</span><span class="w">
                            </span><span class="n">bar_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"country_average"</span><span class="p">,</span><span class="w"> </span><span class="s2">"this_country"</span><span class="p">)){</span><span class="w">
  
  </span><span class="n">bar_fill</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">match.arg</span><span class="p">(</span><span class="n">bar_fill</span><span class="p">)</span><span class="w">
  
  </span><span class="n">death_rates2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">death_rates</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">time_period</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">years</span><span class="p">)</span><span class="w">
  
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">the_country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">death_rates2</span><span class="o">$</span><span class="n">country</span><span class="p">){</span><span class="w">
    </span><span class="n">stop</span><span class="p">(</span><span class="n">glue</span><span class="p">(</span><span class="s2">"Could not find {the_country} in {paste(years, collapse = ', ')}"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  
  
  </span><span class="k">if</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">comparison_countries</span><span class="p">)){</span><span class="w">
    
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">check</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">comparison_countries</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">death_rates2</span><span class="o">$</span><span class="n">country</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">all</span><span class="p">(</span><span class="n">check</span><span class="p">)){</span><span class="w">
      </span><span class="n">warning</span><span class="p">(</span><span class="n">glue</span><span class="p">(</span><span class="s2">"Could not find {pastec(comparison_countries[!check])}"</span><span class="p">))</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="n">death_rates2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">death_rates2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
      </span><span class="n">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">the_country</span><span class="p">,</span><span class="w"> </span><span class="n">comparison_countries</span><span class="p">))</span><span class="w">
    
    </span><span class="k">if</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">subtitle</span><span class="p">)){</span><span class="w">
      </span><span class="n">subtitle</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"Comparison: {pastec(comparison_countries[check])}"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  

  
  </span><span class="c1"># some countries won't have data for all years</span><span class="w">
  </span><span class="n">bad_countries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">death_rates2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">time_period</span><span class="p">)</span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">years</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">pull</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w">
  
  </span><span class="k">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">bad_countries</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">){</span><span class="w">
    </span><span class="n">warning</span><span class="p">(</span><span class="n">glue</span><span class="p">(</span><span class="s2">"Dropping {pastec(bad_countries)} as missing some years"</span><span class="p">))</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">the_country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">bad_countries</span><span class="p">){</span><span class="w">
      </span><span class="n">stop</span><span class="p">(</span><span class="s2">"This is fatal for drawing this graph..."</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="n">death_rates2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">death_rates2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
      </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">bad_countries</span><span class="p">)</span><span class="w">
    
    </span><span class="n">comparison_countries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">comparison_countries</span><span class="p">[</span><span class="o">!</span><span class="n">comparison_countries</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">bad_countries</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  
  </span><span class="n">one_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">death_rates2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">cause_of_death</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">high_level_cod</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">cause_of_death</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w">
      </span><span class="n">cause_of_death</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Diseases of the nervous system"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"Diseases of the nervous system (includes Alzheimer's and Parkinson's)"</span><span class="p">,</span><span class="w">
      </span><span class="n">cause_of_death</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Mental and behavioural disorders"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"Mental and behavioural disorders (includes Dementia)"</span><span class="p">,</span><span class="w">
      </span><span class="n">cause_of_death</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"External causes of mortality"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"External causes of mortality (includes accidents, assaults and self-harm)"</span><span class="p">,</span><span class="w">
      </span><span class="n">cause_of_death</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Neoplasms"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"Neoplasms (eg cancer)"</span><span class="p">,</span><span class="w">
      </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">cause_of_death</span><span class="w">
    </span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">cause_of_death</span><span class="p">,</span><span class="w"> </span><span class="n">time_period</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="s1">'country_average'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">obs_value</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">the_country</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">cause_of_death</span><span class="p">,</span><span class="w"> </span><span class="n">time_period</span><span class="p">,</span><span class="w"> </span><span class="n">one_country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_value</span><span class="p">,</span><span class="w"> </span><span class="s1">'country_average'</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">time_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">time_period</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">cause_of_death</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">str_wrap</span><span class="p">(</span><span class="n">cause_of_death</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">),</span><span class="w"> </span><span class="n">one_country</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">cause_of_death</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">comp_diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">one_country</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">country_average</span><span class="p">),</span><span class="w">
           </span><span class="n">country_average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">country_average</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">ungroup</span><span class="p">()</span><span class="w">
  
  </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">one_wide</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">distinct</span><span class="p">(</span><span class="n">cause_of_death</span><span class="p">,</span><span class="w"> </span><span class="n">comp_diff</span><span class="p">,</span><span class="w"> </span><span class="n">country_average</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">cause_of_death</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">str_wrap</span><span class="p">(</span><span class="n">cause_of_death</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">),</span><span class="w"> </span><span class="n">comp_diff</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comp_diff</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cause_of_death</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_fill_viridis_c</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"Age standardised deaths per 100,000 in {the_country} compared to unweighted average of {length(unique(death_rates2$country))} countries"</span><span class="p">),</span><span class="w">
         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
         </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: OECD. Analysis by freerangestats.info"</span><span class="p">,</span><span class="w">
         </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"Where do extra deaths in {the_country} come from in {pastec(years)}?"</span><span class="p">),</span><span class="w">
         </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_wrap</span><span class="p">(</span><span class="n">subtitle</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">st_width</span><span class="p">))</span><span class="w">
  
  </span><span class="k">if</span><span class="p">(</span><span class="n">bar_fill</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"this_country"</span><span class="p">){</span><span class="w">
    </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">geom_col</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comp_diff</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">labs</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"Rate in {the_country}"</span><span class="p">))</span><span class="w">
    
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">geom_col</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country_average</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">labs</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"All-country average"</span><span class="p">)</span><span class="w">
    
  </span><span class="p">}</span><span class="w">
  
  </span><span class="nf">return</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>Now that I’ve got a function to draw a chart for one country’s cause of death in a given subset of years, compared to the other countries that all also have data for that subset of years, I’m able to start producing graphs! Here’s the first one I actually made, even though I haven’t highlighted it in the “Overview” part of this post. USA 2017 to 2019, compared to all countries available:</p>

<object type="image/svg+xml" data="/img/0285-us-1719.svg" width="100%"><img src="/img/0285-us-1719.png" width="100%" /></object>

<p>The difference between this and the one I used in the overview is the comparison to all countries available, not just those with higher life expectancy than the USA which I’ll come to later. I think this makes it a bit less useful for the purpose of our fundamental question which is “what is wrong with the USA”, although the results aren’t radically different.</p>

<p>I also looked at the USA in 2021, during the time of Covid-19:</p>

<object type="image/svg+xml" data="/img/0285-us-21.svg" width="100%"><img src="/img/0285-us-21.png" width="100%" /></object>

<p>We see that for this period at least, the USA experienced a lower death rate from Covid-19 than other countries were.</p>

<p>Those two USA-compared-to-all-countries charts were just made with these short snippets of code:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">bar_one_country</span><span class="p">(</span><span class="s2">"United States"</span><span class="p">,</span><span class="w"> </span><span class="n">bar_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"country_average"</span><span class="p">,</span><span class="w">
                </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Comparison to all countries with available cause of death rates."</span><span class="p">)</span><span class="w">

</span><span class="n">bar_one_country</span><span class="p">(</span><span class="s2">"United States"</span><span class="p">,</span><span class="w"> </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2021</span><span class="p">,</span><span class="w"> 
                </span><span class="n">comparison_countries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">death_rates</span><span class="o">$</span><span class="n">country</span><span class="p">))</span></code></pre></figure>

<p>To draw the PDFs with one page per country, I made use of the fact that each time you print a new chart to an open PDF device it adds a page, making this a very quick and easy way to store all the charts available with some combination of parameters:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Cairo</span><span class="o">::</span><span class="n">CairoPDF</span><span class="p">(</span><span class="s2">"0285-all-countries-2017-2019.pdf"</span><span class="p">,</span><span class="w"> 
                </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cause of deaths 2017-2019"</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">tc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">death_rates</span><span class="o">$</span><span class="n">country</span><span class="p">))){</span><span class="w">
  </span><span class="n">try</span><span class="p">(</span><span class="n">print</span><span class="p">(</span><span class="n">bar_one_country</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span><span class="w"> </span><span class="n">bar_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"country_average"</span><span class="p">)))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">

</span><span class="n">Cairo</span><span class="o">::</span><span class="n">CairoPDF</span><span class="p">(</span><span class="s2">"0285-all-countries-2021.pdf"</span><span class="p">,</span><span class="w"> 
                </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cause of deaths 2021"</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">tc</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">death_rates</span><span class="o">$</span><span class="n">country</span><span class="p">))){</span><span class="w">
  </span><span class="n">try</span><span class="p">(</span><span class="n">print</span><span class="p">(</span><span class="n">bar_one_country</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span><span class="w"> </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2021</span><span class="p">,</span><span class="w"> </span><span class="n">bar_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"country_average"</span><span class="p">)))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span></code></pre></figure>

<p>For comparsions with just those countries that had better life expectancy than the USA, I went back to my data for that life expectancy scatter plot and extracted the countries from there. One of them (South Korea) needed to have its name changed by hand to work with the OECD data. Once we have that vector of countries, the <code class="language-plaintext highlighter-rouge">bar_one_country()</code> function Just Works; here is the code to draw charts for the USA, Australia and Estonia at different times:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#----------comparisons with a smaller set of countries--------------</span><span class="w">

</span><span class="n">better_countries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">h2</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">life_exp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">h2</span><span class="p">[</span><span class="n">h2</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"United States"</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="o">$</span><span class="n">life_exp</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"Korea, Rep."</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="s2">"Korea"</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">pull</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w">

</span><span class="n">bar_one_country</span><span class="p">(</span><span class="s2">"United States"</span><span class="p">,</span><span class="w"> 
                </span><span class="n">comparison_countries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">better_countries</span><span class="p">,</span><span class="w"> 
                </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2017</span><span class="o">:</span><span class="m">2019</span><span class="p">)</span><span class="w">

</span><span class="n">bar_one_country</span><span class="p">(</span><span class="s2">"United States"</span><span class="p">,</span><span class="w"> 
                </span><span class="n">comparison_countries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">better_countries</span><span class="p">,</span><span class="w"> 
                </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2021</span><span class="p">)</span><span class="w">

</span><span class="n">bar_one_country</span><span class="p">(</span><span class="s2">"Australia"</span><span class="p">,</span><span class="w"> 
                </span><span class="n">comparison_countries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">better_countries</span><span class="p">,</span><span class="w"> 
                </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2022</span><span class="p">)</span><span class="w">

</span><span class="n">bar_one_country</span><span class="p">(</span><span class="s2">"Estonia"</span><span class="p">,</span><span class="w"> 
                </span><span class="n">comparison_countries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">better_countries</span><span class="p">,</span><span class="w"> 
                </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2022</span><span class="p">)</span></code></pre></figure>

<p>And here are the three charts (the United States 2017 to 2019 chart has already been shown in the ‘Overview’ section of this blog):</p>

<object type="image/svg+xml" data="/img/0285-us-21-lim.svg" width="100%"><img src="/img/0285-us-21-lim.png" width="100%" /></object>

<object type="image/svg+xml" data="/img/0285-aus-22-lim.svg" width="100%"><img src="/img/0285-aus-22-lim.png" width="100%" /></object>

<object type="image/svg+xml" data="/img/0285-est-22-lim.svg" width="100%"><img src="/img/0285-est-22-lim.png" width="100%" /></object>

<p>Australia’s highest relative cause of death being ‘endocrine, nutritional and metabolic diseases’ (eg diabetes), and with relatively low death rate from circulatory diseases.</p>

<p>Estonia in stark contrast having a very high death rate from circulatory disease, compared to these particular high-life-expectancy countries.</p>

<h3 id="which-causes-are-associated-with-which-countries">Which causes are associated with which countries?</h3>

<p>Finally, I also scratched my curiousity itch on whether principal components analysis and visualisations could help create and communicate a sense of which countries are associated with which cause of death. This blog post is already very long so I won’t go into much detail on this. I’ll just say that the changing country availability by year was again a fishhook, and the main visualisaiton problem was the long names of the causes of death. In the end, I had to hide most of the labels of causes of death other than those that really made a contribution to the variation in the first two principal components.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#-----------biplot--------</span><span class="w">

</span><span class="n">cod_biplot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">years</span><span class="p">,</span><span class="w"> </span><span class="n">cod_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">,</span><span class="w"> </span><span class="n">min_loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">){</span><span class="w">
  </span><span class="n">all_countries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">death_rates</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">cause_of_death</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">high_level_cod</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
             </span><span class="n">time_period</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">years</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">cause_of_death</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">summarise</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">obs_value</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">spread</span><span class="p">(</span><span class="n">cause_of_death</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
  
  </span><span class="n">all_countries_m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">all_countries</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="m">-1</span><span class="p">])</span><span class="w">
  </span><span class="c1"># decided not to scale the countries, but it wouldn't be insane; here's how to do it:</span><span class="w">
  </span><span class="c1">#all_countries_m &lt;- t(scale(t(all_countries_m)))</span><span class="w">
  
  </span><span class="n">row.names</span><span class="p">(</span><span class="n">all_countries_m</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pull</span><span class="p">(</span><span class="n">all_countries</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">all_countries_m</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"Diseases of the "</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">all_countries_m</span><span class="p">))</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">all_countries_m</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"Certain "</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">all_countries_m</span><span class="p">))</span><span class="w">
  </span><span class="c1">#colnames(all_countries_m) &lt;- gsub(" system", "", colnames(all_countries_m))</span><span class="w">
  
  </span><span class="n">pc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">princomp</span><span class="p">(</span><span class="n">all_countries_m</span><span class="p">)</span><span class="w">
  </span><span class="n">select_cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">loadings</span><span class="p">(</span><span class="n">pc</span><span class="p">)[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">as_tibble</span><span class="p">()</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">cn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row.names</span><span class="p">(</span><span class="n">loadings</span><span class="p">(</span><span class="n">pc</span><span class="p">)[,</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">cn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">Comp.1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">min_loading</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">Comp.2</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">min_loading</span><span class="p">,</span><span class="w"> </span><span class="n">cn</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">pull</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="w">
  
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">all_countries_m</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select_cols</span><span class="w">
  </span><span class="n">pc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">princomp</span><span class="p">(</span><span class="n">all_countries_m</span><span class="p">)</span><span class="w">
  
  
  </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggbiplot</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row.names</span><span class="p">(</span><span class="n">all_countries_m</span><span class="p">),</span><span class="w">
           </span><span class="n">varname.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cod_col</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glue</span><span class="p">(</span><span class="s2">"Cause of death by country: {pastec(years)}"</span><span class="p">))</span><span class="w">
  
  </span><span class="nf">return</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">cod_biplot</span><span class="p">(</span><span class="m">2017</span><span class="o">:</span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="n">min_loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w">
</span><span class="n">cod_biplot</span><span class="p">(</span><span class="m">2020</span><span class="p">,</span><span class="w"> </span><span class="n">min_loading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w">
</span><span class="n">cod_biplot</span><span class="p">(</span><span class="m">2021</span><span class="p">)</span></code></pre></figure>

<p>Here are the three charts drawn by that code, each one representing a different time period.</p>

<object type="image/svg+xml" data="/img/0285-biplot-1719.svg" width="100%"><img src="/img/0285-biplot-1719.png" width="100%" /></object>

<object type="image/svg+xml" data="/img/0285-biplot-20.svg" width="100%"><img src="/img/0285-biplot-20.png" width="100%" /></object>

<object type="image/svg+xml" data="/img/0285-biplot-21.svg" width="100%"><img src="/img/0285-biplot-21.png" width="100%" /></object>

<p>It never pays to overthink a biplot. Just go with the flow and interpret them intuitively.</p>

<p>Do these plots help? I think they do a bit. For example, it helps to see in a single chart - say, the one for 2017 to 2019 - the eastern European countries associated with circulatory system diseases, and Latin America and others with diabetes; cancer in the Balkans.</p>

<p>That’s all for now. Hopefully this helps at least someone understand the variation in cause of death across countries, and how the USA lowish life expectancy is a more complex phenomenon than just being the fault of its health insurance industry.</p>



		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2024/11/30/ponzi-schemes">Simulating Ponzi schemes</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2024/12/23/depression-and-vote">Depression incidence by county and vote for Trump</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<p>Find me on <a rel="me" href="https://bsky.app/profile/freerangestats.info">Bluesky</a> or <a rel="me" href="https://mastodon.social/@peter_ellis">Mastodon</a>.</p>
			<hr></hr>
			
			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>