      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Simulating Persian Monarchs gameplay</title>
      	
         
         
            <meta name ="description" content ="Persian Monarchs described by P. G. Wodehouse in one of his funniest novels is an extremely simple fictional card game, but the gambling makes it a game of skill, and we can even construct plausible different strategies for winning. A good strategy involving card-counting beats a non-counting alternative by about 4% and random wagering by 36%.">
            <meta property="og:description" content ="Persian Monarchs described by P. G. Wodehouse in one of his funniest novels is an extremely simple fictional card game, but the gambling makes it a game of skill, and we can even construct plausible different strategies for winning. A good strategy involving card-counting beats a non-counting alternative by about 4% and random wagering by 36%.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Simulating Persian Monarchs gameplay" />
         
            <meta property="og:image" content="https:/freerangestats.info/img/0135-density.png" />
         
		 
			<meta property="og:url" content="https://freerangestats.info/blog/2018/12/23/persian-monarchs.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2024/09/14/stepwise>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Simulating Persian Monarchs gameplay</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>Persian Monarchs described by P. G. Wodehouse in one of his funniest novels is an extremely simple fictional card game, but the gambling makes it a game of skill, and we can even construct plausible different strategies for winning. A good strategy involving card-counting beats a non-counting alternative by about 4% and random wagering by 36%.</p>
	   <p class="meta">23 Dec 2018</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="i-can-teach-you-in-a-minute">‘I can teach you in a minute…’</h2>

<p>In a <a href="/blog/2018/10/27/dice-games">recent post I simulated some simple dice games</a> and promised (or threatened) that this was the first of a series of posts about games of combined luck and chance. The main aim of that post was to show how even simple probabilistic games can become complicated with tweaks to the rules, but I also mentioned a key concept that “any game of chance can be converted to a complex game of skill by adding gambling”.</p>

<p>Now I want to explore this last idea further with the fictional game Persian Monarchs. As far as I can tell, this game was invented by P. G. Wodehouse for his classic 1939 comedic novel <a href="https://www.goodreads.com/book/show/13707721-uncle-fred-in-the-springtime">Uncle Fred in the Springtime</a>, surely a front runner for some of the best humorous writing of the twentieth century. Wodehouse was in true mid-season form with this, his first full length novel featuring “<a href="https://en.wikipedia.org/wiki/Uncle_Fred">Uncle Fred</a>” (Frederick Altamont Cornwallis Twistleton, 5th Earl of Ickenham); before much of his work became tired and formulaic in the post-WWII years.</p>

<p>The plot of the novel is complex and not really to the point for a statistics blog, so do yourself a favour and read it for yourself in your own time. But for our purposes, it’s important to know that several of the key plot twists revolve around substantial sums of money gambled on Persian Monarchs, described by one character thus:</p>

<blockquote>
  <p>‘I could teach it you in a minute. In its essentials it is not unlike Blind Hooky. Here’s the way it goes. You cut a card, if you see what I mean, and the other fellow cuts a card, if you follow me. Then if the card you’ve cut is higher than the card the other fellow has cut, you win. While, conversely, if the card the other fellow’s cut is higher than the card you’ve cut, he wins.’</p>
</blockquote>

<blockquote>
  <p>He shot an anxious glance at Mr Pott, as if wondering if he had been too abstruse. But Mr Pott appeared to have followed him perfectly.</p>
</blockquote>

<blockquote>
  <p>‘I think I see the idea,’ he said. ‘Anyway, I’ll pick it up as I go along.’</p>
</blockquote>

<p>Claude Eustace ‘Mustard’ Pott - the “Mr Pott” in the quotation above - is actually a Persian Monarchs player of considerable accomplishment; in addition to being a former silver ring bookie and Shakespearan actor, and current private detective and part time card hustler. So having a not-too-bright but rich and friendly representative of the upper classes explain his own favourite game to him is as close to heaven as he gets.</p>

<p>It’s not clear from the novel whether Mr Pott (or, later, the Duke of Dunstable, who also shows himself to be a master of cardplay) win at Persian Monarchs through superior skill or through outright cheating. There are indications both ways. For my purposes, I’m going to put aside the question of cheating and consider how it’s possible for skill to shine through in such a simple game.</p>

<p>It all comes down to the addition of choices about offering and accepting wagers. As the gambling rules around Persian Monarchs are not described by Wodehouse, I’m going to assume that it’s something like the following:</p>

<ul>
  <li>each player contributes one counter (or other gambling unit) at the beginning of a hand to a combined stake, before receiving their card;</li>
  <li>after seeing their card, the non-dealer has the option of raising the wager by an extra amount, up to some specified limit (10 in my simulations below), but by zero if they wish. The dealer then has to either cover the increased wager, or decline on the spot in which case the non-dealer wins the existing stake in full regardless of who has the higher cards;</li>
  <li>if the dealer has covered the extra wager, whomever has the highest card wins and collects the entire stake.</li>
</ul>

<p>I’m also going to assume that once a hand is finished, those cards are put aside and the next hand proceeds with a reduced pack; until the pack is finished at which point the cards are all brought together and reshuffled.</p>

<p>To skip to the chase, here are the results of simulations of three different strategies at Persian Monarchs:</p>

<ul>
  <li>choosing to offer or accept extra wagers completely at random;</li>
  <li>offering or accepting wagers partly at random (in order to avoid being predictable and easy to bluff) but with probabilities aimed at delivering optimal results in the long run, taking into account which cards have so far appeared;</li>
  <li>as above, but without bothering to count the cards that have already appeared and been discarded, so basing choices on general probabilities about one’s card relative to a complete pack.</li>
</ul>

<p><img src="/img/0135-density.svg" width="100%" /></p>

<p>At the end of a game that goes through two whole packs of cards, the optimal strategy outperforms the non-card-counting by between 3.8 to 5.3 counters; and the random strategy by 35 to 37 counters. So skill counts big time. Even the marginal advantage given by counting the cards and adjusting one’s strategy accordingly makes a 4% difference in your rate of return.</p>

<h3 id="optimal-strategy">‘Optimal’ strategy?</h3>

<p>For what I’ve defined as the optimal strategy (without either proof or adequate demonstration by simulation), the non-dealer’s wager-offering algorithm is as follows:</p>

<ul>
  <li>First choose whether to offer an increased wager or not. Do this at random, with a ‘probability of offering more’ equal to the estimated probability that the card I’ve got is higher than a random card from the pack.</li>
  <li>Having decided to offer an increased wager, pick a random number between 1 and 10 to increase the wager by that.</li>
</ul>

<p>The decision of whether to accept or not is taken similarly.</p>

<p>The trick in constructing a decision rule here is that we want to avoid being predictable to our opponent. For example, if we only offered an increased wager when we had one of the top 50% cards in the pack, we have ruled out any bluffing, and once our opponent picks this up they can use it to their advantage. Similarly, if we increase the wager by more depending on our confidence, we are giving away information. So we want a compromise between strict determination and a bit of randomness always present (even if I draw the Queen of spades I might decline an increased wager, or with the 3 of clubs I might offer to increase the stake, albeit at low probability), with your opponent not quite sure where you’re coming from - let’s call it the ‘<a href="https://en.wikipedia.org/wiki/Madman_theory">madman strategy</a> of Persian Monarchs’.</p>

<h2 id="writing-a-card-game-in-r">Writing a card game in R</h2>

<p>How did I implement all this?</p>

<p>First, I defined a few convenience objects and functions.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pack</code> is a data frame of 52 rows with the value and suit of all the cards in a standard pack of cards, with precedence in order as per Bridge;</li>
  <li><code class="language-plaintext highlighter-rouge">pm_draw</code> is a function that, given an existing (possibly incomplete) pack of cards, returns a drawn card and the remaining pack as two elements of a list:</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span><span class="w">

</span><span class="cd">#' Define a starting full pack of cards. In sequence as per Bridge ie Ace of Spades highest, Two of Clubs lowest.</span><span class="w">
</span><span class="n">pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_frame</span><span class="p">(</span><span class="w">
  </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">52</span><span class="p">,</span><span class="w">
  </span><span class="n">suit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"clubs"</span><span class="p">,</span><span class="w"> </span><span class="s2">"diamonds"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hearts"</span><span class="p">,</span><span class="w"> </span><span class="s2">"spades"</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">13</span><span class="p">),</span><span class="w">
  </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="s2">"Jack"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Queen"</span><span class="p">,</span><span class="w"> </span><span class="s2">"King"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ace"</span><span class="p">),</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="s2">"of"</span><span class="p">,</span><span class="w"> </span><span class="n">suit</span><span class="p">))</span><span class="w">

</span><span class="n">full_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pack</span><span class="w">

</span><span class="cd">#' For a given pack (not necessarily a full one), pull out one card, and return</span><span class="w">
</span><span class="cd">#' that card and the remaining pack (as a list with two elements)</span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="cd">#' @param pack a dataframe with such as that defined by `pack`, with at least</span><span class="w">
</span><span class="cd">#' a column named `id`</span><span class="w">
</span><span class="n">pm_draw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">pack</span><span class="p">){</span><span class="w">
  </span><span class="n">drawn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample_n</span><span class="p">(</span><span class="n">pack</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">remaining_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pack</span><span class="p">[</span><span class="n">pack</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">drawn</span><span class="o">$</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">drawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">drawn</span><span class="p">,</span><span class="w"> </span><span class="n">remaining_pack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">remaining_pack</span><span class="p">))</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>Then the workhorse of the whole project comes in the next function, <code class="language-plaintext highlighter-rouge">pm_hand</code>, which plays a single hand of Persian Monarchs with two players. The wagering strategy can be “auto” (the best strategy I could think of), “ask” (a human gets asked to decide each wager decision) “random” and “non-card-counter”. In itself, this function is not much use, but it abstracts the work of a single hand of dealing, wagering, accepting and checking the result away from what is going to become the main loop of the game to ge defined later.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="cd">#' Play a hand of Persian Monarchs</span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="cd">#' @param p1_counters number of counters owned by player 1 (non-dealer) at beginning of hand</span><span class="w">
</span><span class="cd">#' @param p2_counters number of coutners owned by player 2 (dealer) at beginning of hand</span><span class="w">
</span><span class="cd">#' @known_pack pack at the beginning of the hand, 'known' by the players if they have been counting cards.</span><span class="w">
</span><span class="cd">#' @p1_method method for player 1 deciding whether to offer an increased wager</span><span class="w">
</span><span class="cd">#' @p2_method method for player 2 deciding whether to accept an offered increased wager</span><span class="w">
</span><span class="cd">#' @verbose Whether or not to print out extra information to console</span><span class="w">
</span><span class="cd">#' @p1_lab Label for player 1, used in messages to console</span><span class="w">
</span><span class="cd">#' @p2_lab Label for player 2, used in messages to console</span><span class="w">
</span><span class="cd">#' @max_wager Maximum additional wager to be offered by player 1</span><span class="w">
</span><span class="cd">#' @details Player 2 is the dealer and Player 1 gets the first choice - whether or not to offer an increased wager</span><span class="w">
</span><span class="cd">#' on top of the original wager of 1 counter, and if so how much to make that additional wager. Player 2 then gets</span><span class="w">
</span><span class="cd">#' to accept and cover that wager, of to fold and concede the current wager of 1 counter to Player 1.</span><span class="w">
</span><span class="n">pm_hand</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">p1_counters</span><span class="p">,</span><span class="w"> </span><span class="n">p2_counters</span><span class="p">,</span><span class="w"> </span><span class="n">known_pack</span><span class="p">,</span><span class="w">
                    </span><span class="n">p1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ask"</span><span class="p">,</span><span class="w"> </span><span class="s2">"random"</span><span class="p">,</span><span class="w"> </span><span class="s2">"non-card-counter"</span><span class="p">),</span><span class="w"> 
                    </span><span class="n">p2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ask"</span><span class="p">,</span><span class="w"> </span><span class="s2">"random"</span><span class="p">,</span><span class="w"> </span><span class="s2">"non-card-counter"</span><span class="p">),</span><span class="w">
                    </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                    </span><span class="n">p1_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Non-dealer"</span><span class="p">,</span><span class="w">
                    </span><span class="n">p2_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Dealer"</span><span class="p">,</span><span class="w">
                    </span><span class="n">max_wager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">){</span><span class="w">
  
  </span><span class="c1"># convenience function for printing a message to the console but substituting the correct label</span><span class="w">
  </span><span class="c1"># for p1 or p2 (player 1 or player 2):</span><span class="w">
  </span><span class="n">pm_cat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">txt</span><span class="p">){</span><span class="w">
    </span><span class="n">txt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"p1"</span><span class="p">,</span><span class="w"> </span><span class="n">p1_lab</span><span class="p">,</span><span class="w"> </span><span class="n">txt</span><span class="p">)</span><span class="w">
    </span><span class="n">txt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"p2"</span><span class="p">,</span><span class="w"> </span><span class="n">p2_lab</span><span class="p">,</span><span class="w"> </span><span class="n">txt</span><span class="p">)</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">){</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
  </span><span class="p">}</span><span class="w">
  
  </span><span class="n">p1_method</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">match.arg</span><span class="p">(</span><span class="n">p1_method</span><span class="p">)</span><span class="w">
  </span><span class="n">p2_method</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">match.arg</span><span class="p">(</span><span class="n">p2_method</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># Both players start by putting in one counter each just to start to play</span><span class="w">
  </span><span class="n">p1_counters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p1_counters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="w">
  </span><span class="n">p2_counters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p2_counters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="w">
  </span><span class="n">wagered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w">
  
  </span><span class="c1"># Draw a card each</span><span class="w">
  </span><span class="n">tmp1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm_draw</span><span class="p">(</span><span class="n">known_pack</span><span class="p">)</span><span class="w">
  </span><span class="n">tmp2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm_draw</span><span class="p">(</span><span class="n">tmp1</span><span class="o">$</span><span class="n">remaining_pack</span><span class="p">)</span><span class="w">
  </span><span class="n">p1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp1</span><span class="o">$</span><span class="n">drawn</span><span class="w">
  </span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp2</span><span class="o">$</span><span class="n">drawn</span><span class="w">
  
  </span><span class="c1"># The probabilities as they appear to the players:</span><span class="w">
  </span><span class="n">p1_chance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">known_pack</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p1</span><span class="o">$</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">known_pack</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">p2_chance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">known_pack</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p2</span><span class="o">$</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">known_pack</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># Decision - will p1 wager more?</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="n">p1_method</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"random"</span><span class="p">,</span><span class="w"> </span><span class="s2">"non-card-counter"</span><span class="p">)){</span><span class="w">
    </span><span class="c1"># If p1 is being rational, it's chance of increasing the wager comes from it's appreciation</span><span class="w">
    </span><span class="c1"># of the probability of winning this hand (more is 1 if increasing the wager, 0 otherwise).</span><span class="w">
    </span><span class="c1"># But if the method is random, then they choose at random</span><span class="w">
    </span><span class="n">chance_more</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w">
      </span><span class="n">p1_method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"auto"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">p1_chance</span><span class="p">,</span><span class="w"> 
      </span><span class="n">p1_method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"random"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
      </span><span class="n">p1_method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"non-card-counter"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">full_pack</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p1</span><span class="o">$</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">51</span><span class="w">
    </span><span class="p">)</span><span class="w">
    </span><span class="n">more</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbinom</span><span class="p">(</span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chance_more</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
    </span><span class="n">extra</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">max_wager</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">more</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">){</span><span class="w">
      </span><span class="n">pm_cat</span><span class="p">(</span><span class="s2">"p1 does not add to the initial wager.\n"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">pm_cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"You drew the "</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="o">$</span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="s2">". How much extra will you bet this hand?\n(maximum is "</span><span class="p">,</span><span class="w"> </span><span class="n">max_wager</span><span class="p">,</span><span class="w"> 
                    </span><span class="s2">", 0 is acceptable)"</span><span class="p">))</span><span class="w">
      </span><span class="n">extra</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-1</span><span class="w">
      </span><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">extra</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="n">max_wager</span><span class="p">){</span><span class="w">
        </span><span class="n">extra</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">readLines</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
        
      </span><span class="p">}</span><span class="w">
      </span><span class="n">more</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">extra</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
     
  </span><span class="p">}</span><span class="w">  
  
  </span><span class="k">if</span><span class="p">(</span><span class="n">more</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
    
    </span><span class="c1"># Decision - will p2 try to accept the increased wager?</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">p2_method</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"non-card-counter"</span><span class="p">)){</span><span class="w">
      </span><span class="n">p2_chance_enh</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w">
        </span><span class="n">p2_method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"auto"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">p2_chance</span><span class="p">,</span><span class="w">
        </span><span class="n">p2_method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"non-card-counter"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">full_pack</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p2</span><span class="o">$</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">51</span><span class="w">
      </span><span class="p">)</span><span class="w">
      </span><span class="n">p2_expected</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p2_chance_enh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">wagered</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p2_chance_enh</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">wagered</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
      </span><span class="n">accept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2_expected</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">wagered</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="k">if</span><span class="p">(</span><span class="n">p2_method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"ask"</span><span class="p">){</span><span class="w">
        </span><span class="n">pm_cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"You drew the "</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="o">$</span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="s2">". The other player raises the wager by "</span><span class="p">,</span><span class="w"> </span><span class="n">extra</span><span class="p">,</span><span class="w"> </span><span class="s2">". Do you accept? (Y/n)\n"</span><span class="p">))</span><span class="w">
        </span><span class="n">input</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">tolower</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="s2">"n"</span><span class="p">)){</span><span class="w">
          </span><span class="n">input</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readLines</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="n">accept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tolower</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"y"</span><span class="p">)</span><span class="w">
      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c1"># random acceptance:</span><span class="w">
        </span><span class="n">accept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.logical</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="k">if</span><span class="p">(</span><span class="n">accept</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">p2_counters</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">extra</span><span class="p">){</span><span class="w">
      </span><span class="c1"># the bet is on:</span><span class="w">
      </span><span class="n">p1_counters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p1_counters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">extra</span><span class="w">
      </span><span class="n">p2_counters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p2_counters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">extra</span><span class="w">
      </span><span class="n">wagered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">wagered</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w">
      </span><span class="n">pm_cat</span><span class="p">(</span><span class="s2">"p2 accepts the added wager.\n"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="c1"># or else, p2 gives up:</span><span class="w">
      </span><span class="n">p1_counters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p1_counters</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">wagered</span><span class="w">
      </span><span class="n">wagered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
      </span><span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">){</span><span class="w">
        </span><span class="n">pm_cat</span><span class="p">(</span><span class="s2">"p2 did not accept the added wager.\n"</span><span class="p">)</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
  </span><span class="p">}</span><span class="w">
  
  </span><span class="c1"># Who won?</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="n">p1</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">p2</span><span class="o">$</span><span class="n">id</span><span class="p">){</span><span class="w">
    </span><span class="n">p1_counters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p1_counters</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">wagered</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">){</span><span class="w">
      </span><span class="n">pm_cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">p1</span><span class="o">$</span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="s2">" beats "</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="o">$</span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="s2">"; p1 wins.\n"</span><span class="p">))</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">p2_counters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p2_counters</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">wagered</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">){</span><span class="w">
      </span><span class="n">pm_cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">p1</span><span class="o">$</span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="s2">" loses to "</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="o">$</span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="s2">"; p2 wins.\n"</span><span class="p">))</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
  </span><span class="p">}</span><span class="w">
  
  </span><span class="n">known_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp2</span><span class="o">$</span><span class="n">remaining_pack</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">known_pack</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">2</span><span class="p">){</span><span class="w">
    </span><span class="n">pm_cat</span><span class="p">(</span><span class="s2">"Getting a fresh pack of cards.\n"</span><span class="p">)</span><span class="w">
    </span><span class="n">known_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pack</span><span class="w">
  </span><span class="p">}</span><span class="w">
  
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="w">
    </span><span class="n">p1_counters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1_counters</span><span class="p">,</span><span class="w">
    </span><span class="n">p2_counters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2_counters</span><span class="p">,</span><span class="w">
    </span><span class="n">known_pack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">known_pack</span><span class="p">))</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>Having defined the functionality of a single hand, I then wrote a function for the main cycle of a game of user-specified rounds.  This is basically a wrapper around <code class="language-plaintext highlighter-rouge">pm_hand</code>, making it user-friendly for a player with sufficient messages to the console.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#-----------------------Human versus computer---------------------</span><span class="w">
</span><span class="cd">#' Play a human v computer game of Persian Monarchs</span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="cd">#' @param human number of chips human starts with</span><span class="w">
</span><span class="cd">#' @param computer number of chips computer starts with</span><span class="w">
</span><span class="cd">#' @param number of rounds to play (both players get a turn in a round)</span><span class="w">
</span><span class="n">persian_monarchs_hvc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">human</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">computer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">rounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">){</span><span class="w">
  </span><span class="n">start_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_frame</span><span class="p">(</span><span class="w">
    </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">52</span><span class="p">,</span><span class="w">
    </span><span class="n">suit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"clubs"</span><span class="p">,</span><span class="w"> </span><span class="s2">"diamonds"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hearts"</span><span class="p">,</span><span class="w"> </span><span class="s2">"spades"</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">13</span><span class="p">),</span><span class="w">
    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="s2">"Jack"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Queen"</span><span class="p">,</span><span class="w"> </span><span class="s2">"King"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ace"</span><span class="p">),</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="s2">"of"</span><span class="p">,</span><span class="w"> </span><span class="n">suit</span><span class="p">))</span><span class="w">
  
  </span><span class="n">known_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">start_pack</span><span class="w">
  
  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">rounds</span><span class="p">){</span><span class="w">

    </span><span class="c1"># Computer deals:</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Press enter for next hand.\n"</span><span class="p">)</span><span class="w">
      </span><span class="n">readLines</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    
    </span><span class="n">message</span><span class="p">(</span><span class="s2">"Computer's deal."</span><span class="p">)</span><span class="w">
    </span><span class="n">cp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm_hand</span><span class="p">(</span><span class="n">human</span><span class="p">,</span><span class="w">
                  </span><span class="n">computer</span><span class="p">,</span><span class="w">
                  </span><span class="n">known_pack</span><span class="p">,</span><span class="w">
                  </span><span class="n">p1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ask"</span><span class="p">,</span><span class="w">
                  </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                  </span><span class="n">p1_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Human"</span><span class="p">,</span><span class="w">
                  </span><span class="n">p2_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Computer"</span><span class="p">)</span><span class="w">
    </span><span class="n">human</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">p1_counters</span><span class="w">
    </span><span class="n">computer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">p2_counters</span><span class="w">
    </span><span class="n">known_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">known_pack</span><span class="w">
    
    </span><span class="n">cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"You have "</span><span class="p">,</span><span class="w"> </span><span class="n">human</span><span class="p">,</span><span class="w"> </span><span class="s2">" counters.\n"</span><span class="p">))</span><span class="w">
    </span><span class="n">cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"There are "</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">known_pack</span><span class="p">),</span><span class="w"> </span><span class="s2">" cards left in the pack.\n"</span><span class="p">))</span><span class="w">
    
    </span><span class="c1"># Human deals:</span><span class="w">
    </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Press enter for next hand.\n"</span><span class="p">)</span><span class="w">
    </span><span class="n">readLines</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
    
    </span><span class="n">message</span><span class="p">(</span><span class="s2">"Your deal."</span><span class="p">)</span><span class="w">
    </span><span class="n">cp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm_hand</span><span class="p">(</span><span class="n">computer</span><span class="p">,</span><span class="w">
                  </span><span class="n">human</span><span class="p">,</span><span class="w">
                  </span><span class="n">known_pack</span><span class="p">,</span><span class="w">
                  </span><span class="n">p2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ask"</span><span class="p">,</span><span class="w">
                  </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                  </span><span class="n">p1_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Computer"</span><span class="p">,</span><span class="w">
                  </span><span class="n">p2_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Human"</span><span class="p">)</span><span class="w">
    
    </span><span class="n">human</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">p2_counters</span><span class="w">
    </span><span class="n">computer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">p1_counters</span><span class="w">
    </span><span class="n">known_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">known_pack</span><span class="w">
    
    </span><span class="n">cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"You have "</span><span class="p">,</span><span class="w"> </span><span class="n">human</span><span class="p">,</span><span class="w"> </span><span class="s2">" counters.\n"</span><span class="p">))</span><span class="w">
    </span><span class="n">cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"There are "</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">known_pack</span><span class="p">),</span><span class="w"> </span><span class="s2">" cards left in the pack.\n"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Run an interactive game against the computer for three rounds</span><span class="w">
</span><span class="n">persian_monarchs_hvc</span><span class="p">(</span><span class="n">rounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span></code></pre></figure>

<p>This lets us play the game interactively in the R console, with a typical three round game shown in the screenshot below:</p>

<p><img src="/img/0135-gameplay.png" width="100%" /></p>

<p>As you can see, at the end of the three rounds I’d lost a total of one counter to the computer, playing a more or less ad hoc but sensible strategy of increasing the wager by substantial amounts if I draw a spade, less so for hearts, and minimal or nothing for the minor suits (and comparable strategy for acceptance).</p>

<h2 id="simulating-card-game-results">Simulating card game results</h2>

<p>It was fun to write a computer game in R, but this particular one isn’t really fascinating enough to play thousands of rounds to explore optimal strategy. To do that we want a function that lets a computer play against itself, so I adapt the <code class="language-plaintext highlighter-rouge">persian_monarchs_hvc</code> function to <code class="language-plaintext highlighter-rouge">persian_monarchs_cvc</code> (computer versus computer) as below. We can specify one of the three automated strategies for each player.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#-------------------------computer versus computer-------------------</span><span class="w">
</span><span class="cd">#' Play a computer v computer game of Persian Monarchs</span><span class="w">
</span><span class="cd">#' </span><span class="w">
</span><span class="cd">#' @param c1 number of chips Computer One starts with</span><span class="w">
</span><span class="cd">#' @param c2 number of chips Computer Two starts with</span><span class="w">
</span><span class="cd">#' @param c1_method one of "auto" (best choice given expected value) and "random" (coin flip) for</span><span class="w">
</span><span class="cd">#' deciding whether Computer One offers or accepts an increased wager</span><span class="w">
</span><span class="cd">#' @param c2_method one of "auto" (best choice given expected value) and "random" (coin flip) for</span><span class="w">
</span><span class="cd">#' deciding whether Computer Two offers or accepts an increased wager</span><span class="w">
</span><span class="cd">#' @param number of rounds to play (both players get a turn as dealer in a round, so a round is two hands)</span><span class="w">
</span><span class="cd">#' @param verbose whether or not to print results to the screen</span><span class="w">
</span><span class="n">persian_monarchs_cvc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> 
                                 </span><span class="n">c1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"random"</span><span class="p">,</span><span class="w"> </span><span class="s2">"non-card-counter"</span><span class="p">),</span><span class="w">
                                 </span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"random"</span><span class="p">,</span><span class="w"> </span><span class="s2">"non-card-counter"</span><span class="p">),</span><span class="w"> 
                                 </span><span class="n">rounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">){</span><span class="w">
  
  </span><span class="n">c1_method</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">match.arg</span><span class="p">(</span><span class="n">c1_method</span><span class="p">)</span><span class="w">
  </span><span class="n">c2_method</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">match.arg</span><span class="p">(</span><span class="n">c2_method</span><span class="p">)</span><span class="w">
  
  </span><span class="n">start_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_frame</span><span class="p">(</span><span class="w">
    </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">52</span><span class="p">,</span><span class="w">
    </span><span class="n">suit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"clubs"</span><span class="p">,</span><span class="w"> </span><span class="s2">"diamonds"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hearts"</span><span class="p">,</span><span class="w"> </span><span class="s2">"spades"</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">13</span><span class="p">),</span><span class="w">
    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="s2">"Jack"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Queen"</span><span class="p">,</span><span class="w"> </span><span class="s2">"King"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ace"</span><span class="p">),</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="s2">"of"</span><span class="p">,</span><span class="w"> </span><span class="n">suit</span><span class="p">))</span><span class="w">
  
  </span><span class="n">known_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">start_pack</span><span class="w">
  
  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">rounds</span><span class="p">){</span><span class="w">
    
    </span><span class="c1"># c2 deals:</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">){</span><span class="n">message</span><span class="p">(</span><span class="s2">"Computer Two's deal."</span><span class="p">)}</span><span class="w">
    </span><span class="n">cp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm_hand</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="w">
                  </span><span class="n">c2</span><span class="p">,</span><span class="w">
                  </span><span class="n">known_pack</span><span class="p">,</span><span class="w">
                  </span><span class="n">p1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c1_method</span><span class="p">,</span><span class="w">
                  </span><span class="n">p2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2_method</span><span class="p">,</span><span class="w">
                  </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verbose</span><span class="p">,</span><span class="w">
                  </span><span class="n">p1_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Computer One"</span><span class="p">,</span><span class="w">
                  </span><span class="n">p2_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Computer Two"</span><span class="p">)</span><span class="w">
    </span><span class="n">c1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">p1_counters</span><span class="w">
    </span><span class="n">c2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">p2_counters</span><span class="w">
    </span><span class="n">known_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">known_pack</span><span class="w">
    
    </span><span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">){</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Computer One has "</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="s2">" counters.\n"</span><span class="p">))</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"There are "</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">known_pack</span><span class="p">),</span><span class="w"> </span><span class="s2">" cards left in the pack.\n"</span><span class="p">))</span><span class="w">
    </span><span class="p">}</span><span class="w">    
    </span><span class="c1"># c1 deals:</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">){</span><span class="w">
      </span><span class="n">message</span><span class="p">(</span><span class="s2">"Computer One's deal."</span><span class="p">)</span><span class="w">      
    </span><span class="p">}</span><span class="w">
    

    </span><span class="n">cp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pm_hand</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="w">
                  </span><span class="n">c1</span><span class="p">,</span><span class="w">
                  </span><span class="n">known_pack</span><span class="p">,</span><span class="w">
                  </span><span class="n">p1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2_method</span><span class="p">,</span><span class="w">
                  </span><span class="n">p2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c1_method</span><span class="p">,</span><span class="w">
                  </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verbose</span><span class="p">,</span><span class="w">
                  </span><span class="n">p1_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Computer Two"</span><span class="p">,</span><span class="w">
                  </span><span class="n">p2_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Computer One"</span><span class="p">)</span><span class="w">
    
    </span><span class="n">c1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">p2_counters</span><span class="w">
    </span><span class="n">c2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">p1_counters</span><span class="w">
    </span><span class="n">known_pack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cp</span><span class="o">$</span><span class="n">known_pack</span><span class="w">
  
    </span><span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">){</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Computer One has "</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="s2">" counters.\n"</span><span class="p">))</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"There are "</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">known_pack</span><span class="p">),</span><span class="w"> </span><span class="s2">" cards left in the pack.\n"</span><span class="p">))</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">data_frame</span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># examples:</span><span class="w">
</span><span class="n">persian_monarchs_cvc</span><span class="p">(</span><span class="n">rounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">persian_monarchs_cvc</span><span class="p">(</span><span class="n">rounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">26</span><span class="p">,</span><span class="w"> </span><span class="n">c1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">persian_monarchs_cvc</span><span class="p">(</span><span class="n">rounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">26</span><span class="p">,</span><span class="w"> </span><span class="n">c1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"random"</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span></code></pre></figure>

<p>Now that we have this function, it’s a simple matter of playing many thousands of games between computer opponents with differing strategies.  This sort of thing usually needs parallel processing (ie running simulations on as many processors as are available at once, rather than just one at a time) to happen in a reasonable period of time. These days, R has plenty of packages to enable this, even on Windows.</p>

<p>The code below does the simulations (and modelling and presentation of results) of what I’ve called the “optimal” strategy versus an identical strategy, a “no card counting” alternative, and making wager decisions at random.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#--------------------multiple simulations using parallel processing--------------------</span><span class="w">
</span><span class="c1"># cluster with seven processors:</span><span class="w">
</span><span class="n">cl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">makeCluster</span><span class="p">(</span><span class="m">7</span><span class="p">)</span><span class="w">

</span><span class="c1"># load the functionality we need onto the cluster:</span><span class="w">
</span><span class="n">clusterEvalQ</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)})</span><span class="w">
</span><span class="n">clusterExport</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"persian_monarchs_cvc"</span><span class="p">,</span><span class="w"> </span><span class="s2">"full_pack"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pack"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pm_hand"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pm_draw"</span><span class="p">))</span><span class="w">

</span><span class="c1"># number of simulations to do in each run. Takes about 90 seconds per run to do 10,000.</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">

</span><span class="c1"># Run 1 - with both players using the optimal strategy</span><span class="w">
</span><span class="n">results_auto</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parLapply</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
  </span><span class="n">persian_monarchs_cvc</span><span class="p">(</span><span class="n">rounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">26</span><span class="p">,</span><span class="w"> </span><span class="n">c1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="n">results_auto_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="s2">"rbind"</span><span class="p">,</span><span class="w"> </span><span class="n">results_auto</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Best strategy"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Run 2 - computer two plays ok but without counting cards left in the pack</span><span class="w">
</span><span class="n">results_ncc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parLapply</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
  </span><span class="n">persian_monarchs_cvc</span><span class="p">(</span><span class="n">rounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">26</span><span class="p">,</span><span class="w"> </span><span class="n">c1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"non-card-counter"</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="n">results_ncc_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="s2">"rbind"</span><span class="p">,</span><span class="w"> </span><span class="n">results_ncc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"OK strategy but no card counting"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Run 3 - computer two makes and accepts bets at random</span><span class="w">
</span><span class="n">results_random</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parLapply</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
  </span><span class="n">persian_monarchs_cvc</span><span class="p">(</span><span class="n">rounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">26</span><span class="p">,</span><span class="w"> </span><span class="n">c1_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"random"</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="n">results_random_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="s2">"rbind"</span><span class="p">,</span><span class="w"> </span><span class="n">results_random</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Random"</span><span class="p">)</span><span class="w">

</span><span class="n">stopCluster</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span><span class="w">

</span><span class="n">results_combined</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">results_auto_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rbind</span><span class="p">(</span><span class="n">results_random_df</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rbind</span><span class="p">(</span><span class="n">results_ncc_df</span><span class="p">)</span><span class="w">

</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">results_combined</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">c2_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">c2_method</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2_method</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2_method</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_density</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1">#facet_wrap(~c2_method) +</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Wagering decisions:"</span><span class="p">,</span><span class="w">
       </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Counters left at end of game"</span><span class="p">,</span><span class="w">
       </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Wagering decisions:"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"Density of results from"</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">big.mark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">","</span><span class="p">),</span><span class="w"> </span><span class="s2">"simulations"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Results of two automated wagering strategies for Persian Monarchs"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"Counters left (having started with 100) after 26 rounds (two full packs) against a\nsound strategy"</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">

</span><span class="n">mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">c2</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">c2_method</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results_combined</span><span class="p">)</span><span class="w">
</span><span class="n">confint</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span></code></pre></figure>

<h3 id="reflection">Reflection</h3>

<p>Astute readers will have noticed that the strategy I’ve sometimes called “optimal” is anything but. In fact, I’ve assumed away the chance of learning anything from the opponent’s own behaviour, whether a priori (for instance the reasonable assumption that they are more likely to accept or offer increased wagers with better cards) or after observing them for many rounds. So if we were seeking to create a Persian Monarchs master computer player, the algorithms above would be a sort of starting base case, to which we would need to add the ability to learn all sorts of tactics and strategies such as reading the opponent’s tendencies, swapping strategies oneself to confuse the opponent, bluffs and counter bluffs.</p>

<p>But that’s enough for now. In 2019 I’ll be extending this idea to some reflections on variants of Snakes and Ladders, and then to a classic 1970s text-based computer game that’s the granddaddy of <em>Civilization</em> and its turn-based strategic world-building ilk.</p>



		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2018/12/01/number-births">Number of births in the twentieth century</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2019/01/26/world-agreeing">What the world agrees with</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="https://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="https://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics https://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>