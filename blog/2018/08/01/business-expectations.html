      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Business confidence and economic growth</title>
      	
         
         
            <meta name ="description" content ="I have a brief look at the relationship between reported business confidence in New Zealand and what actually happens down the track with economic growth.  Confidence can help (a bit) explain future growth; but current and past growth isn't helpful in explaining confidence.">
            <meta property="og:description" content ="I have a brief look at the relationship between reported business confidence in New Zealand and what actually happens down the track with economic growth.  Confidence can help (a bit) explain future growth; but current and past growth isn't helpful in explaining confidence.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Business confidence and economic growth" />
         
            <meta property="og:image" content="http://freerangestats.info/img/0127-csp-pm.png" />
         
		 
			<meta property="og:url" content="http://freerangestats.info/blog/2018/08/01/business-expectations.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
				  <li><a href = /blog/2019/12/22/nyc-taxis-sql>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">election forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href = "/elections/oz/index.html">Australia federal 2019</a></li>
				  <li><a href = "/elections/combined.html">NZ 2016</a></li>
                  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Business confidence and economic growth</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I have a brief look at the relationship between reported business confidence in New Zealand and what actually happens down the track with economic growth.  Confidence can help (a bit) explain future growth; but current and past growth isn't helpful in explaining confidence.</p>
	   <p class="meta">01 Aug 2018</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <p>The ANZ bank have a nice bit of publicity for themselves each month in New Zealand with the release of the results of their monthly Business Outlook Survey.  This week it caused a bit of a stir, with the ANZ’s own commentary reporting New Zealand corporate sector is “in a funk” (ANZ’s words) with a net 45 percentage points of businesses pessimistic about the economy (while a net positive 4% were positive about their own activity). This led to some animated discussion on what this measure actually means on Twitter and elsewhere.</p>

<p>I set out to explore the value of business confidence as a measure of what the economy is actually going to do.  The ANZ’s data back to the 1970s are available from <a href="https://tradingeconomics.com/new-zealand/business-confidence">Trading Economics</a>, but for non-subscribers this is only as a graphic, slightly inconvenient for my purposes.  David Hood <a href="https://twitter.com/Thoughtfulnz/status/1024575876552245248">pointed out</a> that the OECD have a monthly business confidence measure for many countries.  The ultimate provenance of the data with regard to New Zealand isn’t clear to me, but it follows a similar pattern to the ANZ (not identical, and on a different scale) and it is publicly available so I thought I would work with that.</p>

<p>All the code for today’s post is at the bottom of the post.</p>

<h2 id="introducing-business-confidence">Introducing “Business Confidence”</h2>

<p>Here’s the business confidence series reported by the OECD as part of its <a href="https://data.oecd.org/leadind/business-confidence-index-bci.htm">leading indicators collection</a>.  Because a crucial part of the controversy is whether business report (and possibly feel) their confidence differently according to their personal political views of the government of the day, I’ve coloured this chart by the party of the Prime Minister for most of the month that the survey relates to.</p>

<p><img src="/img/0127-bc.svg" width="100%" /></p>

<p>Business confidence is usually reported as “percent of optimists minus percent of pessimists”, which in principle is symmetric around zero.  It’s not obvious how the OECD have converted such a measure (if they have) into something centred around 100.</p>

<p>The data go back to the 1960s. The dramatic drop reported by the ANZ in the last week hasn’t yet percolated to the OECD database, if indeed the ANZ are one of the sources for the OECD data.  The OECD data go to June 2018, which is extremely up to date for data of this sort.</p>

<p>The most interesting thing with this graph is probably the historical matter - how confidence used to have a semi-regular and large cycle, but since the 1990s the regularity has gone (as has some of the volatility).  Those big patterns in the first few decades that look like seasonality actually reflect some other cycle, longer than a year; a cycle that no longer seems to apply with such regularity.  There were indeed dramatic changes in the economy, and in government-business relations, in the 1980s and 1990s that could explain this.  But I’d also want to check out on how the survey is delivered, and particularly how things are converted to this index, before drawing much from that.</p>

<p>There’s a small component of seasonal regularity, changing over time, which we can see in this LOESS-based seasonal decomposition:</p>

<p><img src="/img/0127-bc-stl.svg" width="100%" /></p>

<p>In the analysis later on, I made a seasonally adjusted version of confidence, and took the mean value over a quarter as the quarterly value.</p>

<h2 id="economic-growth">Economic growth</h2>

<p>I decided the quarterly chain-volume (ie adjusted for price differences) GDP production measure would be a good one to compare to confidence levels.  I manually downloaded this as a CSV from Stats NZ’s <a href="http://archive.stats.govt.nz/infoshare/?url=/infoshare/">Infoshare tool</a>. The published data naturally shows very strong non-stationarity (ie growth, with increasing population and productivity) and much stronger seasonality:</p>

<p><img src="/img/0127-gdp-stl.svg" width="100%" /></p>

<p>Seasonality in the national accounts is driven by many things, with tourism a particularly big contributor in New Zealand.</p>

<p>I used the same methods (X13-SEATS-ARIMA, via Christoph Sax’s <code class="highlighter-rouge">seasonal</code> R package - with defaults such as adjusting for Easter moving from quarter to quarter) to seasonally adjust these quarterly GDP totals as for business confidence.  Then I used the seasonally adjusted totals as the basis for growth quarter-to-quarter:</p>

<p><img src="/img/0127-growth-line.svg" width="100%" /></p>

<p>Note that these percentage rates are just from one quarter to the next, not the annualised growth rates that get most attention in policy discussions.</p>

<p>Stats NZ publish this series only back to 1987.</p>

<h2 id="combining-the-two">Combining the two</h2>

<p>The hope/expectation of business confidence as a leading indicator is that it tells us something about future GDP.  If we look at the relationship between business confidence and GDP 1, 2, 3 and 4 quarters ahead, we see that there is indeed a positive statistical relationship between the two:</p>

<p><img src="/img/0127-csp.svg" width="100%" /></p>

<p>Connected scatter plots like those above are probably the best exploratory tool for this sort of bivariate time series, but they’re too ugly for lots of communication purposes.  But in this case, we can see that generally, when business confidence is higher, then economic growth in the current period and the next four periods forward (with gradually weakening relations) is likely to be higher too.  However, there’s a <em>lot</em> of noise in the relationship; check out for example the top left quadrant of any of the facets comparing business confidence (at various lags) with GDP, which show when business confidence was low, but economic growth ended up being high.</p>

<p>It’s worth noting that a fair chunk of the noise seems to come from the older data (darker in the image above).</p>

<p>As a reference point, I’ve included the lagged value of quarterly growth itself.  Later on, I’ll be looking to see if business confidence helps us predict GDP more than just knowing the historical values of growth does, so this is the right thing to compare it to.  The relationship between growth and its own lagged value is stronger than between growth and business confidence, as seen visually in the connected scatter plots above but also in simple correlations:</p>

<p><img src="/img/0127-cors.svg" width="100%" /></p>

<p>How does it look when we consider periods with a Labour Prime Minister separately from with one from the Nationals (the only two parties to provide Prime Ministers in the time considered)?  Visually, it looks like the relationship between business confidence and subsequent economic growth figures is stronger when the Nationals (centre-right on the political spectrum and associated with being pro-business) are in power or leading a coalition rather than Labour (centre-left):</p>

<p><img src="/img/0127-csp-pm.svg" width="100%" /></p>

<p>This fits with a convenient narrative of business owners erring on the side of pessimism when Labour are in power but being more rational in their expectations with a National government.  However, the statistical modelling discussed in the next section didn’t find significant evidence of this or other party effects (on growth, on confidence, or on the relationship between growth and confidence).  So we leave this one as a non-conclusion.</p>

<h2 id="modelling-growth-on-confidence-and-politics">Modelling growth on confidence (and politics)</h2>

<p>I fit three different models to the data exploring how best to explain future economic growth.  These were:</p>

<ul>
  <li><code class="highlighter-rouge">model_simp</code> - treat it as a univariate time series problem, and only use past values of economic growth to explain the future</li>
  <li><code class="highlighter-rouge">model_apol</code> - an apolitical model which adds lagged business confidence (at 1, 2, 3 and 4 quarter lags) as explanatory variables but does not take into account who was in political power</li>
  <li><code class="highlighter-rouge">model_full</code> - which adds a dummy indicator for periods with a Labour Prime Minister, and also an interaction of that indicator with the first quarter lag of business confidence</li>
</ul>

<p>All the models were fit with <code class="highlighter-rouge">auto.arima</code> from Rob Hyndman’s <code class="highlighter-rouge">forecast</code> R package, which uses a well-tested algorithm to choose the best time series approach (combination of moving average randomness and lagged values of the response variable) for the response variable itself, in this case quarterly growth in seasonally adjusted real GDP.</p>

<p>Time series data is not worth as much, data point for data point, as is data that is sampled independently of a correlating dimension such as time.  The modelling in this section takes this into account (unlike far too much applied statistical/econometric work), and this adds some much-needed conservatism to the inference process.  Graphics such as those shown above are likely to lead to hasty conclusions if they are interpreted as though the data are all independently selected and equally valuable, rather than containing a lot of redundant information from the correlation over time.</p>

<p>The <code class="highlighter-rouge">model_apol</code> was the strongest of the three (with the lowest <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">AIC</a>). This was counter to my expectation that the simple univariate model would win.  This is a vote of confidence for business confidence measures having <em>something</em> to add to understanding of future economic growth.  This exercise doesn’t compare them to other leading indicators (such as commodity and currency prices, to pick two of the most available and pertinent measures, particularly for an export-oriented economy like New Zealand with very large dairy and tourism industries), and it’s quite possible that business confidence is picking up signals from those other measures.  But it certainly is picking up something that is of value.</p>

<p>An increase in business confidence of 1 point on the OECD scale (which would be a bit over one standard deviation of changes in the past decade or so) is estimated to lead to an increase in quarterly economic growth of somewhere between 0.0 and 0.3 percentage points - for example, from real seasonally adjusted quarterly growth of 1.00% to 1.15% (or to anywhere between 1.00% and 1.30%), all else being equal.  So plunges in business confidence are not worth panicking over, but shouldn’t be ignored either.</p>

<h2 id="modelling-confidence-on-growth-and-politics">Modelling confidence on growth (and politics)</h2>

<p>I also tried flipped the problem around.  Can we predict ‘business confidence”, knowing just past values of business confidence, the political party in power, and current and past values of GDP?  Following the same process as above, I came to a slightly surprising conclusion - neither the party in power, nor current and lagged values of GDP growth, not a combination of the two, add materially to a model trying to explain business confidence.  My best model to explain business confidence was a simple univariate time series model.  In other words, the best predictor (of the very limited set of candidates) of business confidence is past business confidence.</p>

<h2 id="code">Code</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">seasonal</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">nzelect</span><span class="p">)</span><span class="w"> </span><span class="c1"># for party colours
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">

</span><span class="c1">#--------------download data that was manually downloaded earlier--------------
</span><span class="n">download.file</span><span class="p">(</span><span class="s2">"https://github.com/ellisp/blog-source/blob/master/_working/DP_LIVE_01082018094138947.csv?raw=true"</span><span class="p">,</span><span class="w">
              </span><span class="n">destfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DP_LIVE_01082018094138947.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">download.file</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/ellisp/blog-source/master/_working/SNE445001_20180801_075329_92.csv"</span><span class="p">,</span><span class="w">
              </span><span class="n">destfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SNE445001_20180801_075329_92.csv"</span><span class="p">)</span><span class="w">


</span><span class="c1">#--------------prep - who was in power?-------------
# Dates taken from https://en.wikipedia.org/wiki/List_of_Prime_Ministers_of_New_Zealand
</span><span class="w">
</span><span class="c1"># a data frame of who was in power for every day over a 70 year period:
</span><span class="n">power</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_frame</span><span class="p">(</span><span class="w">
  </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="w">
    </span><span class="s2">"12/12/1957"</span><span class="p">,</span><span class="w"> </span><span class="s2">"12/12/1960"</span><span class="p">,</span><span class="w"> </span><span class="s2">"8/12/1972"</span><span class="p">,</span><span class="w"> </span><span class="s2">"12/12/1975"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"26/07/1984"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2/11/1990"</span><span class="p">,</span><span class="w"> </span><span class="s2">"5/12/1999"</span><span class="p">,</span><span class="w"> </span><span class="s2">"19/11/2008"</span><span class="p">,</span><span class="w"> </span><span class="s2">"26/10/2017"</span><span class="p">),</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"%d/%m/%Y"</span><span class="p">),</span><span class="w">
  </span><span class="n">pm_party</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">
    </span><span class="s2">"Labour"</span><span class="p">,</span><span class="w"> </span><span class="s2">"National"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Labour"</span><span class="p">,</span><span class="w"> </span><span class="s2">"National"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"Labour"</span><span class="p">,</span><span class="w"> </span><span class="s2">"National"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Labour"</span><span class="p">,</span><span class="w"> </span><span class="s2">"National"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Labour"</span><span class="p">),</span><span class="w">
  </span><span class="c1"># the pm_id identifier is used later in grouping data together to avoid annoying connecting lines
</span><span class="w">  </span><span class="c1"># across the years:
</span><span class="w">  </span><span class="n">pm_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">9</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">right_join</span><span class="p">(</span><span class="w">
    </span><span class="n">data_frame</span><span class="p">(</span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"1957-12-11"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="p">(</span><span class="m">70</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">365</span><span class="p">)),</span><span class="w">
    </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"date"</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">fill</span><span class="p">(</span><span class="n">pm_party</span><span class="p">,</span><span class="w"> </span><span class="n">pm_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">qtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quarter</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="w">
         </span><span class="n">yr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="w">
         </span><span class="n">mon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">month</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="w">

</span><span class="c1"># roll up by month for later use:		 
</span><span class="n">power_m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">mon</span><span class="p">,</span><span class="w"> </span><span class="n">pm_party</span><span class="p">,</span><span class="w"> </span><span class="n">pm_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">mon</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">pm_party</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_party</span><span class="p">[</span><span class="n">freq</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">freq</span><span class="p">)],</span><span class="w">
            </span><span class="n">pm_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_id</span><span class="p">[</span><span class="n">freq</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">freq</span><span class="p">)])</span><span class="w">

</span><span class="c1"># roll up by quarter for later use:
</span><span class="n">power_q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">qtr</span><span class="p">,</span><span class="w"> </span><span class="n">pm_party</span><span class="p">,</span><span class="w"> </span><span class="n">pm_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">qtr</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">pm_party</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_party</span><span class="p">[</span><span class="n">freq</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">freq</span><span class="p">)],</span><span class="w">
            </span><span class="n">pm_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_id</span><span class="p">[</span><span class="n">freq</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">freq</span><span class="p">)])</span><span class="w">




</span><span class="c1">#--------------------Monthly business confidence data----------------------
# See https://data.oecd.org/leadind/business-confidence-index-bci.htm
# Data were downloaded as CSV non-programmatically.
# On a different scale and a bit different in shape (but related) to:
# https://tradingeconomics.com/new-zealand/business-confidence
</span><span class="w">
</span><span class="n">bc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"DP_LIVE_01082018094138947.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">bc</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"LOCATION"</span><span class="w"> </span><span class="c1"># read.csv corrupts the first name on the way in
</span><span class="w">

</span><span class="n">bc_nz</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bc</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">LOCATION</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"NZL"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">TIME</span><span class="p">,</span><span class="w"> </span><span class="s2">"-15"</span><span class="p">),</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"%Y-%m-%d"</span><span class="p">),</span><span class="w">
         </span><span class="n">yr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">Time</span><span class="p">),</span><span class="w">
         </span><span class="n">mon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">month</span><span class="p">(</span><span class="n">Time</span><span class="p">),</span><span class="w">
         </span><span class="n">qtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quarter</span><span class="p">(</span><span class="n">Time</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">INDICATOR</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">SUBJECT</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">MEASURE</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">FREQUENCY</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">as_tibble</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">power_m</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"yr"</span><span class="p">,</span><span class="w"> </span><span class="s2">"mon"</span><span class="p">))</span><span class="w">

</span><span class="n">bc_nz</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Value</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_party</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_id</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_step</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Amplitude-adjusted business confidence index\nlong term average = 100"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: OECD, Business Confidence Index; Wikipedia, Prime Ministers of New Zealand"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Monthly business confidence in New Zealand"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="s2">"Prime Minister's party:"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parties_v</span><span class="p">)</span><span class="w">



</span><span class="c1"># There's a small monthly seasonality present in business confidence
</span><span class="n">bc_ts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ts</span><span class="p">(</span><span class="n">bc_nz</span><span class="o">$</span><span class="n">Value</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1961</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w">

</span><span class="n">par</span><span class="p">(</span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">main_font</span><span class="p">,</span><span class="w"> </span><span class="n">font.main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">stl</span><span class="p">(</span><span class="n">bc_ts</span><span class="p">,</span><span class="w"> </span><span class="n">s.window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Weak and variable seasonality in New Zealand monthly business confidence"</span><span class="p">)</span><span class="w">

</span><span class="n">tsdisplay</span><span class="p">(</span><span class="n">bc_ts</span><span class="p">)</span><span class="w"> </span><span class="c1"># not shown
</span><span class="w">
</span><span class="c1"># seasonally adjusted version of business confidence
</span><span class="n">bc_nz</span><span class="o">$</span><span class="n">bc_sa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">final</span><span class="p">(</span><span class="n">seas</span><span class="p">(</span><span class="n">bc_ts</span><span class="p">))</span><span class="w">


</span><span class="c1">#----------------quarterly GDP-----------------------------
# Total GDP, chain volume, production measure:
</span><span class="n">gdp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"SNE445001_20180801_075329_92.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">skip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">gdp</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"yr_qtr"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gdp_p_cv"</span><span class="p">)</span><span class="w">

</span><span class="n">gdp_q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">qtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substring</span><span class="p">(</span><span class="n">yr_qtr</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w">
         </span><span class="n">yr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substring</span><span class="p">(</span><span class="n">yr_qtr</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w">
         </span><span class="n">yr_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">yr</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">qtr</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.125</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">yr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">yr</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">qtr</span><span class="p">)</span><span class="w">

</span><span class="c1"># Much stronger seasonality in the GDP growth rates than there was in the business confidence:
</span><span class="n">gdp_ts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ts</span><span class="p">(</span><span class="n">gdp_q</span><span class="o">$</span><span class="n">gdp_p_cv</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1987</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">

</span><span class="n">par</span><span class="p">(</span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">main_font</span><span class="p">,</span><span class="w"> </span><span class="n">font.main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">stl</span><span class="p">(</span><span class="n">gdp_ts</span><span class="p">,</span><span class="w"> </span><span class="n">s.window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Strong and consistent seasonality in New Zealand quarterly GDP"</span><span class="p">)</span><span class="w">

</span><span class="n">tsdisplay</span><span class="p">(</span><span class="n">gdp_ts</span><span class="p">)</span><span class="w"> </span><span class="c1"># not shown in blog
</span><span class="w">
</span><span class="c1"># create a seasonally adjusted version of the volume series, which we'll use for growth rates
</span><span class="n">gdp_sa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">final</span><span class="p">(</span><span class="n">seas</span><span class="p">(</span><span class="n">gdp_ts</span><span class="p">))</span><span class="w">
</span><span class="n">gdp_q</span><span class="o">$</span><span class="n">gdp_sa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp_sa</span><span class="w">

</span><span class="c1"># note that this next method only works because it isn't a tibble.  Viva la base.
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">gdp_q</span><span class="p">)</span><span class="w">

</span><span class="n">gdp_q</span><span class="o">$</span><span class="n">growth</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">gdp_q</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="s2">"gdp_sa"</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">gdp_q</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="s2">"gdp_sa"</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="c1"># remove the first row, which is NA for growth (no comparison possible):
</span><span class="n">gdp_q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp_q</span><span class="p">[</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1"># make a time series out of it for use later:
</span><span class="n">growth_ts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ts</span><span class="p">(</span><span class="n">gdp_q</span><span class="o">$</span><span class="n">growth</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1987</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">

</span><span class="c1"># add a lagged growth series for some graphic comparisons:
</span><span class="n">gdp_q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp_q</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">growth_lag1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">growth</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">()]))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">yr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">yr</span><span class="p">),</span><span class="w"> </span><span class="n">qtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">qtr</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">power_q</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"yr"</span><span class="p">,</span><span class="w"> </span><span class="s2">"qtr"</span><span class="p">))</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gdp_q</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yr_num</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">growth</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_party</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_id</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Quarterly growth in seasonally adjusted GDP\n(Compares each quarter to the previous; not annualised)"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: Stats NZ, chain volume GDP, production measure"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="s2">"Prime Minister's party:"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parties_v</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Growth rates in New Zealand GDP over time"</span><span class="p">)</span><span class="w"> 


</span><span class="c1">#--------------combining the two series-------------
# First we need to make a quarterly version of the monthly business confidence data
</span><span class="n">bc_q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bc_nz</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span><span class="w"> </span><span class="n">qtr</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">bc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">bc_sa</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">bc_lag1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">bc</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">()]),</span><span class="w">
         </span><span class="n">bc_lag2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">bc_lag1</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">()]),</span><span class="w">
         </span><span class="n">bc_lag3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">bc_lag2</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">()]),</span><span class="w">
         </span><span class="n">bc_lag4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">bc_lag3</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">()]))</span><span class="w">

</span><span class="c1"># then we merge this with the quarterly GDP:
</span><span class="n">comb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gdp_q</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">inner_join</span><span class="p">(</span><span class="n">bc_q</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"yr"</span><span class="p">,</span><span class="w"> </span><span class="s2">"qtr"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">as_tibble</span><span class="p">()</span><span class="w">

</span><span class="c1"># Draw a connected scatter plot:  
</span><span class="n">comb</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">yr_num</span><span class="o">:</span><span class="n">bc_lag4</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">yr_num</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">growth</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">gdp_sa</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">pm_party</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">pm_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">growth</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yr_num</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_viridis</span><span class="p">(</span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free_x"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_path</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Quarterly growth in seasonally adjusted real GDP"</span><span class="p">,</span><span class="w">
       </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Value of business confidence, or lagged business confidence, or lagged quarterly growth"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: OECD (business confidence) and Stats NZ (chain volume GDP, production measure)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Relationship between business confidence and economic growth"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"Business confidence ('bc') is positively correlated with future economic growth,\nbut not as strongly as past values of growth itself."</span><span class="p">)</span><span class="w"> 


</span><span class="c1"># Let's quantify those correlations:
</span><span class="n">cors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">comb</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">growth</span><span class="o">:</span><span class="n">bc_lag4</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">pm_party</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">pm_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">cor</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w">
</span><span class="n">cors</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"correlate"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">row.names</span><span class="p">(</span><span class="n">cors</span><span class="p">)</span><span class="w">

</span><span class="n">cors</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">correlate</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"growth"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">correlate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">correlate</span><span class="p">,</span><span class="w"> </span><span class="n">growth</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">growth</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">correlate</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Correlation coefficient with real quarterly growth in seasonally adjusted GDP"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: OECD (business confidence) and Stats NZ (chain volume GDP, production measure)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Relationship between business confidence and economic growth"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"Business confidence is positively correlated with future economic growth, but not as strongly as is past values of growth itself."</span><span class="p">)</span><span class="w">

</span><span class="c1"># alternative version of the connected scatter plot, this time with political party in power:
</span><span class="n">comb</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">yr_num</span><span class="o">:</span><span class="n">bc_lag4</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">yr_num</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">growth</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">gdp_sa</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">pm_party</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">pm_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">growth</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_path</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_party</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm_id</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">pm_party</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free_x"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Quarterly growth in seasonally adjusted real GDP"</span><span class="p">,</span><span class="w">
       </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Value of business confidence, or lagged business confidence, or lagged quarterly growth"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: OECD (business confidence) and Stats NZ (chain volume GDP, production measure)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Relationship between business confidence and economic growth"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"The relationship between self-reported business confidence and GDP *looks* stronger under National than Labour.
However, the evidence isn't significant of Party of the Prime Minister impacting on either GDP or business confidence"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="s2">"Prime Minister's party:"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parties_v</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w">


</span><span class="c1">#----------------does business confidence help predict growth?------------
# Modelling to see if the lagged business confidence adds anything to a simple univariate time series model of GDP:
</span><span class="n">xreg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">comb</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">labour_ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">pm_party</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Labour"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">bc_lag1</span><span class="o">:</span><span class="n">bc_lag4</span><span class="p">,</span><span class="w"> </span><span class="n">labour_ind</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">bc_lag1_lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labour_ind</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bc_lag1</span><span class="p">)</span><span class="w">

</span><span class="c1"># Full model predicts growth including with Labour PM as a dummy, and interacting with the first level lag:
</span><span class="n">model_full</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">growth_ts</span><span class="p">,</span><span class="w"> </span><span class="n">xreg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xreg</span><span class="p">)</span><span class="w">
</span><span class="c1"># Apolitical model ignores who is PM:
</span><span class="n">model_apol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">growth_ts</span><span class="p">,</span><span class="w"> </span><span class="n">xreg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xreg</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)])</span><span class="w">
</span><span class="c1"># Simple model just treats growth as a univariate time series, says other information has nothing to offer:
</span><span class="n">model_simp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">growth_ts</span><span class="p">)</span><span class="w">

</span><span class="c1"># Business confidence does help.  The best model (lowest AIC) for predicting GDP ignores who is PM, 
# but does included lagged values of business confidence (ie model_apol):
</span><span class="n">AIC</span><span class="p">(</span><span class="n">model_full</span><span class="p">,</span><span class="w"> </span><span class="n">model_apol</span><span class="p">,</span><span class="w"> </span><span class="n">model_simp</span><span class="p">)</span><span class="w">

</span><span class="n">model_apol</span><span class="w">
</span><span class="n">model_full</span><span class="w">


</span><span class="c1"># the estimate of the bc_lag1 coefficient in the model_full is 0.0018.  So an increase in business confidence by 1 on the OECD
# scale would increase forecast quarterly GDP by 0.18 percentage points (eg from 1.00% to 1.18%).  1 is a
# reasonable increase - about 1.1 standard deviations (using last 20 years' variability as a baseline)
# sd(tail(bc_ts, 80))
</span><span class="w">
</span><span class="c1"># blog reports results for model_apol, which has the lowest AIC.
</span><span class="w">
</span><span class="c1">#---------------------can party explain business confidence?-------------------
# On the other hand, it's worth noting that lagged and current values of GDP growth
# do *not* at all appear to be much related to business confidence
</span><span class="n">xreg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">comb</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">labour_ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">pm_party</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Labour"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">growth</span><span class="p">,</span><span class="w"> </span><span class="n">growth_lag1</span><span class="p">,</span><span class="w"> </span><span class="n">labour_ind</span><span class="p">)</span><span class="w">

</span><span class="n">bc_sub_ts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ts</span><span class="p">(</span><span class="n">comb</span><span class="o">$</span><span class="n">bc</span><span class="p">,</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1987</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span><span class="w">

</span><span class="n">model_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">bc_sub_ts</span><span class="p">,</span><span class="w"> </span><span class="n">xreg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xreg</span><span class="p">)</span><span class="w">
</span><span class="n">model_apol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">bc_sub_ts</span><span class="p">,</span><span class="w"> </span><span class="n">xreg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xreg</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="n">model_lab_only</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">bc_sub_ts</span><span class="p">,</span><span class="w"> </span><span class="n">xreg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xreg</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">])</span><span class="w">
</span><span class="n">model_nothing</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">bc_sub_ts</span><span class="p">)</span><span class="w">

</span><span class="n">AIC</span><span class="p">(</span><span class="n">model_all</span><span class="p">,</span><span class="w"> </span><span class="n">model_apol</span><span class="p">,</span><span class="w"> </span><span class="n">model_lab_only</span><span class="p">,</span><span class="w"> </span><span class="n">model_nothing</span><span class="p">)</span><span class="w">  
</span><span class="err">#</span><span class="w"> </span><span class="n">model_nothing</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">lowest</span></code></pre></figure>



		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2018/07/07/twitter-monitor">Setting up RStudio Server, Shiny Server and PostgreSQL</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2018/08/10/leading-indicators">Leading indicators of economic growth</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics
http://Http://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>