      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Time series intervention analysis with fuel prices</title>
      	
         
         
            <meta name ="description" content ="I look into whether the regional fuel tax in Auckland has led to changes in fuel prices in other regions of New Zealand.">
            <meta property="og:description" content ="I look into whether the regional fuel tax in Auckland has led to changes in fuel prices in other regions of New Zealand.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Time series intervention analysis with fuel prices" />
         
            <meta property="og:image" content="http://freerangestats.info/img/0129-auck-minus-rest.png" />
         
		 
			<meta property="og:url" content="http://freerangestats.info/blog/2018/08/14/fuel-prices.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2024/05/05/pop-projections>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Time series intervention analysis with fuel prices</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I look into whether the regional fuel tax in Auckland has led to changes in fuel prices in other regions of New Zealand.</p>
	   <p class="meta">14 Aug 2018</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <p>A couple of months ago <a href="/blog/2018/07/01/petrol-spend">I blogged about consumer spending on vehicle fuel by income</a>.  The impetus for that post was the introduction on 1 July 2018 of an 11.5 cent per litre <a href="https://www.transport.govt.nz/land/regional-fuel-tax/">“regional fuel tax” in Auckland</a>.</p>

<p>One vehement critic of the levy, largely on the grounds of its impact on the poor, has been <a href="https://nzinitiative.org.nz/about-us/our-people/sam-warburton/">Sam Warburton</a> (@Economissive on Twitter) of the New Zealand Initiative.  Since early May 2018 (ie seven weeks before the fuel levy began), Sam has been collecting fuel prices from <a href="http://pricewatch.co.nz">pricewatch.co.nz</a>, and he recently <a href="https://twitter.com/Economissive/status/1028861304306425856">made the data available</a>.</p>

<p>One of the issues of controversy about a levy like this is whether it will lead to “price spreading” - fuel companies absorbing some of the extra tax in Auckland and increasing prices in other regions.  A relatively small number of firms make retail pricing decisions about fuel in New Zealand so it’s plausible that imperfect competition is making this possible. I had a look at the data to see if the intervention of the fuel levy in New Zealand’s biggest city can be seen to impact on fuel pricing in the rest of the country.</p>

<p>To cut to the chase, this graphic exemplifies my approach and results:</p>

<p><img src="/img/0129-auck-minus-rest.svg" width="100%" /></p>

<p>We see that after the spike at the time the tax was introduced, fuel prices in other regions have converged somewhat on Auckland’s prices (particularly when considering the relative change happening before the tax).  The impact of the tax is still clearly felt much more strongly in Auckland than anywhere else (as of course would be expected - the question at issue is whether <em>anywhere</em> else would be impacted at all). More on that later.</p>

<h2 id="the-data">The data</h2>

<p>First, let’s look at the data Sam’s collected.  The Twitter thread linked to above provides an Excel workbook on Dropbox.  There’s a worksheet for each region (which are  defined similarly, but not identically, to New Zealand’s official Regions) as well as one describing the source.  For each region we have data on fuel prices for combinations of Company, Date, fuel type (eg diesel, 91 octane, etc) and Region.  If we plot all the data other than liquid petroleum gas (which has particularly sparse observations), it looks like this:</p>

<p><img src="/img/0129-overview.png" width="100%" /></p>

<p>“Companies” have been sorted in order of increasing average price for that graphic, but fairly crudely (ie not taking into account different mixes of fuel type by Company).</p>

<p>We can see we have more data for 91 octane petrol than the other types.  For the rest of this post I’ll be focusing on just 91 octane.</p>

<p>Here’s the R code to tidy up the data to this point and draw the graphic.  It assumes you’ve manually downloaded the Excel workbook to your working folder (I’m currently working with severely restricted internet, so couldn’t experiment in automating that process.)</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">openxlsx</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">nlme</span><span class="p">)</span><span class="w">

</span><span class="c1"># Import data:</span><span class="w">
</span><span class="n">sn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getSheetNames</span><span class="p">(</span><span class="s2">"fuel price data.xlsx"</span><span class="p">)</span><span class="w">
</span><span class="n">sn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sn</span><span class="p">[</span><span class="n">sn</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Source"</span><span class="p">]</span><span class="w">

</span><span class="n">fuel_orig</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">

</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">sn</span><span class="p">)){</span><span class="w">
  </span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.xlsx</span><span class="p">(</span><span class="s2">"fuel price data.xlsx"</span><span class="p">,</span><span class="w"> </span><span class="n">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sn</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">,</span><span class="w"> 
                   </span><span class="n">detectDates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">na.strings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"NA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"n/a"</span><span class="p">))</span><span class="w">
  </span><span class="n">tmp</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"region"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
  </span><span class="n">fuel_orig</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Combine into a single data frame</span><span class="w">
</span><span class="n">fuel_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="s2">"rbind"</span><span class="p">,</span><span class="w"> </span><span class="n">fuel_orig</span><span class="p">)</span><span class="w">

</span><span class="c1"># some useful extra information:</span><span class="w">
</span><span class="n">south_island</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Canterbury"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Nelson"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Otago"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Southland"</span><span class="p">,</span><span class="w"> </span><span class="s2">"West Coast"</span><span class="p">)</span><span class="w">
</span><span class="n">big_four</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"CALTEX"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Z ENERGY"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BP"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MOBIL"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make long, thin, tidy version:</span><span class="w">
</span><span class="n">fuel_tidy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fuel_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">LPG</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">fueltype</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">Company</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">region</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">region</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">south_island</span><span class="p">,</span><span class="w"> </span><span class="s2">"South"</span><span class="p">,</span><span class="w"> </span><span class="s2">"North"</span><span class="p">),</span><span class="w">
         </span><span class="n">company_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">Company</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">big_four</span><span class="p">,</span><span class="w"> </span><span class="s2">"Big Four"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Smaller"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">island</span><span class="p">))),</span><span class="w">
         </span><span class="n">Company</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fct_reorder</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w">
  
</span><span class="c1"># Overview graphic:</span><span class="w">
</span><span class="n">fuel_tidy</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Company</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">fueltype</span><span class="o">~</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"free_y"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Price per litre at the pump"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dollar</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Date in 2018"</span><span class="p">,</span><span class="w"> 
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: pricewatch.co.nz, collated by @Economissive"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Petrol prices in New Zealand over several months in mid 2018"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">guides</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_legend</span><span class="p">(</span><span class="n">override.aes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">5</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Set1"</span><span class="p">)</span></code></pre></figure>

<h2 id="regional-comparisons-with-auckland">Regional comparisons with Auckland</h2>

<p>I tried a couple of different ways of comparing prices in individual regions with those in Auckland.  I think this graphic is probably the most informative and straightforward:</p>

<p><img src="/img/0129-petrol-comp-auckland.svg" width="100%" /></p>

<p>The grey line in the background of each facet represents Auckland’s price; the shaded blue rectangle is the post-tax period (ie 1 July 2018 and onwards).  The grey shaded area shows the difference between the given region’s price and that of Auckland.</p>

<p>We can see a lot of regional variation here, and an interesting pattern with three (or maybe even all) of the South Island regions experiencing price declines in June then picking up in July. Of course, the 11.5 cent increase in price in Auckland is very obvious in the grey lines and shading.  Later on I’ll be using time series intervention analysis on this data; this is an approach commonly used in evaluating the impact of evaluations.  If we were only after the direct impact, there would be no need to do any statistical tests beyond this graphic above; the big spike in prices hits you between the eyes, and there is no doubt about the discontinuity in Auckland’s prices on 1 July!  The question, of course, is how sustained that impact is, and whether it bled into secondary impacts in other regions.</p>

<p>Here’s a second graphic that tries to visually simplify what’s going on, by calculating a single line of the ratio of prices in each region to those in Auckland.  I think what it gains in visual simplicity (less lines and shading) it loses in clear interpretability.  In particular, it’s not possible to tell from this graphic what changes in the graphic come from changes in Auckland, and which come from changes in the comparison region.  That’s not a deal-breaker for using a graphic like this, but it does strongly suggest we should also include the first one, with the rawer average prices per region plainly shown without transformation, for context.</p>

<p><img src="/img/0129-petrol-perc-auckland.svg" width="100%" /></p>

<p>Note that even after the introduction of the Auckland-specific fuel tax, 91 octane petrol in several regions still costs more than in Auckland.  The regions with prices higher than Auckland in the most recent data in the collection are West Coast, Otago, Nelson, Canterbury and Wellington.</p>

<p>Here’s the R code for those two graphics:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># construct two convenient summaries of the data, different ways of comparing regions to Auckland:</span><span class="w">
</span><span class="n">p91</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fuel_tidy</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">fueltype</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"91"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">island</span><span class="p">,</span><span class="w"> </span><span class="n">Date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> 

</span><span class="n">p91_rel</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p91</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Auckland</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Auckland"</span><span class="p">])</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Auckland"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Wairarapa"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">perc_of_auck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Auckland</span><span class="p">)</span><span class="w">


</span><span class="c1"># Plot showing original price data</span><span class="w">
</span><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># annoying trick necessary here to draw a semi-transparent background rectangle: </span><span class="w">
 </span><span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="s2">"hello world"</span><span class="p">),</span><span class="w"> 
            </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2018-07-01"</span><span class="p">),</span><span class="w"> </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="c1"># now draw the actual data:</span><span class="w">
  </span><span class="n">geom_ribbon</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p91_rel</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Auckland</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p91_rel</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Auckland</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey50"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p91_rel</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">island</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Price of 91 octane petrol compared to in Auckland\n"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dollar</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2018; grey line shows Auckland"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: pricewatch.co.nz, collated by @Economissive"</span><span class="p">)</span><span class="w">


</span><span class="c1"># ratio of Auckland prices to others</span><span class="w">
</span><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey50"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="s2">"hello world"</span><span class="p">),</span><span class="w"> 
            </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2018-07-01"</span><span class="p">),</span><span class="w"> </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p91_rel</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">perc_of_auck</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">island</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Price of 91 octane petrol as a percentage of in Auckland\n"</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2018"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: pricewatch.co.nz, collated by @Economissive"</span><span class="p">)</span></code></pre></figure>

<h2 id="modelling-the-impact-of-an-intervention-over-time">Modelling the impact of an intervention over time</h2>

<p>When it came to directly addressing our question of interest regarding price spreading, I opted to group all non-Auckland regions together and compare average prices there with those in Auckland.  There are better ways of modelling this that make full use of the granular data available (mostly involving mixed effects models, and more complex ways of representing the trend over time than linearly; and they would certainly take into account weighting from the spread in population over regions) but they come with big costs in complexity that I don’t have time for right now.  Plus, the difference-of-averages method struck me as the easiest way to interpret and communicate, not to mention think about, the question of whether prices were converging back towards eachother after the initial shock of the addition of the tax.  This leads me to the graphic I showed earlier in this post:</p>

<p><img src="/img/0129-auck-minus-rest.svg" width="100%" /></p>

<p>The linear regression lines shown in that graphic are a simplified version of the formal statistical model we want to fit and use to test our hypothesis.  We’re looking for evidence that the slope of the post-tax line is materially less than the slope of the pre-tax line; in other words, is the gap in pricing between Auckland and other regions declining after the initial 11.5 cent shock of the tax.</p>

<p>I defined this as a simple linear model, but fit it using generalized least squares with time series residuals (auto-regressive moving average of order (1, 1)).  This is straightforward to specify and fit using the <code class="language-plaintext highlighter-rouge">gls</code> function in Pinheiro, Bates et al’s <code class="language-plaintext highlighter-rouge">nlme</code> package, but there are other ways of doing it too.</p>

<p>This results in the following:</p>

<table style="text-align:center"><tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td><em>Dependent variable:</em></td></tr>
<tr><td></td><td colspan="1" style="border-bottom: 1px solid black"></td></tr>
<tr><td style="text-align:left"></td><td>value</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Date</td><td>0.001<sup>**</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.0003)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">post_tax</td><td>19.159<sup>**</sup></td></tr>
<tr><td style="text-align:left"></td><td>(7.804)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">Date:post_tax</td><td>-0.001<sup>**</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.0004)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td style="text-align:left">Constant</td><td>-10.470<sup>**</sup></td></tr>
<tr><td style="text-align:left"></td><td>(4.946)</td></tr>
<tr><td style="text-align:left"></td><td></td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Observations</td><td>93</td></tr>
<tr><td style="text-align:left">Log Likelihood</td><td>330.591</td></tr>
<tr><td style="text-align:left">Akaike Inf. Crit.</td><td>-647.182</td></tr>
<tr><td style="text-align:left">Bayesian Inf. Crit.</td><td>-629.761</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"><em>Note:</em></td><td style="text-align:right"><sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01</td></tr>
</table>

<p>…which simply confirms what is visually obvious, that there is indeed statistically significant evidence of the slope changing direction downwards after the tax is introduced.  In other words, we do have evidence consistent with some degree of “spreading” taking place.  After the initial clean shock of the introduction of the tax, prices in Auckland and in the rest of the country are indeed converging somewhat; although nowhere near as much as the full cost of the tax.</p>

<p>This effect holds whether I use all of New Zealand as the comparison point or just the South Island (which has less competition in fuel retailers) or just the North Island, although in the latter case the effect is not as strong (as can be seen in the graphic).  It also doesn’t seem to matter whether we use all available prices, or just those of the “big four” companies that are present in all regions.</p>

<p>We can’t say for sure the effect comes from introducing the tax from just looking at the numbers.  Drawing that conclusion would require carefully considering any other possible causality options.  For example, one driver of the pattern we’re seeing is clearly that prices in Canterbury, Nelson and Otago stopped declining and started rising slightly in July.  What are other plausible causes of that pattern? Understanding and considering such alternative theories would need more knowledge of the fuel market in New Zealand than I have, so I’ll leave it to others to debate that.  All I can safely conclude is what I wrote above:</p>

<blockquote>
  <p>after the spike caused by the tax, fuel prices in Auckland and in the rest of the country are converging somewhat (although much less than the full cost of the tax), and plausibly this is because of companies’ price adjustments down in Auckland and up elsewhere to spread the cost of the tax over a broader base.</p>
</blockquote>

<p>Here’s the code for that final graphic and statistical modelling;</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Data on the difference between Auckland's average price and those in other areas:</span><span class="w">
</span><span class="n">diff_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fuel_tidy</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">fueltype</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"91"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">company_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Big Four"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">auck_v_rest</span><span class="w"> </span><span class="o">=</span><span class="w"> 
              </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Auckland"</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> 
              </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">region</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Auckland"</span><span class="p">]),</span><span class="w">
            </span><span class="n">auck_v_si</span><span class="w"> </span><span class="o">=</span><span class="w"> 
              </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Auckland"</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> 
              </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">island</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"South"</span><span class="p">]),</span><span class="w">
            </span><span class="n">auck_v_ni</span><span class="w"> </span><span class="o">=</span><span class="w"> 
              </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Auckland"</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> 
              </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">island</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"North"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Auckland"</span><span class="p">]),</span><span class="w">
            </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">post_tax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">Date</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2018-07-01"</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">comparison</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">post_tax</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">comparison</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w">
         </span><span class="n">comparison</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"auck_v_si"</span><span class="w">   </span><span class="o">~</span><span class="w"> </span><span class="s2">"Compared to South Island"</span><span class="p">,</span><span class="w">
         </span><span class="n">comparison</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"auck_v_ni"</span><span class="w">   </span><span class="o">~</span><span class="w"> </span><span class="s2">"Compared to rest of North island"</span><span class="p">,</span><span class="w">
         </span><span class="n">comparison</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"auck_v_rest"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"Compared to all NZ except Auckland"</span><span class="p">))</span><span class="w">


</span><span class="c1"># Graphic:</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">diff_data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">comparison</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post_tax</span><span class="p">),</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="s2">"Average price of 91 octane petrol in Auckland\nminus average price in comparison area"</span><span class="p">,</span><span class="w">
                     </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dollar</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Date in 2018\nAverage prices have not been weighted by population or sales"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Source: pricewatch.co.nz, collated by @Economissive"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Fuel prices in Auckland compared to three other comparison areas"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"Restricted to prices from BP, Caltex, Mobil and Z Energy"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Modelling:</span><span class="w">
</span><span class="c1"># first, make a convenient subset of the data (useful later in various tests and diagnostics):</span><span class="w">
</span><span class="n">D</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">diff_data</span><span class="p">,</span><span class="w"> </span><span class="n">comparison</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Compared to all NZ except Auckland"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Fit model, taking care to specify time series residuals, which aren't as useful for inference</span><span class="w">
</span><span class="c1"># as i.i.d. residuals and hence lead to more conservative inference:</span><span class="w">
</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gls</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">post_tax</span><span class="p">,</span><span class="w"> 
            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">diff_data</span><span class="p">,</span><span class="w"> </span><span class="n">comparison</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Compared to all NZ except Auckland"</span><span class="p">),</span><span class="w">
            </span><span class="n">cor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corARMA</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="c1"># print-friendly summary of coefficieints</span><span class="w">
</span><span class="n">stargazer</span><span class="o">::</span><span class="n">stargazer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"html"</span><span class="p">)</span><span class="w">

</span><span class="c1"># more comprehensive summary (not shown in blog):</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w">  </span></code></pre></figure>

<h2 id="observations-per-region">Observations per region</h2>

<p>A topic of interest in fuel pricing debate in New Zealand is the number of companies present in each region, with a particular focus on the presence of Gull.  In case of interest, here are the observations in the pricewatch data collected by Sam Warburton:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">region</th>
      <th style="text-align: right">-</th>
      <th style="text-align: right">ALTERNATE FUEL</th>
      <th style="text-align: right">GULL</th>
      <th style="text-align: right">CHALLENGE</th>
      <th style="text-align: right">CALTEX</th>
      <th style="text-align: right">MOBIL</th>
      <th style="text-align: right">Z ENERGY</th>
      <th style="text-align: right">GAS ALLEY</th>
      <th style="text-align: right">BP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Auckland</td>
      <td style="text-align: right">206</td>
      <td style="text-align: right">143</td>
      <td style="text-align: right">349</td>
      <td style="text-align: right">251</td>
      <td style="text-align: right">279</td>
      <td style="text-align: right">372</td>
      <td style="text-align: right">279</td>
      <td style="text-align: right">279</td>
      <td style="text-align: right">372</td>
    </tr>
    <tr>
      <td style="text-align: left">Bay of Plenty</td>
      <td style="text-align: right">262</td>
      <td style="text-align: right">200</td>
      <td style="text-align: right">295</td>
      <td style="text-align: right">202</td>
      <td style="text-align: right">278</td>
      <td style="text-align: right">264</td>
      <td style="text-align: right">279</td>
      <td style="text-align: right">161</td>
      <td style="text-align: right">370</td>
    </tr>
    <tr>
      <td style="text-align: left">Coromandel</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">249</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">209</td>
      <td style="text-align: right">219</td>
      <td style="text-align: right">233</td>
      <td style="text-align: right">69</td>
      <td style="text-align: right">277</td>
    </tr>
    <tr>
      <td style="text-align: left">Waikato</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">228</td>
      <td style="text-align: right">227</td>
      <td style="text-align: right">276</td>
      <td style="text-align: right">302</td>
      <td style="text-align: right">278</td>
      <td style="text-align: right">220</td>
      <td style="text-align: right">367</td>
    </tr>
    <tr>
      <td style="text-align: left">Hawke’s Bay</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">45</td>
      <td style="text-align: right">217</td>
      <td style="text-align: right">16</td>
      <td style="text-align: right">261</td>
      <td style="text-align: right">228</td>
      <td style="text-align: right">255</td>
      <td style="text-align: right">132</td>
      <td style="text-align: right">345</td>
    </tr>
    <tr>
      <td style="text-align: left">Northland</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">205</td>
      <td style="text-align: right">52</td>
      <td style="text-align: right">274</td>
      <td style="text-align: right">229</td>
      <td style="text-align: right">256</td>
      <td style="text-align: right">268</td>
      <td style="text-align: right">275</td>
    </tr>
    <tr>
      <td style="text-align: left">Manawatū-Whanganui</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">108</td>
      <td style="text-align: right">193</td>
      <td style="text-align: right">120</td>
      <td style="text-align: right">275</td>
      <td style="text-align: right">265</td>
      <td style="text-align: right">277</td>
      <td style="text-align: right">176</td>
      <td style="text-align: right">371</td>
    </tr>
    <tr>
      <td style="text-align: left">Taranaki</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">184</td>
      <td style="text-align: right">178</td>
      <td style="text-align: right">188</td>
      <td style="text-align: right">243</td>
      <td style="text-align: right">88</td>
      <td style="text-align: right">274</td>
      <td style="text-align: right">188</td>
      <td style="text-align: right">301</td>
    </tr>
    <tr>
      <td style="text-align: left">Wellington</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">91</td>
      <td style="text-align: right">78</td>
      <td style="text-align: right">252</td>
      <td style="text-align: right">278</td>
      <td style="text-align: right">277</td>
      <td style="text-align: right">279</td>
      <td style="text-align: right">213</td>
      <td style="text-align: right">372</td>
    </tr>
    <tr>
      <td style="text-align: left">East Coast</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">41</td>
      <td style="text-align: right">71</td>
      <td style="text-align: right">158</td>
      <td style="text-align: right">221</td>
      <td style="text-align: right">122</td>
      <td style="text-align: right">145</td>
      <td style="text-align: right">104</td>
      <td style="text-align: right">211</td>
    </tr>
    <tr>
      <td style="text-align: left">Central Plateau</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">44</td>
      <td style="text-align: right">51</td>
      <td style="text-align: right">159</td>
      <td style="text-align: right">244</td>
      <td style="text-align: right">275</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">295</td>
    </tr>
    <tr>
      <td style="text-align: left">Wairarapa</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">42</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">103</td>
    </tr>
    <tr>
      <td style="text-align: left">Canterbury</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">262</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">279</td>
      <td style="text-align: right">279</td>
      <td style="text-align: right">278</td>
      <td style="text-align: right">279</td>
      <td style="text-align: right">245</td>
      <td style="text-align: right">372</td>
    </tr>
    <tr>
      <td style="text-align: left">Nelson</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">50</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">34</td>
      <td style="text-align: right">216</td>
      <td style="text-align: right">237</td>
      <td style="text-align: right">263</td>
      <td style="text-align: right">163</td>
      <td style="text-align: right">237</td>
    </tr>
    <tr>
      <td style="text-align: left">Otago</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">225</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">226</td>
      <td style="text-align: right">273</td>
      <td style="text-align: right">265</td>
      <td style="text-align: right">277</td>
      <td style="text-align: right">116</td>
      <td style="text-align: right">364</td>
    </tr>
    <tr>
      <td style="text-align: left">Southland</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">114</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">197</td>
      <td style="text-align: right">249</td>
      <td style="text-align: right">195</td>
      <td style="text-align: right">226</td>
      <td style="text-align: right">98</td>
      <td style="text-align: right">245</td>
    </tr>
    <tr>
      <td style="text-align: left">West Coast</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">115</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">227</td>
      <td style="text-align: right">119</td>
      <td style="text-align: right">121</td>
      <td style="text-align: right">115</td>
      <td style="text-align: right">65</td>
      <td style="text-align: right">242</td>
    </tr>
  </tbody>
</table>

<p>That table was generated by:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span><span class="w">
</span><span class="n">fuel_tidy</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">Company</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">spread</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">GULL</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">kable</span></code></pre></figure>



		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2018/08/10/leading-indicators">Leading indicators of economic growth</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2018/08/17/risk-ratios">Relative risk ratios and odds ratios</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics
http://Http://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>