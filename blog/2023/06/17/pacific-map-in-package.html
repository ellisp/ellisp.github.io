      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Simpler drawing of Pacific choropleth maps</title>
      	
         
         
            <meta name ="description" content ="I demonstrate the function I use to make it simpler to draw choropleth maps based on Pacific Island countries' and territories' exclusive economic zones.">
            <meta property="og:description" content ="I demonstrate the function I use to make it simpler to draw choropleth maps based on Pacific Island countries' and territories' exclusive economic zones.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Simpler drawing of Pacific choropleth maps" />
         
            <meta property="og:image" content="http://freerangestats.info/img/0249-hdi-map.png" />
         
		 
			<meta property="og:url" content="http://freerangestats.info/blog/2023/06/17/pacific-map-in-package.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                  <li><a href="/blog/surveys.html">all posts on surveys</a></li> 
				  <li><a href = /blog/2024/05/05/pop-projections>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
				  <li><a href = "/covid-tracking/index.html">Covid-19 in Australia</a></li>
                  <li><a href = "/elections/nz-2020/index.html">NZ election 2020</a></li>
                  <li><a href = "/elections/oz-2019/index.html">Australia federal election 2019</a></li>
				  <li><a href = "/elections/nz-2017/combined.html">NZ election 2017</a></li>
                  <li><a href="/blog/voting.html">all blog posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="jumbotron">
  <div class="container">
	<center><h1>Simpler drawing of Pacific choropleth maps</h1></center>
  </div>
</div>



	<div class = "post-summary">
	<h2>At a glance:</h2>
	   <p>I demonstrate the function I use to make it simpler to draw choropleth maps based on Pacific Island countries' and territories' exclusive economic zones.</p>
	   <p class="meta">17 Jun 2023</p>
	   <hr></hr>
	</div>


<div class="col-md-7">

	<div class="post">
		
	  <h2 id="simple-use-of-the-draw_pac_map-function">Simple use of the <code class="language-plaintext highlighter-rouge">draw_pac_map()</code> function</h2>

<p>Last year <a href="/blog/2022/10/13/pacific-map">I blogged about making a choropleth map of the Pacific</a>, dealing with a few technical details like getting the map centred on the Pacific, using exclusive economic zones (EEZs) to colour things in for good visibility, adding the international dateline, etc.</p>

<p>Soon after that blog post I abstracted that work and added it to the <code class="language-plaintext highlighter-rouge">frs</code> R package, my miscellaneous collection of bits and pieces associated with this Free Range Statistics blog. I reasoned that as I will be in the Pacific for at least a few years I am likely to want to keep drawing these maps, and they might be useful at work too. You can see:</p>
<ul>
  <li><a href="https://github.com/ellisp/frs-r-package/blob/master/pkg/R/draw_pac_map.R">the code for the function itself</a>; and</li>
  <li><a href="https://github.com/ellisp/frs-r-package/blob/master/processing/prep-pac-map.R">preparation of the various data objects called by the function</a>.</li>
</ul>

<p>It’s easy to install with <code class="language-plaintext highlighter-rouge">remotes::install_github("ellisp/frs-r-package/pkg")</code>.</p>

<p>Here’s the minimal demo of the function. By default it will draw all the countries’ EEZs grey:</p>

<p><em>Post continues after R code</em></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">frs</span><span class="p">)</span><span class="w"> </span><span class="c1"># needs to be version 0.8.2 or higher</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">draw_pac_map</span><span class="p">(</span><span class="n">country_label_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code></pre></figure>

<object type="image/svg+xml" data="/img/0249-blank-map.svg" width="90%"><img src="/img/0249-blank-map.png" width="90%" /></object>

<p>For a more realistic use case, here’s a map showing the <a href="https://hdr.undp.org/data-center/human-development-index#/indicies/HDI">Human Development Index</a> or HDI for 2021, for all Pacific countries that have one:</p>

<object type="image/svg+xml" data="/img/0249-hdi-map.svg" width="90%"><img src="/img/0249-blank-map.png" width="90%" /></object>

<p>You can see that the HDI, which is produced by the UNDP, only is calculated for countries that are full UN members; so members of the Realm of New Zealand (Niue, Tokelau and Cook Islands) or French overseas territories (New Caledonia, French Polynesia and Wallis and Futuna) for example aren’t included.</p>

<p>On the other hand, Nauru <em>is</em> a full member of the UN, but it is one of four such countries that lack an HDI score because it is missing data on one of the components - in Nauru’s case, mean years of education. The other countries missing an HDI score for similar reasons are North Korea, Monaco and Somalia.</p>

<p>Here’s the code that downloads that HDI data and draws the map:</p>

<p><em>Post continues after R code</em></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Human Development Index</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ISOcodes</span><span class="p">)</span><span class="w">
</span><span class="n">download.file</span><span class="p">(</span><span class="s2">"https://hdr.undp.org/sites/default/files/2021-22_HDR/HDR21-22_Statistical_Annex_HDI_Table.xlsx"</span><span class="p">,</span><span class="w">
              </span><span class="n">destfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hdi.xlsx"</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"wb"</span><span class="p">)</span><span class="w">

</span><span class="n">hdi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"hdi.xlsx"</span><span class="p">,</span><span class="w"> </span><span class="n">skip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Table 1"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`VERY HIGH HUMAN DEVELOPMENT`</span><span class="p">,</span><span class="w">
         </span><span class="n">hdi2021</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">...3</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">hdi2021</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">hdi2021</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">hdi2021</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">hdi2021</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">ISO_3166_1</span><span class="p">,</span><span class="w"> </span><span class="n">iso3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alpha_3</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Name"</span><span class="p">)</span><span class="w">

</span><span class="c1"># check to see if any failed to match names</span><span class="w">
</span><span class="c1">#View(filter(d, is.na(iso3)))</span><span class="w">

</span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">draw_pac_map</span><span class="p">(</span><span class="n">fill_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hdi</span><span class="p">,</span><span class="w"> </span><span class="n">join_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"iso3"</span><span class="p">,</span><span class="w"> </span><span class="n">fill_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hdi2021"</span><span class="p">,</span><span class="w">
                   </span><span class="n">fill_col_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Human Development\nIndex 2021"</span><span class="p">,</span><span class="w">
                   </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Calibri"</span><span class="p">,</span><span class="w">
                   </span><span class="n">country_label_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_viridis_c</span><span class="p">(</span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"A"</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span></code></pre></figure>

<p>You can see that it’s non trivial to get a good combination of colours that works complete with the country labels. There are options for most of the things you’d want to change in the initial call to <code class="language-plaintext highlighter-rouge">draw_pac_map</code> itself; and because it outputs a <code class="language-plaintext highlighter-rouge">ggplot2</code> object you can modify it by adding scales, labels, themes etc the usual way (as I do in the above by adding <code class="language-plaintext highlighter-rouge">scale_fill_viridis_c()</code> to set the scale of colours to use for the fill aesthetic).</p>

<p>Mental note to self - it would be entirely possible to use the data on SDGs 3, 4.3, 4.4 and 8.5 we have in the Pacific Data Hub to create estimates of HDI for at least some of the territories that the UNDP doesn’t calculate it for. But that’s enough of a job to leave for another time.</p>

<h2 id="combining-with-pacific-data-hub-data-for-an-animation-of-sdgs">Combining with Pacific Data Hub data for an animation of SDGs</h2>

<p>OK, here’s a more complex use case. I wanted to show off the Pacific Data Hub at a presentation last year to attendees of the Pacific Community’s Committee of Representatives of Governments and Administrations - effectively the board of the Pacific Community or SPC, where I work. I decided it would be nice to do this while also showing that there is a lot of work to be done to improve official statistics production in the region. So I opted to use a sequence of maps, pulling data from the Pacific Data Hub for all the Sustainable Development Goal (SDG) indicators that the Pacific had agreed were priorities to measure. I limited it to those that made sense to represent on a one-dimensional choropleth map (e.g. where a single number for each country is a meaningful thing to compare).</p>

<p>So the result was this GIF, which basically becomes eye candy in the background while I talked about the issues:</p>

<p><img src="/img/0249-pac-maps-sdgs.gif" width="100%" /></p>

<p>I’m going to present all the code that does this animation in one chunk rather than try to explain it line by line. Hopefully it makes sense as-is. The key, like any animation, is to save one frame at a time; then I use ImageMagick to knit them all up into an actual animation. You’ll see I opted to not clutter up this particular set of maps with country labels.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#==================animated map===================</span><span class="w">
</span><span class="c1">#-----------------------Get the SDG data and metadata---------------</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rsdmx</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">janitor</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glue</span><span class="p">)</span><span class="w">

</span><span class="n">dataflow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"DF_SDG"</span><span class="w">

</span><span class="c1"># metadata ie code lists. Warning this next function, in frs, is a bit of a hack</span><span class="w">
</span><span class="c1"># and is subject to change!</span><span class="w">
</span><span class="n">d_code_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_pdh_codelists</span><span class="p">(</span><span class="n">dataflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataflow</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"3.0"</span><span class="p">)</span><span class="w">

</span><span class="c1"># data</span><span class="w">
</span><span class="n">d_raw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readSDMX</span><span class="p">(</span><span class="n">providerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PDH"</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w"> </span><span class="n">flowRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataflow</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> 
  </span><span class="n">as_tibble</span><span class="p">()</span><span class="w">

</span><span class="c1"># join the data to the code list so we have labels</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d_raw</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">left_join</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">d_code_list</span><span class="p">,</span><span class="w"> </span><span class="n">category_en</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Codelist for SDG indicators"</span><span class="p">),</span><span class="w">
            </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"INDICATOR"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"id"</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">category_en</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">category_fr</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="n">indicator_full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">clean_names</span><span class="p">()</span><span class="w"> 

</span><span class="c1"># for simplicity, limit ourselves just to indicators that are totals eg all</span><span class="w">
</span><span class="c1"># age groups, not individual age groups, not disaagregated by sex, etc.</span><span class="w">
</span><span class="c1"># this loses a lot of data of course but is ok because it is just for illustration</span><span class="w">
</span><span class="c1"># to coose the indicators most suitable for choropleth matps</span><span class="w">
</span><span class="n">d_totals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="w">
    </span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"_T"</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
      </span><span class="n">age</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"_T"</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
      </span><span class="n">urbanization</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"_T"</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
      </span><span class="n">income</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"_T"</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
      </span><span class="n">education</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"_T"</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
      </span><span class="n">occupation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"_T"</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
      </span><span class="n">composite_breakdown</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"_Z"</span><span class="w">  </span><span class="o">&amp;</span><span class="w">
      </span><span class="n">disability</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"_T"</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">indicator_full</span><span class="p">,</span><span class="w"> </span><span class="n">geo_pict</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">obs_time</span><span class="p">))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w">

</span><span class="n">indicator_summary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d_totals</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">indicator</span><span class="p">,</span><span class="w"> </span><span class="n">indicator_full</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">countries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">geo_pict</span><span class="p">)),</span><span class="w">
            </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">obs_time</span><span class="p">)),</span><span class="w">
            </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">countries</span><span class="p">))</span><span class="w">

</span><span class="c1"># what indicators are we going to use, in a simple vector</span><span class="w">
</span><span class="n">inds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pull</span><span class="p">(</span><span class="n">indicator_summary</span><span class="p">,</span><span class="w"> </span><span class="n">indicator_full</span><span class="p">)</span><span class="w">

</span><span class="c1">#--------------------draw the maps------------------</span><span class="w">

</span><span class="n">dir.create</span><span class="p">(</span><span class="s2">"pac-maps"</span><span class="p">,</span><span class="w"> </span><span class="n">showWarnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">inds</span><span class="p">)){</span><span class="w">
  </span><span class="n">the_ind</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
  </span><span class="n">the_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">d_totals</span><span class="p">,</span><span class="w"> </span><span class="n">indicator_full</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">the_ind</span><span class="p">)</span><span class="w"> 
  
  </span><span class="n">units</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">the_data</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">unit_measure</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">pull</span><span class="p">(</span><span class="n">unit_measure</span><span class="p">)</span><span class="w">
  
  </span><span class="k">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
    </span><span class="n">warning</span><span class="p">(</span><span class="s2">"More than 1 unit measure, choosing the most common"</span><span class="p">)</span><span class="w">
    </span><span class="n">the_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">the_data</span><span class="p">,</span><span class="w"> </span><span class="n">unit_measure</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">units</span><span class="p">[</span><span class="m">1</span><span class="p">])</span><span class="w">
  </span><span class="p">}</span><span class="w">
  
  </span><span class="n">unit_title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stringr</span><span class="o">::</span><span class="n">str_to_title</span><span class="p">(</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"_"</span><span class="p">,</span><span class="w"> </span><span class="s2">" "</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="p">[</span><span class="m">1</span><span class="p">]))</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">str_replace</span><span class="p">(</span><span class="s2">"Usd"</span><span class="p">,</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">str_replace</span><span class="p">(</span><span class="s2">"Ha "</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hectares "</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">str_replace</span><span class="p">(</span><span class="s2">"Ha$"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Hectares"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">str_replace</span><span class="p">(</span><span class="s2">"Bool$"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Yes (1)/No (0)"</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w">
    </span><span class="n">str_replace</span><span class="p">(</span><span class="s2">"Km"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Kilometres"</span><span class="p">)</span><span class="w"> 
  
  </span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">draw_pac_map</span><span class="p">(</span><span class="n">the_data</span><span class="p">,</span><span class="w"> 
                    </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Calibri"</span><span class="p">,</span><span class="w">
                    </span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w">
                    </span><span class="n">country_labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                    </span><span class="n">fill_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"obs_value"</span><span class="p">,</span><span class="w">
                    </span><span class="n">fill_col_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit_title</span><span class="p">,</span><span class="w">
                    </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-40</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_fill_viridis_c</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_ind</span><span class="p">,</span><span class="w">
         </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">the_data</span><span class="o">$</span><span class="n">obs_time</span><span class="p">)),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">", "</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">
  
  </span><span class="n">png</span><span class="p">(</span><span class="n">glue</span><span class="p">(</span><span class="s2">"pac-maps/{i + 1000}-{indicator_summary[i, ]$indicator}.png"</span><span class="p">),</span><span class="w"> </span><span class="m">1500</span><span class="p">,</span><span class="w"> </span><span class="m">900</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">150</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cairo-png"</span><span class="p">)</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">
  </span><span class="n">dev.off</span><span class="p">()</span><span class="w">
  
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Convert all the single frames into a GIF.</span><span class="w">
</span><span class="c1"># Requires ImageMagick to be installed. Can uncomment and run it here or do </span><span class="w">
</span><span class="c1"># it directly in a system / shell window</span><span class="w">
</span><span class="c1"># projdir &lt;- setwd("pac-maps")</span><span class="w">
</span><span class="c1"># system('magick -loop 0 -delay 150 *.png "pac-maps-sdgs.gif"')</span><span class="w">
</span><span class="c1"># setwd(projdir)</span></code></pre></figure>

<p>That’s it! See you next time.</p>


		
	</div>
</div>

<div class="col-md-1"></div>
<div class="col-md-4">
	<div class="side-banner">
	


	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2023/06/04/causality-sims">Simulating confounders, colliders and mediators</a></p>
		
		
		
		
		 
			
			<p>Next post &rarr;</p>
			<p><a rel="next" href="/blog/2023/06/24/weighted-percentiles">Weighted versus unweighted percentiles</a></p>
			
			
		
		
	</div>
	
	 

   <div class = "side-footer">
			
			<hr></hr>
			<p><gcse:search></gcse:search></p>
			<hr></hr>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			<hr></hr>
			
			<p>My day job is Director of the <a href='https://sdd.spc.int/'>Statistics for Development Division</a> at the Pacific Community, the principal scientific and technical organisation in the Pacific region, proudly supporting development since 1947. We are an international development organisation owned and governed by our 27 country and territory members. This blog is not part of my role there and contains my personal views only.</p>
		
		    <hr></hr>
			
       <div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false"></div>
			
			<hr></hr>
			<p>I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>
			<hr></hr>

			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><i>free range statistics</i></span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			<hr></hr>
			


    </div>



  
   




		  
		  



	   
	<div id="disqus_thread"></div>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>

		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES * * */
			var disqus_shortname = 'statsinthewild';
			
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var s = document.createElement('script'); s.async = true;
				s.type = 'text/javascript';
				s.src = '//' + disqus_shortname + '.disqus.com/count.js';
				(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
			}());
		</script>

	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>	
</div>    
   
   

			
			</div><!-- /.container -->
         
   <!-- Default Statcounter code for Free Range Statistics
http://Http://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>   
</html>