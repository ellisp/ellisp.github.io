---
layout: post
title: Jekyll and code highlighting
date: 2016-06-16
tag: 
   - R
description: XXX
image: /img/0044-control-trial.png
socialimage: http://ellisp.github.io/img/0044-control-trial.png
category: R
---

Some test code
{% highlight R lang %} 
library(ggseas)
library(ggthemes)
library(extrafont)

plot(ldeaths)

ggplot(mtcars, aes(x = disp, y = mpg, colour = as.factor(cyl))) +
   geom_point() +
   theme_economist(base_family = "Calibri")

var(mtcars$mpg)   
is.function("ggplot")

x <- NULL
if(TRUE){
	print(3:8 * 5)
}
   
{% endhighlight %}      

On my old system the code generated by Jekyll 2.5, Pygments.rb and pygments looks like this:

{% highlight HTML lang %} 
<div class="highlight"><pre><code class="language-r" data-lang="r"><a name="True-1"></a><span class="kn">library</span><span class="p">(</span>ggseas<span class="p">)</span>
<a name="True-2"></a><span class="kn">library</span><span class="p">(</span>ggthemes<span class="p">)</span>
<a name="True-3"></a><span class="kn">library</span><span class="p">(</span>extrafont<span class="p">)</span>
<a name="True-4"></a>
<a name="True-5"></a>plot<span class="p">(</span>ldeaths<span class="p">)</span>
<a name="True-6"></a>
<a name="True-7"></a>ggplot<span class="p">(</span>mtcars<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> disp<span class="p">,</span> y <span class="o">=</span> mpg<span class="p">,</span> colour <span class="o">=</span> <span class="kp">as.factor</span><span class="p">(</span>cyl<span class="p">)))</span> <span class="o">+</span>
<a name="True-8"></a>   geom_point<span class="p">()</span> <span class="o">+</span>
<a name="True-9"></a>   theme_economist<span class="p">(</span>base_family <span class="o">=</span> <span class="s">&quot;Calibri&quot;</span><span class="p">)</span>
<a name="True-10"></a>
<a name="True-11"></a>var<span class="p">(</span>mtcars<span class="o">$</span>mpg<span class="p">)</span></code></pre></div>
</div>
{% endhighlight %}      

On my new system with Jekyll 3.1 and rouge it looks like this:

{% highlight HTML lang %} 
<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="w"> 
</span><span class="n">library</span><span class="p">(</span><span class="n">ggseas</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">extrafont</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">ldeaths</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">disp</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">cyl</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme_economist</span><span class="p">(</span><span class="n">base_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Calibri"</span><span class="p">)</span><span class="w">

</span><span class="n">var</span><span class="p">(</span><span class="n">mtcars</span><span class="o">$</span><span class="n">mpg</span><span class="p">)</span><span class="w">   
   </span></code></pre></figure>
   {% endhighlight %}      
   
So what's changed?  Without trying to be comprehensive here are some of the changes:

* The whole thing is wrapped in `<figure></figure>` instead of `<div></div>`
* Each line of code now finishes in `<span class="w"></span>`
* The class of the `library` code has changed from "kn" to "n"
* 

Here are some things that are the same

* the class of the `<figure>` or `<div>`
* the `<pre>`
* the brackets and commas are still in a span of class `p`
* the dollar sign in `mtcars$mpg` is still in a span of class `o`

OK, so after wasting many hours on this I found that rouge syntax highlighting for R basically didn't work until a couple of weeks ago.  A fix has been prepared over the last few months at https://github.com/jneen/rouge/pull/383 .  It got implemented

After mysterious Ruby error messages I was helped by Stack Overflow http://stackoverflow.com/questions/23777277/rails-could-not-find-minitest-4-7-5-in-any-of-the-sources and the cryptic but effective advice
On server run gem update bundler and after bundle install.

   fork rouge and clone it to my machine
   uninstall jekyll and rouge
   run rake - builds the gem but doesn't install it
   
http://stackoverflow.com/questions/220176/how-can-i-install-a-local-gem
gem install xxxx-xxxx.gem
   
   that seemed to hang my computer...
   
   Meanwhile, I asked http://stackoverflow.com/questions/37868854/is-rouge-syntax-highlighting-meant-to-highlight-non-base-functions-in-r , pretty sure the answer was that rouge only highlights base functions